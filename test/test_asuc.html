<!DOCTYPE html> <html> <head>         <title>Test d3flux page</title>         <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.2/require.min.js" integrity="sha256-Vjusm6Kh2U7/tb6jBh+MOfxnaf2TWsTph34bMKhC1Qc=" crossorigin="anonymous"></script>         <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>         <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">         </head> <body><div class="container">
  <div class="row row-offcanvas row-offcanvas-right">

      <div class="navbar navbar-static-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">
              <i class="fa fa-comments-o"></i>
              VisMap
            </a>
          </div>
          <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li><a href="/">Home</a></li>
            </ul>
            <ul class="nav navbar-nav">
              <li><a href="/">Document</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="/login">Login</a></li>
            </ul>
          </div>
        </div>
      </div>

    <div class="col-xs-12 col-sm-9">
      <div id="d3flux001">
        
      </div>
    </div>

    <div id="d3flux001_options" class="col-xs-6 col-sm-3 sidebar-offcanvas">
        <div class="btn-group-vertical" role="group" aria-label="btn-group-vertical">
            <button type="button" class="download btn btn-primary ">Save JSON</button>
            <button type="button" class="reactionbutton btn btn-success ">Show Reaction Nodes </button>
            <button type="button" class="svgbutton btn btn-info ">Download SVG</button>
            <button type="button" class="path_button btn btn-warning ">Select Path</button>
            <button type="button" class="marker_button btn btn-warning ">Select Marker</button>
            <button type="button" class="reset_button btn btn-warning ">Reset</button>
            <button type="button" class="test_button btn btn-test ">Alg Test</button>
            <form>
                <input id="info" type="text" value="">
                <button type="button" class="animate_button btn btn-warning ">Downstream Nodes</button>
              </form>
        </div>
      </div><!--/.sidebar-offcanvas-->

    <!-- <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar">
        <div class="list-group">
          <li class="list-group-item active">External Links</li>
          <a href="http://bigg.ucsd.edu/" target="_blank" class="list-group-item">BiGG</a>
          <a href="https://opencobra.github.io/" target="_blank" class="list-group-item">Open Cobra</a>
          <a href="https://d3js.org/" target="_blank" class="list-group-item">D3.js</a>
          <a href="#" class="list-group-item">...</a>
          <a href="#" class="list-group-item">...</a>
          <a href="#" class="list-group-item">...</a>
          <a href="#" class="list-group-item">...</a>
          <a href="#" class="list-group-item">...</a>
          <a href="https://getbootstrap.com/" target="_blank" class="list-group-item">Bootstrap</a>
        </div>
      </div> -->
      <!--.sidebar-offcanvas-->

  </div>
</div>


<script type="text/Javascript">
var d3flux001model = {"metabolites": [{"id": "13dpg_c", "name": "3-Phospho-D-glyceroyl phosphate", "compartment": "c", "charge": -4, "formula": "C3H4O10P2", "notes": {"BRENDA": ["BG18032", "BG87317"], "BioPath": ["1,3-Diphospho-D-glycerate"], "ChEBI": ["16001", "1658", "20189", "57604", "11881"], "HMDB": ["HMDB01270"], "KEGG": "C00236", "MetaCyc": "DPG", "PUBCHEM ID": ["3535"], "Reactome": ["29800"], "SEED": ["cpd00203"], "UPA": ["UPC00236"], "map_info": {"x": 373.043223866228, "display_name": "13DPG", "y": 237.3584107009283, "flux": 11.381363595251807}}}, {"id": "2pg_c", "name": "D-Glycerate 2-phosphate", "compartment": "c", "charge": -3, "formula": "C3H4O7P", "notes": {"BRENDA": ["BG17976", "BG17975"], "BioPath": ["2-Phospho-D-glycerate"], "ChEBI": ["1267", "58289", "17835", "21028", "11651", "12986", "24344", "39868"], "HMDB": ["HMDB03391", "HMDB00362"], "KEGG": "C00631", "MetaCyc": "2-PG", "PUBCHEM ID": ["3904"], "Reactome": ["30485"], "SEED": ["cpd00482"], "UPA": ["UPC00631"], "map_info": {"x": 324.1399811479195, "display_name": "2PG", "y": 361.40399959209265, "flux": 11.03321625992348}}}, {"id": "3pg_c", "name": "3-Phospho-D-glycerate", "compartment": "c", "charge": -3, "formula": "C3H4O7P", "notes": {"BRENDA": ["BG17981", "BG17979"], "BioPath": ["3-Phospho-D-glycerate"], "ChEBI": ["40016", "58272", "57998", "11879", "1657", "1659", "17050", "21029", "11882", "11880", "12987", "17794", "24345"], "HMDB": ["HMDB00807"], "KEGG": "C00197", "MetaCyc": "G3P", "PUBCHEM ID": ["3497"], "Reactome": ["29728"], "SEED": ["cpd00169"], "UPA": ["UPC00597", "UPC00197"], "map_info": {"x": 386.81349679838365, "display_name": "3PG", "y": 307.835730848789, "flux": 11.381363595251807}}}, {"id": "6pgc_c", "name": "6-Phospho-D-gluconate", "compartment": "c", "charge": -3, "formula": "C6H10O10P", "notes": {"BRENDA": ["BG22563"], "BioPath": ["6-Phospho-D-gluconate"], "ChEBI": ["2231", "12232", "48928", "16863", "58759", "40282", "33851"], "HMDB": ["HMDB01316"], "KEGG": "C00345", "MetaCyc": "CPD-2961", "PUBCHEM ID": ["3638"], "Reactome": ["29996"], "SEED": ["cpd00284"], "UPA": ["UPC00345"], "map_info": {"x": 198.1801574871815, "display_name": "6PGC", "y": 8.920309065114125, "flux": 0.0}}}, {"id": "ac_c", "name": "Acetate", "compartment": "c", "charge": -1, "formula": "C2H3O2", "notes": {"BRENDA": ["BG15447"], "BioPath": ["Acetate"], "CAS": ["71-50-1"], "CASID": ["71-50-1"], "ChEBI": ["62947", "62964", "32029", "22165", "3310", "2387", "62984", "63879", "32138", "15366", "13704", "63078", "30089", "40480", "22169", "40486", "59199", "63045", "32954"], "HMDB": ["HMDB00042"], "KEGG": "C00033", "LIPIDMAPS": ["LMFA01010000", "LMFA01010002"], "MetaCyc": "ACET", "PUBCHEM ID": ["3335"], "Reactome": ["113539", "2022890", "29416", "1524044", "390305"], "SEED": ["cpd00029"], "UPA": ["UPC00033"], "map_info": {"x": 282.34262460899663, "display_name": "AC", "y": 648.5447410537606, "flux": 4.3332578312250725}}}, {"id": "ac_e", "name": "Acetate", "compartment": "e", "charge": -1, "formula": "C2H3O2", "notes": {"BRENDA": ["BG15447"], "BioPath": ["Acetate"], "CAS": ["71-50-1"], "CASID": ["71-50-1"], "ChEBI": ["62947", "62964", "32029", "22165", "3310", "2387", "62984", "63879", "32138", "15366", "13704", "63078", "30089", "40480", "22169", "40486", "59199", "63045", "32954"], "HMDB": ["HMDB00042"], "KEGG": "C00033", "LIPIDMAPS": ["LMFA01010000", "LMFA01010002"], "MetaCyc": "ACET", "PUBCHEM ID": ["3335"], "Reactome": ["113539", "2022890", "29416", "1524044", "390305"], "SEED": ["cpd00029"], "UPA": ["UPC00033"], "map_info": {"display_name": "AC", "hidden": true, "flux": 4.3332578312250725}}}, {"id": "acald_c", "name": "Acetaldehyde", "compartment": "c", "charge": 0, "formula": "C2H4O", "notes": {"BRENDA": ["BG89392", "BG15435"], "BioPath": ["Acetaldehyde"], "CAS": ["75-07-0"], "CASID": ["75-07-0"], "ChEBI": ["13703", "2383", "15343", "22158", "40533"], "HMDB": ["HMDB00990"], "KEGG": "C00084", "MetaCyc": "ACETALD", "PUBCHEM ID": ["3384"], "Reactome": ["113532", "29510", "113681", "113745"], "SEED": ["cpd00071"], "UPA": ["UPC00084"], "map_info": {"x": 396.5187869869987, "display_name": "ACALD", "y": 583.8260177198886, "flux": 0.0}}}, {"id": "acald_e", "name": "Acetaldehyde", "compartment": "e", "charge": 0, "formula": "C2H4O", "notes": {"BRENDA": ["BG89392", "BG15435"], "BioPath": ["Acetaldehyde"], "CAS": ["75-07-0"], "CASID": ["75-07-0"], "ChEBI": ["13703", "2383", "15343", "22158", "40533"], "HMDB": ["HMDB00990"], "KEGG": "C00084", "MetaCyc": "ACETALD", "PUBCHEM ID": ["3384"], "Reactome": ["113532", "29510", "113681", "113745"], "SEED": ["cpd00071"], "UPA": ["UPC00084"], "map_info": {"display_name": "ACALD", "hidden": true, "flux": 0.0}}}, {"id": "accoa_c", "name": "Acetyl-CoA", "compartment": "c", "charge": -4, "formula": "C23H34N7O17P3S", "notes": {"BRENDA": ["BG36329"], "BioPath": ["Acetyl-CoA"], "CAS": ["72-89-9"], "CASID": ["72-89-9"], "ChEBI": ["13712", "22192", "40470", "2408", "57288", "15351"], "HMDB": ["HMDB01206"], "KEGG": "C00024", "LIPIDMAPS": ["LMFA07050029", "LMFA07050000"], "MetaCyc": "ACETYL-COA", "PUBCHEM ID": ["3326"], "Reactome": ["113559", "727753", "113560", "353123", "76183"], "SEED": ["cpd00022"], "UPA": ["UPC00024"], "map_info": {"x": 356.5408460563843, "display_name": "ACCOA", "y": 517.5604880189204, "flux": 5.2054413762408345}}}, {"id": "actp_c", "name": "Acetyl phosphate", "compartment": "c", "charge": -2, "formula": "C2H3O5P", "notes": {"BRENDA": ["BG15501"], "BioPath": ["Acetyl_phosphate"], "CAS": ["19926-71-7"], "CASID": ["19926-71-7"], "ChEBI": ["13711", "2407", "22191", "46262", "15350"], "HMDB": ["HMDB01494"], "KEGG": "C00227", "MetaCyc": "ACETYL-P", "PUBCHEM ID": ["3527"], "SEED": ["cpd00196"], "UPA": ["UPC00227"], "map_info": {"x": 319.1394521829853, "display_name": "ACTP", "y": 582.8240702520674, "flux": 4.3332578312250725}}}, {"id": "adp_c", "name": "ADP", "compartment": "c", "charge": -3, "formula": "C10H12N5O10P2", "notes": {"BRENDA": ["BG1228"], "BioPath": ["Adenosine-5-prime-diphosphate"], "CAS": ["58-64-0"], "CASID": ["58-64-0"], "ChEBI": ["13222", "16761", "2342", "22244", "40553", "456216"], "HMDB": ["HMDB01341"], "KEGG": "C00008", "MetaCyc": "ADP", "PUBCHEM ID": ["3310"], "Reactome": ["190072", "481002", "211606", "429160", "29370", "196180", "113581", "113582", "114564", "114565", "429153"], "SEED": ["cpd00008"], "UPA": ["UPC00008"], "map_info": {"display_name": "ADP", "hidden": true, "flux": 25.627033353667112}}}, {"id": "atp_c", "name": "ATP", "compartment": "c", "charge": -4, "formula": "C10H12N5O13P3", "notes": {"BRENDA": ["BG1395"], "BioPath": ["Adenosine-5-prime-triphosphate"], "CAS": ["56-65-5"], "CASID": ["56-65-5"], "ChEBI": ["40938", "15422", "57299", "13236", "10789", "30616", "22249", "10841", "2359"], "HMDB": ["HMDB00538"], "KEGG": "C00002", "MetaCyc": "ATP", "PUBCHEM ID": ["3304"], "Reactome": ["190078", "113592", "113593", "114570", "29358", "389573", "139836", "211579"], "SEED": ["cpd00002"], "UPA": ["UPC00002"], "map_info": {"color": "#ffbb78", "display_name": "ATP", "hidden": true, "flux": 25.627033353667112}}}, {"id": "co2_c", "name": "CO2", "compartment": "c", "charge": 0, "formula": "CO2", "notes": {"BRENDA": ["BG28651"], "BioPath": ["Carbon_dioxide"], "CAS": ["124-38-9"], "CASID": ["124-38-9"], "ChEBI": ["48829", "16526", "13284", "13285", "13282", "13283", "23011", "3283"], "HMDB": ["HMDB01967"], "KEGG": "C00011", "MetaCyc": "CARBON-DIOXIDE", "PUBCHEM ID": ["3313"], "Reactome": ["159751", "159942", "1237009", "29376", "113528", "389536", "189480"], "SEED": ["cpd00011"], "UPA": ["UPC00011"], "map_info": {"x": 457.4357200364724, "color": "#aec7e8", "display_name": "CO2", "y": 516.2417657229903, "hidden": false, "flux": 7.957440958901438}}}, {"id": "co2_e", "name": "CO2", "compartment": "e", "charge": 0, "formula": "CO2", "notes": {"BRENDA": ["BG28651"], "BioPath": ["Carbon_dioxide"], "CAS": ["124-38-9"], "CASID": ["124-38-9"], "ChEBI": ["48829", "16526", "13284", "13285", "13282", "13283", "23011", "3283"], "HMDB": ["HMDB01967"], "KEGG": "C00011", "MetaCyc": "CARBON-DIOXIDE", "PUBCHEM ID": ["3313"], "Reactome": ["159751", "159942", "1237009", "29376", "113528", "389536", "189480"], "SEED": ["cpd00011"], "UPA": ["UPC00011"], "map_info": {"display_name": "CO2", "hidden": true, "flux": 1.9759155858706183}}}, {"id": "coa_c", "name": "Coenzyme A", "compartment": "c", "charge": -4, "formula": "C21H32N7O16P3S", "notes": {"BRENDA": ["BG11741"], "BioPath": ["CoA-SH"], "CAS": ["85-61-0"], "CASID": ["85-61-0"], "ChEBI": ["57287", "13295", "13294", "13298", "41631", "41597", "741566", "15346", "23355", "3771"], "HMDB": ["HMDB01423"], "KEGG": "C00010", "MetaCyc": "CO-A", "PUBCHEM ID": ["3312"], "Reactome": ["76194", "193514", "29374", "2485002", "162743"], "SEED": ["cpd00010"], "UPA": ["UPC00010"], "map_info": {"display_name": "COA", "hidden": true, "flux": 5.2054413762408345}}}, {"id": "dhap_c", "name": "Dihydroxyacetone phosphate", "compartment": "c", "charge": -2, "formula": "C3H5O6P", "notes": {"BRENDA": ["BG89172"], "BioPath": ["2-Glycerone_phosphate"], "CAS": ["57-04-5"], "CASID": ["57-04-5"], "ChEBI": ["14341", "57642", "14342", "16108", "5454", "24355", "39571"], "HMDB": ["HMDB01473", "HMDB11735"], "KEGG": "C00111", "MetaCyc": "DIHYDROXY-ACETONE-PHOSPHATE", "PUBCHEM ID": ["3411"], "Reactome": ["188451", "75970", "390404"], "SEED": ["cpd00095"], "UPA": ["UPC00111"], "map_info": {"x": 288.1821461789964, "display_name": "DHAP", "y": 259.62935854085896, "flux": 4.768514602639647}}}, {"id": "e4p_c", "name": "D-Erythrose 4-phosphate", "compartment": "c", "charge": -2, "formula": "C4H7O7P", "notes": {"BRENDA": ["BG59851", "BG91980"], "BioPath": ["D-Erythrose_4-phosphate"], "CAS": ["585-18-2"], "CASID": ["585-18-2"], "ChEBI": ["42349", "48153", "4256", "20927", "12921", "21109", "27508", "4114", "16897"], "HMDB": ["HMDB01321"], "KEGG": "C00279", "MetaCyc": "ERYTHROSE-4P", "PUBCHEM ID": ["3574"], "Reactome": ["29878"], "SEED": ["cpd01994", "cpd00236"], "UPA": ["UPC00279"], "map_info": {"x": 177.79008346463644, "display_name": "E4P", "y": 62.84947822464068, "flux": 1.9583666054209639}}}, {"id": "etoh_c", "name": "Ethanol", "compartment": "c", "charge": 0, "formula": "C2H6O", "notes": {"BRENDA": ["BG15529"], "BioPath": ["Ethanol"], "CAS": ["64-17-5"], "CASID": ["64-17-5"], "ChEBI": ["4879", "30880", "16236", "30878", "52092", "14222", "52096", "23978", "44594", "42377"], "HMDB": ["HMDB00108"], "KEGG": "C00469", "MetaCyc": "ETOH", "PUBCHEM ID": ["3752"], "Reactome": ["30203", "113748"], "SEED": ["cpd00363"], "UPA": ["UPC00469"], "map_info": {"x": 428.49577610988814, "display_name": "ETOH", "y": 642.6537303483125, "flux": 0.0}}}, {"id": "etoh_e", "name": "Ethanol", "compartment": "e", "charge": 0, "formula": "C2H6O", "notes": {"BRENDA": ["BG15529"], "BioPath": ["Ethanol"], "CAS": ["64-17-5"], "CASID": ["64-17-5"], "ChEBI": ["4879", "30880", "16236", "30878", "52092", "14222", "52096", "23978", "44594", "42377"], "HMDB": ["HMDB00108"], "KEGG": "C00469", "MetaCyc": "ETOH", "PUBCHEM ID": ["3752"], "Reactome": ["30203", "113748"], "SEED": ["cpd00363"], "UPA": ["UPC00469"], "map_info": {"display_name": "ETOH", "hidden": true, "flux": 0.0}}}, {"id": "f6p_c", "name": "D-Fructose 6-phosphate", "compartment": "c", "charge": -2, "formula": "C6H11O9P", "notes": {"BRENDA": ["BG56501", "BG22637"], "BioPath": ["beta-D-Fructose_6-phosphate"], "CAS": ["643-13-0"], "CASID": ["643-13-0"], "ChEBI": ["57634", "12352", "45804", "61527", "61553", "10375", "16084", "42378", "22768"], "HMDB": ["HMDB03971"], "KEGG": "C00085", "MetaCyc": "FRUCTOSE-6P", "PUBCHEM ID": ["3385"], "SEED": ["cpd00072"], "UPA": ["UPC05345", "UPC00085"], "map_info": {"x": 101.26331523486641, "display_name": "F6P", "y": 177.34727315441216, "align": "center left", "flux": 4.785014366058617}}}, {"id": "fdp_c", "name": "D-Fructose 1,6-bisphosphate", "compartment": "c", "charge": -4, "formula": "C6H10O12P2", "notes": {"BRENDA": ["BG22767"], "BioPath": ["beta-D-Fructose_1,6-bisphosphate"], "CAS": ["488-69-7"], "CASID": ["488-69-7"], "ChEBI": ["32968", "49299", "42553", "32966", "37736", "28013", "32967", "41014", "22767", "10374", "40595", "40591"], "KEGG": "C00354", "MetaCyc": "FRUCTOSE-16-DIPHOSPHATE", "PUBCHEM ID": ["3647"], "SEED": ["cpd00290"], "UPA": ["UPC00354"], "map_info": {"x": 180.377220566232, "display_name": "FDP", "y": 240.75502501147935, "flux": 4.768514602639647}}}, {"id": "for_c", "name": "Formate", "compartment": "c", "charge": -1, "formula": "CH1O2", "notes": {"BRENDA": ["BG28488"], "BioPath": ["Formate"], "CAS": ["64-18-6"], "CASID": ["64-18-6"], "ChEBI": ["42460", "14276", "63050", "5145", "24082", "24081", "30751", "63880", "15740", "52343"], "HMDB": ["HMDB00142"], "KEGG": "C00058", "LIPIDMAPS": ["LMFA01010040"], "MetaCyc": "FORMATE", "PUBCHEM ID": ["3358"], "Reactome": ["389585", "29460"], "SEED": ["cpd00047"], "UPA": ["UPC00058"], "map_info": {"x": 397.42101960996047, "display_name": "FOR", "y": 484.62092175127543, "flux": 5.2054413762408345}}}, {"id": "for_e", "name": "Formate", "compartment": "e", "charge": -1, "formula": "CH1O2", "notes": {"BRENDA": ["BG28488"], "BioPath": ["Formate"], "CAS": ["64-18-6"], "CASID": ["64-18-6"], "ChEBI": ["42460", "14276", "63050", "5145", "24082", "24081", "30751", "63880", "15740", "52343"], "HMDB": ["HMDB00142"], "KEGG": "C00058", "LIPIDMAPS": ["LMFA01010040"], "MetaCyc": "FORMATE", "PUBCHEM ID": ["3358"], "Reactome": ["389585", "29460"], "SEED": ["cpd00047"], "UPA": ["UPC00058"], "map_info": {"display_name": "FOR", "hidden": true, "flux": 5.2054413762408345}}}, {"id": "fru_e", "name": "D-Fructose", "compartment": "e", "charge": 0, "formula": "C6H12O6", "notes": {"BRENDA": ["BG22357", "BG22370"], "BioPath": ["beta-D-Fructofuranose"], "CAS": ["57-48-7"], "CASID": ["57-48-7"], "ChEBI": ["5172", "10373", "37721", "37720", "28757", "48673", "24104", "49089", "22766", "42560", "24110", "28645"], "HMDB": ["HMDB00660"], "KEGG": "C00095", "MetaCyc": "CPD-10723", "PUBCHEM ID": ["3395"], "SEED": ["cpd00082"], "UPA": ["UPC00095"], "map_info": {"display_name": "FRU", "hidden": true, "flux": 0.0}}}, {"id": "fum_c", "name": "Fumarate", "compartment": "c", "charge": -2, "formula": "C4H2O4", "notes": {"BRENDA": ["BG19266"], "BioPath": ["Fumarate"], "CAS": ["110-17-8"], "CASID": ["110-17-8"], "ChEBI": ["42743", "18012", "5190", "22958", "24122", "24124", "22956", "22957", "37154", "37155", "42511", "29806", "36180", "14284"], "HMDB": ["HMDB00134"], "KEGG": "C00122", "MetaCyc": "FUM", "PUBCHEM ID": ["3422"], "Reactome": ["29586", "113588"], "SEED": ["cpd00106"], "UPA": ["UPC00122"], "map_info": {"x": 110.73854035372122, "display_name": "FUM", "y": 585.6323318434088, "flux": 4.631926021839013}}}, {"id": "fum_e", "name": "Fumarate", "compartment": "e", "charge": -2, "formula": "C4H2O4", "notes": {"BRENDA": ["BG19266"], "BioPath": ["Fumarate"], "CAS": ["110-17-8"], "CASID": ["110-17-8"], "ChEBI": ["42743", "18012", "5190", "22958", "24122", "24124", "22956", "22957", "37154", "37155", "42511", "29806", "36180", "14284"], "HMDB": ["HMDB00134"], "KEGG": "C00122", "MetaCyc": "FUM", "PUBCHEM ID": ["3422"], "Reactome": ["29586", "113588"], "SEED": ["cpd00106"], "UPA": ["UPC00122"], "map_info": {"display_name": "FUM", "hidden": true, "flux": 0.0}}}, {"id": "g3p_c", "name": "Glyceraldehyde 3-phosphate", "compartment": "c", "charge": -2, "formula": "C3H5O6P", "notes": {"BRENDA": ["BG17970"], "CAS": ["142-10-9"], "CASID": ["142-10-9"], "ChEBI": ["17138", "14333", "5446", "58027"], "HMDB": ["HMDB01112"], "KEGG": "C00118", "MetaCyc": "GAP", "PUBCHEM ID": ["3930"], "SEED": ["cpd00102"], "UPA": ["UPC00661", "UPC00118"], "map_info": {"x": 306.2673827992605, "display_name": "G3P", "y": 207.3921752993234, "flux": 13.369750926780629}}}, {"id": "g6p_c", "name": "D-Glucose 6-phosphate", "compartment": "c", "charge": -2, "formula": "C6H11O9P", "notes": {"BRENDA": ["BG22626", "BG22646"], "CAS": ["56-73-5"], "CASID": ["56-73-5"], "ChEBI": ["10399", "22797", "41041", "17719", "4170", "61548", "58247", "12375"], "HMDB": ["HMDB03498", "HMDB06793", "HMDB01401", "HMDB01549"], "KEGG": "C00092", "MetaCyc": "GLC-6-P", "PUBCHEM ID": ["3392"], "Reactome": ["1629756"], "SEED": ["cpd00079"], "UPA": ["UPC00092"], "map_info": {"x": 112.52666232322949, "display_name": "G6P", "y": 60.75748557678827, "flux": 1.0}}}, {"id": "glc__D_e", "name": "D-Glucose", "compartment": "e", "charge": 0, "formula": "C6H12O6", "notes": {"CAS": ["50-99-7"], "CASID": ["50-99-7"], "KEGG": "C00031", "MetaCyc": "ALPHA-GLUCOSE", "PUBCHEM ID": ["3333"], "map_info": {"x": 34.37107051776515, "display_name": "GLC", "y": 32.477984768907746, "flux": 1.0}}}, {"id": "h2o_c", "name": "H2O", "compartment": "c", "charge": 0, "formula": "H2O", "notes": {"BRENDA": ["BG92137", "BG89181", "BG92081", "BG92002"], "BioPath": ["OH-", "Water", "Oxygen_atom"], "CAS": ["7732-18-5"], "CASID": ["7732-18-5"], "ChEBI": ["15377", "13365", "41979", "16234", "36385", "42857", "27313", "44819", "29373", "10743", "5594", "29356", "53442", "29375", "29374", "13419", "43228", "44292", "13352", "41981", "29412", "42043", "33811", "33813", "35511", "5585", "44641", "44701"], "HMDB": ["HMDB01039", "HMDB02111"], "KEGG": "C00001", "MetaCyc": "WATER", "PUBCHEM ID": ["3303"], "Reactome": ["947593", "189422", "141343", "113518", "1605715", "109276", "113521", "113519", "2022884", "351603", "29356"], "SEED": ["cpd15275", "cpd00001"], "UPA": ["UPC00001", "UPC01328"], "map_info": {"display_name": "H2O", "hidden": true, "flux": 16.106540842220916}}}, {"id": "h2o_e", "name": "H2O", "compartment": "e", "charge": 0, "formula": "H2O", "notes": {"BRENDA": ["BG92137", "BG89181", "BG92081", "BG92002"], "BioPath": ["OH-", "Water", "Oxygen_atom"], "CAS": ["7732-18-5"], "CASID": ["7732-18-5"], "ChEBI": ["15377", "13365", "41979", "16234", "36385", "42857", "27313", "44819", "29373", "10743", "5594", "29356", "53442", "29375", "29374", "13419", "43228", "44292", "13352", "41981", "29412", "42043", "33811", "33813", "35511", "5585", "44641", "44701"], "HMDB": ["HMDB01039", "HMDB02111"], "KEGG": "C00001", "MetaCyc": "WATER", "PUBCHEM ID": ["3303"], "Reactome": ["947593", "189422", "141343", "113518", "1605715", "109276", "113521", "113519", "2022884", "351603", "29356"], "SEED": ["cpd15275", "cpd00001"], "UPA": ["UPC00001", "UPC01328"], "map_info": {"display_name": "H2O", "hidden": true, "flux": 0.4413985604584232}}}, {"id": "h_c", "name": "H+", "compartment": "c", "charge": 1, "formula": "H", "notes": {"BRENDA": ["BG79440"], "BioPath": ["Proton"], "CAS": ["12408-02-5"], "CASID": ["12408-02-5"], "ChEBI": ["24636", "15378", "10744", "13357", "5584"], "KEGG": "C00080", "MetaCyc": "PROTON", "PUBCHEM ID": ["3380"], "Reactome": ["194688", "425978", "193465", "374900", "74722", "425999", "428040", "163953", "372511", "2000349", "70106", "1470067", "113529", "425969", "428548", "156540", "1614597", "351626", "427899"], "SEED": ["cpd00067"], "UPA": ["UPC00080"], "map_info": {"display_name": "H", "hidden": true, "flux": 45.407769680058045}}}, {"id": "h_e", "name": "H+", "compartment": "e", "charge": 1, "formula": "H", "notes": {"BRENDA": ["BG79440"], "BioPath": ["Proton"], "CAS": ["12408-02-5"], "CASID": ["12408-02-5"], "ChEBI": ["24636", "15378", "10744", "13357", "5584"], "KEGG": "C00080", "MetaCyc": "PROTON", "PUBCHEM ID": ["3380"], "Reactome": ["194688", "425978", "193465", "374900", "74722", "425999", "428040", "163953", "372511", "2000349", "70106", "1470067", "113529", "425969", "428548", "156540", "1614597", "351626", "427899"], "SEED": ["cpd00067"], "UPA": ["UPC00080"], "map_info": {"display_name": "H", "hidden": true, "flux": 35.62929526583659}}}, {"id": "mal__L_c", "name": "L-Malate", "compartment": "c", "charge": -2, "formula": "C4H4O5", "notes": {"CAS": ["97-67-6"], "CASID": ["97-67-6"], "KEGG": "C00149", "MetaCyc": "MAL", "PUBCHEM ID": ["3449"], "map_info": {"x": 147.25266608917624, "display_name": "MAL", "y": 521.7750406278898, "flux": 7.541642266367215}}}, {"id": "mal__L_e", "name": "L-Malate", "compartment": "e", "charge": -2, "formula": "C4H4O5", "notes": {"CAS": ["97-67-6"], "CASID": ["97-67-6"], "KEGG": "C00149", "MetaCyc": "MAL", "PUBCHEM ID": ["3449"], "map_info": {"display_name": "MAL", "hidden": true, "flux": 0.0}}}, {"id": "nad_c", "name": "Nicotinamide adenine dinucleotide", "compartment": "c", "charge": -1, "formula": "C21H26N7O14P2", "notes": {"BRENDA": ["BG11259"], "BioPath": ["NAD"], "CAS": ["53-84-9"], "CASID": ["53-84-9"], "ChEBI": ["21901", "7422", "44214", "15846", "13394", "13393", "44215", "13389", "57540", "44281"], "HMDB": ["HMDB00902"], "KEGG": "C00003", "MetaCyc": "NAD", "PUBCHEM ID": ["3305"], "Reactome": ["192307", "29360", "427523", "194653", "113526"], "SEED": ["cpd00003"], "UPA": ["UPC00003"], "map_info": {"display_name": "NAD", "hidden": true, "flux": 12.173568288206276}}}, {"id": "nadh_c", "name": "Nicotinamide adenine dinucleotide - reduced", "compartment": "c", "charge": -2, "formula": "C21H27N7O14P2", "notes": {"BRENDA": ["BG11384"], "BioPath": ["NADH"], "CAS": ["58-68-4"], "CASID": ["58-68-4"], "ChEBI": ["13395", "21902", "16908", "7423", "44216", "57945", "13396"], "HMDB": ["HMDB01487"], "KEGG": "C00004", "MetaCyc": "NADH", "PUBCHEM ID": ["3306"], "Reactome": ["192305", "73473", "194697", "29362"], "SEED": ["cpd00004"], "UPA": ["UPC00004"], "map_info": {"color": "#b5cf6b", "display_name": "NADH", "hidden": true, "flux": 12.173568288206276}}}, {"id": "nadp_c", "name": "Nicotinamide adenine dinucleotide phosphate", "compartment": "c", "charge": -3, "formula": "C21H25N7O17P3", "notes": {"BRENDA": ["BG48210"], "BioPath": ["NADP"], "CAS": ["53-59-8"], "CASID": ["53-59-8"], "ChEBI": ["7424", "13398", "13397", "13390", "25524", "25523", "44405", "44409", "18009", "58349", "21903"], "HMDB": ["HMDB00217"], "KEGG": "C00006", "MetaCyc": "NADP", "PUBCHEM ID": ["3308"], "Reactome": ["29366", "2000348", "113563", "113564", "389556", "428218", "351628", "194668", "517495"], "SEED": ["cpd00006"], "UPA": ["UPC00006"], "map_info": {"display_name": "NADP", "hidden": true, "flux": 2.9097162445282017}}}, {"id": "nadph_c", "name": "Nicotinamide adenine dinucleotide phosphate - reduced", "compartment": "c", "charge": -4, "formula": "C21H26N7O17P3", "notes": {"BRENDA": ["BG48213"], "BioPath": ["NADPH"], "CAS": ["2646-71-1"], "CASID": ["2646-71-1"], "ChEBI": ["13400", "16474", "7425", "13399", "13392", "57783", "21904", "44286"], "HMDB": ["HMDB00799", "HMDB06341", "HMDB00221"], "KEGG": "C00005", "MetaCyc": "NADPH", "PUBCHEM ID": ["3307"], "Reactome": ["2000347", "29364", "428206", "113602", "113600", "113601", "194725", "517496", "351627"], "SEED": ["cpd00005"], "UPA": ["UPC00005"], "map_info": {"color": "#8ca252", "display_name": "NADPH", "hidden": true, "flux": 2.9097162445282017}}}, {"id": "o2_c", "name": "O2", "compartment": "c", "charge": 0, "formula": "O2", "notes": {"BRENDA": ["BG36249"], "BioPath": ["Oxygen"], "CAS": ["7782-44-7"], "CASID": ["7782-44-7"], "ChEBI": ["44742", "27140", "15379", "25366", "26689", "30491", "13416", "29793", "23833", "7860", "10745"], "HMDB": ["HMDB01377"], "KEGG": "C00007", "MetaCyc": "OXYGEN-MOLECULE", "PUBCHEM ID": ["3309"], "Reactome": ["113534", "29368", "113535", "1236709", "113533", "189461", "113685", "352327", "351593"], "SEED": ["cpd00532"], "UPA": ["UPC00007"], "map_info": {"display_name": "O2", "hidden": true, "flux": 0.0}}}, {"id": "o2_e", "name": "O2", "compartment": "e", "charge": 0, "formula": "O2", "notes": {"BRENDA": ["BG36249"], "BioPath": ["Oxygen"], "CAS": ["7782-44-7"], "CASID": ["7782-44-7"], "ChEBI": ["44742", "27140", "15379", "25366", "26689", "30491", "13416", "29793", "23833", "7860", "10745"], "HMDB": ["HMDB01377"], "KEGG": "C00007", "MetaCyc": "OXYGEN-MOLECULE", "PUBCHEM ID": ["3309"], "Reactome": ["113534", "29368", "113535", "1236709", "113533", "189461", "113685", "352327", "351593"], "SEED": ["cpd00532"], "UPA": ["UPC00007"], "map_info": {"display_name": "O2", "hidden": true, "flux": 0.0}}}, {"id": "oaa_c", "name": "Oxaloacetate", "compartment": "c", "charge": -2, "formula": "C4H2O5", "notes": {"BRENDA": ["BG19269", "BG19271"], "BioPath": ["Oxaloacetate"], "CAS": ["328-42-7"], "CASID": ["328-42-7"], "ChEBI": ["23911", "23910", "12810", "10547", "16452", "17479", "30744", "7812", "19638", "25734", "25731", "12820", "1158", "14703", "28394", "24958", "24959"], "HMDB": ["HMDB00223"], "KEGG": "C00036", "LIPIDMAPS": ["LMFA01170061", "LMFA01170120"], "MetaCyc": "OXALACETIC_ACID", "PUBCHEM ID": ["3338"], "Reactome": ["76213", "113587"], "SEED": ["cpd00032"], "UPA": ["UPC00036"], "map_info": {"x": 194.71811459453318, "display_name": "OAA", "y": 440.88467502945394, "flux": 7.957440958901389}}}, {"id": "pep_c", "name": "Phosphoenolpyruvate", "compartment": "c", "charge": -3, "formula": "C3H2O6P", "notes": {"BRENDA": ["BG17779"], "BioPath": ["Phosphoenolpyruvate"], "CAS": ["138-08-9"], "CASID": ["138-08-9"], "ChEBI": ["44897", "44894", "14812", "8147", "26055", "26054", "58702", "18021"], "HMDB": ["HMDB00263"], "KEGG": "PHOSPHO-ENOL-PYRUVATE", "MetaCyc": "PHOSPHO-ENOL-PYRUVATE", "PUBCHEM ID": ["3374"], "Reactome": ["29492", "372364"], "SEED": ["cpd00061"], "UPA": ["UPC00074"], "map_info": {"x": 251.87819507727542, "display_name": "PEP", "y": 338.4645607084292, "flux": 11.033216259923481}}}, {"id": "pi_c", "name": "Phosphate", "compartment": "c", "charge": -2, "formula": "HO4P", "notes": {"BRENDA": ["BG92038"], "BioPath": ["Phosphate", "Phosphate_(protonated)"], "CAS": ["14265-44-2"], "CASID": ["14265-44-2"], "ChEBI": ["37583", "7793", "37585", "34683", "14791", "34855", "29137", "29139", "63036", "26020", "39739", "32597", "32596", "43474", "63051", "43470", "9679", "35433", "4496", "45024", "18367", "26078", "39745", "24838"], "HMDB": ["HMDB02142"], "KEGG": "C00009", "MetaCyc": "Pi", "PUBCHEM ID": ["3311"], "Reactome": ["947590", "109277", "113548", "2255331", "29372", "113550", "113551"], "SEED": ["cpd09464", "cpd09463", "cpd00009"], "UPA": ["UPC00009"], "map_info": {"display_name": "PI", "hidden": true, "flux": 15.714621426476882}}}, {"id": "pi_e", "name": "Phosphate", "compartment": "e", "charge": -2, "formula": "HO4P", "notes": {"BRENDA": ["BG92038"], "BioPath": ["Phosphate", "Phosphate_(protonated)"], "CAS": ["14265-44-2"], "CASID": ["14265-44-2"], "ChEBI": ["37583", "7793", "37585", "34683", "14791", "34855", "29137", "29139", "63036", "26020", "39739", "32597", "32596", "43474", "63051", "43470", "9679", "35433", "4496", "45024", "18367", "26078", "39745", "24838"], "HMDB": ["HMDB02142"], "KEGG": "C00009", "MetaCyc": "Pi", "PUBCHEM ID": ["3311"], "Reactome": ["947590", "109277", "113548", "2255331", "29372", "113550", "113551"], "SEED": ["cpd09464", "cpd09463", "cpd00009"], "UPA": ["UPC00009"], "map_info": {"display_name": "PI", "hidden": true, "flux": 0.0}}}, {"id": "pyr_c", "name": "Pyruvate", "compartment": "c", "charge": -1, "formula": "C3H3O3", "notes": {"BRENDA": ["BG17694"], "BioPath": ["Pyruvate"], "CAS": ["127-17-3"], "CASID": ["127-17-3"], "ChEBI": ["15361", "14987", "8685", "32816", "45253", "26466", "26462"], "HMDB": ["HMDB00243"], "KEGG": "C00022", "LIPIDMAPS": ["LMFA01060077"], "MetaCyc": "PYRUVATE", "PUBCHEM ID": ["3324"], "Reactome": ["113557", "389680", "29398"], "SEED": ["cpd00020"], "UPA": ["UPC00022"], "map_info": {"x": 312.26594527039765, "display_name": "PYR", "y": 436.20477823325166, "flux": 5.864687212817096}}}, {"id": "pyr_e", "name": "Pyruvate", "compartment": "e", "charge": -1, "formula": "C3H3O3", "notes": {"BRENDA": ["BG17694"], "BioPath": ["Pyruvate"], "CAS": ["127-17-3"], "CASID": ["127-17-3"], "ChEBI": ["15361", "14987", "8685", "32816", "45253", "26466", "26462"], "HMDB": ["HMDB00243"], "KEGG": "C00022", "LIPIDMAPS": ["LMFA01060077"], "MetaCyc": "PYRUVATE", "PUBCHEM ID": ["3324"], "Reactome": ["113557", "389680", "29398"], "SEED": ["cpd00020"], "UPA": ["UPC00022"], "map_info": {"display_name": "PYR", "hidden": true, "flux": 0.0}}}, {"id": "q8_c", "name": "Ubiquinone-8", "compartment": "c", "charge": 0, "formula": "C49H74O4", "notes": {"BRENDA": ["BG18990"], "CAS": ["1339-63-5"], "CASID": ["1339-63-5"], "ChEBI": ["61683"], "KEGG": "C00399", "LIPIDMAPS": ["LMPR02010005"], "MetaCyc": "UBIQUINONE-8", "PUBCHEM ID": ["3689"], "SEED": ["cpd15560"], "map_info": {"color": "#b5cf6b", "display_name": "Q8", "hidden": true, "flux": 4.631926021839013}}}, {"id": "q8h2_c", "name": "Ubiquinol-8", "compartment": "c", "charge": 0, "formula": "C49H76O4", "notes": {"BRENDA": ["BG79801"], "ChEBI": ["61682"], "KEGG": "C00390", "MetaCyc": "CPD-9956", "PUBCHEM ID": ["3680"], "SEED": ["cpd15561"], "map_info": {"color": "#b5cf6b", "display_name": "Q8H2", "hidden": true, "flux": 4.631926021839013}}}, {"id": "r5p_c", "name": "Alpha-D-Ribose 5-phosphate", "compartment": "c", "charge": -2, "formula": "C5H9O8P", "notes": {"BRENDA": ["BG81798", "BG34575"], "BioPath": ["alpha-D-Ribose_5-phosphate"], "CAS": ["4300-28-1"], "CASID": ["4300-28-1"], "ChEBI": ["12331", "52742", "10270", "22413", "18189"], "HMDB": ["HMDB00618", "HMDB01548", "HMDB02033", "HMDB02694"], "KEGG": "C00117", "MetaCyc": "RIBOSE-5P", "PUBCHEM ID": ["3417"], "SEED": ["cpd00101"], "UPA": ["UPC00117"], "map_info": {"x": 252.27219055767722, "display_name": "R5P", "y": 84.61556835464663, "flux": 2.1672782784986646}}}, {"id": "ru5p__D_c", "name": "D-Ribulose 5-phosphate", "compartment": "c", "charge": -2, "formula": "C5H9O8P", "notes": {"CAS": ["4151-19-3"], "CASID": ["4151-19-3"], "KEGG": "C00199", "MetaCyc": "RIBULOSE-5P", "PUBCHEM ID": ["3499"], "map_info": {"x": 306.9904123614967, "display_name": "RU5P", "y": 53.89042223441865, "flux": 2.1672782784986646}}}, {"id": "s7p_c", "name": "Sedoheptulose 7-phosphate", "compartment": "c", "charge": -2, "formula": "C7H13O10P", "notes": {"BRENDA": ["BG24563"], "BioPath": ["D-Sedoheptulose_7-phosphate"], "CASID": ["583-08-4"], "ChEBI": ["26621", "57483", "9083", "15721", "4244", "15074", "15073"], "KEGG": "C05382", "MetaCyc": "D-SEDOHEPTULOSE-7-P", "PUBCHEM ID": ["3576"], "Reactome": ["29882"], "SEED": ["cpd00238"], "UPA": ["UPC05382"], "map_info": {"x": 197.90319841866625, "display_name": "S7P", "y": 216.66892207293898, "flux": 1.9583666054209639}}}, {"id": "succ_c", "name": "Succinate", "compartment": "c", "charge": -2, "formula": "C4H4O4", "notes": {"BRENDA": ["BG19270"], "BioPath": ["Succinate"], "CAS": ["110-15-6"], "CASID": ["110-15-6"], "ChEBI": ["22941", "22943", "26807", "26803", "30031", "9304", "15125", "45639", "15741", "30779"], "HMDB": ["HMDB00254"], "KEGG": "C00042", "LIPIDMAPS": ["LMFA01170043"], "MetaCyc": "SUC", "PUBCHEM ID": ["3344"], "Reactome": ["113536", "433123", "29434", "389583", "1650769", "159939"], "SEED": ["cpd00036"], "UPA": ["UPC00042"], "map_info": {"x": 76.0034965285222, "display_name": "SUCC", "y": 646.9972070225022, "flux": 4.631926021839013}}}, {"id": "succ_e", "name": "Succinate", "compartment": "e", "charge": -2, "formula": "C4H4O4", "notes": {"BRENDA": ["BG19270"], "BioPath": ["Succinate"], "CAS": ["110-15-6"], "CASID": ["110-15-6"], "ChEBI": ["22941", "22943", "26807", "26803", "30031", "9304", "15125", "45639", "15741", "30779"], "HMDB": ["HMDB00254"], "KEGG": "C00042", "LIPIDMAPS": ["LMFA01170043"], "MetaCyc": "SUC", "PUBCHEM ID": ["3344"], "Reactome": ["113536", "433123", "29434", "389583", "1650769", "159939"], "SEED": ["cpd00036"], "UPA": ["UPC00042"], "map_info": {"display_name": "SUCC", "hidden": true, "flux": 4.631926021839013}}}, {"id": "xu5p__D_c", "name": "D-Xylulose 5-phosphate", "compartment": "c", "charge": -2, "formula": "C5H9O8P", "notes": {"KEGG": "C00231", "MetaCyc": "XYLULOSE-5-PHOSPHATE", "PUBCHEM ID": ["3530"], "map_info": {"x": 328.8045419120096, "display_name": "XU5P", "y": 149.42807376203066, "flux": 6.0}}}, {"id": "h2_e", "name": "H2", "compartment": "e", "charge": 0, "formula": "H2", "notes": {"map_info": {"display_name": "H2", "hidden": true, "flux": 0.0}}}, {"id": "glc__D_c", "name": "D-Glucose", "compartment": "c", "charge": 0, "formula": "C6H12O6", "notes": {"map_info": {"display_name": "GLC", "hidden": true, "flux": 0.0}}}, {"id": "xyl__D_e", "name": "D-Xylose", "compartment": "e", "charge": 0, "formula": "C5H10O5", "notes": {"map_info": {"display_name": "XYL", "hidden": true, "flux": 6.0}}}, {"id": "xyl__D_c", "name": "D-Xylose", "compartment": "c", "charge": 0, "formula": "C5H10O5", "notes": {"map_info": {"x": 430.8162518021068, "display_name": "XYL", "y": 86.69573824181867, "flux": 6.0}}}, {"id": "xylu__D_c", "name": "D-Xylulose", "compartment": "c", "charge": 0, "formula": "C5H10O5", "notes": {"map_info": {"x": 385.69889867167296, "display_name": "XU", "y": 115.60941469730261, "flux": 6.0}}}, {"id": "arab__D_e", "name": "D Arabinose C5H10O5", "compartment": "e", "charge": 0, "formula": "C5H10O5", "notes": {"map_info": {"display_name": "ARAB", "hidden": true, "flux": 0.0}}}, {"id": "arab__D_c", "name": "D Arabinose C5H10O5", "compartment": "c", "charge": 0, "formula": "C5H10O5", "notes": {"map_info": {"x": 431.41646996280593, "display_name": "ARAB", "y": -23.905634013546177, "hidden": true, "flux": 0.0}}}, {"id": "rbl__D_c", "name": "D-Ribulose", "compartment": "c", "charge": 0, "formula": "C5H10O5", "notes": {"map_info": {"x": 387.07235689544444, "display_name": "RIB", "y": -1.7130130677534225, "hidden": true, "flux": 0.0}}}, {"id": "gal_e", "name": "D-Galactose", "compartment": "e", "charge": 0, "formula": "C6H12O6", "notes": {"map_info": {"display_name": "GAL", "hidden": true, "flux": 0.0}}}, {"id": "gal_c", "name": "D-Galactose", "compartment": "c", "charge": 0, "formula": "C6H12O6", "notes": {"map_info": {"x": 5.135350485571223, "display_name": "GAL", "y": 79.88406774077112, "hidden": true, "flux": 0.0}}}, {"id": "gal1p_c", "name": "Alpha-D-Galactose 1-phosphate", "compartment": "c", "charge": -2, "formula": "C6H11O9P", "notes": {"map_info": {"x": 10.916224067944043, "display_name": "GAL1P", "y": 41.453644652449725, "hidden": true, "flux": 0.0}}}, {"id": "udpg_c", "name": "UDPglucose", "compartment": "c", "charge": -2, "formula": "C15H22N2O17P2", "notes": {"map_info": {"display_name": "UDP_GLUCOSE", "hidden": true, "flux": 0.0}}}, {"id": "udpgal_c", "name": "UDPgalactose", "compartment": "c", "charge": -2, "formula": "C15H22N2O17P2", "notes": {"map_info": {"display_name": "UDP_GALACTOSE", "hidden": true, "flux": 0.0}}}, {"id": "g1p_c", "name": "D-Glucose 1-phosphate", "compartment": "c", "charge": -2, "formula": "C6H11O9P", "notes": {"map_info": {"x": 44.48121996313575, "display_name": "G1P", "y": 11.753846178531717, "hidden": true, "flux": 0.0}}}, {"id": "biomass", "name": "", "compartment": "e", "formula": "C24.967H49.934O12.4835", "notes": {"map_info": {"display_name": "BIOMA", "hidden": true, "flux": 0.22334499378473902}}}, {"id": "atpm", "name": "atp maintenance", "compartment": "", "formula": "", "notes": {"map_info": {"display_name": "AT", "hidden": true, "flux": 4.701484070350633}}}, {"id": "lac__D_c", "name": "D-Lactate", "compartment": "c", "charge": -1, "formula": "C3H5O3", "notes": {"CAS": ["10326-41-7"], "CASID": ["10326-41-7"], "KEGG": "C00256", "MetaCyc": "D-LACTATE", "PUBCHEM ID": ["3555"], "map_info": {"x": 424.23354197668004, "display_name": "LAC", "y": 381.0789779306125, "flux": 0.0}}}, {"id": "lac__D_e", "name": "D-Lactate", "compartment": "e", "charge": -1, "formula": "C3H5O3", "notes": {"CAS": ["10326-41-7"], "CASID": ["10326-41-7"], "KEGG": "C00256", "MetaCyc": "D-LACTATE", "PUBCHEM ID": ["3555"], "map_info": {"display_name": "LAC", "hidden": true, "flux": 0.0}}}], "reactions": [{"id": "ACALD", "name": "acetaldehyde dehydrogenase (acetylating)", "metabolites": {"acald_c": -1, "accoa_c": 1, "coa_c": -1, "h_c": 1, "nad_c": -1, "nadh_c": 1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0591", "notes": {"Enzymes": ["1.2.1.10"], "KEGG": "R00228", "MetaCyc": "ACETALD-DEHYDROG-RXN", "map_info": {"x": 382.64525895293133, "reversibility": true, "y": 560.8483113179269, "cofactors": {"nadh_c": {"x": 393.63231629605326, "y": 535.5403540860555}}, "flux": 0.0}, "original_bigg_id": "ACALD"}}, {"id": "ACALDt", "name": "R_acetaldehyde_reversible_transport", "metabolites": {"acald_c": 1, "acald_e": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": true, "hidden": true, "flux": 0.0}, "original_bigg_id": "ACALDt"}}, {"id": "ACKr", "name": "acetate kinase", "metabolites": {"ac_c": -1, "actp_c": 1, "adp_c": 1, "atp_c": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_1661", "notes": {"Enzymes": ["2.7.2.1", "2.7.2.15"], "KEGG": "R00315", "MetaCyc": "ACETATEKIN-RXN", "map_info": {"x": 303.0931379450599, "reversibility": true, "y": 610.9159748329513, "cofactors": {"atp_c": {"x": 266.7300153137178, "y": 610.8281666525227}}, "flux": -4.3332578312250725}, "original_bigg_id": "ACKr"}}, {"id": "ACt2r", "name": "R_acetate_reversible_transport_via_proton_symport", "metabolites": {"ac_c": 1, "ac_e": -1, "h_c": 1, "h_e": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": true, "hidden": true, "flux": -4.3332578312250725}, "original_bigg_id": "ACt2r"}}, {"id": "ALCD2x", "name": "alcohol dehydrogenase (ethanol)", "metabolites": {"acald_c": 1, "etoh_c": -1, "h_c": 1, "nad_c": -1, "nadh_c": 1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0403", "notes": {"Enzymes": ["1.1.1.1", "1.1.1.71"], "KEGG": "R00754", "MetaCyc": "ALCOHOL-DEHYDROG-RXN", "map_info": {"x": 419.00015582585576, "reversibility": true, "y": 624.4703227914397, "cofactors": {"nadh_c": {"x": 433.1132679242588, "y": 602.7038041865424}}, "flux": 0.0}, "original_bigg_id": "ALCD2x"}}, {"id": "ATPM", "name": "ATP maintenance requirement", "metabolites": {"adp_c": 1, "atp_c": -1, "atpm": 1, "h2o_c": -1, "h_c": 1, "pi_c": 1}, "lower_bound": 4.701484070350633, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"Enzymes": ["3.6.1.3", "3.6.1.15", "3.6.4.6"], "map_info": {"hidden": true, "reversibility": false, "cofactors": {"atp_c": {}}, "flux": 4.701484070350633}, "original_bigg_id": "ATPM"}}, {"id": "ATPS4r", "name": "ATP synthase (four protons for one ATP)", "metabolites": {"adp_c": -1, "atp_c": 1, "h2o_c": 1, "h_c": 3, "h_e": -4, "pi_c": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0326 or Asuc_0328", "notes": {"Enzymes": ["3.6.3.14"], "map_info": {"hidden": true, "reversibility": true, "cofactors": {"atp_c": {}}, "flux": -4.35006484227362}, "original_bigg_id": "ATPS4r"}}, {"id": "CO2t", "name": "R_CO2_transporter_via_diffusion", "metabolites": {"co2_c": 1, "co2_e": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": true, "cofactors": {"co2_c": {}}, "flux": 1.9759155858706183}, "original_bigg_id": "CO2t"}}, {"id": "CYTBD", "name": "cytochrome oxidase bd (ubiquinol-8: 2 protons)", "metabolites": {"h2o_c": 1, "h_c": -2, "h_e": 2, "o2_c": -0.5, "q8_c": 1, "q8h2_c": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": false, "cofactors": {"q8_c": {}, "q8h2_c": {}}, "flux": 0.0}, "original_bigg_id": "CYTBD"}}, {"id": "ENO", "name": "enolase", "metabolites": {"2pg_c": -1, "h2o_c": 1, "pep_c": 1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_2051", "notes": {"Enzymes": ["4.2.1.11"], "KEGG": "R00658", "MetaCyc": "2PGADEHYDRAT-RXN", "map_info": {"x": 291.7908162239458, "reversibility": true, "y": 359.025665205511, "flux": 11.03321625992348}, "original_bigg_id": "ENO"}}, {"id": "ETOHt2r", "name": "ETOHt2r", "metabolites": {"etoh_c": 1, "etoh_e": -1, "h_c": 1, "h_e": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": true, "hidden": true, "flux": 0.0}, "original_bigg_id": "ETOHt2r"}}, {"id": "EX_ac_e", "name": "Acetate exchange", "metabolites": {"ac_e": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 4.3332578312250725}, "original_bigg_id": "EX_ac_e"}}, {"id": "EX_acald_e", "name": "Acetaldehyde exchange", "metabolites": {"acald_e": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 0.0}, "original_bigg_id": "EX_acald_e"}}, {"id": "EX_co2_e", "name": "CO2 exchange", "metabolites": {"co2_e": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": true, "hidden": true, "flux": -1.9759155858706183}, "original_bigg_id": "EX_co2_e"}}, {"id": "EX_etoh_e", "name": "Ethanol exchange", "metabolites": {"etoh_e": -1}, "lower_bound": 0, "upper_bound": 0, "gene_reaction_rule": "", "notes": {"map_info": {"group": "ko", "reversibility": false, "hidden": true}, "original_bigg_id": "EX_etoh_e"}}, {"id": "EX_for_e", "name": "Formate exchange", "metabolites": {"for_e": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 5.2054413762408345}, "original_bigg_id": "EX_for_e"}}, {"id": "EX_fru_e", "name": "D-Fructose exchange", "metabolites": {"fru_e": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 0.0}, "original_bigg_id": "EX_fru_e"}}, {"id": "EX_fum_e", "name": "Fumarate exchange", "metabolites": {"fum_e": -1}, "lower_bound": 0, "upper_bound": 0, "gene_reaction_rule": "", "notes": {"map_info": {"group": "ko", "reversibility": false, "hidden": true}, "original_bigg_id": "EX_fum_e"}}, {"id": "EX_glc_e", "name": "D-Glucose exchange", "metabolites": {"glc__D_e": -1}, "lower_bound": -1, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": true, "hidden": true, "flux": -1.0}, "original_bigg_id": "EX_glc_e"}}, {"id": "EX_h_e", "name": "H+ exchange", "metabolites": {"h_e": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": true, "hidden": true, "flux": 24.997369243997575}, "original_bigg_id": "EX_h_e"}}, {"id": "EX_h2o_e", "name": "H2O exchange", "metabolites": {"h2o_e": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": true, "hidden": true, "flux": -0.4413985604584232}, "original_bigg_id": "EX_h2o_e"}}, {"id": "EX_mal__L_e", "name": "L-Malate exchange", "metabolites": {"mal__L_e": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 0.0}, "original_bigg_id": "EX_mal_L_e"}}, {"id": "EX_o2_e", "name": "O2 exchange", "metabolites": {"o2_e": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 0.0}, "original_bigg_id": "EX_o2_e"}}, {"id": "EX_pi_e", "name": "Phosphate exchange", "metabolites": {"pi_e": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": true, "hidden": true, "flux": 0.0}, "original_bigg_id": "EX_pi_e"}}, {"id": "EX_pyr_e", "name": "Pyruvate exchange", "metabolites": {"pyr_e": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 0.0}, "original_bigg_id": "EX_pyr_e"}}, {"id": "EX_succ_e", "name": "Succinate exchange", "metabolites": {"succ_e": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 4.631926021839013}, "original_bigg_id": "EX_succ_e"}}, {"id": "FBA", "name": "fructose-bisphosphate aldolase", "metabolites": {"dhap_c": 1, "fdp_c": -1, "g3p_c": 1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0536", "notes": {"Enzymes": ["4.1.2.13"], "KEGG": "R01068", "MetaCyc": "F16ALDOLASE-RXN", "map_info": {"x": 224.1583165935302, "reversibility": true, "y": 244.87862920130573, "flux": 4.768514602639647}, "original_bigg_id": "FBA"}}, {"id": "FBP", "name": "fructose-bisphosphatase", "metabolites": {"f6p_c": 1, "fdp_c": -1, "h2o_c": -1, "pi_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0394 or Asuc_1073", "notes": {"Enzymes": ["3.1.3.11"], "KEGG": "R00762", "MetaCyc": "F16BDEPHOS-RXN", "map_info": {"x": 142.3640880339957, "reversibility": false, "y": 205.18000736770938, "flux": 0.0}, "original_bigg_id": "FBP"}}, {"id": "FORt2", "name": "formate transport in via proton symport", "metabolites": {"for_c": 1, "for_e": -1, "h_c": 1, "h_e": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 0.0}, "original_bigg_id": "FORt2"}}, {"id": "FORti", "name": "formate transport via diffusion", "metabolites": {"for_c": -1, "for_e": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 5.2054413762408345}, "original_bigg_id": "FORti"}}, {"id": "FRD7", "name": "fumarate reductase", "metabolites": {"fum_c": -1, "q8_c": 1, "q8h2_c": -1, "succ_c": 1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_1813 or Asuc_1814", "notes": {"Enzymes": ["1.3.5.1", "1.3.5.4"], "KEGG": "R02164", "MetaCyc": "SUCCINATE-DEHYDROGENASE-UBIQUINONE-RXN", "map_info": {"x": 91.85808723484153, "reversibility": true, "y": 617.1681673337579, "cofactors": {"q8_c": {"x": 118.69275404506878, "y": 624.3914968332098}, "q8h2_c": {"x": 119.2533052823336, "y": 608.0773561013383}}, "flux": 4.631926021839013}, "original_bigg_id": "FRD7"}}, {"id": "FRUpts2", "name": "R_Fructose_transport_via_PEPPyr_PTS__f6p_generating", "metabolites": {"f6p_c": 1, "fru_e": -1, "pep_c": -1, "pyr_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 0.0}, "original_bigg_id": "FRUpts2"}}, {"id": "FUM", "name": "fumarase", "metabolites": {"fum_c": -1, "h2o_c": -1, "mal__L_c": 1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0956", "notes": {"Enzymes": ["4.2.1.2"], "KEGG": "R01082", "MetaCyc": "FUMHYDR-RXN", "map_info": {"x": 128.7879223563044, "reversibility": true, "y": 552.1226480673281, "group": 2, "flux": -4.631926021839013}, "original_bigg_id": "FUM"}}, {"id": "FUMt2_2", "name": "R_Fumarate_transport_via_proton_symport__2_H", "metabolites": {"fum_c": 1, "fum_e": -1, "h_c": 2, "h_e": -2}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 0.0}, "original_bigg_id": "FUMt2_2"}}, {"id": "GAPD", "name": "glyceraldehyde-3-phosphate dehydrogenase", "metabolites": {"13dpg_c": 1, "g3p_c": -1, "h_c": 1, "nad_c": -1, "nadh_c": 1, "pi_c": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_1027", "notes": {"Enzymes": ["1.2.1.12", "1.2.1.59"], "KEGG": "R01061", "MetaCyc": "GAPOXNPHOSPHN-RXN", "map_info": {"x": 347.3582370890107, "reversibility": true, "y": 211.28467493652442, "cofactors": {"nadh_c": {"x": 380.0553232949826, "y": 196.7216203331348}}, "flux": 11.381363595251807}, "original_bigg_id": "GAPD"}}, {"id": "GLCpts", "name": "D-glucose transport via PEP:Pyr PTS", "metabolites": {"g6p_c": 1, "glc__D_e": -1, "pep_c": -1, "pyr_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"x": 74.07382680101327, "reversibility": false, "y": 47.09257932828508, "cofactors": {"pyr_c": {"x": 58.002541538494754, "y": 78.79946293784405}, "pep_c": {"x": 31.480504681410935, "y": 60.264936292496046}}, "flux": 1.0}, "original_bigg_id": "GLCpts"}}, {"id": "GND", "name": "phosphogluconate dehydrogenase", "metabolites": {"6pgc_c": -1, "co2_c": 1, "nadp_c": -1, "nadph_c": 1, "ru5p__D_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0232", "notes": {"Enzymes": ["1.1.1.44", "1.1.1.351"], "KEGG": "R01528", "MetaCyc": "RXN-9952", "map_info": {"x": 264.4839278394269, "reversibility": false, "y": 19.07008358081694, "cofactors": {"nadph_c": {"x": 321.66670403486387, "y": 30.554305302939596}, "co2_c": {"x": 316.74655609093656, "y": 15.396386542933953}}, "flux": 0.0}, "original_bigg_id": "GND"}}, {"id": "H2Ot", "name": "R_H2O_transport_via_diffusion", "metabolites": {"h2o_c": 1, "h2o_e": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": true, "hidden": true, "flux": 0.4413985604584232}, "original_bigg_id": "H2Ot"}}, {"id": "MALt2_2", "name": "R_Malate_transport_via_proton_symport__2_H", "metabolites": {"h_c": 2, "h_e": -2, "mal__L_c": 1, "mal__L_e": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 0.0}, "original_bigg_id": "MALt2_2"}}, {"id": "MDH", "name": "malate dehydrogenase", "metabolites": {"h_c": 1, "mal__L_c": -1, "nad_c": -1, "nadh_c": 1, "oaa_c": 1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_1612", "notes": {"Enzymes": ["1.1.1.37", "1.1.1.299"], "KEGG": "R00342", "MetaCyc": "MALATE-DEH-RXN", "map_info": {"x": 168.8757596691594, "reversibility": true, "y": 483.36967508245345, "cofactors": {"nadh_c": {"x": 137.77353012291036, "y": 432.74976774451216}}, "group": 2, "flux": -7.541642266367215}, "original_bigg_id": "MDH"}}, {"id": "ME2", "name": "malic enzyme (NADP)", "metabolites": {"co2_c": 1, "mal__L_c": -1, "nadp_c": -1, "nadph_c": 1, "pyr_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0669", "notes": {"Enzymes": ["1.1.1.40"], "KEGG": "R00216", "MetaCyc": "MALIC-NADP-RXN", "map_info": {"x": 205.61003807650025, "reversibility": false, "y": 491.3126487628525, "cofactors": {"nadph_c": {"x": 218.02399667262947, "y": 536.0931373872677}, "co2_c": {"x": 235.94197276702695, "y": 520.8345509714555}}, "flux": 2.9097162445282017}, "original_bigg_id": "ME2"}}, {"id": "NADH16", "name": "NADH dehydrogenase (ubiquinone-8 & 3 protons)", "metabolites": {"h_c": -4, "h_e": 3, "nad_c": 1, "nadh_c": -1, "q8_c": -1, "q8h2_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": false, "cofactors": {"q8_c": {}, "nadh_c": {}, "q8h2_c": {}}, "flux": 4.631926021839013}, "original_bigg_id": "NADH16"}}, {"id": "NADTRHD", "name": "NAD transhydrogenase", "metabolites": {"nad_c": -1, "nadh_c": 1, "nadp_c": 1, "nadph_c": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "Asuc_1021 or Asuc_1022", "notes": {"Enzymes": ["1.6.1.1", "1.6.1.2", "1.6.1.3"], "KEGG": "R00112", "MetaCyc": "PYRNUTRANSHYDROGEN-RXN", "map_info": {"hidden": true, "reversibility": false, "cofactors": {"nadph_c": {}, "nadh_c": {}}, "flux": 0.0}, "original_bigg_id": "NADTRHD"}}, {"id": "O2t", "name": "R_o2_transport__diffusion", "metabolites": {"o2_c": 1, "o2_e": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": true, "hidden": true, "flux": 0.0}, "original_bigg_id": "O2t"}}, {"id": "PDH", "name": "pyruvate dehydrogenase", "metabolites": {"accoa_c": 1, "co2_c": 1, "coa_c": -1, "nad_c": -1, "nadh_c": 1, "pyr_c": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0942 or Asuc_0944 or Asuc_0943", "notes": {"Enzymes": ["1.2.4.1", "1.8.1.4", "2.3.1.12"], "KEGG": "R00209", "MetaCyc": "PYRUVDEH-RXN", "map_info": {"x": 316.9307329456555, "reversibility": false, "y": 466.0116167359042, "cofactors": {"co2_c": {"x": 300.80184508575394, "y": 520.1979178366431}, "nadh_c": {"x": 280.4304995293506, "y": 502.42259256641546}}, "flux": 0.0}, "original_bigg_id": "PDH"}}, {"id": "PFK", "name": "phosphofructokinase", "metabolites": {"adp_c": 1, "atp_c": -1, "f6p_c": -1, "fdp_c": 1, "h_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0687", "notes": {"Enzymes": ["2.7.1.11"], "KEGG": "R00756", "MetaCyc": "6PFRUCTPHOS-RXN", "map_info": {"x": 133.80538618985943, "reversibility": false, "y": 216.73428030936736, "cofactors": {"atp_c": {"x": 79.98019294099704, "y": 218.81350203548726}}, "flux": 4.768514602639647}, "original_bigg_id": "PFK"}}, {"id": "PFL", "name": "pyruvate formate lyase", "metabolites": {"accoa_c": 1, "coa_c": -1, "for_c": 1, "pyr_c": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0207", "notes": {"Enzymes": ["2.3.1.54"], "KEGG": "R00212", "MetaCyc": "PYRUVFORMLY-RXN", "map_info": {"x": 345.3829389128512, "reversibility": false, "y": 467.39393224318394, "flux": 5.2054413762408345}, "original_bigg_id": "PFL"}}, {"id": "PGI", "name": "glucose-6-phosphate isomerase", "metabolites": {"f6p_c": 1, "g6p_c": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_1425", "notes": {"Enzymes": ["5.3.1.9"], "KEGG": "R00771", "MetaCyc": "PGLUCISOM-RXN", "map_info": {"x": 91.98307808744356, "reversibility": true, "y": 115.95617458755262, "flux": 0.9522926445572812}, "original_bigg_id": "PGI"}}, {"id": "PGK", "name": "phosphoglycerate kinase", "metabolites": {"13dpg_c": 1, "3pg_c": -1, "adp_c": 1, "atp_c": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0535", "notes": {"Enzymes": ["2.7.2.3"], "KEGG": "R01512", "MetaCyc": "PHOSGLYPHOS-RXN", "map_info": {"x": 389.9618138227907, "reversibility": true, "y": 258.5231106462878, "cofactors": {"atp_c": {"x": 420.31493574154047, "y": 278.9922657220668}}, "flux": -11.381363595251807}, "original_bigg_id": "PGK"}}, {"id": "PGM", "name": "phosphoglycerate mutase", "metabolites": {"2pg_c": -1, "3pg_c": 1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0572 or Asuc_1383", "notes": {"Enzymes": ["5.4.2.11", "5.4.2.12"], "KEGG": "R01518", "MetaCyc": "3PGAREARR-RXN", "map_info": {"x": 367.8069554754235, "reversibility": true, "y": 341.2765723756918, "flux": -11.03321625992348}, "original_bigg_id": "PGM"}}, {"id": "PIt2r", "name": "R_phosphate_reversible_transport_via_symport", "metabolites": {"h_c": 1, "h_e": -1, "pi_c": 1, "pi_e": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": true, "hidden": true, "flux": 0.0}, "original_bigg_id": "PIt2r"}}, {"id": "PPCK", "name": "phosphoenolpyruvate carboxykinase", "metabolites": {"adp_c": 1, "atp_c": -1, "co2_c": 1, "oaa_c": -1, "pep_c": 1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0221", "notes": {"Enzymes": ["4.1.1.49"], "KEGG": "R00341", "MetaCyc": "PEPCARBOXYKIN-RXN", "map_info": {"x": 225.14157388231007, "reversibility": true, "y": 384.6537560731797, "cofactors": {"co2_c": {"x": 195.29336942169803, "y": 342.9377798390681}, "atp_c": {"x": 172.8741869016683, "y": 380.0570124689461}}, "group": 2, "flux": -7.957440958901389}, "original_bigg_id": "PPCK"}}, {"id": "PTAr", "name": "phosphotransacetylase", "metabolites": {"accoa_c": -1, "actp_c": 1, "coa_c": 1, "pi_c": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_1662", "notes": {"Enzymes": ["2.3.1.8"], "KEGG": "R00230", "MetaCyc": "PHOSACETYLTRANS-RXN", "map_info": {"x": 337.56678237297814, "reversibility": true, "y": 551.3180861798992, "flux": 4.3332578312250725}, "original_bigg_id": "PTAr"}}, {"id": "PYK", "name": "pyruvate kinase", "metabolites": {"adp_c": -1, "atp_c": 1, "h_c": -1, "pep_c": -1, "pyr_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "Asuc_1171", "notes": {"Enzymes": ["2.7.1.40"], "KEGG": "R00200", "MetaCyc": "PEPDEPHOS-RXN", "map_info": {"x": 275.7553622814589, "reversibility": false, "y": 374.0973638547674, "cofactors": {"atp_c": {"x": 310.9807956946766, "y": 386.16479587096}}, "flux": 1.9549709682888459}, "original_bigg_id": "PYK"}}, {"id": "PYRt2", "name": "R_pyruvate_transport_in_via_proton_symport", "metabolites": {"h_c": 1, "h_e": -1, "pyr_c": 1, "pyr_e": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": true, "hidden": true, "flux": 0.0}, "original_bigg_id": "PYRt2r"}}, {"id": "RPE", "name": "ribulose 5-phosphate 3-epimerase", "metabolites": {"ru5p__D_c": -1, "xu5p__D_c": 1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0218", "notes": {"Enzymes": ["5.1.3.1"], "KEGG": "R01529", "MetaCyc": "RIBULP3EPIM-RXN", "map_info": {"x": 325.8088418501407, "reversibility": true, "y": 97.32403922907261, "flux": -2.1672782784986646}, "original_bigg_id": "RPE"}}, {"id": "RPI", "name": "ribose-5-phosphate isomerase", "metabolites": {"r5p_c": -1, "ru5p__D_c": 1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_1580 or Asuc_1597 or Asuc_1870", "notes": {"Enzymes": ["5.3.1.6"], "KEGG": "R01056", "MetaCyc": "RIB5PISOM-RXN", "map_info": {"x": 283.881107839456, "reversibility": true, "y": 67.29564196697308, "flux": -2.1672782784986646}, "original_bigg_id": "RPI"}}, {"id": "SUCCt2_2", "name": "R_succinate_transport_via_proton_symport__2_H", "metabolites": {"h_c": 2, "h_e": -2, "succ_c": 1, "succ_e": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 0.0}, "original_bigg_id": "SUCCt2_2"}}, {"id": "SUCCt3", "name": "succinate transport out via proton antiport", "metabolites": {"h_c": 1, "h_e": -1, "succ_c": -1, "succ_e": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 4.631926021839013}, "original_bigg_id": "SUCCt3"}}, {"id": "TALA", "name": "transaldolase", "metabolites": {"e4p_c": 1, "f6p_c": 1, "g3p_c": -1, "s7p_c": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0582", "notes": {"Enzymes": ["2.2.1.2"], "KEGG": "R08575", "MetaCyc": "TRANSALDOL-RXN", "map_info": {"x": 180.55593569906966, "reversibility": true, "y": 166.4198058730998, "flux": 1.9583666054209639}, "original_bigg_id": "TALA"}}, {"id": "THD2", "name": "R_NAD_P__transhydrogenase", "metabolites": {"h_c": 2, "h_e": -2, "nad_c": 1, "nadh_c": -1, "nadp_c": -1, "nadph_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "Asuc_1021 or Asuc_1022", "notes": {"Enzymes": ["1.6.1.2"], "map_info": {"hidden": true, "reversibility": false, "cofactors": {"nadph_c": {}, "nadh_c": {}}, "flux": 0.0}, "original_bigg_id": "THD2"}}, {"id": "TKT1", "name": "transketolase", "metabolites": {"g3p_c": 1, "r5p_c": -1, "s7p_c": 1, "xu5p__D_c": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0170 or Asuc_0171 or Asuc_0265", "notes": {"Enzymes": ["2.2.1.1"], "KEGG": "R01641", "MetaCyc": "1TRANSKETO-RXN", "map_info": {"x": 274.51468969512905, "reversibility": true, "y": 156.8092631665833, "flux": 1.9583666054209639}, "original_bigg_id": "TKT1"}}, {"id": "TKT2", "name": "transketolase", "metabolites": {"e4p_c": -1, "f6p_c": 1, "g3p_c": 1, "xu5p__D_c": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0170 or Asuc_0171 or Asuc_0265", "notes": {"Enzymes": ["2.2.1.1"], "KEGG": "R01067", "MetaCyc": "2TRANSKETO-RXN", "map_info": {"x": 231.48068334636415, "reversibility": true, "y": 136.77351849450065, "flux": 1.8743551160803715}, "original_bigg_id": "TKT2"}}, {"id": "TPI", "name": "triose-phosphate isomerase", "metabolites": {"dhap_c": -1, "g3p_c": 1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0677 or Asuc_1575 or Asuc_1601", "notes": {"Enzymes": ["5.3.1.1"], "KEGG": "R01015", "MetaCyc": "TRIOSEPISOMERIZATION-RXN", "map_info": {"x": 297.1596302668127, "reversibility": true, "y": 237.50395472210562, "flux": 4.768514602639647}, "original_bigg_id": "TPI"}}, {"id": "OAADC", "name": "OXALODECARB-RXN", "metabolites": {"co2_c": 1, "h_c": -1, "oaa_c": -1, "pyr_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "Asuc_0301 or Asuc_0302 or Asuc_0303", "subsystem": "PWY-6339, METHYLGALLATE-DEGRADATION-PWY, P184-PWY", "notes": {"BIOCYC": ["OXALODECARB-RXN"], "CONFIDENCE LEVEL": ["4"], "Enzymes": ["1.1.1.38", "4.1.1.3"], "KEGG": ["R00217"], "RHEA": ["15641"], "map_info": {"x": 248.3832451334038, "reversibility": false, "y": 438.2336301142614, "cofactors": {"co2_c": {"x": 253.12970865514836, "y": 411.3388431800438}}, "flux": 0.0}, "orig_id": "OXALODECARB-RXN"}}, {"id": "FDH", "name": "1.2.1.2-RXN", "metabolites": {"co2_c": 1, "for_c": -1, "nad_c": -1, "nadh_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "Asuc_1264 or Asuc_1265 or Asuc_1704", "subsystem": "PWY-1881, PWY-5497, P164-PWY, PWY-6696", "notes": {"BIOCYC": ["1.2.1.2-RXN"], "CONFIDENCE LEVEL": ["2"], "Enzymes": ["1.2.1.2"], "KEGG": ["R00519"], "RHEA": ["15985"], "map_info": {"x": 423.4407901556308, "reversibility": false, "hidden": false, "cofactors": {"nadh_c": {"x": 463.5330220895758, "y": 493.4239508909179}}, "y": 496.2018904466845, "flux": 0.0}, "orig_id": "_1.2.1.2-RXN"}}, {"id": "H2RED", "name": "H2RED", "metabolites": {"h2_e": -1, "h_c": -2, "h_e": 2, "q8_c": -1, "q8h2_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": false, "cofactors": {"q8_c": {}, "q8h2_c": {}}, "flux": 0.0}}}, {"id": "EX_h2_e", "name": "EX_h2_e", "metabolites": {"h2_e": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 0.0}}}, {"id": "GLCabc", "name": "GLCabc", "metabolites": {"adp_c": 1, "atp_c": -1, "glc__D_c": 1, "glc__D_e": -1, "h2o_c": -1, "h_c": 1, "pi_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": false, "cofactors": {"atp_c": {}}, "flux": 0.0}}}, {"id": "GLK", "name": "Glucokinase", "metabolites": {"adp_c": 1, "atp_c": -1, "g6p_c": 1, "glc__D_c": -1, "h_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": false, "cofactors": {"atp_c": {}}, "flux": 0.0}}}, {"id": "EX_xyl_e", "name": "EX_xyl_e", "metabolites": {"xyl__D_e": -1}, "lower_bound": -6, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": true, "hidden": true, "flux": -6.0}}}, {"id": "XYLT", "name": "XYLT", "metabolites": {"h_c": 1, "h_e": -1, "xyl__D_c": 1, "xyl__D_e": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 6.0}}}, {"id": "XYLI", "name": "xylose isomerase", "metabolites": {"xyl__D_c": -1, "xylu__D_c": 1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"x": 409.74618702609604, "reversibility": true, "y": 101.00702504959148, "flux": 6.0}}}, {"id": "XYLK", "name": "xylulokinase", "metabolites": {"adp_c": 1, "atp_c": -1, "h_c": 1, "xu5p__D_c": 1, "xylu__D_c": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"x": 355.274637558575, "reversibility": true, "y": 134.06484742133145, "cofactors": {"atp_c": {"x": 391.9735184439857, "y": 141.7113484973318}}, "flux": 6.0}}}, {"id": "EX_arab_e", "name": "EX_arab_e", "metabolites": {"arab__D_e": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 0.0}}}, {"id": "ARABT", "name": "ARABT", "metabolites": {"adp_c": 1, "arab__D_c": 1, "arab__D_e": -1, "atp_c": -1, "h2o_c": -1, "h_c": 1, "pi_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": false, "cofactors": {"atp_c": {}}, "flux": 0.0}}}, {"id": "AKI", "name": "AKI", "metabolites": {"arab__D_c": -1, "rbl__D_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"x": 412.8530223543729, "reversibility": false, "y": -12.086736195040189, "hidden": true, "flux": 0.0}}}, {"id": "arab_ptrans", "name": "arab_ptrans", "metabolites": {"adp_c": 1, "atp_c": -1, "h_c": 1, "rbl__D_c": -1, "ru5p__D_c": 1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"x": 367.9683175146411, "reversibility": true, "hidden": true, "cofactors": {"atp_c": {}}, "y": 11.104788301272038, "flux": 0.0}}}, {"id": "EX_galac_e", "name": "EX_galac_e", "metabolites": {"gal_e": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 0.0}}}, {"id": "GALACT", "name": "GALACT", "metabolites": {"adp_c": 1, "atp_c": -1, "gal_c": 1, "gal_e": -1, "h2o_c": -1, "h_c": 1, "pi_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": false, "cofactors": {"atp_c": {}}, "flux": 0.0}}}, {"id": "GALACP", "name": "GALACP", "metabolites": {"adp_c": 1, "atp_c": -1, "gal1p_c": 1, "gal_c": -1, "h_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"x": 4.867197102182892, "reversibility": false, "hidden": true, "cofactors": {"atp_c": {}}, "y": 64.34888023257503, "flux": 0.0}}}, {"id": "GALUTRANS", "name": "GALUTRANS", "metabolites": {"g1p_c": 1, "gal1p_c": -1, "udpg_c": -1, "udpgal_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"x": 22.99337196476698, "reversibility": false, "y": 24.975832474358228, "hidden": true, "flux": 0.0}}}, {"id": "UDP_RECYC", "name": "UDP_RECYC", "metabolites": {"udpg_c": -1, "udpgal_c": 1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": true, "hidden": true, "flux": 0.0}}}, {"id": "G1PPI", "name": "G1PPI", "metabolites": {"g1p_c": -1, "g6p_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"x": 68.14513967049888, "reversibility": false, "y": 6.471010071849321, "hidden": true, "flux": 0.0}}}, {"id": "EX_biomass", "name": "", "metabolites": {"biomass": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "objective_coefficient": 1.0, "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 0.22334499378473902}}}, {"id": "biomass", "name": "A. succinogenes 130z biomass formation", "metabolites": {"3pg_c": -1.5587872798432814, "accoa_c": -3.9050955664416107, "adp_c": 26, "atp_c": -26, "biomass": 1, "co2_c": 13.753651140545564, "coa_c": 3.9050955664416107, "e4p_c": -0.37615120857180784, "f6p_c": -0.07387568057546033, "g3p_c": -0.1344141437832776, "g6p_c": -0.2136038719036582, "h2o_c": -31.587866869298622, "h_c": 35.4809, "nad_c": -3.547, "nadh_c": 3.547, "nadp_c": 13.0279, "nadph_c": -13.0279, "oaa_c": -1.8616879899037369, "pep_c": -0.5408866824643365, "pi_c": 29.833095432058474, "pyr_c": -2.9516929186765024, "r5p_c": -0.9353765649166534}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": false, "cofactors": {"nadph_c": {}, "co2_c": {}, "atp_c": {}, "nadh_c": {}}, "flux": 0.22334499378473902}}}, {"id": "EX_atpm", "name": "", "metabolites": {"atpm": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 4.701484070350633}}}, {"id": "LDH_D", "name": "D-lactate dehydrogenase", "metabolites": {"h_c": 1, "lac__D_c": -1, "nad_c": -1, "nadh_c": 1, "pyr_c": 1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "(b2133 or b1380)", "notes": {"Enzymes": ["1.1.1.28"], "KEGG": "R00704", "MetaCyc": "DLACTDEHYDROGNAD-RXN", "map_info": {"x": 394.36957371174753, "reversibility": true, "y": 396.6707449188173, "cofactors": {"nadh_c": {"x": 375.7087967758144, "y": 430.8530168183352}}, "flux": 0.0}, "original_bigg_id": "LDH_D"}}, {"id": "D_LACt2", "name": "R_D_lactate_transport_via_proton_symport", "metabolites": {"h_c": 1, "h_e": -1, "lac__D_c": 1, "lac__D_e": -1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "( b2975  or  b3603 )", "notes": {"map_info": {"reversibility": true, "hidden": true, "flux": 0.0}, "original_bigg_id": "D_LACt2"}}, {"id": "EX_lac__D_e", "name": "D-lactate exchange", "metabolites": {"lac__D_e": -1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "", "notes": {"map_info": {"reversibility": false, "hidden": true, "flux": 0.0}, "original_bigg_id": "EX_lac_D_e"}}, {"id": "G6PDH2r", "name": "glucose 6-phosphate dehydrogenase", "metabolites": {"6pgc_c": 1, "g6p_c": -1, "h2o_c": -1, "h_c": 2, "nadp_c": -1, "nadph_c": 1}, "lower_bound": -1000, "upper_bound": 1000, "gene_reaction_rule": "(Asuc_0227) and (Asuc_0228)", "notes": {"Enzymes": ["1.1.1.49", "1.1.1.363"], "KEGG": "R00835", "MetaCyc": "GLU6PDEHYDROG-RXN", "map_info": {"x": 147.73235676719128, "reversibility": true, "y": 24.99947127525205, "cofactors": {"nadph_c": {"x": 180.3723335905413, "y": 34.60991459649382}}, "flux": 0.0}, "original_bigg_id": "G6PDH2r"}}, {"id": "ALDD2x", "name": "aldehyde dehydrogenase (acetaldehyde, NAD)", "metabolites": {"ac_c": 1, "acald_c": -1, "h2o_c": -1, "h_c": 2, "nad_c": -1, "nadh_c": 1}, "lower_bound": 0, "upper_bound": 1000, "gene_reaction_rule": "b1300", "notes": {"map_info": {"reversibility": false, "cofactors": {"nadh_c": {"x": 349.85825961700823, "y": 640.8539741979195}}, "x": 351.1322090979263, "y": 609.5077876523435, "flux": 0.0}}}], "genes": [{"id": "Asuc_0591", "name": "Asuc_0591", "notes": {"map_info": {}}}, {"id": "Asuc_1661", "name": "Asuc_1661", "notes": {"map_info": {}}}, {"id": "Asuc_0185", "name": "Asuc_0185", "notes": {"map_info": {}}}, {"id": "Asuc_1819", "name": "fabG", "notes": {"map_info": {}}}, {"id": "Asuc_0403", "name": "Asuc_0403", "notes": {"map_info": {}}}, {"id": "Asuc_0326", "name": "Asuc_0326", "notes": {"map_info": {}}}, {"id": "Asuc_0328", "name": "Asuc_0328", "notes": {"map_info": {}}}, {"id": "Asuc_2051", "name": "fabG", "notes": {"map_info": {}}}, {"id": "Asuc_0536", "name": "Asuc_0536", "notes": {"map_info": {}}}, {"id": "Asuc_0394", "name": "fabG", "notes": {"map_info": {}}}, {"id": "Asuc_1073", "name": "Asuc_1073", "notes": {"map_info": {}}}, {"id": "Asuc_1813", "name": "Asuc_1813", "notes": {"map_info": {}}}, {"id": "Asuc_1814", "name": "Asuc_1814", "notes": {"map_info": {}}}, {"id": "Asuc_0956", "name": "fabG", "notes": {"map_info": {}}}, {"id": "Asuc_0227", "name": "Asuc_0227", "notes": {"map_info": {}}}, {"id": "Asuc_1027", "name": "Asuc_1027", "notes": {"map_info": {}}}, {"id": "Asuc_0232", "name": "Asuc_0232", "notes": {"map_info": {}}}, {"id": "Asuc_1612", "name": "Asuc_1612", "notes": {"map_info": {}}}, {"id": "Asuc_0669", "name": "Asuc_0669", "notes": {"map_info": {}}}, {"id": "Asuc_1021", "name": "fabG", "notes": {"map_info": {}}}, {"id": "Asuc_1022", "name": "fabG", "notes": {"map_info": {}}}, {"id": "Asuc_0942", "name": "fabG", "notes": {"map_info": {}}}, {"id": "Asuc_0944", "name": "Asuc_0944", "notes": {"map_info": {}}}, {"id": "Asuc_0943", "name": "fabG", "notes": {"map_info": {}}}, {"id": "Asuc_0687", "name": "Asuc_0687", "notes": {"map_info": {}}}, {"id": "Asuc_0207", "name": "Asuc_0207", "notes": {"map_info": {}}}, {"id": "Asuc_1425", "name": "fabG", "notes": {"map_info": {}}}, {"id": "Asuc_0535", "name": "fabG", "notes": {"map_info": {}}}, {"id": "Asuc_0228", "name": "Asuc_0228", "notes": {"map_info": {}}}, {"id": "Asuc_0572", "name": "fabG", "notes": {"map_info": {}}}, {"id": "Asuc_1383", "name": "Asuc_1383", "notes": {"map_info": {}}}, {"id": "Asuc_0221", "name": "Asuc_0221", "notes": {"map_info": {}}}, {"id": "Asuc_1662", "name": "Asuc_1662", "notes": {"map_info": {}}}, {"id": "Asuc_1171", "name": "Asuc_1171", "notes": {"map_info": {}}}, {"id": "Asuc_0218", "name": "Asuc_0218", "notes": {"map_info": {}}}, {"id": "Asuc_1580", "name": "Asuc_1580", "notes": {"map_info": {}}}, {"id": "Asuc_1597", "name": "Asuc_1597", "notes": {"map_info": {}}}, {"id": "Asuc_1870", "name": "Asuc_1870", "notes": {"map_info": {}}}, {"id": "Asuc_0582", "name": "Asuc_0582", "notes": {"map_info": {}}}, {"id": "Asuc_0170", "name": "Asuc_0170", "notes": {"map_info": {}}}, {"id": "Asuc_0171", "name": "Asuc_0171", "notes": {"map_info": {}}}, {"id": "Asuc_0265", "name": "Asuc_0265", "notes": {"map_info": {}}}, {"id": "Asuc_0677", "name": "fabG", "notes": {"map_info": {}}}, {"id": "Asuc_1575", "name": "Asuc_1575", "notes": {"map_info": {}}}, {"id": "Asuc_1601", "name": "Asuc_1601", "notes": {"map_info": {}}}, {"id": "Asuc_0301", "name": "Asuc_0301", "notes": {"map_info": {}}}, {"id": "Asuc_0302", "name": "Asuc_0302", "notes": {"map_info": {}}}, {"id": "Asuc_0303", "name": "Asuc_0303", "notes": {"map_info": {}}}, {"id": "Asuc_1264", "name": "Asuc_1264", "notes": {"map_info": {}}}, {"id": "Asuc_1265", "name": "Asuc_1265", "notes": {"map_info": {}}}, {"id": "Asuc_1704", "name": "Asuc_1704", "notes": {"map_info": {}}}, {"id": "b1380", "name": "ldhA", "notes": {"map_info": {}}}, {"id": "b2133", "name": "dld", "notes": {"map_info": {}}}, {"id": "b3603", "name": "lldP", "notes": {"map_info": {}}}, {"id": "b2975", "name": "glcA", "notes": {"map_info": {}}}, {"id": "b1300", "name": "b1300"}], "id": "asuc_v1", "name": "A. Succinogenes CCM Model", "compartments": {"": "", "c": "", "e": ""}, "notes": {"map_info": {}}};

require.config({
  paths: {
    d3: "https://d3js.org/d3.v3.min",
    cola: "http://marvl.infotech.monash.edu/webcola/cola.v3.min",
    math: "https://cdnjs.cloudflare.com/ajax/libs/mathjs/2.4.0/math.min",
    FileSaver: "https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2014-11-29/FileSaver.min",
  },
  shim: {
    'cola': {
      exports: 'cola'
    }
  }
});

require(["cola", "d3", "math", "FileSaver",], function (cola, d3, math, FileSaver) {

  function main(model) {
    // Render a metabolic network representation of a cobra.Model object.
    //
    // `model` is a json-serialized representation of a metabolic network,
    // generated by cobra.display.flux_analysis.create_model_json

    // Height and width of the SVG figure, passed via jinja2
    var width = 748,
    height = 700;

    // var color = d3.scale.category10();

    // Reaction color allows different reaction groups to be colored
    // accordingly. Grouping is mainly handled by color_redox_reactions. First
    // group ('undefined') is for normal reactions (gray). Second group is for
    // knocked-out reactions, (red). Others are rendered in different
    // contrasting colors
    var rxncolor = d3.scale.ordinal()
      // .range(["#bbb", "#d62728", "#ff7f0e", "#2ca02c", "#9467bd",
      //         "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf"])
      .range(["#bbb", "#d62728",
        "#eb6a9b",
        "#6f3589",
        "#f18572",
        "#246035",
        "#009fea",
        "#83522b",
        "#29378a",
        "#989033"])
      .domain([undefined, 'ko', 1, 2, 3, 4, 5, 6, 7, 8]);

    // Initialize the d3 force diagram. Parameters like charge, gavity, and
    // link distance are currently hard-coded in -- probably should change
    // this?
    var force = cola.d3adaptor()
      .linkDistance(30)
      
      .size([width, height]);
    // var force = d3.layout.force()
    //   .linkDistance(30)
    //   .charge(-100)
    //   .chargeDistance(400)
    //   .gravity(.015)
    //   .size([width, height]);

    // Allow for a background SVG template if one has been provided, otherwise
    // initalize the svg canvas
    if (true) {
      var svg = d3.select("#d3flux001").append("svg")
        .attr("viewBox", "0 0 748 700")
        .attr("style", "display:block;margin:auto;width:100%");
    } else {
      var svg = d3.select("#d3flux001").select("svg");
    }

    // Append the CSS styles
    svg.append("style").text(".node.rxn{fill:#ffa319}.node.rxn.hidden{fill:none;stroke:none;stroke-width:0}.link{fill:none;stroke-linecap:round}text.nodelabel{font-size:12pt;fill:#555;font-family:Arial}text.nodelabel.cofactor{font-size:9.600000000000001pt;fill:#789}text.nodelabel.rxn{fill:#a9a9a9;font-size:9.600000000000001pt;font-style:italic}marker.inactive,.node.inactive,text.inactive{fill-opacity:.5}.link.inactive{stroke-opacity:.5}");

    // Code for the figure manipulation buttons.
    d3.select("#d3flux001_options .reactionbutton").on("click", function() {
      // Show/hide the reaction control node points.
      // _note: HTMLjquery
      var $this = $(this);
      $this.toggleClass('btn-danger');
      d3.selectAll(".node.rxn")
        .classed("hidden", function (d, i) {
          return !d3.select(this).classed("hidden");
        });
      if($this.hasClass('btn-danger')){
        $this.text('Hide Reaction Nodes');
      } else {
        $this.text('Show Reaction Nodes');
      }
    });

    d3.select("#d3flux001_options .svgbutton").on("click", function() { 
      // Download the svg using SVG Crowbar. This is still very buggy.

      var e = document.createElement('script'); 
      e.setAttribute('src', 'https://rawgit.com/pstjohn/svg-crowbar/gh-pages/svg-crowbar.js'); 
      e.setAttribute('class', 'svg-crowbar'); 
      document.body.appendChild(e); 
    });

    function calc_imag_angle(x1, y1, x2, y2) {
      // Function to calculate the imaginary angle of the line between two
      // points. Used to find the average direction to the metabolites of a
      // reaction node
      var calcAngleVal = Math.atan2(x1-x2,y1-y2);
      return math.exp(math.multiply(math.i, calcAngleVal));
    }

    function average_angles(rxn, rstoich, nodes) {
      // Find the slope of the line through the reaction node as a function of
      // the current position of the metabolites. Reactants and products are
      // separated and placed on opposite ends of the nodes.
      //
      // Looks like for cofactors, rstoich could be set to zero to remove the
      // effect on the reaction slope. 
      var angles = []
      for (var n in rstoich) {
        if (!('cofactor' in nodes[n])) {
          var angle = calc_imag_angle(rxn.x, rxn.y, nodes[n].x, nodes[n].y);
          angles.push([math.multiply(angle, rstoich[n])]);
        }
      }
      return math.mean(angles).toPolar().phi;
    }

    function average_dist(rxn, rstoich, nodes) {
      // Calculate the average distance to the reaction nodes, which is used to
      var dist = []
      for (var n in rstoich) {
        var this_dist = math.sqrt(math.square(rxn.x - nodes[n].x) 
            + math.square(rxn.y - nodes[n].y));
        dist.push([this_dist]);
      }
      return math.mean(dist);
    }

    function calculate_path(d, force) {
      var s = d.source,
      t = d.target,
      r = d.rxn,
      a=.1, b=.1,
      cp_inv = {};

      var angle = average_angles(r, d.rstoich, force.nodes());
      var dist = average_dist(r, d.rstoich, force.nodes());

      cp = new Point2D(r.x - math.multiply(.5*dist, math.sin(angle)),
                 r.y - math.multiply(.5*dist, math.cos(angle)));

      cp_inv = new Point2D(r.x + math.multiply(.5*dist, math.sin(angle)),
                     r.y + math.multiply(.5*dist, math.cos(angle)));

      s_point = new Point2D(s.x, s.y)
      r_point = new Point2D(r.x, r.y)
      t_point = new Point2D(t.x, t.y)

      var padding = 5;
      // var total_len = quadraticBezierLength(s, cp, r) + quadraticBezierLength(r, cp_inv, t);


      // Adjust control points to start late and stop early
      if (plot_reverse_arrowhead(d.rxn)) {

        first_intersect = Intersection.intersectBezier2Circle(
    s_point, cp, r_point, s_point, 
    padding + arrowhead_scale(get_flux_width(d.rxn)) + get_node_radius(s)).slice(0)[0];
        last_intersect = Intersection.intersectBezier2Circle(
    r_point, cp_inv, t_point, t_point, 
    padding + arrowhead_scale(get_flux_width(d.rxn)) + get_node_radius(t)).slice(-1)[0];
        a = first_intersect;
        b = last_intersect;

      }
      else {

        first_intersect = Intersection.intersectBezier2Circle(
    s_point, cp, r_point, s_point, padding + get_node_radius(s)).slice(0)[0];
        last_intersect = Intersection.intersectBezier2Circle(
    r_point, cp_inv, t_point, t_point,
    padding + arrowhead_scale(get_flux_width(d.rxn)) + get_node_radius(t)).slice(-1)[0];
        a = first_intersect;
        b = last_intersect;

        // b = 1 - (padding + arrowhead_scale(get_flux_width(d.rxn)))/total_len;
      }
            
      var source_x = s.x*a**2 - 2*s.x*a + s.x - 2*cp.x*a**2 + 2*cp.x*a + r.x*a**2;
      var source_y = s.y*a**2 - 2*s.y*a + s.y - 2*cp.y*a**2 + 2*cp.y*a + r.y*a**2;

      var cp_x = -cp.x*a + cp.x + r.x*a;
      var cp_y = -cp.y*a + cp.y + r.y*a;

      var cp_inv_x = -r.x*b + r.x + cp_inv.x*b
      var cp_inv_y = -r.y*b + r.y + cp_inv.y*b

      var target_x = r.x*b**2 - 2*r.x*b + r.x - 2*cp_inv.x*b**2 + 2*cp_inv.x*b + t.x*b**2;
      var target_y = r.y*b**2 - 2*r.y*b + r.y - 2*cp_inv.y*b**2 + 2*cp_inv.y*b + t.y*b**2;

      if ( isFinite(source_x) & isFinite(cp_x) & isFinite(cp_inv_x) & isFinite(target_x) ) {
        return "M" + source_x + "," + source_y
          + " Q" + cp_x + "," + cp_y
          + " " + r.x + "," + r.y
          + " Q" + cp_inv_x + "," + cp_inv_y
          +" " + target_x + "," + target_y;
      } else {
        return "M" + s.x + "," + s.y
          + " L" + r.x + "," + r.y
          +" L" + t.x + "," + t.y;
      }
    }

    // _note: return a boolean of whether to draw reverse arrowhead
    function plot_reverse_arrowhead(rxn) {
     return (((Math.abs(rxn.notes.map_info.flux) < 1E-8) || isNaN(rxn.notes.map_info.flux))
      && rxn.notes.map_info.reversibility);
    }

    // _note: need to distinguish links and bilinks
    // _ans: links include the edge between a source node and a reaction node.
    metabolites = jQuery.extend(true, [], model.metabolites),
    reactions = jQuery.extend(true, [], model.reactions),
    nodes = [],
    node_lookup = {},
    links = [],
    mlinks = [],
    bilinks = []
    rxn_stoich = {};

    var mfluxes = [];
    metabolites.forEach(function(metabolite) {
      if ('notes' in metabolite) {
        if ('map_info' in metabolite.notes) {
          if (metabolite.notes.map_info.hidden) {
            return;
          } else {
            if (false && (Math.abs(metabolite.notes.map_info.flux) < 1E-6)) {
              return;
            }
            mfluxes.push(Math.abs(metabolite.notes.map_info.flux));
          }
        }
      }
      // It's not hidden, add it to the nodes
      nodes.push(metabolite);
    });

    // Create a dictionary-like structure to allow us to look up nodes by their
    // id, rather than numerical index
    for (var i = 0, len = nodes.length; i < len; i++) {
      var node = nodes[i]
      node_lookup[node.id] = i;
    }

    // Handle cofactor metabolites
    reactions.forEach(function(reaction) {
      if ('notes' in reaction) {
        if ('map_info' in reaction.notes) {
          if ('hidden' in reaction.notes.map_info) {
            if (reaction.notes.map_info.hidden) {
              return;
            }
          }
          if (false &&
              (Math.abs(reaction.notes.map_info.flux) < 1E-6)) {
            return;
          } 
          if ('cofactors' in reaction.notes.map_info) {
            for (var cofactor in reaction.notes.map_info.cofactors) {

              var orig_metabolite = obj = $.grep(model.metabolites,
                  function(e){ return e.id == cofactor; })[0];
              var cf_id = cofactor + '_' + reaction.id;

              var cofactor_node = {
                'id' : cf_id,
                'name' : orig_metabolite.name,
                'notes' : {
                  'map_info' : reaction.notes.map_info.cofactors[cofactor],
                  'orig_id' : cofactor
                },
                'cofactor' : reaction.id
              };

              if ('flux' in orig_metabolite.notes.map_info) {
                cofactor_node.notes.map_info['flux'] = orig_metabolite.notes.map_info.flux;
              }

              // Inheret color from original metabolite
              if ('color' in orig_metabolite.notes.map_info) {
                cofactor_node.notes.map_info.color = 
                  orig_metabolite.notes.map_info.color;
              }

              // Get the cofactor display name from the original 
              // metabolite node
              if ('map_info' in orig_metabolite.notes) {
                if (('display_name' in orig_metabolite.notes.map_info) &
	            !('display_name' in cofactor_node.notes.map_info)) {
                  cofactor_node.notes.map_info.display_name =
                    orig_metabolite.notes.map_info.display_name;
                }
              }

              reaction.metabolites[cf_id] = reaction.metabolites[cofactor];
              delete reaction.metabolites[cofactor];

              // Update nodes and node_lookup table
              nodes.push(cofactor_node);
              node_lookup[cf_id]  = nodes.length - 1;

            }
          }
        }
      }
    });


    // Create a dictionary-like structure to allow us to look up nodes by their
    // id, rather than numerical index
    // for (var i = 0, len = nodes.length; i < len; i++) {
    //   var node = nodes[i]
    //   node_lookup[node.id] = i;
    // }

    var fluxes = [];
    reactions.forEach(function(reaction) {

      // Don't add hidden reactions
      if ('notes' in reaction) {
        if ('map_info' in reaction.notes) {
          if (reaction.notes.map_info.hidden) {
            return;
          } else if ('flux' in reaction.notes.map_info) {
            if (false && (Math.abs(reaction.notes.map_info.flux) < 1E-6)) {
              return;
            }
            fluxes.push(Math.abs(reaction.notes.map_info.flux));
            if (reaction.notes.map_info.flux < -1E-10) {
              // If the reaction is flowing in reverse, switch products and
              // reactants.
              for (var item in reaction.metabolites) {
                reaction.metabolites[item] *= -1;
              }
            }
          }
        }
      }

      // !important
      reaction['reactants'] = []
      reaction['products'] = []

      for (var item in reaction.metabolites) {
        if (reaction.metabolites[item] > 0) {
          if (item in node_lookup) {
            // _notes: reaction.metabolites[item] = 1 -> product, = -1 -> reactant
            // Only add if the node hasn't been hidden
            reaction.products.push(item);
          }
        } else if (item in node_lookup) {
          reaction.reactants.push(item);
        }
      }

      var r_length = reaction.reactants.length,
      p_length = reaction.products.length,
      r_node = {
        "id" : reaction.id,
        "type" : "rxn"
      };

      // Add notes to reaction, if it exists (for map_info)
      if ("notes" in reaction) {
        r_node["notes"] = reaction.notes;
      }

      // Don't add links on the boundary
      if (r_length == 0 || p_length == 0) {
        return; 
      }

      // Add reaction to the nodes list, get the current length of the nodes
      // list as the reaction index for later.
      nodes.push(r_node);
      rindex = nodes.length - 1;


      // !important: drawing
      if (r_length >= p_length) {
        reaction.reactants.forEach(function (reactant, i) {
          // Add source -> rxn -> product triplets for drawing the line. For
          // each reactant (product), just get any product (reactant), as the
          // lines will overlap)
          mlinks.push({
            "source" : node_lookup[reactant],
            // _note: ? i % p_length - 1 
            "target" : node_lookup[reaction.products[i % p_length]],
            "rxn" : rindex
          });
        });
      } // else: products > reactants
      else {
        reaction.products.forEach(function (product, i) {
          mlinks.push({
            "source" : node_lookup[reaction.reactants[i % r_length]],
            "target" : node_lookup[product],
            "rxn" : rindex
          });
        });
      }

    });

    // Build the reaction stoichiometry database to remember which nodes are
    // reactants and which are products. Used to calculate path angles.
    // _note: rxn_stoich is the database.
    mlinks.forEach(function(link) {
      if (link.rxn in rxn_stoich) {
        rxn_stoich[link.rxn][link.source] = 1;
        rxn_stoich[link.rxn][link.target] = -1;
      } else {
        rxn_stoich[link.rxn] = {};
        rxn_stoich[link.rxn][link.source] = 1;
        rxn_stoich[link.rxn][link.target] = -1;
      }
    });

    mlinks.forEach(function(link, i) {
      var s = nodes[link.source],
      t = nodes[link.target],
      r = nodes[link.rxn];

      // _note: push 2 objects into links
      links.push({source: s, target: r}, {source: r, target: t});
      //_note: bilinks stand for what?
      bilinks.push({
        "source" : s,
        "target" : t,
        "rxn" : r,
        "rstoich" : rxn_stoich[link.rxn],
        "id": "bilink_" + i
      });
    });

    nodes.forEach( function (node) {
      if ("notes" in node) {
        if ("map_info" in node.notes) {
          if (("x" in node.notes.map_info) && ("y" in node.notes.map_info)) {
            node.x = node.notes.map_info.x;
            node.y = node.notes.map_info.y;
            node.fixed = 1;
          }
        }
      }
    });



    // Modify link strength based on flux:
    // link_strength_scale = d3.scale.pow().exponent(1/2)
    // link_strength_scale = d3.scale.linear()
    //   .domain([d3.min(fluxes), d3.max(fluxes)])
    //   .range([.2, 2]);
    //
    // force
    //   .linkStrength(function (link) {
    //     try {
    //       return link.rxn.notes.map_info.flux;
    //     }
    //     catch(err) {
    //       return 1;
    //     }
    //   });

    force
      .nodes(nodes)
      .links(links)
      .start();

    svg.append("defs").selectAll("marker")
      .data(reactions)
      .enter()
      .append("marker")
      .attr("id", function (d) { return "d3flux001" + d.id; })
      .attr("viewBox", "0 0 10 10")
      .attr("refX", 1)
      .attr("refY", 5)
      .attr("markerUnits", "userSpaceOnUse")
      .attr("markerWidth", "7pt")
      .attr("markerHeight", "7pt")
      .attr("orient", "auto")
      .attr("class", function (d) {
        var labels = "endmarker"
        if ('flux' in d.notes.map_info) {
          // _note: flux = 0 means this reaction is inactive
          if (d.notes.map_info.flux == 0) {
            labels = labels.concat(" inactive");
          }
        }
        return labels;
      })
      .append("path")
      .attr("d", "M 0 0 L 10 5 L 0 10 z");

    svg.append("defs").selectAll("marker")
      .data(reactions)
      .enter()
      .append("marker")
      .attr("id", function (d) { return "d3flux001" + d.id + "_rev"; })
      .attr("viewBox", "0 0 10 10")
      .attr("refX", 9)
      .attr("refY", 5)
      .attr("markerUnits", "userSpaceOnUse")
      .attr("markerWidth", "7pt")
      .attr("markerHeight", "7pt")
      .attr("orient", "auto")
      .attr("class", function (d) {
        var labels = "startmarker"
        if ('flux' in d.notes.map_info) {
          if (d.notes.map_info.flux == 0) {
            labels = labels.concat(" inactive");
          }
        }
        return labels;
      })
      .append("path")
      .attr("d", "M 10,10 0,5 10,0 Z");

    var link = svg.append('g').selectAll(".link")
      .data(bilinks)
      .enter()
      .append("path")
      .attr("class", function (d) {
        var labels = "link d3flux001" + d.rxn.id;
        if ('flux' in d.rxn.notes.map_info) {
          if (d.rxn.notes.map_info.flux == 0) {
            // _note: use labels to select the link.
            labels = labels.concat(" inactive");
          }
        }
        return labels;
      })
      .attr("id", function (d) {
        return d.id;
      })
      .attr("marker-end", function(d) {
        return "url(#d3flux001" + d.rxn.id + ")"; 
      })
      .attr("marker-start", function(d) {
  // Only show the reversible arrow if the reaction isnt carrying flux in
  // a particular direction
        if (plot_reverse_arrowhead(d.rxn)) {
    return "url(#d3flux001" + d.rxn.id + "_rev)";
  }
      });



    var node_drag = force.drag()
      .on("dragstart", dragstart);

    function dragstart(d) {
      d3.select(this).classed("fixed", d.fixed = true);
    }

    function releasenode(d) {
      // of course set the node to fixed so the force doesn't include the node in
      // its auto positioning stuff
      d.fixed = false; 
      force.resume();
    }

    function showInfo(d) {
      return d.id;
    }

    // define the nodes
    var node = svg.append("g").selectAll(".node")
      .data(nodes)
      .enter()
      .append("g")
      .on('dblclick', releasenode)
      .call(node_drag)
      // Show node info on click
      .on("click", function (d) {
        d3.select("#info")
        .property("value", d.id);
        console.log(d.id);
      });


    node.append("circle")
      .attr("class", function(d) {
        var labels = "node";
        if (d.type == 'rxn') {
          labels = labels.concat(" " + d.type + " hidden");
        } else {
          labels = labels.concat(" metabolite");
        }
        if ('flux' in d.notes.map_info) {
          if (d.notes.map_info.flux == 0) {
            labels = labels.concat(" inactive");
          }
        }
        return labels;
      })
      .attr("id", function(d) { return "_" + d.id; })
      .attr("r", 5)
      .style("fill", function(d) { 
        if (d.type != 'rxn') {
          if ('color' in d.notes.map_info) {
            return d.notes.map_info.color;
          } else {
            return '#1f77b4';
          }
        } else return "";});

    // add the text 
    var text = node.append("text")
      .attr("class", function(d) {
        var labels = "nodelabel";
        if ('cofactor' in d) {
          labels = labels.concat(" cofactor");
        }
        if ('flux' in d.notes.map_info) {
          if (d.notes.map_info.flux == 0) {
            labels = labels.concat(" inactive");
          }
        }
        if (d.type == 'rxn') {
	  labels = labels.concat(" rxn");
        }
        return labels;
      })
      .attr("id", function(d) {return d.id})

      .attr("y", function(d) {
        if ('align' in d.notes.map_info) {
          if (d.notes.map_info.align.indexOf("upper") !== -1) {
            return '-.65em';
          }
          else if (d.notes.map_info.align.indexOf("lower") !== -1) {
            return '1.35em';
          }
          else {
            return '.35em';
          }
        } else {
          return '.35em';
        }
      })
      .attr("text-anchor", function(d) {
        if ('align' in d.notes.map_info) {
          if (d.notes.map_info.align.indexOf("left") !== -1) {
            return 'end';
          }
          else if (d.notes.map_info.align.indexOf("center") !== -1) {
            return 'middle';
          }
          else {
            return 'start';
          }
        } else {
          return 'start';
        }
      });
      // .text(function(d) { 
      //   if ('map_info' in d.notes) {
      //     if ('display_name' in d.notes.map_info) {
      //       return d.notes.map_info.display_name;
      //     }}});
      
    text.selectAll("tspan.text")
      .data(function(d) { 
        if ('map_info' in d.notes) {
          if ('display_name' in d.notes.map_info) {
            return d.notes.map_info.display_name.split('\n').map(function(item, index) {
                 return {
                   text : item,
                   notes : d.notes,
                   index : index
                 }})
          }
        }
        // Must not have returned a display name, return the metabolite name
        // instead
        return [{text: d.name, notes: d.notes, index: 0}]; 
      })
      .enter()
      .append("tspan")
      .attr("class", "text")
      .text(d => d.text)
      .attr("dy", function(d) {
        if (d.index == 0) {
          return "0"
        } else {
          return "1.2em"
        }
      })
      .attr("x", function(d) {
        if ('align' in d.notes.map_info) {
          if (d.notes.map_info.align.indexOf("left") !== -1) {
            if ((d.notes.map_info.align.indexOf("upper") !== -1) || 
                (d.notes.map_info.align.indexOf("lower") !== -1)) {
              return '-.6em';
            }
            else {
              return '-.9em';
            }
          }
          else if (d.notes.map_info.align.indexOf("center") !== -1) {
            return '0em';
          }
          else {
            if ((d.notes.map_info.align.indexOf("upper") !== -1) ||
                (d.notes.map_info.align.indexOf("lower") !== -1)) {
              return '.6em';
            }
            else {
              return '.9em';
            }
          }
        }
        else {
          return '.9em';
        }
      });

    var updateNode = function() {
      this.attr("transform", function(d) {
        return "translate(" + Math.max(0, Math.min(width, d.x)) + ","
          + Math.max(0, Math.min(height, d.y)) + ")";
      });
    }

    var updateAnchorLink = function() {
      this.attr("x1", function(d) {
        return d.source.x;
      }).attr("y1", function(d) {
        return d.source.y;
      }).attr("x2", function(d) {
        return d.target.x;
      }).attr("y2", function(d) {
        return d.target.y;
      });
    }

    var updateLink = function() {
        try {
          this.attr("d", function(d) {
            return calculate_path(d, force, Math.max(this.getTotalLength(), 15));
          });
        }
        catch(err) {
          return '';
        }
    }

    var updateAnchorNodes = function() {
      this.each(function(d, i) {
        if(i % 2 == 0) {
          d.x = d.node.x;
          d.y = d.node.y;
        } else {
          var b = this.childNodes[1].getBBox();

          var diffX = d.x - d.node.x;
          var diffY = d.y - d.node.y;

          var dist = Math.sqrt(diffX * diffX + diffY * diffY);

          var shiftX = b.width * (diffX - dist) / (dist * 2);
          shiftX = Math.max(-b.width, Math.min(0, shiftX));
          var shiftY = 5;
          this.childNodes[1].setAttribute("transform", "translate(" + shiftX + "," + shiftY + ")");
        }
      });
    }

    force.on("tick", function() {
      link.call(updateLink);
      node.call(updateNode);
    });

    // flux_scale = d3.scale.pow().exponent(1/2)
    flux_scale = d3.scale.linear()
      .domain([d3.min(fluxes), d3.max(fluxes)])
      .range([1.5, 6]);

    // metabolite_scale = d3.scale.pow().exponent(1/2)
    metabolite_scale = d3.scale.linear()
      .domain([d3.min(mfluxes), d3.max(mfluxes)])
      .range([4, 8]);

    arrowhead_scale = d3.scale.linear()
      .domain([1.5, 6])
      .range([6, 12]);

    function get_flux_width (rxn) {
      try {
        var flux = flux_scale(Math.abs(rxn.notes.map_info.flux));
        if (!isNaN(flux)) {
          return flux;
        } else{
          return 2.5;
        }
      }
      catch(err) {
        return 2.5; // Default linewidth
      }
    }

    function get_flux_dasharray (d) {
      try {
        if (d.rxn.notes.map_info.group == 'ko') {
          return "5, 5, 1, 5";
        }
        else if (Math.abs(d.rxn.notes.map_info.flux) < 1E-6) {
          return "5,5";
        }
      }
      catch(err) {
        return;
      }
    }

    function get_flux_stroke (d) {
      if ('color' in d.notes.map_info) {
        return d.notes.map_info.color;
      } else {
          return rxncolor(d.notes.map_info.group);
        }
    }

    function markerscale (d) {
      return arrowhead_scale(get_flux_width(d)) + "pt";
    }

    function get_node_radius (d) {
      if ('cofactor' in d) {return 4;}
      try {
        var nodewidth = metabolite_scale(Math.abs(d.notes.map_info.flux));
        if (!isNaN(nodewidth)) {
          return nodewidth;
        } else {
          return 5;
        }
      }
      catch(err){ return 5; }
    }


    // Node selection effect
    svg.selectAll("circle").on("mouseover", function(){
        d3.select(this)
        .style("fill", "red");
    })

    svg.selectAll("circle").on("click", function(){
      d3.select(this)
      .style("fill", "red");
  })

    svg.selectAll("circle").on("mouseout", function(){
      d3.select(this)
      .style("fill", function(d) { 
        if (d.type != 'rxn') {
          if ('color' in d.notes.map_info) {
            return d.notes.map_info.color;
          } else {
            return '#1f77b4';
          }
        } else return "";});
  })


    // hari: !important
    svg.selectAll(".link")
      .attr("stroke-width", function (d) {return get_flux_width(d.rxn);})
      .attr("stroke", function (d) {return get_flux_stroke(d.rxn);})
      .attr("stroke-dasharray", get_flux_dasharray);

    svg.selectAll("marker")
      .attr("markerWidth", markerscale)
      .attr("markerHeight", markerscale)
      .select("path")
      .attr("fill", get_flux_stroke);

    // hari: btn test
    d3.select("#d3flux001_options .marker_button").on("click", function() {
      svg.selectAll("marker")
      .select("path")
      .transition()
      .style("fill", "purple");
    });

    d3.select("#d3flux001_options .path_button").on("click", function() {
      svg.selectAll(".link")
      // color is not effective
      .transition()
      .style("stroke", "#006633");
    });

    d3.select("#d3flux001_options .reset_button").on("click", function() {
      svg.selectAll(".link")
      // color is not effective
      .transition()
      .style("stroke", function (d) {return get_flux_stroke(d.rxn);});

      svg.selectAll("marker")
      .select("path")
      .transition()
      .style("fill", get_flux_stroke);

      svg.selectAll("circle")
      .transition()
      .style("fill", function(d) { 
        if (d.type != 'rxn') {
          if ('color' in d.notes.map_info) {
            return d.notes.map_info.color;
          } else {
            return '#1f77b4';
          }
        } else return "";});

    });

    d3.select("#d3flux001_options .animate_button").on("click", function() {
      //svg.selectAll(".metabolite")
      graph = new Graph();
      // add unhidden metabolites

      // nodes.forEach(function(metabolite) {
      //   //graph.vertices.addVertex(metabolite);
      //   console.log(metabolite.id);
      //   graph.addVertex(metabolite.id);
      // });

      bilinks.forEach(function(link, i) {
        //console.log(link.source.id, " -> ",link.target.id);
        // if (!link.source.id in graph.getVertives) {
        //   graph.addVertex(link.source.id);
        // }

        // _debug: can't use id cause id will be identical
        //console.log(link.source.id, " -> ",link.target.id);

        // Ignore cofacor nodes
        if(link.target.cofactor) {
          return;
        }

        graph.addVertex(link.source.id);
        graph.addVertex(link.target.id);
        graph.addEdge(link.source.id, link.target.id);
        // svg.select("#" + link.id)
        // .transition()
        // .duration(700)
        // .delay( i * 700)
        // .style("stroke", "#006633");

      });
      
      console.log(graph.toString());
      var count = 0;
      function printNode(value) {
        
        console.log('Visited vertex: ' + value);
        count++;
        svg.select("circle#" + "_" + value)
        .transition()
        .duration(700)
        .delay(count* 700)
        .style("fill", "red");
      }

      var select = d3.select("#info").property("value");
      graph.dfs(select, printNode);
    });


d3.select("#d3flux001_options .test_button").on("click", function () {
  d3.select("#info")
  .property("value", "test");
  graph = new Graph();
  var myVertices = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I'];
  for (var i = 0; i < myVertices.length; i++) {
    graph.addVertex(myVertices[i]);
  }
  graph.addEdge('A', 'B');
  graph.addEdge('A', 'C');
  graph.addEdge('A', 'D');
  graph.addEdge('C', 'D');
  graph.addEdge('C', 'G');
  graph.addEdge('D', 'G');
  graph.addEdge('D', 'H');
  graph.addEdge('B', 'E');
  graph.addEdge('B', 'F');
  graph.addEdge('E', 'I');
  console.log(graph.toString());

  function printNode(value) {
    console.log('Visited vertex: ' + value);
  }
  graph.dfs("B", printNode);

});


    svg.selectAll(".metabolite")
      .attr("r", get_node_radius);

    d3.select("#d3flux001_options .download")
      .on("click", function () {

        // Add position data to model nodes
        force.nodes().forEach(function (node) {
          if (node.fixed) {
            if (node.type == "rxn") {
              // Reaction object
              obj = $.grep(model.reactions, function(e){ return e.id == node.id; })[0];
              if (!("notes" in obj)) { obj.notes = {}; }
              if (!("map_info" in obj.notes)) { obj.notes.map_info = {}; }
              obj.notes.map_info['x'] = node.x;
              obj.notes.map_info['y'] = node.y;
            } else {
              // Look in metabolites
              if (!('cofactor' in node)) {
                obj = $.grep(model.metabolites, function(e){ return e.id == node.id; })[0];
                if (!("notes" in obj)) { obj.notes = {}; }
                if (!("map_info" in obj.notes)) { obj.notes.map_info = {}; }
                obj.notes.map_info['x'] = node.x;
                obj.notes.map_info['y'] = node.y;
              } else {
                rxn = $.grep(model.reactions, function(e){ 
                  return e.id == node.cofactor; })[0];
                rxn.notes.map_info.cofactors[node.notes.orig_id]['x'] = node.x
                rxn.notes.map_info.cofactors[node.notes.orig_id]['y'] = node.y
              }
            }
          }
        });

        var json = JSON.stringify(model);
        var blob = new Blob([json], {type: "application/json"});
        saveAs(blob, model.id + ".json");
      });
  }

  main(d3flux001model);
});


class Queue {
  constructor() {
    var items = [];
    this.enqueue = function (element) {
      items.push(element);
    };
    this.dequeue = function () {
      return items.shift();
    };
    this.front = function () {
      return items[0];
    };
    this.isEmpty = function () {
      return items.length == 0;
    };
    this.clear = function () {
      items = [];
    };
    this.size = function () {
      return items.length;
    };
    this.print = function () {
      console.log(items.toString());
    };
  }
}

// Graph function
class Graph {
  constructor() {
    var vertices = []; //
    var adjList = new Dictionary(); //
    this.addVertex = function (v) {
      // Ignore existed vertex.
      if (vertices.indexOf(v) in vertices) {
        return;
      }
      vertices.push(v);
      adjList.set(v, []); //
    };
    this.addEdge = function (v, w) {
      adjList.get(v).push(w); //
      //adjList.get(w).push(v); //
    };
    this.hasVertex = function (v) {
      return v in vertices;
    }
    this.toString = function () {
      var s = '';
      for (var i = 0; i < vertices.length; i++) {
        s += vertices[i] + ' -> ';
        var neighbors = adjList.get(vertices[i]);
        for (var j = 0; j < neighbors.length; j++) {
          s += neighbors[j] + ' ';
        }
        s += '\n';
      }
      return s;
    };
    var initializeColor = function () {
      var color = [];
      for (var i = 0; i < vertices.length; i++) {
        color[vertices[i]] = 'white';
      }
      return color;
    };

    

    this.dfs2 = function (s, callback) {
      var color = initializeColor(); //
      // for (var i=0; i<vertices.length; i++){
      //     if (color[vertices[i]] === 'white'){
      //         dfsVisit(vertices[i], color, callback); //
      //     }
      // }
      if (color[s] == "white") {
        dfsVisit2(s, color, callback);
      }
    };
    var dfsVisit2 = function (u, color, callback) {
      color[u] = 'grey';
      if (callback) {
        callback(u);
      }
      var neighbors = adjList.get(u); //


      for (var i = 0; i < neighbors.length; i++) {
        var w = neighbors[i];
        // Stop recursion when end vertex is visted.
        if (neighbors.length == 0)
        {
          color[u] = 'black';
          callback(u);
          return;
        }

        if (color[w] === 'white') {
          dfsVisit2(w, color, callback); //w
        }

      }
      color[u] = 'black';
    };


    this.dfs = function (s, callback) {
      var color = initializeColor(); //
      // for (var i=0; i<vertices.length; i++){
      //     if (color[vertices[i]] === 'white'){
      //         dfsVisit(vertices[i], color, callback); //
      //     }
      // }
      if (color[s] == "white") {
        dfsVisit(s, color, callback);
      }
    };
    var dfsVisit = function (u, color, callback) {
      color[u] = 'grey';
      if (callback) {
        callback(u);
      }
      var neighbors = adjList.get(u); //
      for (var i = 0; i < neighbors.length; i++) {
        var w = neighbors[i];
        if (color[w] === 'white') {
          dfsVisit(w, color, callback); //w
        }
      }
      color[u] = 'black';
    };

    this.bfs = function (v, callback) {
      var color = initializeColor(),
        queue = new Queue(); //
      queue.enqueue(v); //
      while (!queue.isEmpty()) {
        var u = queue.dequeue(), //
          neighbors = adjList.get(u); //
        color[u] = 'grey'; //
        for (var i = 0; i < neighbors.length; i++) {
          var w = neighbors[i]; //
          if (color[w] === 'white') {
            color[w] = 'grey'; //
            queue.enqueue(w); //
          }
        }
        color[u] = 'black'; //
        if (callback) {
          callback(u);
        }
      }
    };

  }
}

// Class Dictionary
class Dictionary {
  constructor() {
    var items = {};
    this.set = function (key, value) {
      items[key] = value;
    };
    this.remove = function (key) {
      if (this.has(key)) {
        delete items[key];
        return true;
      }
      return false;
    };
    this.has = function (key) {
      return items.hasOwnProperty(key);
    };
    this.get = function (key) {
      return this.has(key) ? items[key] : undefined;
    };
    this.clear = function () {
      items = {};
    };
    this.size = function () {
      return Object.keys(items).length;
    };
    this.keys = function () {
      return Object.keys(items);
    };
    this.values = function () {
      var values = [];
      for (var k in items) {
        if (this.has(k)) {
          values.push(items[k]);
        }
      }
      return values;
    };
    this.each = function (fn) {
      for (var k in items) {
        if (this.has(k)) {
          fn(k, items[k]);
        }
      }
    };
    this.getItems = function () {
      return items;
    };
  }
}








function Point(x, y) {
    this.x = x;
    this.y = y;
}

function quadraticBezierLength(p0, p1, p2) {
    var a = new Point(
        p0.x - 2 * p1.x + p2.x,
        p0.y - 2 * p1.y + p2.y
    );
    var b = new Point(
        2 * p1.x - 2 * p0.x,
        2 * p1.y - 2 * p0.y
    );
    var A = 4 * (a.x * a.x + a.y * a.y);
    var B = 4 * (a.x * b.x + a.y * b.y);
    var C = b.x * b.x + b.y * b.y;

    var Sabc = 2 * Math.sqrt(A+B+C);
    var A_2 = Math.sqrt(A);
    var A_32 = 2 * A * A_2;
    var C_2 = 2 * Math.sqrt(C);
    var BA = B / A_2;

    return (A_32 * Sabc + A_2 * B * (Sabc - C_2) + (4 * C * A - B * B) * Math.log((2 * A_2 + BA + Sabc) / (BA + C_2))) / (4 * A_32);
}


/*****
*
*   Point2D.js
*
*   copyright 2001-2002, Kevin Lindsey
*
*****/

/*****
*
*   Point2D
*
*****/

/*****
*
*   constructor
*
*****/
function Point2D(x, y) {
    if ( arguments.length > 0 ) {
        this.x = x;
        this.y = y;
    }
}


/*****
*
*   clone
*
*****/
Point2D.prototype.clone = function() {
    return new Point2D(this.x, this.y);
};


/*****
*
*   add
*
*****/
Point2D.prototype.add = function(that) {
    return new Point2D(this.x+that.x, this.y+that.y);
};


/*****
*
*   addEquals
*
*****/
Point2D.prototype.addEquals = function(that) {
    this.x += that.x;
    this.y += that.y;

    return this;
};


/*****
*
*   offset - used in dom_graph
*
*   This method is based on code written by Walter Korman
*      http://www.go2net.com/internet/deep/1997/05/07/body.html 
*   which is in turn based on an algorithm by Sven Moen
*
*****/
Point2D.prototype.offset = function(a, b) {
    var result = 0;

    if ( !( b.x <= this.x || this.x + a.x <= 0 ) ) {
        var t = b.x * a.y - a.x * b.y;
        var s;
        var d;

        if ( t > 0 ) {
            if ( this.x < 0 ) {
                s = this.x * a.y;
                d = s / a.x - this.y;
            } else if ( this.x > 0 ) {
                s = this.x * b.y;
                d = s / b.x - this.y
            } else {
                d = -this.y;
            }
        } else {
            if ( b.x < this.x + a.x ) {
                s = ( b.x - this.x ) * a.y;
                d = b.y - (this.y + s / a.x);
            } else if ( b.x > this.x + a.x ) {
                s = (a.x + this.x) * b.y;
                d = s / b.x - (this.y + a.y);
            } else {
                d = b.y - (this.y + a.y);
            }
        }

        if ( d > 0 ) {
            result = d;
        }
    }

    return result;
};


/*****
*
*   rmoveto
*
*****/
Point2D.prototype.rmoveto = function(dx, dy) {
    this.x += dx;
    this.y += dy;
};


/*****
*
*   scalarAdd
*
*****/
Point2D.prototype.scalarAdd = function(scalar) {
    return new Point2D(this.x+scalar, this.y+scalar);
};


/*****
*
*   scalarAddEquals
*
*****/
Point2D.prototype.scalarAddEquals = function(scalar) {
    this.x += scalar;
    this.y += scalar;

    return this;
};


/*****
*
*   subtract
*
*****/
Point2D.prototype.subtract = function(that) {
    return new Point2D(this.x-that.x, this.y-that.y);
};


/*****
*
*   subtractEquals
*
*****/
Point2D.prototype.subtractEquals = function(that) {
    this.x -= that.x;
    this.y -= that.y;

    return this;
};


/*****
*
*   scalarSubtract
*
*****/
Point2D.prototype.scalarSubtract = function(scalar) {
    return new Point2D(this.x-scalar, this.y-scalar);
};


/*****
*
*   scalarSubtractEquals
*
*****/
Point2D.prototype.scalarSubtractEquals = function(scalar) {
    this.x -= scalar;
    this.y -= scalar;

    return this;
};


/*****
*
*   multiply
*
*****/
Point2D.prototype.multiply = function(scalar) {
    return new Point2D(this.x*scalar, this.y*scalar);
};


/*****
*
*   multiplyEquals
*
*****/
Point2D.prototype.multiplyEquals = function(scalar) {
    this.x *= scalar;
    this.y *= scalar;

    return this;
};


/*****
*
*   divide
*
*****/
Point2D.prototype.divide = function(scalar) {
    return new Point2D(this.x/scalar, this.y/scalar);
};


/*****
*
*   divideEquals
*
*****/
Point2D.prototype.divideEquals = function(scalar) {
    this.x /= scalar;
    this.y /= scalar;

    return this;
};


/*****
*
*   comparison methods
*
*   these were a nice idea, but ...  It would be better to define these names
*   in two parts so that the first part is the x comparison and the second is
*   the y.  For example, to test p1.x < p2.x and p1.y >= p2.y, you would call
*   p1.lt_gte(p2).  Honestly, I only did these types of comparisons in one
*   Intersection routine, so these probably could be removed.
*
*****/

/*****
*
*   compare
*
*****/
Point2D.prototype.compare = function(that) {
    return (this.x - that.x || this.y - that.y);
};


/*****
*
*   eq - equal
*
*****/
Point2D.prototype.eq = function(that) {
    return ( this.x == that.x && this.y == that.y );
};


/*****
*
*   lt - less than
*
*****/
Point2D.prototype.lt = function(that) {
    return ( this.x < that.x && this.y < that.y );
};


/*****
*
*   lte - less than or equal
*
*****/
Point2D.prototype.lte = function(that) {
    return ( this.x <= that.x && this.y <= that.y );
};


/*****
*
*   gt - greater than
*
*****/
Point2D.prototype.gt = function(that) {
    return ( this.x > that.x && this.y > that.y );
};


/*****
*
*   gte - greater than or equal
*
*****/
Point2D.prototype.gte = function(that) {
    return ( this.x >= that.x && this.y >= that.y );
};


/*****
*
*   utility methods
*
*****/

/*****
*
*   lerp
*
*****/
Point2D.prototype.lerp = function(that, t) {
    return new Point2D(
        this.x + (that.x - this.x) * t,
        this.y + (that.y - this.y) * t
    );
};


/*****
*
*   distanceFrom
*
*****/
Point2D.prototype.distanceFrom = function(that) {
    var dx = this.x - that.x;
    var dy = this.y - that.y;

    return Math.sqrt(dx*dx + dy*dy);
};


/*****
*
*   min
*
*****/
Point2D.prototype.min = function(that) {
    return new Point2D(
        Math.min( this.x, that.x ),
        Math.min( this.y, that.y )
    );
};


/*****
*
*   max
*
*****/
Point2D.prototype.max = function(that) {
    return new Point2D(
        Math.max( this.x, that.x ),
        Math.max( this.y, that.y )
    );
};


/*****
*
*   toString
*
*****/
Point2D.prototype.toString = function() {
    return this.x + "," + this.y;
};


/*****
*
*   get/set methods
*
*****/

/*****
*
*   setXY
*
*****/
Point2D.prototype.setXY = function(x, y) {
    this.x = x;
    this.y = y;
};


/*****
*
*   setFromPoint
*
*****/
Point2D.prototype.setFromPoint = function(that) {
    this.x = that.x;
    this.y = that.y;
};


/*****
*
*   swap
*
*****/
Point2D.prototype.swap = function(that) {
    var x = this.x;
    var y = this.y;

    this.x = that.x;
    this.y = that.y;

    that.x = x;
    that.y = y;
};

/*****
*
*   Polynomial.js
*
*   copyright 2002, Kevin Lindsey
*
*****/

Polynomial.TOLERANCE = 1e-6;
Polynomial.ACCURACY  = 6;


/*****
*
*   interpolate - class method
*
*****/
Polynomial.interpolate = function(xs, ys, n, offset, x) {
    if ( xs.constructor !== Array || ys.constructor !== Array )
        throw new Error("Polynomial.interpolate: xs and ys must be arrays");
    if ( isNaN(n) || isNaN(offset) || isNaN(x) )
        throw new Error("Polynomial.interpolate: n, offset, and x must be numbers");

    var y  = 0;
    var dy = 0;
    var c = new Array(n);
    var d = new Array(n);
    var ns = 0;
    var result;

    var diff = Math.abs(x - xs[offset]);
    for ( var i = 0; i < n; i++ ) {
        var dift = Math.abs(x - xs[offset+i]);

        if ( dift < diff ) {
            ns = i;
            diff = dift;
        }
        c[i] = d[i] = ys[offset+i];
    }
    y = ys[offset+ns];
    ns--;

    for ( var m = 1; m < n; m++ ) {
        for ( var i = 0; i < n-m; i++ ) {
            var ho = xs[offset+i] - x;
            var hp = xs[offset+i+m] - x;
            var w = c[i+1]-d[i];
            var den = ho - hp;

            if ( den == 0.0 ) {
                result = { y: 0, dy: 0};
                break;
            }

            den = w / den;
            d[i] = hp*den;
            c[i] = ho*den;
        }
        dy = (2*(ns+1) < (n-m)) ? c[ns+1] : d[ns--];
        y += dy;
    }

    return { y: y, dy: dy };
};


/*****
*
*   constructor
*
*****/
function Polynomial() {
    this.init( arguments );
}


/*****
*
*   init
*
*****/
Polynomial.prototype.init = function(coefs) {
    this.coefs = new Array();

    for ( var i = coefs.length - 1; i >= 0; i-- )
        this.coefs.push( coefs[i] );

    this._variable = "t";
    this._s = 0;
};


/*****
*
*   eval
*
*****/
Polynomial.prototype.eval = function(x) {
    if ( isNaN(x) )
        throw new Error("Polynomial.eval: parameter must be a number");

    var result = 0;

    for ( var i = this.coefs.length - 1; i >= 0; i-- )
        result = result * x + this.coefs[i];

    return result;
};


/*****
*
*   add
*
*****/
Polynomial.prototype.add = function(that) {
    var result = new Polynomial();
    var d1 = this.getDegree();
    var d2 = that.getDegree();
    var dmax = Math.max(d1,d2);

    for ( var i = 0; i <= dmax; i++ ) {
        var v1 = (i <= d1) ? this.coefs[i] : 0;
        var v2 = (i <= d2) ? that.coefs[i] : 0;

        result.coefs[i] = v1 + v2;
    }

    return result;
};


/*****
*
*   multiply
*
*****/
Polynomial.prototype.multiply = function(that) {
    var result = new Polynomial();

    for ( var i = 0; i <= this.getDegree() + that.getDegree(); i++ )
        result.coefs.push(0);

    for ( var i = 0; i <= this.getDegree(); i++ )
        for ( var j = 0; j <= that.getDegree(); j++ )
            result.coefs[i+j] += this.coefs[i] * that.coefs[j];

    return result;
};


/*****
*
*   divide_scalar
*
*****/
Polynomial.prototype.divide_scalar = function(scalar) {
    for ( var i = 0; i < this.coefs.length; i++ )
        this.coefs[i] /= scalar;
};


/*****
*
*   simplify
*
*****/
Polynomial.prototype.simplify = function() {
    for ( var i = this.getDegree(); i >= 0; i-- ) {
        if ( Math.abs( this.coefs[i] ) <= Polynomial.TOLERANCE )
            this.coefs.pop();
        else
            break;
    }
};


/*****
*
*   bisection
*
*****/
Polynomial.prototype.bisection = function(min, max) {
    var minValue = this.eval(min);
    var maxValue = this.eval(max);
    var result;
    
    if ( Math.abs(minValue) <= Polynomial.TOLERANCE )
        result = min;
    else if ( Math.abs(maxValue) <= Polynomial.TOLERANCE )
        result = max;
    else if ( minValue * maxValue <= 0 ) {
        var tmp1  = Math.log(max - min);
        var tmp2  = Math.LN10 * Polynomial.ACCURACY;
        var iters = Math.ceil( (tmp1+tmp2) / Math.LN2 );

        for ( var i = 0; i < iters; i++ ) {
            result = 0.5 * (min + max);
            var value = this.eval(result);

            if ( Math.abs(value) <= Polynomial.TOLERANCE ) {
                break;
            }

            if ( value * minValue < 0 ) {
                max = result;
                maxValue = value;
            } else {
                min = result;
                minValue = value;
            }
        }
    }

    return result;
};


/*****
*
*   toString
*
*****/
Polynomial.prototype.toString = function() {
    var coefs = new Array();
    var signs = new Array();
    
    for ( var i = this.coefs.length - 1; i >= 0; i-- ) {
        var value = Math.round(this.coefs[i]*1000)/1000;
        //var value = this.coefs[i];

        if ( value != 0 ) {
            var sign = ( value < 0 ) ? " - " : " + ";

            value = Math.abs(value);
            if ( i > 0 )
                if ( value == 1 )
                    value = this._variable;
                else
                    value += this._variable;
            if ( i > 1 ) value += "^" + i;

            signs.push( sign );
            coefs.push( value );
        }
    }

    signs[0] = ( signs[0] == " + " ) ? "" : "-";

    var result = "";
    for ( var i = 0; i < coefs.length; i++ )
        result += signs[i] + coefs[i];
    
    return result;
};


/*****
*
*   trapezoid
*   Based on trapzd in "Numerical Recipes in C", page 137
*
*****/
Polynomial.prototype.trapezoid = function(min, max, n) {
    if ( isNaN(min) || isNaN(max) || isNaN(n) )
        throw new Error("Polynomial.trapezoid: parameters must be numbers");

    var range = max - min;
    var TOLERANCE = 1e-7;

    if ( n == 1 ) {
        var minValue = this.eval(min);
        var maxValue = this.eval(max);
        this._s = 0.5*range*( minValue + maxValue );
    } else {
        var it = 1 << (n-2);
        var delta = range / it;
        var x = min + 0.5*delta;
        var sum = 0;

        for ( var i = 0; i < it; i++ ) {
            sum += this.eval(x);
            x += delta;
        }
        this._s = 0.5*(this._s + range*sum/it);
    }

    if ( isNaN(this._s) )
        throw new Error("Polynomial.trapezoid: this._s is NaN");

    return this._s;
};


/*****
*
*   simpson
*   Based on trapzd in "Numerical Recipes in C", page 139
*
*****/
Polynomial.prototype.simpson = function(min, max) {
    if ( isNaN(min) || isNaN(max) )
        throw new Error("Polynomial.simpson: parameters must be numbers");

    var range = max - min;
    var st = 0.5 * range * ( this.eval(min) + this.eval(max) );
    var t = st;
    var s = 4.0*st/3.0;
    var os = s;
    var ost = st;
    var TOLERANCE = 1e-7;

    var it = 1;
    for ( var n = 2; n <= 20; n++ ) {
        var delta = range / it;
        var x     = min + 0.5*delta;
        var sum   = 0;

        for ( var i = 1; i <= it; i++ ) {
            sum += this.eval(x);
            x += delta;
        }

        t = 0.5 * (t + range * sum / it);
        st = t;
        s = (4.0*st - ost)/3.0;

        if ( Math.abs(s-os) < TOLERANCE*Math.abs(os) )
            break;

        os = s;
        ost = st;
        it <<= 1;
    }

    return s;
};


/*****
*
*   romberg
*
*****/
Polynomial.prototype.romberg = function(min, max) {
    if ( isNaN(min) || isNaN(max) )
        throw new Error("Polynomial.romberg: parameters must be numbers");

    var MAX = 20;
    var K = 3;
    var TOLERANCE = 1e-6;
    var s = new Array(MAX+1);
    var h = new Array(MAX+1);
    var result = { y: 0, dy: 0 };

    h[0] = 1.0;
    for ( var j = 1; j <= MAX; j++ ) {
        s[j-1] = this.trapezoid(min, max, j);
        if ( j >= K ) {
            result = Polynomial.interpolate(h, s, K, j-K, 0.0);
            if ( Math.abs(result.dy) <= TOLERANCE*result.y) break;
        }
        s[j] = s[j-1];
        h[j] = 0.25 * h[j-1];
    }

    return result.y;
};


/*****
*
*   get/set methods
*
*****/

/*****
*
*   get degree
*
*****/
Polynomial.prototype.getDegree = function() {
    return this.coefs.length - 1;
};


/*****
*
*   getDerivative
*
*****/
Polynomial.prototype.getDerivative = function() {
    var derivative = new Polynomial();

    for ( var i = 1; i < this.coefs.length; i++ ) {
        derivative.coefs.push(i*this.coefs[i]);
    }

    return derivative;
};


/*****
*
*   getRoots
*
*****/
Polynomial.prototype.getRoots = function() {
    var result;

    this.simplify();
    switch ( this.getDegree() ) {
        case 0: result = new Array();              break;
        case 1: result = this.getLinearRoot();     break;
        case 2: result = this.getQuadraticRoots(); break;
        case 3: result = this.getCubicRoots();     break;
        case 4: result = this.getQuarticRoots();   break;
        default:
            result = new Array();
            // should try Newton's method and/or bisection
    }

    return result;
};


/*****
*
*   getRootsInInterval
*
*****/
Polynomial.prototype.getRootsInInterval = function(min, max) {
    var roots = new Array();
    var root;

    if ( this.getDegree() == 1 ) {
        root = this.bisection(min, max);
        if ( root != null ) roots.push(root);
    } else {
        // get roots of derivative
        var deriv  = this.getDerivative();
        var droots = deriv.getRootsInInterval(min, max);

        if ( droots.length > 0 ) {
            // find root on [min, droots[0]]
            root = this.bisection(min, droots[0]);
            if ( root != null ) roots.push(root);

            // find root on [droots[i],droots[i+1]] for 0 <= i <= count-2
            for ( i = 0; i <= droots.length-2; i++ ) {
                root = this.bisection(droots[i], droots[i+1]);
                if ( root != null ) roots.push(root);
            }

            // find root on [droots[count-1],xmax]
            root = this.bisection(droots[droots.length-1], max);
            if ( root != null ) roots.push(root);
        } else {
            // polynomial is monotone on [min,max], has at most one root
            root = this.bisection(min, max);
            if ( root != null ) roots.push(root);
        }
    }

    return roots;
};


/*****
*
*   getLinearRoot
*
*****/
Polynomial.prototype.getLinearRoot = function() {
    var result = new Array();
    var a = this.coefs[1];
    
    if ( a != 0 )
        result.push( -this.coefs[0] / a );

    return result;
};


/*****
*
*   getQuadraticRoots
*
*****/
Polynomial.prototype.getQuadraticRoots = function() {
    var results = new Array();

    if ( this.getDegree() == 2 ) {
        var a = this.coefs[2];
        var b = this.coefs[1] / a;
        var c = this.coefs[0] / a;
        var d = b*b - 4*c;

        if ( d > 0 ) {
            var e = Math.sqrt(d);
            
            results.push( 0.5 * (-b + e) );
            results.push( 0.5 * (-b - e) );
        } else if ( d == 0 ) {
            // really two roots with same value, but we only return one
            results.push( 0.5 * -b );
        }
    }

    return results;
};


/*****
*
*   getCubicRoots
*
*   This code is based on MgcPolynomial.cpp written by David Eberly.  His
*   code along with many other excellent examples are avaiable at his site:
*   http://www.magic-software.com
*
*****/
Polynomial.prototype.getCubicRoots = function() {
    var results = new Array();

    if ( this.getDegree() == 3 ) {
        var c3 = this.coefs[3];
        var c2 = this.coefs[2] / c3;
        var c1 = this.coefs[1] / c3;
        var c0 = this.coefs[0] / c3;

        var a       = (3*c1 - c2*c2) / 3;
        var b       = (2*c2*c2*c2 - 9*c1*c2 + 27*c0) / 27;
        var offset  = c2 / 3;
        var discrim = b*b/4 + a*a*a/27;
        var halfB   = b / 2;

        if ( Math.abs(discrim) <= Polynomial.TOLERANCE ) discrim = 0;
        
        if ( discrim > 0 ) {
            var e = Math.sqrt(discrim);
            var tmp;
            var root;

            tmp = -halfB + e;
            if ( tmp >= 0 )
                root = Math.pow(tmp, 1/3);
            else
                root = -Math.pow(-tmp, 1/3);

            tmp = -halfB - e;
            if ( tmp >= 0 )
                root += Math.pow(tmp, 1/3);
            else
                root -= Math.pow(-tmp, 1/3);

            results.push( root - offset );
        } else if ( discrim < 0 ) {
            var distance = Math.sqrt(-a/3);
            var angle    = Math.atan2( Math.sqrt(-discrim), -halfB) / 3;
            var cos      = Math.cos(angle);
            var sin      = Math.sin(angle);
            var sqrt3    = Math.sqrt(3);

            results.push( 2*distance*cos - offset );
            results.push( -distance * (cos + sqrt3 * sin) - offset);
            results.push( -distance * (cos - sqrt3 * sin) - offset);
        } else {
            var tmp;

            if ( halfB >= 0 )
                tmp = -Math.pow(halfB, 1/3);
            else
                tmp = Math.pow(-halfB, 1/3);

            results.push( 2*tmp - offset );
            // really should return next root twice, but we return only one
            results.push( -tmp - offset );
        }
    }

    return results;
};


/*****
*
*   getQuarticRoots
*
*   This code is based on MgcPolynomial.cpp written by David Eberly.  His
*   code along with many other excellent examples are avaiable at his site:
*   http://www.magic-software.com
*
*****/
Polynomial.prototype.getQuarticRoots = function() {
    var results = new Array();

    if ( this.getDegree() == 4 ) {
        var c4 = this.coefs[4];
        var c3 = this.coefs[3] / c4;
        var c2 = this.coefs[2] / c4;
        var c1 = this.coefs[1] / c4;
        var c0 = this.coefs[0] / c4;

        var resolveRoots = new Polynomial(
            1, -c2, c3*c1 - 4*c0, -c3*c3*c0 + 4*c2*c0 -c1*c1
        ).getCubicRoots();
        var y       = resolveRoots[0];
        var discrim = c3*c3/4 - c2 + y;

        if ( Math.abs(discrim) <= Polynomial.TOLERANCE ) discrim = 0;

        if ( discrim > 0 ) {
            var e     = Math.sqrt(discrim);
            var t1    = 3*c3*c3/4 - e*e - 2*c2;
            var t2    = ( 4*c3*c2 - 8*c1 - c3*c3*c3 ) / ( 4*e );
            var plus  = t1+t2;
            var minus = t1-t2;

            if ( Math.abs(plus)  <= Polynomial.TOLERANCE ) plus  = 0;
            if ( Math.abs(minus) <= Polynomial.TOLERANCE ) minus = 0;

            if ( plus >= 0 ) {
                var f = Math.sqrt(plus);

                results.push( -c3/4 + (e+f)/2 );
                results.push( -c3/4 + (e-f)/2 );
            }
            if ( minus >= 0 ) {
                var f = Math.sqrt(minus);

                results.push( -c3/4 + (f-e)/2 );
                results.push( -c3/4 - (f+e)/2 );
            }
        } else if ( discrim < 0 ) {
            // no roots
        } else {
            var t2 = y*y - 4*c0;

            if ( t2 >= -Polynomial.TOLERANCE ) {
                if ( t2 < 0 ) t2 = 0;

                t2 = 2*Math.sqrt(t2);
                t1 = 3*c3*c3/4 - 2*c2;
                if ( t1+t2 >= Polynomial.TOLERANCE ) {
                    var d = Math.sqrt(t1+t2);

                    results.push( -c3/4 + d/2 );
                    results.push( -c3/4 - d/2 );
                }
                if ( t1-t2 >= Polynomial.TOLERANCE ) {
                    var d = Math.sqrt(t1-t2);

                    results.push( -c3/4 + d/2 );
                    results.push( -c3/4 - d/2 );
                }
            }
        }
    }

    return results;
};

/*****
*
*   Intersection.js
*
*   copyright 2002, Kevin Lindsey
*
*****/

/*****
*
*   constructor
*
*****/
function Intersection(status) {
    if ( arguments.length > 0 ) {
        this.init(status);
    }
}


/*****
*
*   init
*
*****/
Intersection.prototype.init = function(status) {
    this.status = status;
    this.points = new Array();
};


/*****
*
*   appendPoint
*
*****/
Intersection.prototype.appendPoint = function(point) {
    this.points.push(point);
};


/*****
*
*   appendPoints
*
*****/
Intersection.prototype.appendPoints = function(points) {
    this.points = this.points.concat(points);
};


/*****
*
*   class methods
*
*****/

/*****
*
*   intersectShapes
*
*****/
Intersection.intersectShapes = function(shape1, shape2) {
    var ip1 = shape1.getIntersectionParams();
    var ip2 = shape2.getIntersectionParams();
    var result;

    if ( ip1 != null && ip2 != null ) {
        if ( ip1.name == "Path" ) {
            result = Intersection.intersectPathShape(shape1, shape2);
        } else if ( ip2.name == "Path" ) {
            result = Intersection.intersectPathShape(shape2, shape1);
        } else {
            var method;
            var params;

            if ( ip1.name < ip2.name ) {
                method = "intersect" + ip1.name + ip2.name;
                params = ip1.params.concat( ip2.params );
            } else {
                method = "intersect" + ip2.name + ip1.name;
                params = ip2.params.concat( ip1.params );
            }

            if ( !(method in Intersection) )
                throw new Error("Intersection not available: " + method);

            result = Intersection[method].apply(null, params);
        }
    } else {
        result = new Intersection("No Intersection");
    }

    return result;
};


/*****
*
*   intersectPathShape
*
*****/
Intersection.intersectPathShape = function(path, shape) {
    return path.intersectShape(shape);
};


/*****
*
*   intersectBezier2Bezier2
*
*****/
Intersection.intersectBezier2Bezier2 = function(a1, a2, a3, b1, b2, b3) {
    var a, b;
    var c12, c11, c10;
    var c22, c21, c20;
    var result = new Intersection("No Intersection");
    var poly;

    a = a2.multiply(-2);
    c12 = a1.add(a.add(a3));

    a = a1.multiply(-2);
    b = a2.multiply(2);
    c11 = a.add(b);

    c10 = new Point2D(a1.x, a1.y);

    a = b2.multiply(-2);
    c22 = b1.add(a.add(b3));

    a = b1.multiply(-2);
    b = b2.multiply(2);
    c21 = a.add(b);

    c20 = new Point2D(b1.x, b1.y);
    
    if ( c12.y == 0 ) {
        var v0 = c12.x*(c10.y - c20.y);
        var v1 = v0 - c11.x*c11.y;
        var v2 = v0 + v1;
        var v3 = c11.y*c11.y;

        poly = new Polynomial(
            c12.x*c22.y*c22.y,
            2*c12.x*c21.y*c22.y,
            c12.x*c21.y*c21.y - c22.x*v3 - c22.y*v0 - c22.y*v1,
            -c21.x*v3 - c21.y*v0 - c21.y*v1,
            (c10.x - c20.x)*v3 + (c10.y - c20.y)*v1
        );
    } else {
        var v0 = c12.x*c22.y - c12.y*c22.x;
        var v1 = c12.x*c21.y - c21.x*c12.y;
        var v2 = c11.x*c12.y - c11.y*c12.x;
        var v3 = c10.y - c20.y;
        var v4 = c12.y*(c10.x - c20.x) - c12.x*v3;
        var v5 = -c11.y*v2 + c12.y*v4;
        var v6 = v2*v2;

        poly = new Polynomial(
            v0*v0,
            2*v0*v1,
            (-c22.y*v6 + c12.y*v1*v1 + c12.y*v0*v4 + v0*v5) / c12.y,
            (-c21.y*v6 + c12.y*v1*v4 + v1*v5) / c12.y,
            (v3*v6 + v4*v5) / c12.y
        );
    }

    var roots = poly.getRoots();
    for ( var i = 0; i < roots.length; i++ ) {
        var s = roots[i];

        if ( 0 <= s && s <= 1 ) {
            var xRoots = new Polynomial(
                c12.x,
                c11.x,
                c10.x - c20.x - s*c21.x - s*s*c22.x
            ).getRoots();
            var yRoots = new Polynomial(
                c12.y,
                c11.y,
                c10.y - c20.y - s*c21.y - s*s*c22.y
            ).getRoots();

            if ( xRoots.length > 0 && yRoots.length > 0 ) {
                var TOLERANCE = 1e-4;

                checkRoots:
                for ( var j = 0; j < xRoots.length; j++ ) {
                    var xRoot = xRoots[j];

                    if ( 0 <= xRoot && xRoot <= 1 ) {
                        for ( var k = 0; k < yRoots.length; k++ ) {
                            if ( Math.abs( xRoot - yRoots[k] ) < TOLERANCE ) {
                                result.points.push( c22.multiply(s*s).add(c21.multiply(s).add(c20)) );
                                break checkRoots;
                            }
                        }
                    }
                }
            }
        }
    }

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectBezier2Bezier3
*
*****/
Intersection.intersectBezier2Bezier3 = function(a1, a2, a3, b1, b2, b3, b4) {
    var a, b,c, d;
    var c12, c11, c10;
    var c23, c22, c21, c20;
    var result = new Intersection("No Intersection");

    a = a2.multiply(-2);
    c12 = a1.add(a.add(a3));

    a = a1.multiply(-2);
    b = a2.multiply(2);
    c11 = a.add(b);

    c10 = new Point2D(a1.x, a1.y);

    a = b1.multiply(-1);
    b = b2.multiply(3);
    c = b3.multiply(-3);
    d = a.add(b.add(c.add(b4)));
    c23 = new Vector2D(d.x, d.y);

    a = b1.multiply(3);
    b = b2.multiply(-6);
    c = b3.multiply(3);
    d = a.add(b.add(c));
    c22 = new Vector2D(d.x, d.y);

    a = b1.multiply(-3);
    b = b2.multiply(3);
    c = a.add(b);
    c21 = new Vector2D(c.x, c.y);

    c20 = new Vector2D(b1.x, b1.y);

    var c10x2 = c10.x*c10.x;
    var c10y2 = c10.y*c10.y;
    var c11x2 = c11.x*c11.x;
    var c11y2 = c11.y*c11.y;
    var c12x2 = c12.x*c12.x;
    var c12y2 = c12.y*c12.y;
    var c20x2 = c20.x*c20.x;
    var c20y2 = c20.y*c20.y;
    var c21x2 = c21.x*c21.x;
    var c21y2 = c21.y*c21.y;
    var c22x2 = c22.x*c22.x;
    var c22y2 = c22.y*c22.y;
    var c23x2 = c23.x*c23.x;
    var c23y2 = c23.y*c23.y;

    var poly = new Polynomial(
        -2*c12.x*c12.y*c23.x*c23.y + c12x2*c23y2 + c12y2*c23x2,
        -2*c12.x*c12.y*c22.x*c23.y - 2*c12.x*c12.y*c22.y*c23.x + 2*c12y2*c22.x*c23.x +
            2*c12x2*c22.y*c23.y,
        -2*c12.x*c21.x*c12.y*c23.y - 2*c12.x*c12.y*c21.y*c23.x - 2*c12.x*c12.y*c22.x*c22.y +
            2*c21.x*c12y2*c23.x + c12y2*c22x2 + c12x2*(2*c21.y*c23.y + c22y2),
        2*c10.x*c12.x*c12.y*c23.y + 2*c10.y*c12.x*c12.y*c23.x + c11.x*c11.y*c12.x*c23.y +
            c11.x*c11.y*c12.y*c23.x - 2*c20.x*c12.x*c12.y*c23.y - 2*c12.x*c20.y*c12.y*c23.x -
            2*c12.x*c21.x*c12.y*c22.y - 2*c12.x*c12.y*c21.y*c22.x - 2*c10.x*c12y2*c23.x -
            2*c10.y*c12x2*c23.y + 2*c20.x*c12y2*c23.x + 2*c21.x*c12y2*c22.x -
            c11y2*c12.x*c23.x - c11x2*c12.y*c23.y + c12x2*(2*c20.y*c23.y + 2*c21.y*c22.y),
        2*c10.x*c12.x*c12.y*c22.y + 2*c10.y*c12.x*c12.y*c22.x + c11.x*c11.y*c12.x*c22.y +
            c11.x*c11.y*c12.y*c22.x - 2*c20.x*c12.x*c12.y*c22.y - 2*c12.x*c20.y*c12.y*c22.x -
            2*c12.x*c21.x*c12.y*c21.y - 2*c10.x*c12y2*c22.x - 2*c10.y*c12x2*c22.y +
            2*c20.x*c12y2*c22.x - c11y2*c12.x*c22.x - c11x2*c12.y*c22.y + c21x2*c12y2 +
            c12x2*(2*c20.y*c22.y + c21y2),
        2*c10.x*c12.x*c12.y*c21.y + 2*c10.y*c12.x*c21.x*c12.y + c11.x*c11.y*c12.x*c21.y +
            c11.x*c11.y*c21.x*c12.y - 2*c20.x*c12.x*c12.y*c21.y - 2*c12.x*c20.y*c21.x*c12.y -
            2*c10.x*c21.x*c12y2 - 2*c10.y*c12x2*c21.y + 2*c20.x*c21.x*c12y2 -
            c11y2*c12.x*c21.x - c11x2*c12.y*c21.y + 2*c12x2*c20.y*c21.y,
        -2*c10.x*c10.y*c12.x*c12.y - c10.x*c11.x*c11.y*c12.y - c10.y*c11.x*c11.y*c12.x +
            2*c10.x*c12.x*c20.y*c12.y + 2*c10.y*c20.x*c12.x*c12.y + c11.x*c20.x*c11.y*c12.y +
            c11.x*c11.y*c12.x*c20.y - 2*c20.x*c12.x*c20.y*c12.y - 2*c10.x*c20.x*c12y2 +
            c10.x*c11y2*c12.x + c10.y*c11x2*c12.y - 2*c10.y*c12x2*c20.y -
            c20.x*c11y2*c12.x - c11x2*c20.y*c12.y + c10x2*c12y2 + c10y2*c12x2 +
            c20x2*c12y2 + c12x2*c20y2
    );
    var roots = poly.getRootsInInterval(0,1);

    for ( var i = 0; i < roots.length; i++ ) {
        var s = roots[i];
        var xRoots = new Polynomial(
            c12.x,
            c11.x,
            c10.x - c20.x - s*c21.x - s*s*c22.x - s*s*s*c23.x
        ).getRoots();
        var yRoots = new Polynomial(
            c12.y,
            c11.y,
            c10.y - c20.y - s*c21.y - s*s*c22.y - s*s*s*c23.y
        ).getRoots();

        if ( xRoots.length > 0 && yRoots.length > 0 ) {
            var TOLERANCE = 1e-4;

            checkRoots:
            for ( var j = 0; j < xRoots.length; j++ ) {
                var xRoot = xRoots[j];
                
                if ( 0 <= xRoot && xRoot <= 1 ) {
                    for ( var k = 0; k < yRoots.length; k++ ) {
                        if ( Math.abs( xRoot - yRoots[k] ) < TOLERANCE ) {
                            result.points.push(
                                c23.multiply(s*s*s).add(c22.multiply(s*s).add(c21.multiply(s).add(c20)))
                            );
                            break checkRoots;
                        }
                    }
                }
            }
        }
    }

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;

};


/*****
*
*   intersectBezier2Circle
*
*****/
Intersection.intersectBezier2Circle = function(p1, p2, p3, c, r) {
    return Intersection.intersectBezier2Ellipse(p1, p2, p3, c, r, r);
};


/*****
*
*   intersectBezier2Ellipse
*
*****/
Intersection.intersectBezier2Ellipse = function(p1, p2, p3, ec, rx, ry) {
    var a, b;       // temporary variables
    var c2, c1, c0; // coefficients of quadratic
    var result = new Intersection("No Intersection");

    a = p2.multiply(-2);
    c2 = p1.add(a.add(p3));

    a = p1.multiply(-2);
    b = p2.multiply(2);
    c1 = a.add(b);

    c0 = new Point2D(p1.x, p1.y);

    var rxrx  = rx*rx;
    var ryry  = ry*ry;
    var roots = new Polynomial(
        ryry*c2.x*c2.x + rxrx*c2.y*c2.y,
        2*(ryry*c2.x*c1.x + rxrx*c2.y*c1.y),
        ryry*(2*c2.x*c0.x + c1.x*c1.x) + rxrx*(2*c2.y*c0.y+c1.y*c1.y) -
            2*(ryry*ec.x*c2.x + rxrx*ec.y*c2.y),
        2*(ryry*c1.x*(c0.x-ec.x) + rxrx*c1.y*(c0.y-ec.y)),
        ryry*(c0.x*c0.x+ec.x*ec.x) + rxrx*(c0.y*c0.y + ec.y*ec.y) -
            2*(ryry*ec.x*c0.x + rxrx*ec.y*c0.y) - rxrx*ryry
    ).getRoots();

    function isValid(value) {
    return ( 0 <= value && value <= 1 );
  }

    return roots.filter(isValid).sort();

    // for ( var i = 0; i < roots.length; i++ ) {
    //     var t = roots[i];
    //
    //     if ( 0 <= t && t <= 1 )
    //         result.points.push( c2.multiply(t*t).add(c1.multiply(t).add(c0)) );
    // }

    // if ( result.points.length > 0 ) result.status = "Intersection";
    //
    // return result;
};


/*****
*
*   intersectBezier2Line
*
*****/
Intersection.intersectBezier2Line = function(p1, p2, p3, a1, a2) {
    var a, b;             // temporary variables
    var c2, c1, c0;       // coefficients of quadratic
    var cl;               // c coefficient for normal form of line
    var n;                // normal for normal form of line
    var min = a1.min(a2); // used to determine if point is on line segment
    var max = a1.max(a2); // used to determine if point is on line segment
    var result = new Intersection("No Intersection");
    
    a = p2.multiply(-2);
    c2 = p1.add(a.add(p3));

    a = p1.multiply(-2);
    b = p2.multiply(2);
    c1 = a.add(b);

    c0 = new Point2D(p1.x, p1.y);

    // Convert line to normal form: ax + by + c = 0
    // Find normal to line: negative inverse of original line's slope
    n = new Vector2D(a1.y - a2.y, a2.x - a1.x);
    
    // Determine new c coefficient
    cl = a1.x*a2.y - a2.x*a1.y;

    // Transform cubic coefficients to line's coordinate system and find roots
    // of cubic
    roots = new Polynomial(
        n.dot(c2),
        n.dot(c1),
        n.dot(c0) + cl
    ).getRoots();

    // Any roots in closed interval [0,1] are intersections on Bezier, but
    // might not be on the line segment.
    // Find intersections and calculate point coordinates
    for ( var i = 0; i < roots.length; i++ ) {
        var t = roots[i];

        if ( 0 <= t && t <= 1 ) {
            // We're within the Bezier curve
            // Find point on Bezier
            var p4 = p1.lerp(p2, t);
            var p5 = p2.lerp(p3, t);

            var p6 = p4.lerp(p5, t);

            // See if point is on line segment
            // Had to make special cases for vertical and horizontal lines due
            // to slight errors in calculation of p6
            if ( a1.x == a2.x ) {
                if ( min.y <= p6.y && p6.y <= max.y ) {
                    result.status = "Intersection";
                    result.appendPoint( p6 );
                }
            } else if ( a1.y == a2.y ) {
                if ( min.x <= p6.x && p6.x <= max.x ) {
                    result.status = "Intersection";
                    result.appendPoint( p6 );
                }
            } else if ( p6.gte(min) && p6.lte(max) ) {
                result.status = "Intersection";
                result.appendPoint( p6 );
            }
        }
    }

    return result;
};


/*****
*
*   intersectBezier2Polygon
*
*****/
Intersection.intersectBezier2Polygon = function(p1, p2, p3, points) {
    var result = new Intersection("No Intersection");
    var length = points.length;

    for ( var i = 0; i < length; i++ ) {
        var a1 = points[i];
        var a2 = points[(i+1) % length];
        var inter = Intersection.intersectBezier2Line(p1, p2, p3, a1, a2);

        result.appendPoints(inter.points);
    }

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectBezier2Rectangle
*
*****/
Intersection.intersectBezier2Rectangle = function(p1, p2, p3, r1, r2) {
    var min        = r1.min(r2);
    var max        = r1.max(r2);
    var topRight   = new Point2D( max.x, min.y );
    var bottomLeft = new Point2D( min.x, max.y );
    
    var inter1 = Intersection.intersectBezier2Line(p1, p2, p3, min, topRight);
    var inter2 = Intersection.intersectBezier2Line(p1, p2, p3, topRight, max);
    var inter3 = Intersection.intersectBezier2Line(p1, p2, p3, max, bottomLeft);
    var inter4 = Intersection.intersectBezier2Line(p1, p2, p3, bottomLeft, min);
    
    var result = new Intersection("No Intersection");

    result.appendPoints(inter1.points);
    result.appendPoints(inter2.points);
    result.appendPoints(inter3.points);
    result.appendPoints(inter4.points);

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectBezier3Bezier3
*
*****/
Intersection.intersectBezier3Bezier3 = function(a1, a2, a3, a4, b1, b2, b3, b4) {
    var a, b, c, d;         // temporary variables
    var c13, c12, c11, c10; // coefficients of cubic
    var c23, c22, c21, c20; // coefficients of cubic
    var result = new Intersection("No Intersection");

    // Calculate the coefficients of cubic polynomial
    a = a1.multiply(-1);
    b = a2.multiply(3);
    c = a3.multiply(-3);
    d = a.add(b.add(c.add(a4)));
    c13 = new Vector2D(d.x, d.y);

    a = a1.multiply(3);
    b = a2.multiply(-6);
    c = a3.multiply(3);
    d = a.add(b.add(c));
    c12 = new Vector2D(d.x, d.y);

    a = a1.multiply(-3);
    b = a2.multiply(3);
    c = a.add(b);
    c11 = new Vector2D(c.x, c.y);

    c10 = new Vector2D(a1.x, a1.y);

    a = b1.multiply(-1);
    b = b2.multiply(3);
    c = b3.multiply(-3);
    d = a.add(b.add(c.add(b4)));
    c23 = new Vector2D(d.x, d.y);

    a = b1.multiply(3);
    b = b2.multiply(-6);
    c = b3.multiply(3);
    d = a.add(b.add(c));
    c22 = new Vector2D(d.x, d.y);

    a = b1.multiply(-3);
    b = b2.multiply(3);
    c = a.add(b);
    c21 = new Vector2D(c.x, c.y);

    c20 = new Vector2D(b1.x, b1.y);

    var c10x2 = c10.x*c10.x;
    var c10x3 = c10.x*c10.x*c10.x;
    var c10y2 = c10.y*c10.y;
    var c10y3 = c10.y*c10.y*c10.y;
    var c11x2 = c11.x*c11.x;
    var c11x3 = c11.x*c11.x*c11.x;
    var c11y2 = c11.y*c11.y;
    var c11y3 = c11.y*c11.y*c11.y;
    var c12x2 = c12.x*c12.x;
    var c12x3 = c12.x*c12.x*c12.x;
    var c12y2 = c12.y*c12.y;
    var c12y3 = c12.y*c12.y*c12.y;
    var c13x2 = c13.x*c13.x;
    var c13x3 = c13.x*c13.x*c13.x;
    var c13y2 = c13.y*c13.y;
    var c13y3 = c13.y*c13.y*c13.y;
    var c20x2 = c20.x*c20.x;
    var c20x3 = c20.x*c20.x*c20.x;
    var c20y2 = c20.y*c20.y;
    var c20y3 = c20.y*c20.y*c20.y;
    var c21x2 = c21.x*c21.x;
    var c21x3 = c21.x*c21.x*c21.x;
    var c21y2 = c21.y*c21.y;
    var c22x2 = c22.x*c22.x;
    var c22x3 = c22.x*c22.x*c22.x;
    var c22y2 = c22.y*c22.y;
    var c23x2 = c23.x*c23.x;
    var c23x3 = c23.x*c23.x*c23.x;
    var c23y2 = c23.y*c23.y;
    var c23y3 = c23.y*c23.y*c23.y;
    var poly = new Polynomial(
        -c13x3*c23y3 + c13y3*c23x3 - 3*c13.x*c13y2*c23x2*c23.y +
            3*c13x2*c13.y*c23.x*c23y2,
        -6*c13.x*c22.x*c13y2*c23.x*c23.y + 6*c13x2*c13.y*c22.y*c23.x*c23.y + 3*c22.x*c13y3*c23x2 -
            3*c13x3*c22.y*c23y2 - 3*c13.x*c13y2*c22.y*c23x2 + 3*c13x2*c22.x*c13.y*c23y2,
        -6*c21.x*c13.x*c13y2*c23.x*c23.y - 6*c13.x*c22.x*c13y2*c22.y*c23.x + 6*c13x2*c22.x*c13.y*c22.y*c23.y +
            3*c21.x*c13y3*c23x2 + 3*c22x2*c13y3*c23.x + 3*c21.x*c13x2*c13.y*c23y2 - 3*c13.x*c21.y*c13y2*c23x2 -
            3*c13.x*c22x2*c13y2*c23.y + c13x2*c13.y*c23.x*(6*c21.y*c23.y + 3*c22y2) + c13x3*(-c21.y*c23y2 -
            2*c22y2*c23.y - c23.y*(2*c21.y*c23.y + c22y2)),
        c11.x*c12.y*c13.x*c13.y*c23.x*c23.y - c11.y*c12.x*c13.x*c13.y*c23.x*c23.y + 6*c21.x*c22.x*c13y3*c23.x +
            3*c11.x*c12.x*c13.x*c13.y*c23y2 + 6*c10.x*c13.x*c13y2*c23.x*c23.y - 3*c11.x*c12.x*c13y2*c23.x*c23.y -
            3*c11.y*c12.y*c13.x*c13.y*c23x2 - 6*c10.y*c13x2*c13.y*c23.x*c23.y - 6*c20.x*c13.x*c13y2*c23.x*c23.y +
            3*c11.y*c12.y*c13x2*c23.x*c23.y - 2*c12.x*c12y2*c13.x*c23.x*c23.y - 6*c21.x*c13.x*c22.x*c13y2*c23.y -
            6*c21.x*c13.x*c13y2*c22.y*c23.x - 6*c13.x*c21.y*c22.x*c13y2*c23.x + 6*c21.x*c13x2*c13.y*c22.y*c23.y +
            2*c12x2*c12.y*c13.y*c23.x*c23.y + c22x3*c13y3 - 3*c10.x*c13y3*c23x2 + 3*c10.y*c13x3*c23y2 +
            3*c20.x*c13y3*c23x2 + c12y3*c13.x*c23x2 - c12x3*c13.y*c23y2 - 3*c10.x*c13x2*c13.y*c23y2 +
            3*c10.y*c13.x*c13y2*c23x2 - 2*c11.x*c12.y*c13x2*c23y2 + c11.x*c12.y*c13y2*c23x2 - c11.y*c12.x*c13x2*c23y2 +
            2*c11.y*c12.x*c13y2*c23x2 + 3*c20.x*c13x2*c13.y*c23y2 - c12.x*c12y2*c13.y*c23x2 -
            3*c20.y*c13.x*c13y2*c23x2 + c12x2*c12.y*c13.x*c23y2 - 3*c13.x*c22x2*c13y2*c22.y +
            c13x2*c13.y*c23.x*(6*c20.y*c23.y + 6*c21.y*c22.y) + c13x2*c22.x*c13.y*(6*c21.y*c23.y + 3*c22y2) +
            c13x3*(-2*c21.y*c22.y*c23.y - c20.y*c23y2 - c22.y*(2*c21.y*c23.y + c22y2) - c23.y*(2*c20.y*c23.y + 2*c21.y*c22.y)),
        6*c11.x*c12.x*c13.x*c13.y*c22.y*c23.y + c11.x*c12.y*c13.x*c22.x*c13.y*c23.y + c11.x*c12.y*c13.x*c13.y*c22.y*c23.x -
            c11.y*c12.x*c13.x*c22.x*c13.y*c23.y - c11.y*c12.x*c13.x*c13.y*c22.y*c23.x - 6*c11.y*c12.y*c13.x*c22.x*c13.y*c23.x -
            6*c10.x*c22.x*c13y3*c23.x + 6*c20.x*c22.x*c13y3*c23.x + 6*c10.y*c13x3*c22.y*c23.y + 2*c12y3*c13.x*c22.x*c23.x -
            2*c12x3*c13.y*c22.y*c23.y + 6*c10.x*c13.x*c22.x*c13y2*c23.y + 6*c10.x*c13.x*c13y2*c22.y*c23.x +
            6*c10.y*c13.x*c22.x*c13y2*c23.x - 3*c11.x*c12.x*c22.x*c13y2*c23.y - 3*c11.x*c12.x*c13y2*c22.y*c23.x +
            2*c11.x*c12.y*c22.x*c13y2*c23.x + 4*c11.y*c12.x*c22.x*c13y2*c23.x - 6*c10.x*c13x2*c13.y*c22.y*c23.y -
            6*c10.y*c13x2*c22.x*c13.y*c23.y - 6*c10.y*c13x2*c13.y*c22.y*c23.x - 4*c11.x*c12.y*c13x2*c22.y*c23.y -
            6*c20.x*c13.x*c22.x*c13y2*c23.y - 6*c20.x*c13.x*c13y2*c22.y*c23.x - 2*c11.y*c12.x*c13x2*c22.y*c23.y +
            3*c11.y*c12.y*c13x2*c22.x*c23.y + 3*c11.y*c12.y*c13x2*c22.y*c23.x - 2*c12.x*c12y2*c13.x*c22.x*c23.y -
            2*c12.x*c12y2*c13.x*c22.y*c23.x - 2*c12.x*c12y2*c22.x*c13.y*c23.x - 6*c20.y*c13.x*c22.x*c13y2*c23.x -
            6*c21.x*c13.x*c21.y*c13y2*c23.x - 6*c21.x*c13.x*c22.x*c13y2*c22.y + 6*c20.x*c13x2*c13.y*c22.y*c23.y +
            2*c12x2*c12.y*c13.x*c22.y*c23.y + 2*c12x2*c12.y*c22.x*c13.y*c23.y + 2*c12x2*c12.y*c13.y*c22.y*c23.x +
            3*c21.x*c22x2*c13y3 + 3*c21x2*c13y3*c23.x - 3*c13.x*c21.y*c22x2*c13y2 - 3*c21x2*c13.x*c13y2*c23.y +
            c13x2*c22.x*c13.y*(6*c20.y*c23.y + 6*c21.y*c22.y) + c13x2*c13.y*c23.x*(6*c20.y*c22.y + 3*c21y2) +
            c21.x*c13x2*c13.y*(6*c21.y*c23.y + 3*c22y2) + c13x3*(-2*c20.y*c22.y*c23.y - c23.y*(2*c20.y*c22.y + c21y2) -
            c21.y*(2*c21.y*c23.y + c22y2) - c22.y*(2*c20.y*c23.y + 2*c21.y*c22.y)),
        c11.x*c21.x*c12.y*c13.x*c13.y*c23.y + c11.x*c12.y*c13.x*c21.y*c13.y*c23.x + c11.x*c12.y*c13.x*c22.x*c13.y*c22.y -
            c11.y*c12.x*c21.x*c13.x*c13.y*c23.y - c11.y*c12.x*c13.x*c21.y*c13.y*c23.x - c11.y*c12.x*c13.x*c22.x*c13.y*c22.y -
            6*c11.y*c21.x*c12.y*c13.x*c13.y*c23.x - 6*c10.x*c21.x*c13y3*c23.x + 6*c20.x*c21.x*c13y3*c23.x +
            2*c21.x*c12y3*c13.x*c23.x + 6*c10.x*c21.x*c13.x*c13y2*c23.y + 6*c10.x*c13.x*c21.y*c13y2*c23.x +
            6*c10.x*c13.x*c22.x*c13y2*c22.y + 6*c10.y*c21.x*c13.x*c13y2*c23.x - 3*c11.x*c12.x*c21.x*c13y2*c23.y -
            3*c11.x*c12.x*c21.y*c13y2*c23.x - 3*c11.x*c12.x*c22.x*c13y2*c22.y + 2*c11.x*c21.x*c12.y*c13y2*c23.x +
            4*c11.y*c12.x*c21.x*c13y2*c23.x - 6*c10.y*c21.x*c13x2*c13.y*c23.y - 6*c10.y*c13x2*c21.y*c13.y*c23.x -
            6*c10.y*c13x2*c22.x*c13.y*c22.y - 6*c20.x*c21.x*c13.x*c13y2*c23.y - 6*c20.x*c13.x*c21.y*c13y2*c23.x -
            6*c20.x*c13.x*c22.x*c13y2*c22.y + 3*c11.y*c21.x*c12.y*c13x2*c23.y - 3*c11.y*c12.y*c13.x*c22x2*c13.y +
            3*c11.y*c12.y*c13x2*c21.y*c23.x + 3*c11.y*c12.y*c13x2*c22.x*c22.y - 2*c12.x*c21.x*c12y2*c13.x*c23.y -
            2*c12.x*c21.x*c12y2*c13.y*c23.x - 2*c12.x*c12y2*c13.x*c21.y*c23.x - 2*c12.x*c12y2*c13.x*c22.x*c22.y -
            6*c20.y*c21.x*c13.x*c13y2*c23.x - 6*c21.x*c13.x*c21.y*c22.x*c13y2 + 6*c20.y*c13x2*c21.y*c13.y*c23.x +
            2*c12x2*c21.x*c12.y*c13.y*c23.y + 2*c12x2*c12.y*c21.y*c13.y*c23.x + 2*c12x2*c12.y*c22.x*c13.y*c22.y -
            3*c10.x*c22x2*c13y3 + 3*c20.x*c22x2*c13y3 + 3*c21x2*c22.x*c13y3 + c12y3*c13.x*c22x2 +
            3*c10.y*c13.x*c22x2*c13y2 + c11.x*c12.y*c22x2*c13y2 + 2*c11.y*c12.x*c22x2*c13y2 -
            c12.x*c12y2*c22x2*c13.y - 3*c20.y*c13.x*c22x2*c13y2 - 3*c21x2*c13.x*c13y2*c22.y +
            c12x2*c12.y*c13.x*(2*c21.y*c23.y + c22y2) + c11.x*c12.x*c13.x*c13.y*(6*c21.y*c23.y + 3*c22y2) +
            c21.x*c13x2*c13.y*(6*c20.y*c23.y + 6*c21.y*c22.y) + c12x3*c13.y*(-2*c21.y*c23.y - c22y2) +
            c10.y*c13x3*(6*c21.y*c23.y + 3*c22y2) + c11.y*c12.x*c13x2*(-2*c21.y*c23.y - c22y2) +
            c11.x*c12.y*c13x2*(-4*c21.y*c23.y - 2*c22y2) + c10.x*c13x2*c13.y*(-6*c21.y*c23.y - 3*c22y2) +
            c13x2*c22.x*c13.y*(6*c20.y*c22.y + 3*c21y2) + c20.x*c13x2*c13.y*(6*c21.y*c23.y + 3*c22y2) +
            c13x3*(-2*c20.y*c21.y*c23.y - c22.y*(2*c20.y*c22.y + c21y2) - c20.y*(2*c21.y*c23.y + c22y2) -
            c21.y*(2*c20.y*c23.y + 2*c21.y*c22.y)),
        -c10.x*c11.x*c12.y*c13.x*c13.y*c23.y + c10.x*c11.y*c12.x*c13.x*c13.y*c23.y + 6*c10.x*c11.y*c12.y*c13.x*c13.y*c23.x -
            6*c10.y*c11.x*c12.x*c13.x*c13.y*c23.y - c10.y*c11.x*c12.y*c13.x*c13.y*c23.x + c10.y*c11.y*c12.x*c13.x*c13.y*c23.x +
            c11.x*c11.y*c12.x*c12.y*c13.x*c23.y - c11.x*c11.y*c12.x*c12.y*c13.y*c23.x + c11.x*c20.x*c12.y*c13.x*c13.y*c23.y +
            c11.x*c20.y*c12.y*c13.x*c13.y*c23.x + c11.x*c21.x*c12.y*c13.x*c13.y*c22.y + c11.x*c12.y*c13.x*c21.y*c22.x*c13.y -
            c20.x*c11.y*c12.x*c13.x*c13.y*c23.y - 6*c20.x*c11.y*c12.y*c13.x*c13.y*c23.x - c11.y*c12.x*c20.y*c13.x*c13.y*c23.x -
            c11.y*c12.x*c21.x*c13.x*c13.y*c22.y - c11.y*c12.x*c13.x*c21.y*c22.x*c13.y - 6*c11.y*c21.x*c12.y*c13.x*c22.x*c13.y -
            6*c10.x*c20.x*c13y3*c23.x - 6*c10.x*c21.x*c22.x*c13y3 - 2*c10.x*c12y3*c13.x*c23.x + 6*c20.x*c21.x*c22.x*c13y3 +
            2*c20.x*c12y3*c13.x*c23.x + 2*c21.x*c12y3*c13.x*c22.x + 2*c10.y*c12x3*c13.y*c23.y - 6*c10.x*c10.y*c13.x*c13y2*c23.x +
            3*c10.x*c11.x*c12.x*c13y2*c23.y - 2*c10.x*c11.x*c12.y*c13y2*c23.x - 4*c10.x*c11.y*c12.x*c13y2*c23.x +
            3*c10.y*c11.x*c12.x*c13y2*c23.x + 6*c10.x*c10.y*c13x2*c13.y*c23.y + 6*c10.x*c20.x*c13.x*c13y2*c23.y -
            3*c10.x*c11.y*c12.y*c13x2*c23.y + 2*c10.x*c12.x*c12y2*c13.x*c23.y + 2*c10.x*c12.x*c12y2*c13.y*c23.x +
            6*c10.x*c20.y*c13.x*c13y2*c23.x + 6*c10.x*c21.x*c13.x*c13y2*c22.y + 6*c10.x*c13.x*c21.y*c22.x*c13y2 +
            4*c10.y*c11.x*c12.y*c13x2*c23.y + 6*c10.y*c20.x*c13.x*c13y2*c23.x + 2*c10.y*c11.y*c12.x*c13x2*c23.y -
            3*c10.y*c11.y*c12.y*c13x2*c23.x + 2*c10.y*c12.x*c12y2*c13.x*c23.x + 6*c10.y*c21.x*c13.x*c22.x*c13y2 -
            3*c11.x*c20.x*c12.x*c13y2*c23.y + 2*c11.x*c20.x*c12.y*c13y2*c23.x + c11.x*c11.y*c12y2*c13.x*c23.x -
            3*c11.x*c12.x*c20.y*c13y2*c23.x - 3*c11.x*c12.x*c21.x*c13y2*c22.y - 3*c11.x*c12.x*c21.y*c22.x*c13y2 +
            2*c11.x*c21.x*c12.y*c22.x*c13y2 + 4*c20.x*c11.y*c12.x*c13y2*c23.x + 4*c11.y*c12.x*c21.x*c22.x*c13y2 -
            2*c10.x*c12x2*c12.y*c13.y*c23.y - 6*c10.y*c20.x*c13x2*c13.y*c23.y - 6*c10.y*c20.y*c13x2*c13.y*c23.x -
            6*c10.y*c21.x*c13x2*c13.y*c22.y - 2*c10.y*c12x2*c12.y*c13.x*c23.y - 2*c10.y*c12x2*c12.y*c13.y*c23.x -
            6*c10.y*c13x2*c21.y*c22.x*c13.y - c11.x*c11.y*c12x2*c13.y*c23.y - 2*c11.x*c11y2*c13.x*c13.y*c23.x +
            3*c20.x*c11.y*c12.y*c13x2*c23.y - 2*c20.x*c12.x*c12y2*c13.x*c23.y - 2*c20.x*c12.x*c12y2*c13.y*c23.x -
            6*c20.x*c20.y*c13.x*c13y2*c23.x - 6*c20.x*c21.x*c13.x*c13y2*c22.y - 6*c20.x*c13.x*c21.y*c22.x*c13y2 +
            3*c11.y*c20.y*c12.y*c13x2*c23.x + 3*c11.y*c21.x*c12.y*c13x2*c22.y + 3*c11.y*c12.y*c13x2*c21.y*c22.x -
            2*c12.x*c20.y*c12y2*c13.x*c23.x - 2*c12.x*c21.x*c12y2*c13.x*c22.y - 2*c12.x*c21.x*c12y2*c22.x*c13.y -
            2*c12.x*c12y2*c13.x*c21.y*c22.x - 6*c20.y*c21.x*c13.x*c22.x*c13y2 - c11y2*c12.x*c12.y*c13.x*c23.x +
            2*c20.x*c12x2*c12.y*c13.y*c23.y + 6*c20.y*c13x2*c21.y*c22.x*c13.y + 2*c11x2*c11.y*c13.x*c13.y*c23.y +
            c11x2*c12.x*c12.y*c13.y*c23.y + 2*c12x2*c20.y*c12.y*c13.y*c23.x + 2*c12x2*c21.x*c12.y*c13.y*c22.y +
            2*c12x2*c12.y*c21.y*c22.x*c13.y + c21x3*c13y3 + 3*c10x2*c13y3*c23.x - 3*c10y2*c13x3*c23.y +
            3*c20x2*c13y3*c23.x + c11y3*c13x2*c23.x - c11x3*c13y2*c23.y - c11.x*c11y2*c13x2*c23.y +
            c11x2*c11.y*c13y2*c23.x - 3*c10x2*c13.x*c13y2*c23.y + 3*c10y2*c13x2*c13.y*c23.x - c11x2*c12y2*c13.x*c23.y +
            c11y2*c12x2*c13.y*c23.x - 3*c21x2*c13.x*c21.y*c13y2 - 3*c20x2*c13.x*c13y2*c23.y + 3*c20y2*c13x2*c13.y*c23.x +
            c11.x*c12.x*c13.x*c13.y*(6*c20.y*c23.y + 6*c21.y*c22.y) + c12x3*c13.y*(-2*c20.y*c23.y - 2*c21.y*c22.y) +
            c10.y*c13x3*(6*c20.y*c23.y + 6*c21.y*c22.y) + c11.y*c12.x*c13x2*(-2*c20.y*c23.y - 2*c21.y*c22.y) +
            c12x2*c12.y*c13.x*(2*c20.y*c23.y + 2*c21.y*c22.y) + c11.x*c12.y*c13x2*(-4*c20.y*c23.y - 4*c21.y*c22.y) +
            c10.x*c13x2*c13.y*(-6*c20.y*c23.y - 6*c21.y*c22.y) + c20.x*c13x2*c13.y*(6*c20.y*c23.y + 6*c21.y*c22.y) +
            c21.x*c13x2*c13.y*(6*c20.y*c22.y + 3*c21y2) + c13x3*(-2*c20.y*c21.y*c22.y - c20y2*c23.y -
            c21.y*(2*c20.y*c22.y + c21y2) - c20.y*(2*c20.y*c23.y + 2*c21.y*c22.y)),
        -c10.x*c11.x*c12.y*c13.x*c13.y*c22.y + c10.x*c11.y*c12.x*c13.x*c13.y*c22.y + 6*c10.x*c11.y*c12.y*c13.x*c22.x*c13.y -
            6*c10.y*c11.x*c12.x*c13.x*c13.y*c22.y - c10.y*c11.x*c12.y*c13.x*c22.x*c13.y + c10.y*c11.y*c12.x*c13.x*c22.x*c13.y +
            c11.x*c11.y*c12.x*c12.y*c13.x*c22.y - c11.x*c11.y*c12.x*c12.y*c22.x*c13.y + c11.x*c20.x*c12.y*c13.x*c13.y*c22.y +
            c11.x*c20.y*c12.y*c13.x*c22.x*c13.y + c11.x*c21.x*c12.y*c13.x*c21.y*c13.y - c20.x*c11.y*c12.x*c13.x*c13.y*c22.y -
            6*c20.x*c11.y*c12.y*c13.x*c22.x*c13.y - c11.y*c12.x*c20.y*c13.x*c22.x*c13.y - c11.y*c12.x*c21.x*c13.x*c21.y*c13.y -
            6*c10.x*c20.x*c22.x*c13y3 - 2*c10.x*c12y3*c13.x*c22.x + 2*c20.x*c12y3*c13.x*c22.x + 2*c10.y*c12x3*c13.y*c22.y -
            6*c10.x*c10.y*c13.x*c22.x*c13y2 + 3*c10.x*c11.x*c12.x*c13y2*c22.y - 2*c10.x*c11.x*c12.y*c22.x*c13y2 -
            4*c10.x*c11.y*c12.x*c22.x*c13y2 + 3*c10.y*c11.x*c12.x*c22.x*c13y2 + 6*c10.x*c10.y*c13x2*c13.y*c22.y +
            6*c10.x*c20.x*c13.x*c13y2*c22.y - 3*c10.x*c11.y*c12.y*c13x2*c22.y + 2*c10.x*c12.x*c12y2*c13.x*c22.y +
            2*c10.x*c12.x*c12y2*c22.x*c13.y + 6*c10.x*c20.y*c13.x*c22.x*c13y2 + 6*c10.x*c21.x*c13.x*c21.y*c13y2 +
            4*c10.y*c11.x*c12.y*c13x2*c22.y + 6*c10.y*c20.x*c13.x*c22.x*c13y2 + 2*c10.y*c11.y*c12.x*c13x2*c22.y -
            3*c10.y*c11.y*c12.y*c13x2*c22.x + 2*c10.y*c12.x*c12y2*c13.x*c22.x - 3*c11.x*c20.x*c12.x*c13y2*c22.y +
            2*c11.x*c20.x*c12.y*c22.x*c13y2 + c11.x*c11.y*c12y2*c13.x*c22.x - 3*c11.x*c12.x*c20.y*c22.x*c13y2 -
            3*c11.x*c12.x*c21.x*c21.y*c13y2 + 4*c20.x*c11.y*c12.x*c22.x*c13y2 - 2*c10.x*c12x2*c12.y*c13.y*c22.y -
            6*c10.y*c20.x*c13x2*c13.y*c22.y - 6*c10.y*c20.y*c13x2*c22.x*c13.y - 6*c10.y*c21.x*c13x2*c21.y*c13.y -
            2*c10.y*c12x2*c12.y*c13.x*c22.y - 2*c10.y*c12x2*c12.y*c22.x*c13.y - c11.x*c11.y*c12x2*c13.y*c22.y -
            2*c11.x*c11y2*c13.x*c22.x*c13.y + 3*c20.x*c11.y*c12.y*c13x2*c22.y - 2*c20.x*c12.x*c12y2*c13.x*c22.y -
            2*c20.x*c12.x*c12y2*c22.x*c13.y - 6*c20.x*c20.y*c13.x*c22.x*c13y2 - 6*c20.x*c21.x*c13.x*c21.y*c13y2 +
            3*c11.y*c20.y*c12.y*c13x2*c22.x + 3*c11.y*c21.x*c12.y*c13x2*c21.y - 2*c12.x*c20.y*c12y2*c13.x*c22.x -
            2*c12.x*c21.x*c12y2*c13.x*c21.y - c11y2*c12.x*c12.y*c13.x*c22.x + 2*c20.x*c12x2*c12.y*c13.y*c22.y -
            3*c11.y*c21x2*c12.y*c13.x*c13.y + 6*c20.y*c21.x*c13x2*c21.y*c13.y + 2*c11x2*c11.y*c13.x*c13.y*c22.y +
            c11x2*c12.x*c12.y*c13.y*c22.y + 2*c12x2*c20.y*c12.y*c22.x*c13.y + 2*c12x2*c21.x*c12.y*c21.y*c13.y -
            3*c10.x*c21x2*c13y3 + 3*c20.x*c21x2*c13y3 + 3*c10x2*c22.x*c13y3 - 3*c10y2*c13x3*c22.y + 3*c20x2*c22.x*c13y3 +
            c21x2*c12y3*c13.x + c11y3*c13x2*c22.x - c11x3*c13y2*c22.y + 3*c10.y*c21x2*c13.x*c13y2 -
            c11.x*c11y2*c13x2*c22.y + c11.x*c21x2*c12.y*c13y2 + 2*c11.y*c12.x*c21x2*c13y2 + c11x2*c11.y*c22.x*c13y2 -
            c12.x*c21x2*c12y2*c13.y - 3*c20.y*c21x2*c13.x*c13y2 - 3*c10x2*c13.x*c13y2*c22.y + 3*c10y2*c13x2*c22.x*c13.y -
            c11x2*c12y2*c13.x*c22.y + c11y2*c12x2*c22.x*c13.y - 3*c20x2*c13.x*c13y2*c22.y + 3*c20y2*c13x2*c22.x*c13.y +
            c12x2*c12.y*c13.x*(2*c20.y*c22.y + c21y2) + c11.x*c12.x*c13.x*c13.y*(6*c20.y*c22.y + 3*c21y2) +
            c12x3*c13.y*(-2*c20.y*c22.y - c21y2) + c10.y*c13x3*(6*c20.y*c22.y + 3*c21y2) +
            c11.y*c12.x*c13x2*(-2*c20.y*c22.y - c21y2) + c11.x*c12.y*c13x2*(-4*c20.y*c22.y - 2*c21y2) +
            c10.x*c13x2*c13.y*(-6*c20.y*c22.y - 3*c21y2) + c20.x*c13x2*c13.y*(6*c20.y*c22.y + 3*c21y2) +
            c13x3*(-2*c20.y*c21y2 - c20y2*c22.y - c20.y*(2*c20.y*c22.y + c21y2)),
        -c10.x*c11.x*c12.y*c13.x*c21.y*c13.y + c10.x*c11.y*c12.x*c13.x*c21.y*c13.y + 6*c10.x*c11.y*c21.x*c12.y*c13.x*c13.y -
            6*c10.y*c11.x*c12.x*c13.x*c21.y*c13.y - c10.y*c11.x*c21.x*c12.y*c13.x*c13.y + c10.y*c11.y*c12.x*c21.x*c13.x*c13.y -
            c11.x*c11.y*c12.x*c21.x*c12.y*c13.y + c11.x*c11.y*c12.x*c12.y*c13.x*c21.y + c11.x*c20.x*c12.y*c13.x*c21.y*c13.y +
            6*c11.x*c12.x*c20.y*c13.x*c21.y*c13.y + c11.x*c20.y*c21.x*c12.y*c13.x*c13.y - c20.x*c11.y*c12.x*c13.x*c21.y*c13.y -
            6*c20.x*c11.y*c21.x*c12.y*c13.x*c13.y - c11.y*c12.x*c20.y*c21.x*c13.x*c13.y - 6*c10.x*c20.x*c21.x*c13y3 -
            2*c10.x*c21.x*c12y3*c13.x + 6*c10.y*c20.y*c13x3*c21.y + 2*c20.x*c21.x*c12y3*c13.x + 2*c10.y*c12x3*c21.y*c13.y -
            2*c12x3*c20.y*c21.y*c13.y - 6*c10.x*c10.y*c21.x*c13.x*c13y2 + 3*c10.x*c11.x*c12.x*c21.y*c13y2 -
            2*c10.x*c11.x*c21.x*c12.y*c13y2 - 4*c10.x*c11.y*c12.x*c21.x*c13y2 + 3*c10.y*c11.x*c12.x*c21.x*c13y2 +
            6*c10.x*c10.y*c13x2*c21.y*c13.y + 6*c10.x*c20.x*c13.x*c21.y*c13y2 - 3*c10.x*c11.y*c12.y*c13x2*c21.y +
            2*c10.x*c12.x*c21.x*c12y2*c13.y + 2*c10.x*c12.x*c12y2*c13.x*c21.y + 6*c10.x*c20.y*c21.x*c13.x*c13y2 +
            4*c10.y*c11.x*c12.y*c13x2*c21.y + 6*c10.y*c20.x*c21.x*c13.x*c13y2 + 2*c10.y*c11.y*c12.x*c13x2*c21.y -
            3*c10.y*c11.y*c21.x*c12.y*c13x2 + 2*c10.y*c12.x*c21.x*c12y2*c13.x - 3*c11.x*c20.x*c12.x*c21.y*c13y2 +
            2*c11.x*c20.x*c21.x*c12.y*c13y2 + c11.x*c11.y*c21.x*c12y2*c13.x - 3*c11.x*c12.x*c20.y*c21.x*c13y2 +
            4*c20.x*c11.y*c12.x*c21.x*c13y2 - 6*c10.x*c20.y*c13x2*c21.y*c13.y - 2*c10.x*c12x2*c12.y*c21.y*c13.y -
            6*c10.y*c20.x*c13x2*c21.y*c13.y - 6*c10.y*c20.y*c21.x*c13x2*c13.y - 2*c10.y*c12x2*c21.x*c12.y*c13.y -
            2*c10.y*c12x2*c12.y*c13.x*c21.y - c11.x*c11.y*c12x2*c21.y*c13.y - 4*c11.x*c20.y*c12.y*c13x2*c21.y -
            2*c11.x*c11y2*c21.x*c13.x*c13.y + 3*c20.x*c11.y*c12.y*c13x2*c21.y - 2*c20.x*c12.x*c21.x*c12y2*c13.y -
            2*c20.x*c12.x*c12y2*c13.x*c21.y - 6*c20.x*c20.y*c21.x*c13.x*c13y2 - 2*c11.y*c12.x*c20.y*c13x2*c21.y +
            3*c11.y*c20.y*c21.x*c12.y*c13x2 - 2*c12.x*c20.y*c21.x*c12y2*c13.x - c11y2*c12.x*c21.x*c12.y*c13.x +
            6*c20.x*c20.y*c13x2*c21.y*c13.y + 2*c20.x*c12x2*c12.y*c21.y*c13.y + 2*c11x2*c11.y*c13.x*c21.y*c13.y +
            c11x2*c12.x*c12.y*c21.y*c13.y + 2*c12x2*c20.y*c21.x*c12.y*c13.y + 2*c12x2*c20.y*c12.y*c13.x*c21.y +
            3*c10x2*c21.x*c13y3 - 3*c10y2*c13x3*c21.y + 3*c20x2*c21.x*c13y3 + c11y3*c21.x*c13x2 - c11x3*c21.y*c13y2 -
            3*c20y2*c13x3*c21.y - c11.x*c11y2*c13x2*c21.y + c11x2*c11.y*c21.x*c13y2 - 3*c10x2*c13.x*c21.y*c13y2 +
            3*c10y2*c21.x*c13x2*c13.y - c11x2*c12y2*c13.x*c21.y + c11y2*c12x2*c21.x*c13.y - 3*c20x2*c13.x*c21.y*c13y2 +
            3*c20y2*c21.x*c13x2*c13.y,
        c10.x*c10.y*c11.x*c12.y*c13.x*c13.y - c10.x*c10.y*c11.y*c12.x*c13.x*c13.y + c10.x*c11.x*c11.y*c12.x*c12.y*c13.y -
            c10.y*c11.x*c11.y*c12.x*c12.y*c13.x - c10.x*c11.x*c20.y*c12.y*c13.x*c13.y + 6*c10.x*c20.x*c11.y*c12.y*c13.x*c13.y +
            c10.x*c11.y*c12.x*c20.y*c13.x*c13.y - c10.y*c11.x*c20.x*c12.y*c13.x*c13.y - 6*c10.y*c11.x*c12.x*c20.y*c13.x*c13.y +
            c10.y*c20.x*c11.y*c12.x*c13.x*c13.y - c11.x*c20.x*c11.y*c12.x*c12.y*c13.y + c11.x*c11.y*c12.x*c20.y*c12.y*c13.x +
            c11.x*c20.x*c20.y*c12.y*c13.x*c13.y - c20.x*c11.y*c12.x*c20.y*c13.x*c13.y - 2*c10.x*c20.x*c12y3*c13.x +
            2*c10.y*c12x3*c20.y*c13.y - 3*c10.x*c10.y*c11.x*c12.x*c13y2 - 6*c10.x*c10.y*c20.x*c13.x*c13y2 +
            3*c10.x*c10.y*c11.y*c12.y*c13x2 - 2*c10.x*c10.y*c12.x*c12y2*c13.x - 2*c10.x*c11.x*c20.x*c12.y*c13y2 -
            c10.x*c11.x*c11.y*c12y2*c13.x + 3*c10.x*c11.x*c12.x*c20.y*c13y2 - 4*c10.x*c20.x*c11.y*c12.x*c13y2 +
            3*c10.y*c11.x*c20.x*c12.x*c13y2 + 6*c10.x*c10.y*c20.y*c13x2*c13.y + 2*c10.x*c10.y*c12x2*c12.y*c13.y +
            2*c10.x*c11.x*c11y2*c13.x*c13.y + 2*c10.x*c20.x*c12.x*c12y2*c13.y + 6*c10.x*c20.x*c20.y*c13.x*c13y2 -
            3*c10.x*c11.y*c20.y*c12.y*c13x2 + 2*c10.x*c12.x*c20.y*c12y2*c13.x + c10.x*c11y2*c12.x*c12.y*c13.x +
            c10.y*c11.x*c11.y*c12x2*c13.y + 4*c10.y*c11.x*c20.y*c12.y*c13x2 - 3*c10.y*c20.x*c11.y*c12.y*c13x2 +
            2*c10.y*c20.x*c12.x*c12y2*c13.x + 2*c10.y*c11.y*c12.x*c20.y*c13x2 + c11.x*c20.x*c11.y*c12y2*c13.x -
            3*c11.x*c20.x*c12.x*c20.y*c13y2 - 2*c10.x*c12x2*c20.y*c12.y*c13.y - 6*c10.y*c20.x*c20.y*c13x2*c13.y -
            2*c10.y*c20.x*c12x2*c12.y*c13.y - 2*c10.y*c11x2*c11.y*c13.x*c13.y - c10.y*c11x2*c12.x*c12.y*c13.y -
            2*c10.y*c12x2*c20.y*c12.y*c13.x - 2*c11.x*c20.x*c11y2*c13.x*c13.y - c11.x*c11.y*c12x2*c20.y*c13.y +
            3*c20.x*c11.y*c20.y*c12.y*c13x2 - 2*c20.x*c12.x*c20.y*c12y2*c13.x - c20.x*c11y2*c12.x*c12.y*c13.x +
            3*c10y2*c11.x*c12.x*c13.x*c13.y + 3*c11.x*c12.x*c20y2*c13.x*c13.y + 2*c20.x*c12x2*c20.y*c12.y*c13.y -
            3*c10x2*c11.y*c12.y*c13.x*c13.y + 2*c11x2*c11.y*c20.y*c13.x*c13.y + c11x2*c12.x*c20.y*c12.y*c13.y -
            3*c20x2*c11.y*c12.y*c13.x*c13.y - c10x3*c13y3 + c10y3*c13x3 + c20x3*c13y3 - c20y3*c13x3 -
            3*c10.x*c20x2*c13y3 - c10.x*c11y3*c13x2 + 3*c10x2*c20.x*c13y3 + c10.y*c11x3*c13y2 +
            3*c10.y*c20y2*c13x3 + c20.x*c11y3*c13x2 + c10x2*c12y3*c13.x - 3*c10y2*c20.y*c13x3 - c10y2*c12x3*c13.y +
            c20x2*c12y3*c13.x - c11x3*c20.y*c13y2 - c12x3*c20y2*c13.y - c10.x*c11x2*c11.y*c13y2 +
            c10.y*c11.x*c11y2*c13x2 - 3*c10.x*c10y2*c13x2*c13.y - c10.x*c11y2*c12x2*c13.y + c10.y*c11x2*c12y2*c13.x -
            c11.x*c11y2*c20.y*c13x2 + 3*c10x2*c10.y*c13.x*c13y2 + c10x2*c11.x*c12.y*c13y2 +
            2*c10x2*c11.y*c12.x*c13y2 - 2*c10y2*c11.x*c12.y*c13x2 - c10y2*c11.y*c12.x*c13x2 + c11x2*c20.x*c11.y*c13y2 -
            3*c10.x*c20y2*c13x2*c13.y + 3*c10.y*c20x2*c13.x*c13y2 + c11.x*c20x2*c12.y*c13y2 - 2*c11.x*c20y2*c12.y*c13x2 +
            c20.x*c11y2*c12x2*c13.y - c11.y*c12.x*c20y2*c13x2 - c10x2*c12.x*c12y2*c13.y - 3*c10x2*c20.y*c13.x*c13y2 +
            3*c10y2*c20.x*c13x2*c13.y + c10y2*c12x2*c12.y*c13.x - c11x2*c20.y*c12y2*c13.x + 2*c20x2*c11.y*c12.x*c13y2 +
            3*c20.x*c20y2*c13x2*c13.y - c20x2*c12.x*c12y2*c13.y - 3*c20x2*c20.y*c13.x*c13y2 + c12x2*c20y2*c12.y*c13.x
    );
    var roots = poly.getRootsInInterval(0,1);

    for ( var i = 0; i < roots.length; i++ ) {
        var s = roots[i];
        var xRoots = new Polynomial(
            c13.x,
            c12.x,
            c11.x,
            c10.x - c20.x - s*c21.x - s*s*c22.x - s*s*s*c23.x
        ).getRoots();
        var yRoots = new Polynomial(
            c13.y,
            c12.y,
            c11.y,
            c10.y - c20.y - s*c21.y - s*s*c22.y - s*s*s*c23.y
        ).getRoots();

        if ( xRoots.length > 0 && yRoots.length > 0 ) {
            var TOLERANCE = 1e-4;

            checkRoots:
            for ( var j = 0; j < xRoots.length; j++ ) {
                var xRoot = xRoots[j];
                
                if ( 0 <= xRoot && xRoot <= 1 ) {
                    for ( var k = 0; k < yRoots.length; k++ ) {
                        if ( Math.abs( xRoot - yRoots[k] ) < TOLERANCE ) {
                            result.points.push(
                                c23.multiply(s*s*s).add(c22.multiply(s*s).add(c21.multiply(s).add(c20)))
                            );
                            break checkRoots;
                        }
                    }
                }
            }
        }
    }

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectBezier3Circle
*
*****/
Intersection.intersectBezier3Circle = function(p1, p2, p3, p4, c, r) {
    return Intersection.intersectBezier3Ellipse(p1, p2, p3, p4, c, r, r);
};


/*****
*
*   intersectBezier3Ellipse
*
*****/
Intersection.intersectBezier3Ellipse = function(p1, p2, p3, p4, ec, rx, ry) {
    var a, b, c, d;       // temporary variables
    var c3, c2, c1, c0;   // coefficients of cubic
    var result = new Intersection("No Intersection");

    // Calculate the coefficients of cubic polynomial
    a = p1.multiply(-1);
    b = p2.multiply(3);
    c = p3.multiply(-3);
    d = a.add(b.add(c.add(p4)));
    c3 = new Vector2D(d.x, d.y);

    a = p1.multiply(3);
    b = p2.multiply(-6);
    c = p3.multiply(3);
    d = a.add(b.add(c));
    c2 = new Vector2D(d.x, d.y);

    a = p1.multiply(-3);
    b = p2.multiply(3);
    c = a.add(b);
    c1 = new Vector2D(c.x, c.y);

    c0 = new Vector2D(p1.x, p1.y);

    var rxrx  = rx*rx;
    var ryry  = ry*ry;
    var poly = new Polynomial(
        c3.x*c3.x*ryry + c3.y*c3.y*rxrx,
        2*(c3.x*c2.x*ryry + c3.y*c2.y*rxrx),
        2*(c3.x*c1.x*ryry + c3.y*c1.y*rxrx) + c2.x*c2.x*ryry + c2.y*c2.y*rxrx,
        2*c3.x*ryry*(c0.x - ec.x) + 2*c3.y*rxrx*(c0.y - ec.y) +
            2*(c2.x*c1.x*ryry + c2.y*c1.y*rxrx),
        2*c2.x*ryry*(c0.x - ec.x) + 2*c2.y*rxrx*(c0.y - ec.y) +
            c1.x*c1.x*ryry + c1.y*c1.y*rxrx,
        2*c1.x*ryry*(c0.x - ec.x) + 2*c1.y*rxrx*(c0.y - ec.y),
        c0.x*c0.x*ryry - 2*c0.y*ec.y*rxrx - 2*c0.x*ec.x*ryry +
            c0.y*c0.y*rxrx + ec.x*ec.x*ryry + ec.y*ec.y*rxrx - rxrx*ryry
    );
    var roots = poly.getRootsInInterval(0,1);

    for ( var i = 0; i < roots.length; i++ ) {
        var t = roots[i];

        result.points.push(
            c3.multiply(t*t*t).add(c2.multiply(t*t).add(c1.multiply(t).add(c0)))
        );
    }

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectBezier3Line
*
*   Many thanks to Dan Sunday at SoftSurfer.com.  He gave me a very thorough
*   sketch of the algorithm used here.  Without his help, I'm not sure when I
*   would have figured out this intersection problem.
*
*****/
Intersection.intersectBezier3Line = function(p1, p2, p3, p4, a1, a2) {
    var a, b, c, d;       // temporary variables
    var c3, c2, c1, c0;   // coefficients of cubic
    var cl;               // c coefficient for normal form of line
    var n;                // normal for normal form of line
    var min = a1.min(a2); // used to determine if point is on line segment
    var max = a1.max(a2); // used to determine if point is on line segment
    var result = new Intersection("No Intersection");
    
    // Start with Bezier using Bernstein polynomials for weighting functions:
    //     (1-t^3)P1 + 3t(1-t)^2P2 + 3t^2(1-t)P3 + t^3P4
    //
    // Expand and collect terms to form linear combinations of original Bezier
    // controls.  This ends up with a vector cubic in t:
    //     (-P1+3P2-3P3+P4)t^3 + (3P1-6P2+3P3)t^2 + (-3P1+3P2)t + P1
    //             /\                  /\                /\       /\
    //             ||                  ||                ||       ||
    //             c3                  c2                c1       c0
    
    // Calculate the coefficients
    a = p1.multiply(-1);
    b = p2.multiply(3);
    c = p3.multiply(-3);
    d = a.add(b.add(c.add(p4)));
    c3 = new Vector2D(d.x, d.y);

    a = p1.multiply(3);
    b = p2.multiply(-6);
    c = p3.multiply(3);
    d = a.add(b.add(c));
    c2 = new Vector2D(d.x, d.y);

    a = p1.multiply(-3);
    b = p2.multiply(3);
    c = a.add(b);
    c1 = new Vector2D(c.x, c.y);

    c0 = new Vector2D(p1.x, p1.y);
    
    // Convert line to normal form: ax + by + c = 0
    // Find normal to line: negative inverse of original line's slope
    n = new Vector2D(a1.y - a2.y, a2.x - a1.x);
    
    // Determine new c coefficient
    cl = a1.x*a2.y - a2.x*a1.y;

    // ?Rotate each cubic coefficient using line for new coordinate system?
    // Find roots of rotated cubic
    roots = new Polynomial(
        n.dot(c3),
        n.dot(c2),
        n.dot(c1),
        n.dot(c0) + cl
    ).getRoots();

    // Any roots in closed interval [0,1] are intersections on Bezier, but
    // might not be on the line segment.
    // Find intersections and calculate point coordinates
    for ( var i = 0; i < roots.length; i++ ) {
        var t = roots[i];

        if ( 0 <= t && t <= 1 ) {
            // We're within the Bezier curve
            // Find point on Bezier
            var p5 = p1.lerp(p2, t);
            var p6 = p2.lerp(p3, t);
            var p7 = p3.lerp(p4, t);

            var p8 = p5.lerp(p6, t);
            var p9 = p6.lerp(p7, t);

            var p10 = p8.lerp(p9, t);

            // See if point is on line segment
            // Had to make special cases for vertical and horizontal lines due
            // to slight errors in calculation of p10
            if ( a1.x == a2.x ) {
                if ( min.y <= p10.y && p10.y <= max.y ) {
                    result.status = "Intersection";
                    result.appendPoint( p10 );
                }
            } else if ( a1.y == a2.y ) {
                if ( min.x <= p10.x && p10.x <= max.x ) {
                    result.status = "Intersection";
                    result.appendPoint( p10 );
                }
            } else if ( p10.gte(min) && p10.lte(max) ) {
                result.status = "Intersection";
                result.appendPoint( p10 );
            }
        }
    }

    return result;
};


/*****
*
*   intersectBezier3Polygon
*
*****/
Intersection.intersectBezier3Polygon = function(p1, p2, p3, p4, points) {
    var result = new Intersection("No Intersection");
    var length = points.length;

    for ( var i = 0; i < length; i++ ) {
        var a1 = points[i];
        var a2 = points[(i+1) % length];
        var inter = Intersection.intersectBezier3Line(p1, p2, p3, p4, a1, a2);

        result.appendPoints(inter.points);
    }

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectBezier3Rectangle
*
*****/
Intersection.intersectBezier3Rectangle = function(p1, p2, p3, p4, r1, r2) {
    var min        = r1.min(r2);
    var max        = r1.max(r2);
    var topRight   = new Point2D( max.x, min.y );
    var bottomLeft = new Point2D( min.x, max.y );
    
    var inter1 = Intersection.intersectBezier3Line(p1, p2, p3, p4, min, topRight);
    var inter2 = Intersection.intersectBezier3Line(p1, p2, p3, p4, topRight, max);
    var inter3 = Intersection.intersectBezier3Line(p1, p2, p3, p4, max, bottomLeft);
    var inter4 = Intersection.intersectBezier3Line(p1, p2, p3, p4, bottomLeft, min);
    
    var result = new Intersection("No Intersection");

    result.appendPoints(inter1.points);
    result.appendPoints(inter2.points);
    result.appendPoints(inter3.points);
    result.appendPoints(inter4.points);

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectCircleCircle
*
*****/
Intersection.intersectCircleCircle = function(c1, r1, c2, r2) {
    var result;
    
    // Determine minimum and maximum radii where circles can intersect
    var r_max = r1 + r2;
    var r_min = Math.abs(r1 - r2);
    
    // Determine actual distance between circle circles
    var c_dist = c1.distanceFrom( c2 );

    if ( c_dist > r_max ) {
        result = new Intersection("Outside");
    } else if ( c_dist < r_min ) {
        result = new Intersection("Inside");
    } else {
        result = new Intersection("Intersection");

        var a = (r1*r1 - r2*r2 + c_dist*c_dist) / ( 2*c_dist );
        var h = Math.sqrt(r1*r1 - a*a);
        var p = c1.lerp(c2, a/c_dist);
        var b = h / c_dist;

        result.points.push(
            new Point2D(
                p.x - b * (c2.y - c1.y),
                p.y + b * (c2.x - c1.x)
            )
        );
        result.points.push(
            new Point2D(
                p.x + b * (c2.y - c1.y),
                p.y - b * (c2.x - c1.x)
            )
        );
    }

    return result;
};


/*****
*
*   intersectCircleEllipse
*
*****/
Intersection.intersectCircleEllipse = function(cc, r, ec, rx, ry) {
    return Intersection.intersectEllipseEllipse(cc, r, r, ec, rx, ry);
};


/*****
*
*   intersectCircleLine
*
*****/
Intersection.intersectCircleLine = function(c, r, a1, a2) {
    var result;
    var a  = (a2.x - a1.x) * (a2.x - a1.x) +
             (a2.y - a1.y) * (a2.y - a1.y);
    var b  = 2 * ( (a2.x - a1.x) * (a1.x - c.x) +
                   (a2.y - a1.y) * (a1.y - c.y)   );
    var cc = c.x*c.x + c.y*c.y + a1.x*a1.x + a1.y*a1.y -
             2 * (c.x * a1.x + c.y * a1.y) - r*r;
    var deter = b*b - 4*a*cc;

    if ( deter < 0 ) {
        result = new Intersection("Outside");
    } else if ( deter == 0 ) {
        result = new Intersection("Tangent");
        // NOTE: should calculate this point
    } else {
        var e  = Math.sqrt(deter);
        var u1 = ( -b + e ) / ( 2*a );
        var u2 = ( -b - e ) / ( 2*a );

        if ( (u1 < 0 || u1 > 1) && (u2 < 0 || u2 > 1) ) {
            if ( (u1 < 0 && u2 < 0) || (u1 > 1 && u2 > 1) ) {
                result = new Intersection("Outside");
            } else {
                result = new Intersection("Inside");
            }
        } else {
            result = new Intersection("Intersection");

            if ( 0 <= u1 && u1 <= 1)
                result.points.push( a1.lerp(a2, u1) );

            if ( 0 <= u2 && u2 <= 1)
                result.points.push( a1.lerp(a2, u2) );
        }
    }
    
    return result;
};


/*****
*
*   intersectCirclePolygon
*
*****/
Intersection.intersectCirclePolygon = function(c, r, points) {
    var result = new Intersection("No Intersection");
    var length = points.length;
    var inter;

    for ( var i = 0; i < length; i++ ) {
        var a1 = points[i];
        var a2 = points[(i+1) % length];

        inter = Intersection.intersectCircleLine(c, r, a1, a2);
        result.appendPoints(inter.points);
    }

    if ( result.points.length > 0 )
        result.status = "Intersection";
    else
        result.status = inter.status;

    return result;
};


/*****
*
*   intersectCircleRectangle
*
*****/
Intersection.intersectCircleRectangle = function(c, r, r1, r2) {
    var min        = r1.min(r2);
    var max        = r1.max(r2);
    var topRight   = new Point2D( max.x, min.y );
    var bottomLeft = new Point2D( min.x, max.y );
    
    var inter1 = Intersection.intersectCircleLine(c, r, min, topRight);
    var inter2 = Intersection.intersectCircleLine(c, r, topRight, max);
    var inter3 = Intersection.intersectCircleLine(c, r, max, bottomLeft);
    var inter4 = Intersection.intersectCircleLine(c, r, bottomLeft, min);
    
    var result = new Intersection("No Intersection");

    result.appendPoints(inter1.points);
    result.appendPoints(inter2.points);
    result.appendPoints(inter3.points);
    result.appendPoints(inter4.points);

    if ( result.points.length > 0 )
        result.status = "Intersection";
    else
        result.status = inter1.status;

    return result;
};


/*****
*
*   intersectEllipseEllipse
*   
*   This code is based on MgcIntr2DElpElp.cpp written by David Eberly.  His
*   code along with many other excellent examples are avaiable at his site:
*   http://www.magic-software.com
*
*   NOTE: Rotation will need to be added to this function
*
*****/
Intersection.intersectEllipseEllipse = function(c1, rx1, ry1, c2, rx2, ry2) {
    var a = [
        ry1*ry1, 0, rx1*rx1, -2*ry1*ry1*c1.x, -2*rx1*rx1*c1.y,
        ry1*ry1*c1.x*c1.x + rx1*rx1*c1.y*c1.y - rx1*rx1*ry1*ry1
    ];
    var b = [
        ry2*ry2, 0, rx2*rx2, -2*ry2*ry2*c2.x, -2*rx2*rx2*c2.y,
        ry2*ry2*c2.x*c2.x + rx2*rx2*c2.y*c2.y - rx2*rx2*ry2*ry2
    ];

    var yPoly   = Intersection.bezout(a, b);
    var yRoots  = yPoly.getRoots();
    var epsilon = 1e-3;
    var norm0   = ( a[0]*a[0] + 2*a[1]*a[1] + a[2]*a[2] ) * epsilon;
    var norm1   = ( b[0]*b[0] + 2*b[1]*b[1] + b[2]*b[2] ) * epsilon;
    var result  = new Intersection("No Intersection");

    for ( var y = 0; y < yRoots.length; y++ ) {
        var xPoly = new Polynomial(
            a[0],
            a[3] + yRoots[y] * a[1],
            a[5] + yRoots[y] * (a[4] + yRoots[y]*a[2])
        );
        var xRoots = xPoly.getRoots();

        for ( var x = 0; x < xRoots.length; x++ ) {
            var test =
                ( a[0]*xRoots[x] + a[1]*yRoots[y] + a[3] ) * xRoots[x] + 
                ( a[2]*yRoots[y] + a[4] ) * yRoots[y] + a[5];
            if ( Math.abs(test) < norm0 ) {
                test =
                    ( b[0]*xRoots[x] + b[1]*yRoots[y] + b[3] ) * xRoots[x] +
                    ( b[2]*yRoots[y] + b[4] ) * yRoots[y] + b[5];
                if ( Math.abs(test) < norm1 ) {
                    result.appendPoint( new Point2D( xRoots[x], yRoots[y] ) );
                }
            }
        }
    }

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectEllipseLine
*   
*   NOTE: Rotation will need to be added to this function
*
*****/
Intersection.intersectEllipseLine = function(c, rx, ry, a1, a2) {
    var result;
    var origin = new Vector2D(a1.x, a1.y);
    var dir    = Vector2D.fromPoints(a1, a2);
    var center = new Vector2D(c.x, c.y);
    var diff   = origin.subtract(center);
    var mDir   = new Vector2D( dir.x/(rx*rx),  dir.y/(ry*ry)  );
    var mDiff  = new Vector2D( diff.x/(rx*rx), diff.y/(ry*ry) );

    var a = dir.dot(mDir);
    var b = dir.dot(mDiff);
    var c = diff.dot(mDiff) - 1.0;
    var d = b*b - a*c;

    if ( d < 0 ) {
        result = new Intersection("Outside");
    } else if ( d > 0 ) {
        var root = Math.sqrt(d);
        var t_a  = (-b - root) / a;
        var t_b  = (-b + root) / a;

        if ( (t_a < 0 || 1 < t_a) && (t_b < 0 || 1 < t_b) ) {
            if ( (t_a < 0 && t_b < 0) || (t_a > 1 && t_b > 1) )
                result = new Intersection("Outside");
            else
                result = new Intersection("Inside");
        } else {
            result = new Intersection("Intersection");
            if ( 0 <= t_a && t_a <= 1 )
                result.appendPoint( a1.lerp(a2, t_a) );
            if ( 0 <= t_b && t_b <= 1 )
                result.appendPoint( a1.lerp(a2, t_b) );
        }
    } else {
        var t = -b/a;
        if ( 0 <= t && t <= 1 ) {
            result = new Intersection("Intersection");
            result.appendPoint( a1.lerp(a2, t) );
        } else {
            result = new Intersection("Outside");
        }
    }
    
    return result;
};


/*****
*
*   intersectEllipsePolygon
*
*****/
Intersection.intersectEllipsePolygon = function(c, rx, ry, points) {
    var result = new Intersection("No Intersection");
    var length = points.length;

    for ( var i = 0; i < length; i++ ) {
        var b1 = points[i];
        var b2 = points[(i+1) % length];
        var inter = Intersection.intersectEllipseLine(c, rx, ry, b1, b2);

        result.appendPoints(inter.points);
    }

    if ( result.points.length > 0 )
        result.status = "Intersection";

    return result;
};


/*****
*
*   intersectEllipseRectangle
*
*****/
Intersection.intersectEllipseRectangle = function(c, rx, ry, r1, r2) {
    var min        = r1.min(r2);
    var max        = r1.max(r2);
    var topRight   = new Point2D( max.x, min.y );
    var bottomLeft = new Point2D( min.x, max.y );
    
    var inter1 = Intersection.intersectEllipseLine(c, rx, ry, min, topRight);
    var inter2 = Intersection.intersectEllipseLine(c, rx, ry, topRight, max);
    var inter3 = Intersection.intersectEllipseLine(c, rx, ry, max, bottomLeft);
    var inter4 = Intersection.intersectEllipseLine(c, rx, ry, bottomLeft, min);
    
    var result = new Intersection("No Intersection");

    result.appendPoints(inter1.points);
    result.appendPoints(inter2.points);
    result.appendPoints(inter3.points);
    result.appendPoints(inter4.points);

    if ( result.points.length > 0 )
        result.status = "Intersection";

    return result;
};


/*****
*
*   intersectLineLine
*
*****/
Intersection.intersectLineLine = function(a1, a2, b1, b2) {
    var result;
    
    var ua_t = (b2.x - b1.x) * (a1.y - b1.y) - (b2.y - b1.y) * (a1.x - b1.x);
    var ub_t = (a2.x - a1.x) * (a1.y - b1.y) - (a2.y - a1.y) * (a1.x - b1.x);
    var u_b  = (b2.y - b1.y) * (a2.x - a1.x) - (b2.x - b1.x) * (a2.y - a1.y);

    if ( u_b != 0 ) {
        var ua = ua_t / u_b;
        var ub = ub_t / u_b;

        if ( 0 <= ua && ua <= 1 && 0 <= ub && ub <= 1 ) {
            result = new Intersection("Intersection");
            result.points.push(
                new Point2D(
                    a1.x + ua * (a2.x - a1.x),
                    a1.y + ua * (a2.y - a1.y)
                )
            );
        } else {
            result = new Intersection("No Intersection");
        }
    } else {
        if ( ua_t == 0 || ub_t == 0 ) {
            result = new Intersection("Coincident");
        } else {
            result = new Intersection("Parallel");
        }
    }

    return result;
};


/*****
*
*   intersectLinePolygon
*
*****/
Intersection.intersectLinePolygon = function(a1, a2, points) {
    var result = new Intersection("No Intersection");
    var length = points.length;

    for ( var i = 0; i < length; i++ ) {
        var b1 = points[i];
        var b2 = points[(i+1) % length];
        var inter = Intersection.intersectLineLine(a1, a2, b1, b2);

        result.appendPoints(inter.points);
    }

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectLineRectangle
*
*****/
Intersection.intersectLineRectangle = function(a1, a2, r1, r2) {
    var min        = r1.min(r2);
    var max        = r1.max(r2);
    var topRight   = new Point2D( max.x, min.y );
    var bottomLeft = new Point2D( min.x, max.y );
    
    var inter1 = Intersection.intersectLineLine(min, topRight, a1, a2);
    var inter2 = Intersection.intersectLineLine(topRight, max, a1, a2);
    var inter3 = Intersection.intersectLineLine(max, bottomLeft, a1, a2);
    var inter4 = Intersection.intersectLineLine(bottomLeft, min, a1, a2);
    
    var result = new Intersection("No Intersection");

    result.appendPoints(inter1.points);
    result.appendPoints(inter2.points);
    result.appendPoints(inter3.points);
    result.appendPoints(inter4.points);

    if ( result.points.length > 0 )
        result.status = "Intersection";

    return result;
};


/*****
*
*   intersectPolygonPolygon
*
*****/
Intersection.intersectPolygonPolygon = function(points1, points2) {
    var result = new Intersection("No Intersection");
    var length = points1.length;

    for ( var i = 0; i < length; i++ ) {
        var a1 = points1[i];
        var a2 = points1[(i+1) % length];
        var inter = Intersection.intersectLinePolygon(a1, a2, points2);

        result.appendPoints(inter.points);
    }

    if ( result.points.length > 0 )
        result.status = "Intersection";

    return result;

};


/*****
*
*   intersectPolygonRectangle
*
*****/
Intersection.intersectPolygonRectangle = function(points, r1, r2) {
    var min        = r1.min(r2);
    var max        = r1.max(r2);
    var topRight   = new Point2D( max.x, min.y );
    var bottomLeft = new Point2D( min.x, max.y );
    
    var inter1 = Intersection.intersectLinePolygon(min, topRight, points);
    var inter2 = Intersection.intersectLinePolygon(topRight, max, points);
    var inter3 = Intersection.intersectLinePolygon(max, bottomLeft, points);
    var inter4 = Intersection.intersectLinePolygon(bottomLeft, min, points);
    
    var result = new Intersection("No Intersection");

    result.appendPoints(inter1.points);
    result.appendPoints(inter2.points);
    result.appendPoints(inter3.points);
    result.appendPoints(inter4.points);

    if ( result.points.length > 0 )
        result.status = "Intersection";

    return result;
};


/*****
*
*   intersectRayRay
*
*****/
Intersection.intersectRayRay = function(a1, a2, b1, b2) {
    var result;
    
    var ua_t = (b2.x - b1.x) * (a1.y - b1.y) - (b2.y - b1.y) * (a1.x - b1.x);
    var ub_t = (a2.x - a1.x) * (a1.y - b1.y) - (a2.y - a1.y) * (a1.x - b1.x);
    var u_b  = (b2.y - b1.y) * (a2.x - a1.x) - (b2.x - b1.x) * (a2.y - a1.y);

    if ( u_b != 0 ) {
        var ua = ua_t / u_b;

        result = new Intersection("Intersection");
        result.points.push(
            new Point2D(
                a1.x + ua * (a2.x - a1.x),
                a1.y + ua * (a2.y - a1.y)
            )
        );
    } else {
        if ( ua_t == 0 || ub_t == 0 ) {
            result = new Intersection("Coincident");
        } else {
            result = new Intersection("Parallel");
        }
    }

    return result;
};


/*****
*
*   intersectRectangleRectangle
*
*****/
Intersection.intersectRectangleRectangle = function(a1, a2, b1, b2) {
    var min        = a1.min(a2);
    var max        = a1.max(a2);
    var topRight   = new Point2D( max.x, min.y );
    var bottomLeft = new Point2D( min.x, max.y );
    
    var inter1 = Intersection.intersectLineRectangle(min, topRight, b1, b2);
    var inter2 = Intersection.intersectLineRectangle(topRight, max, b1, b2);
    var inter3 = Intersection.intersectLineRectangle(max, bottomLeft, b1, b2);
    var inter4 = Intersection.intersectLineRectangle(bottomLeft, min, b1, b2);
    
    var result = new Intersection("No Intersection");

    result.appendPoints(inter1.points);
    result.appendPoints(inter2.points);
    result.appendPoints(inter3.points);
    result.appendPoints(inter4.points);

    if ( result.points.length > 0 )
        result.status = "Intersection";

    return result;
};


/*****
*
*   bezout
*
*   This code is based on MgcIntr2DElpElp.cpp written by David Eberly.  His
*   code along with many other excellent examples are avaiable at his site:
*   http://www.magic-software.com
*
*****/
Intersection.bezout = function(e1, e2) {
    var AB    = e1[0]*e2[1] - e2[0]*e1[1];
    var AC    = e1[0]*e2[2] - e2[0]*e1[2];
    var AD    = e1[0]*e2[3] - e2[0]*e1[3];
    var AE    = e1[0]*e2[4] - e2[0]*e1[4];
    var AF    = e1[0]*e2[5] - e2[0]*e1[5];
    var BC    = e1[1]*e2[2] - e2[1]*e1[2];
    var BE    = e1[1]*e2[4] - e2[1]*e1[4];
    var BF    = e1[1]*e2[5] - e2[1]*e1[5];
    var CD    = e1[2]*e2[3] - e2[2]*e1[3];
    var DE    = e1[3]*e2[4] - e2[3]*e1[4];
    var DF    = e1[3]*e2[5] - e2[3]*e1[5];
    var BFpDE = BF + DE;
    var BEmCD = BE - CD;

    return new Polynomial(
        AB*BC - AC*AC,
        AB*BEmCD + AD*BC - 2*AC*AE,
        AB*BFpDE + AD*BEmCD - AE*AE - 2*AC*AF,
        AB*DF + AD*BFpDE - 2*AE*AF,
        AD*DF - AF*AF
    );
};

</script></body> </html>
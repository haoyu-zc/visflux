<!DOCTYPE html> <html> <head><title>putida.json</title>
         <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.2/require.min.js" defer async="true" integrity="sha256-Vjusm6Kh2U7/tb6jBh+MOfxnaf2TWsTph34bMKhC1Qc=" crossorigin="anonymous"></script>
         <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
         <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" defer async="true" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
         <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
         </head> <body><nav id="nav-area" class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
        aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand">VisMap</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Map
            <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li class="dropdown-header">Export</li>
            <li><a id="menu_save-json" class="menu_item">Save Map JSON</a></li>
            <li><a class="menu_item">Save as SVG</a></li>
            <li><a class="menu_item">Save as PNG</a></li>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header">General</li>
            <li><a class="menu_item">Clear Map</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
            aria-expanded="false">Model
            <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a class="menu_item">Load COBRA Model</a></li>
            <li><a class="menu_item">Render Model</a></li>
            <li><a class="menu_item">Clear Model</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
            aria-expanded="false">View
            <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a class="menu_item">Zoom In</a></li>
            <li><a class="menu_item">Zoom Out</a></li>
            <li><a class="menu_item">Enable Mouse Zoom</a></li>
            <li><a class="menu_item">Disable Hover Tip</a></li>
          </ul>
        </li>
        <li><a href="https://pstjohn.github.io/d3flux/">Document</a></li>

      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="active"><a href="#">Home <span class="sr-only">(current)</span></a></li>
      </ul>
    </div>
    <!--/.nav-collapse -->
  </div>
  <!--/.container-fluid -->
</nav>

<div id="content-area" class="container-fluid">
  <div class="row">
    <!-- <div class="col-xs-12 col-sm-9"> -->
    <div class="col-md-9 col-md-offset-1">
      <div id="d3flux001"></div>
    </div>

    <!-- <div id="d3flux001_options" class="col-xs-6 col-sm-3 sidebar-offcanvas"> -->
    <div id="vismap-sidebar" class="col-md-2 sidebar">

      <div class="btn-group-vertical" role="group" aria-label="btn-group-vertical">
        <h4>Search</h4>
        <input type="text" class="form-control" id="search" placeholder="Name or id" type="text" value="">
        <button type="button" class="test_button btn btn-primary ">Search Node</button>

        <h4>Traverse</h4>
        <input type="text" class="form-control" id="info" placeholder="Node info" type="text" value="">
        <div class="checkbox">
          <label>
            <input type="checkbox" value="">
            Reversibility
          </label>
        </div>
        <div class="checkbox">
          <label>
            <input type="checkbox" value="">
            Enable Animation
          </label>
        </div>
        <button type="button" id="btn_downstream" class="btn btn-primary ">Downstream Nodes</button>

        <h4>Custom</h4>
        <button type="button" id="btn_reaction" class="btn btn-success">Show Reaction Nodes</button>
        <button type="button" id="btn_path-color" class="btn btn-danger">Disable Path Color</button>
        <!-- <button type="button" class="marker_button btn btn-warning ">Select Marker</button> -->
        <button type="button" id="btn_reset" class="btn btn-warning ">Reset</button>
        <button id="zoom_in" type="button" class="zoom_button btn">Zoom in</button>
        <button id="zoom_out" type="button" class="zoom_button btn  ">Zoom out</button>
        <!-- <button type="button" class="test_button btn btn-test ">Alg Test</button> -->
        <div class="checkbox">
          <label>
            <input id="cb-zoom" type="checkbox" value="">
            Enable mouse zoom
          </label>
        </div>
        <div class="checkbox">
          <label>
            <input id="cb-tip" type="checkbox" value="">
            Disable hover tip
          </label>
        </div>


      </div>
    </div>
    <!--/.sidebar-offcanvas-->
  </div> <!-- row -->
</div> <!-- contianer-fluid -->

<script type="text/Javascript">
var d3flux001model = {"metabolites": [{"id": "2dda7p_c", "name": "3-deoxy-D-arabino-heptulosonate-7-phosphate", "compartment": "c", "charge": -3, "formula": "C7H10O10P", "notes": {"BIGG": "2dda7p", "BIOCYC": ["3-DEOXY-D-ARABINO-HEPTULOSONATE-7-P"], "CAS": ["2627-73-8"], "CHEBI": ["58394"], "INCHI": ["InChI=1S/C7H13O10P/c8-3(1-4(9)7(12)13)6(11)5(10)2-17-18(14,15)16/h3,5-6,8,10-11H,1-2H2,(H,12,13)(H2,14,15,16)/p-3/t3-,5-,6+/m1/s1"], "KEGG": ["C04691"], "PUBCHEM": ["5460215"], "map_info": {"align": "upper center", "display_name": "DAHP", "x": 385.0399485613115, "y": 693.7065928045413}, "orig_id": "_3-DEOXY-D-ARABINO-HEPTULOSONATE-7-P_c"}}, {"id": "2ddg6p_c", "name": "2-dehydro-3-deoxy-D-gluconate 6-phosphate", "compartment": "c", "formula": "C6H8O9P1", "notes": {"BIGG": "2ddg6p", "BIOCYC": ["2-KETO-3-DEOXY-6-P-GLUCONATE"], "MetaCyc": "2-KETO-3-DEOXY-6-P-GLUCONATE", "map_info": {"align": "right", "display_name": "KDPG", "x": 379.85375877561717, "y": 427.7777681752259}}}, {"id": "2dhglcn_c", "name": "2-Dehydro-D-gluconate", "compartment": "c", "formula": "C6H9O7", "notes": {"map_info": {"display_name": "2-KG", "x": 517.0991306306175, "y": 80.35134935228953}, "original_bigg_ids": ["2dhglcn_c"]}}, {"id": "34dhbz_c", "name": "protocatechuate", "compartment": "c", "charge": -1, "formula": "C7H5O4", "notes": {"BIGG": "34dhbz", "BIOCYC": ["3-4-DIHYDROXYBENZOATE"], "CHEBI": ["36241"], "CHEMSPIDER": ["3353991"], "DRUGBANK": ["DB03946"], "HMDB": ["HMDB01856"], "INCHI": ["InChI=1S/C7H6O4/c8-5-2-1-4(7(10)11)3-6(5)9/h1-3,8-9H,(H,10,11)/p-1"], "KEGG": ["C00230"], "KNAPSACK": ["C00002668"], "PUBCHEM": ["54675866"], "map_info": {"align": "left", "display_name": "PCA", "x": 587.7245016868075, "y": 762.3366919634361}, "orig_id": "_3-4-DIHYDROXYBENZOATE_c"}}, {"id": "3dhq_c", "name": "3-dehydroquinate", "compartment": "c", "charge": -1, "formula": "C7H9O6", "notes": {"BIGG": "3dhq", "BIOCYC": ["DEHYDROQUINATE"], "CAS": ["10534-44-8"], "CHEBI": ["32364"], "CHEMSPIDER": ["4573866"], "HMDB": ["HMDB12710"], "INCHI": ["InChI=1S/C7H10O6/c8-3-1-7(13,6(11)12)2-4(9)5(3)10/h3,5,8,10,13H,1-2H2,(H,11,12)/p-1/t3-,5+,7-/m1/s1"], "KEGG": ["C00944"], "PUBCHEM": ["5460271"], "map_info": {"align": "upper center", "display_name": "3DHQ", "x": 486.3829331545779, "y": 693.9076470855373}, "orig_id": "DEHYDROQUINATE_c"}}, {"id": "3dhsk_c", "name": "3-dehydroshikimate", "compartment": "c", "charge": -1, "formula": "C7H7O5", "notes": {"BIGG": "3dhsk", "BIOCYC": ["3-DEHYDRO-SHIKIMATE"], "CHEBI": ["16630"], "CHEMSPIDER": ["4573915"], "INCHI": ["InChI=1S/C7H8O5/c8-4-1-3(7(11)12)2-5(9)6(4)10/h1,5-6,9-10H,2H2,(H,11,12)/p-1/t5-,6-/m1/s1"], "KEGG": ["C02637"], "PUBCHEM": ["5460360"], "map_info": {"align": "upper center", "display_name": "3-DHS", "x": 587.0993475765838, "y": 693.6225486812924}, "orig_id": "_3-DEHYDRO-SHIKIMATE_c"}}, {"id": "3pg_c", "name": "3-Phospho-D-glycerate", "compartment": "c", "formula": "C3H4O7P", "notes": {"BIOCYC": ["G3P"], "BRENDA": ["BG17981", "BG17979"], "BioPath": ["3-Phospho-D-glycerate"], "ChEBI": ["40016", "58272", "57998", "11879", "1657", "1659", "17050", "21029", "11882", "11880", "12987", "17794", "24345"], "HMDB": ["HMDB00807"], "KEGG": "C00197", "MetaCyc": "G3P", "PUBCHEM ID": ["3497"], "Reactome": ["29728"], "SEED": ["cpd00169"], "UPA": ["UPC00597", "UPC00197"], "map_info": {"align": "lower right", "display_name": "3PG", "x": 214.4778424417119, "y": 607.931238863077}}}, {"id": "6p2dhglcn_c", "name": "6-Phospho-2-dehydro-D-gluconate", "compartment": "c", "formula": "C6H11O10P", "notes": {"map_info": {"align": "upper left", "display_name": "2-KG6P", "x": 517.513475161629, "y": 228.38211074782805}, "original_bigg_ids": ["6p2dhglcn_c"]}}, {"id": "6pgc_c", "name": "6-Phospho-D-gluconate", "compartment": "c", "formula": "C6H10O10P", "notes": {"BIOCYC": ["CPD-2961"], "BRENDA": ["BG22563"], "BioPath": ["6-Phospho-D-gluconate"], "ChEBI": ["2231", "12232", "48928", "16863", "58759", "40282", "33851"], "HMDB": ["HMDB01316"], "KEGG": "C00345", "MetaCyc": "CPD-2961", "PUBCHEM ID": ["3638"], "Reactome": ["29996"], "SEED": ["cpd00284"], "UPA": ["UPC00345"], "map_info": {"align": "lower right", "display_name": "6PGC", "x": 391.9201764724269, "y": 291.09991473689433}}}, {"id": "accoa_c", "name": "Acetyl-CoA", "compartment": "c", "formula": "C23H34N7O17P3S", "notes": {"BIOCYC": ["ACETYL-COA"], "BRENDA": ["BG36329"], "BioPath": ["Acetyl-CoA"], "CAS": ["72-89-9"], "CASID": ["72-89-9"], "ChEBI": ["13712", "22192", "40470", "2408", "57288", "15351"], "HMDB": ["HMDB01206"], "KEGG": "C00024", "LIPIDMAPS": ["LMFA07050029", "LMFA07050000"], "MetaCyc": "ACETYL-COA", "PUBCHEM ID": ["3326"], "Reactome": ["113559", "727753", "113560", "353123", "76183"], "SEED": ["cpd00022"], "UPA": ["UPC00024"], "map_info": {"align": "upper left", "display_name": "AcCoA", "x": 601.2183569287542, "y": 436.73245470797156}}}, {"id": "acon_c", "name": "cis-Aconitate", "compartment": "c", "formula": "C6H3O6", "notes": {"BIOCYC": ["CIS-ACONITATE"], "CAS": ["585-84-2"], "CASID": ["585-84-2"], "KEGG": "C00417", "MetaCyc": "CIS-ACONITATE", "PUBCHEM ID": ["3707"], "map_info": {"display_name": "ACON", "x": 648.7510440378754, "y": 263.39599360974995}}}, {"id": "adp_c", "name": "ADP", "compartment": "c", "formula": "C10H12N5O10P2", "notes": {"BIOCYC": ["ADP"], "BRENDA": ["BG1228"], "BioPath": ["Adenosine-5-prime-diphosphate"], "CAS": ["58-64-0"], "CASID": ["58-64-0"], "ChEBI": ["13222", "16761", "2342", "22244", "40553", "456216"], "HMDB": ["HMDB01341"], "KEGG": "C00008", "MetaCyc": "ADP", "PUBCHEM ID": ["3310"], "Reactome": ["190072", "481002", "211606", "429160", "29370", "196180", "113581", "113582", "114564", "114565", "429153"], "SEED": ["cpd00008"], "UPA": ["UPC00008"], "map_info": {"display_name": "ADP", "hidden": true}}}, {"id": "akg_c", "name": "2-Oxoglutarate", "compartment": "c", "formula": "C5H4O5", "notes": {"BIOCYC": ["2-KETOGLUTARATE"], "BRENDA": ["BG21003"], "BioPath": ["2-Oxoglutarate"], "CAS": ["328-50-7"], "CASID": ["328-50-7"], "ChEBI": ["30915", "40661", "1253", "19749", "19748", "16810", "30916", "11638"], "HMDB": ["HMDB02812", "HMDB00208"], "KEGG": "C00026", "MetaCyc": "2-KETOGLUTARATE", "PUBCHEM ID": ["3328"], "Reactome": ["113594", "113671", "389537", "561075", "29406", "1650779"], "SEED": ["cpd00024"], "UPA": ["UPC00026"], "map_info": {"display_name": "AKG", "x": 826.6657259495349, "y": 261.95273712453286}}}, {"id": "atp_c", "name": "ATP", "compartment": "c", "formula": "C10H12N5O13P3", "notes": {"BIOCYC": ["ATP"], "BRENDA": ["BG1395"], "BioPath": ["Adenosine-5-prime-triphosphate"], "CAS": ["56-65-5"], "CASID": ["56-65-5"], "ChEBI": ["40938", "15422", "57299", "13236", "10789", "30616", "22249", "10841", "2359"], "HMDB": ["HMDB00538"], "KEGG": "C00002", "MetaCyc": "ATP", "PUBCHEM ID": ["3304"], "Reactome": ["190078", "113592", "113593", "114570", "29358", "389573", "139836", "211579"], "SEED": ["cpd00002"], "UPA": ["UPC00002"], "map_info": {"color": "#ffbb78", "display_name": "ATP", "hidden": true}}}, {"id": "catechol_c", "name": "catechol", "compartment": "c", "charge": 0, "formula": "C6H6O2", "notes": {"BIGG": "catechol", "BIOCYC": ["CATECHOL"], "CAS": ["120-80-9"], "CHEBI": ["18135"], "CHEMSPIDER": ["13837760"], "DRUGBANK": ["DB02232"], "HMDB": ["HMDB00957"], "INCHI": ["InChI=1S/C6H6O2/c7-5-3-1-2-4-6(5)8/h1-4,7-8H"], "KEGG": ["C00090"], "METABOLIGHTS": ["MTBLC18135"], "PUBCHEM": ["289"], "map_info": {"align": "upper center", "display_name": "CAT", "x": 688.4338686798405, "y": 762.2985457831887}, "orig_id": "CATECHOL_c"}}, {"id": "ccmuac_c", "name": "cis,cis-muconate", "compartment": "c", "charge": -2, "formula": "C6H4O4", "notes": {"BIGG": "ccmuac", "BIOCYC": ["CIS-CIS-MUCONATE"], "CAS": ["1119-72-8"], "CHEBI": ["32379"], "CHEMSPIDER": ["5641039"], "HMDB": ["HMDB06331"], "INCHI": ["InChI=1S/C6H6O4/c7-5(8)3-1-2-4-6(9)10/h1-4H,(H,7,8)(H,9,10)/p-2/b3-1-,4-2-"], "KEGG": ["C02480"], "PUBCHEM": ["7310978"], "map_info": {"display_name": "muconate", "x": 789.7488376739086, "y": 762.6028921236009}, "orig_id": "CIS-CIS-MUCONATE_c"}}, {"id": "cit_c", "name": "Citrate", "compartment": "c", "formula": "C6H5O7", "notes": {"BIOCYC": ["CIT"], "BRENDA": ["BG23703"], "BioPath": ["Citrate"], "CAS": ["77-92-9"], "CASID": ["77-92-9"], "ChEBI": ["53258", "23322", "50744", "23321", "35810", "3727", "32142", "30769", "63037", "63076", "41523", "35806", "35802", "35809", "16947", "13999", "42563"], "HMDB": ["HMDB00094"], "KEGG": "C00158", "MetaCyc": "CIT", "PUBCHEM ID": ["3458"], "Reactome": ["76190", "433138", "29654"], "SEED": ["cpd00137", "cpd09279"], "UPA": ["UPC00158"], "map_info": {"display_name": "CIT", "x": 614.0446837649886, "y": 352.7034141897304}}}, {"id": "co2_c", "name": "CO2", "compartment": "c", "formula": "CO2", "notes": {"BIOCYC": ["CARBON-DIOXIDE"], "BRENDA": ["BG28651"], "BioPath": ["Carbon_dioxide"], "CAS": ["124-38-9"], "CASID": ["124-38-9"], "ChEBI": ["48829", "16526", "13284", "13285", "13282", "13283", "23011", "3283"], "HMDB": ["HMDB01967"], "KEGG": "C00011", "MetaCyc": "CARBON-DIOXIDE", "PUBCHEM ID": ["3313"], "Reactome": ["159751", "159942", "1237009", "29376", "113528", "389536", "189480"], "SEED": ["cpd00011"], "UPA": ["UPC00011"], "map_info": {"color": "#aec7e8", "display_name": "CO2", "hidden": true}}}, {"id": "co2_e", "name": "CO2", "compartment": "e", "formula": "CO2", "notes": {"BIOCYC": ["CARBON-DIOXIDE"], "BRENDA": ["BG28651"], "BioPath": ["Carbon_dioxide"], "CAS": ["124-38-9"], "CASID": ["124-38-9"], "ChEBI": ["48829", "16526", "13284", "13285", "13282", "13283", "23011", "3283"], "HMDB": ["HMDB01967"], "KEGG": "C00011", "MetaCyc": "CARBON-DIOXIDE", "PUBCHEM ID": ["3313"], "Reactome": ["159751", "159942", "1237009", "29376", "113528", "389536", "189480"], "SEED": ["cpd00011"], "UPA": ["UPC00011"], "map_info": {"display_name": "CO2", "hidden": true}}}, {"id": "coa_c", "name": "Coenzyme A", "compartment": "c", "formula": "C21H32N7O16P3S", "notes": {"BIOCYC": ["CO-A"], "BRENDA": ["BG11741"], "BioPath": ["CoA-SH"], "CAS": ["85-61-0"], "CASID": ["85-61-0"], "ChEBI": ["57287", "13295", "13294", "13298", "41631", "41597", "741566", "15346", "23355", "3771"], "HMDB": ["HMDB01423"], "KEGG": "C00010", "MetaCyc": "CO-A", "PUBCHEM ID": ["3312"], "Reactome": ["76194", "193514", "29374", "2485002", "162743"], "SEED": ["cpd00010"], "UPA": ["UPC00010"], "map_info": {"display_name": "COA", "hidden": true}}}, {"id": "dhap_c", "name": "Dihydroxyacetone phosphate", "compartment": "c", "formula": "C3H5O6P", "notes": {"BIOCYC": ["DIHYDROXY-ACETONE-PHOSPHATE"], "BRENDA": ["BG89172"], "BioPath": ["2-Glycerone_ehosphate"], "CAS": ["57-04-5"], "CASID": ["57-04-5"], "ChEBI": ["14341", "57642", "14342", "16108", "5454", "24355", "39571"], "HMDB": ["HMDB01473", "HMDB11735"], "KEGG": "C00111", "MetaCyc": "DIHYDROXY-ACETONE-PHOSPHATE", "PUBCHEM ID": ["3411"], "Reactome": ["188451", "75970", "390404"], "SEED": ["cpd00095"], "UPA": ["UPC00111"], "map_info": {"display_name": "DHAP", "x": 116.55128494519695, "y": 596.2853919010893}}}, {"id": "e4p_c", "name": "D-Erythrose 4-phosphate", "compartment": "c", "formula": "C4H7O7P", "notes": {"BIOCYC": ["ERYTHROSE-4P"], "BRENDA": ["BG59851", "BG91980"], "BioPath": ["D-Erythrose_4-phosphate"], "CAS": ["585-18-2"], "CASID": ["585-18-2"], "ChEBI": ["42349", "48153", "4256", "20927", "12921", "21109", "27508", "4114", "16897"], "HMDB": ["HMDB01321"], "KEGG": "C00279", "MetaCyc": "ERYTHROSE-4P", "PUBCHEM ID": ["3574"], "Reactome": ["29878"], "SEED": ["cpd01994", "cpd00236"], "UPA": ["UPC00279"], "map_info": {"align": "upper center", "display_name": "E4P", "x": 134.6511951066036, "y": 268.56314823916296}}}, {"id": "f6p_c", "name": "D-Fructose 6-phosphate", "compartment": "c", "formula": "C6H11O9P", "notes": {"BIOCYC": ["FRUCTOSE-6P"], "BRENDA": ["BG56501", "BG22637"], "BioPath": ["beta-D-Fructose_6-phosphate"], "CAS": ["643-13-0"], "CASID": ["643-13-0"], "ChEBI": ["57634", "12352", "45804", "61527", "61553", "10375", "16084", "42378", "22768"], "HMDB": ["HMDB03971"], "KEGG": "C00085", "MetaCyc": "FRUCTOSE-6P", "PUBCHEM ID": ["3385"], "SEED": ["cpd00072"], "UPA": ["UPC05345", "UPC00085"], "map_info": {"display_name": "F6P", "x": 45.342179217742256, "y": 273.52747569956034}}}, {"id": "fdp_c", "name": "D-Fructose 1,6-bisphosphate", "compartment": "c", "formula": "C6H10O12P2", "notes": {"BIOCYC": ["FRUCTOSE-16-DIPHOSPHATE"], "BRENDA": ["BG22767"], "BioPath": ["beta-D-Fructose_1,6-bisphosphate"], "CAS": ["488-69-7"], "CASID": ["488-69-7"], "ChEBI": ["32968", "49299", "42553", "32966", "37736", "28013", "32967", "41014", "22767", "10374", "40595", "40591"], "KEGG": "C00354", "MetaCyc": "FRUCTOSE-16-DIPHOSPHATE", "PUBCHEM ID": ["3647"], "SEED": ["cpd00290"], "UPA": ["UPC00354"], "map_info": {"align": "left", "display_name": "FDP", "x": 66.43767458469955, "y": 453.55841812184474}}}, {"id": "fum_c", "name": "Fumarate", "compartment": "c", "formula": "C4H2O4", "notes": {"BIOCYC": ["FUM"], "BRENDA": ["BG19266"], "BioPath": ["Fumarate"], "CAS": ["110-17-8"], "CASID": ["110-17-8"], "ChEBI": ["42743", "18012", "5190", "22958", "24122", "24124", "22956", "22957", "37154", "37155", "42511", "29806", "36180", "14284"], "HMDB": ["HMDB00134"], "KEGG": "C00122", "MetaCyc": "FUM", "PUBCHEM ID": ["3422"], "Reactome": ["29586", "113588"], "SEED": ["cpd00106"], "UPA": ["UPC00122"], "map_info": {"display_name": "FUM", "x": 824.3677489481508, "y": 438.7436110518927}}}, {"id": "g3p_c", "name": "Glyceraldehyde 3-phosphate", "compartment": "c", "formula": "C3H5O6P", "notes": {"BIOCYC": ["GAP"], "BRENDA": ["BG17970"], "CAS": ["142-10-9"], "CASID": ["142-10-9"], "ChEBI": ["17138", "14333", "5446", "58027"], "HMDB": ["HMDB01112"], "KEGG": "C00118", "MetaCyc": "GAP", "PUBCHEM ID": ["3930"], "SEED": ["cpd00102"], "UPA": ["UPC00661", "UPC00118"], "map_info": {"align": "lower right", "display_name": "G3P", "x": 214.69275871542567, "y": 532.8467848363625}}}, {"id": "g6p_c", "name": "D-Glucose 6-phosphate", "compartment": "c", "formula": "C6H11O9P", "notes": {"BIOCYC": ["GLC-6-P"], "BRENDA": ["BG22626", "BG22646"], "CAS": ["56-73-5"], "CASID": ["56-73-5"], "ChEBI": ["10399", "22797", "41041", "17719", "4170", "61548", "58247", "12375"], "HMDB": ["HMDB03498", "HMDB06793", "HMDB01401", "HMDB01549"], "KEGG": "C00092", "MetaCyc": "GLC-6-P", "PUBCHEM ID": ["3392"], "Reactome": ["1629756"], "SEED": ["cpd00079"], "UPA": ["UPC00092"], "map_info": {"align": "lower right", "display_name": "G6P", "x": 206.71489698085014, "y": 163.2157286550697}}}, {"id": "glc__D_c", "name": "D-Glucose", "compartment": "c", "formula": "C6H12O6", "notes": {"BIOCYC": ["ALPHA-GLUCOSE"], "CAS": ["50-99-7"], "CASID": ["50-99-7"], "KEGG": ["C00031"], "PUBCHEM ID": ["3333"], "map_info": {"align": "lower right", "display_name": "GLC", "x": 206.01962567832595, "y": 80.10623239168993}}}, {"id": "glc__D_e", "name": "D-Glucose (p)", "compartment": "e", "formula": "C6H12O6", "notes": {"BIOCYC": ["ALPHA-GLUCOSE"], "CAS": ["50-99-7"], "CASID": ["50-99-7"], "KEGG": "C00031", "MetaCyc": "ALPHA-GLUCOSE", "PUBCHEM ID": ["3333"], "map_info": {"display_name": "GLC(e)", "x": 204.81223866283983, "y": 14.940902846350852}}}, {"id": "glcn_c", "name": "D-Gluconate", "compartment": "c", "formula": "C6H11O7", "notes": {"BRENDA": ["BG22387"], "BioPath": ["D-Gluconate"], "CAS": ["526-95-4"], "CASID": ["526-95-4"], "ChEBI": ["20983", "42715", "4157", "33198", "12955", "20986", "20985", "18391"], "HMDB": ["HMDB00625", "HMDB03373"], "KEGG": ["C00257"], "MetaCyc": ["GLUCONATE"], "PUBCHEM ID": ["3556"], "SEED": ["cpd00222"], "UPA": ["UPC00257"], "map_info": {"align": "lower right", "display_name": "GLCN", "x": 392.46464183190346, "y": 80.2647156359561}}}, {"id": "gln__L_c", "name": "L-Glutamine", "compartment": "c", "formula": "C5H10N2O3", "notes": {"BIOCYC": ["GLN"], "CAS": ["56-85-9"], "CASID": ["56-85-9"], "KEGG": "C00064", "MetaCyc": "GLN", "PUBCHEM ID": ["3364"], "map_info": {"display_name": "GLN", "hidden": true}}}, {"id": "glu__L_c", "name": "L-Glutamate", "compartment": "c", "formula": "C5H8NO4", "notes": {"BIOCYC": ["GLT"], "CAS": ["56-86-0"], "CASID": ["56-86-0"], "KEGG": "C00025", "MetaCyc": "GLT", "PUBCHEM ID": ["3327"], "map_info": {"display_name": "GLU", "hidden": true}}}, {"id": "glx_c", "name": "Glyoxylate", "compartment": "c", "formula": "C2H1O3", "notes": {"BIOCYC": ["GLYOX"], "BRENDA": ["BG15375"], "BioPath": ["Glyoxalate"], "CAS": ["298-12-4"], "CASID": ["298-12-4"], "ChEBI": ["36655", "42767", "14368", "35977", "24421", "24420", "16891", "5509"], "HMDB": ["HMDB00119"], "KEGG": "C00048", "MetaCyc": "GLYOX", "PUBCHEM ID": ["3350"], "Reactome": ["904849", "389678"], "SEED": ["cpd00040"], "UPA": ["UPC00048"], "map_info": {"align": "left", "display_name": "GLX", "x": 737.854492276155, "y": 352.539742588711}}}, {"id": "h2o_c", "name": "H2O", "compartment": "c", "formula": "H2O", "notes": {"BIOCYC": ["WATER"], "BRENDA": ["BG92137", "BG89181", "BG92081", "BG92002"], "BioPath": ["OH-", "Water", "Oxygen_atom"], "CAS": ["7732-18-5"], "CASID": ["7732-18-5"], "ChEBI": ["15377", "13365", "41979", "16234", "36385", "42857", "27313", "44819", "29373", "10743", "5594", "29356", "53442", "29375", "29374", "13419", "43228", "44292", "13352", "41981", "29412", "42043", "33811", "33813", "35511", "5585", "44641", "44701"], "HMDB": ["HMDB01039", "HMDB02111"], "KEGG": "C00001", "MetaCyc": "WATER", "PUBCHEM ID": ["3303"], "Reactome": ["947593", "189422", "141343", "113518", "1605715", "109276", "113521", "113519", "2022884", "351603", "29356"], "SEED": ["cpd15275", "cpd00001"], "UPA": ["UPC00001", "UPC01328"], "map_info": {"display_name": "H2O", "hidden": true}}}, {"id": "h2o_e", "name": "H2O", "compartment": "e", "formula": "H2O", "notes": {"BIOCYC": ["WATER"], "BRENDA": ["BG92137", "BG89181", "BG92081", "BG92002"], "BioPath": ["OH-", "Water", "Oxygen_atom"], "CAS": ["7732-18-5"], "CASID": ["7732-18-5"], "ChEBI": ["15377", "13365", "41979", "16234", "36385", "42857", "27313", "44819", "29373", "10743", "5594", "29356", "53442", "29375", "29374", "13419", "43228", "44292", "13352", "41981", "29412", "42043", "33811", "33813", "35511", "5585", "44641", "44701"], "HMDB": ["HMDB01039", "HMDB02111"], "KEGG": "C00001", "MetaCyc": "WATER", "PUBCHEM ID": ["3303"], "Reactome": ["947593", "189422", "141343", "113518", "1605715", "109276", "113521", "113519", "2022884", "351603", "29356"], "SEED": ["cpd15275", "cpd00001"], "UPA": ["UPC00001", "UPC01328"], "map_info": {"display_name": "H2O", "hidden": true}}}, {"id": "h_c", "name": "H+", "compartment": "c", "formula": "H", "notes": {"BIOCYC": ["PROTON"], "BRENDA": ["BG79440"], "BioPath": ["Proton"], "CAS": ["12408-02-5"], "CASID": ["12408-02-5"], "ChEBI": ["24636", "15378", "10744", "13357", "5584"], "KEGG": "C00080", "MetaCyc": "PROTON", "PUBCHEM ID": ["3380"], "Reactome": ["194688", "425978", "193465", "374900", "74722", "425999", "428040", "163953", "372511", "2000349", "70106", "1470067", "113529", "425969", "428548", "156540", "1614597", "351626", "427899"], "SEED": ["cpd00067"], "UPA": ["UPC00080"], "map_info": {"display_name": "H", "hidden": true}}}, {"id": "h_e", "name": "H+", "compartment": "e", "formula": "H", "notes": {"BIOCYC": ["PROTON"], "BRENDA": ["BG79440"], "BioPath": ["Proton"], "CAS": ["12408-02-5"], "CASID": ["12408-02-5"], "ChEBI": ["24636", "15378", "10744", "13357", "5584"], "KEGG": "C00080", "MetaCyc": "PROTON", "PUBCHEM ID": ["3380"], "Reactome": ["194688", "425978", "193465", "374900", "74722", "425999", "428040", "163953", "372511", "2000349", "70106", "1470067", "113529", "425969", "428548", "156540", "1614597", "351626", "427899"], "SEED": ["cpd00067"], "UPA": ["UPC00080"], "map_info": {"display_name": "H", "hidden": true}}}, {"id": "hco3_c", "name": "hydrogen carbonate", "compartment": "c", "charge": -1, "formula": "CHO3", "notes": {"BIGG": "hco3", "BIOCYC": ["HCO3"], "CAS": ["71-52-3"], "CHEBI": ["17544"], "CHEMSPIDER": ["749"], "HMDB": ["HMDB00595"], "INCHI": ["InChI=1S/CH2O3/c2-1(3)4/h(H2,2,3,4)/p-1"], "KEGG": ["C00288"], "METABOLIGHTS": ["MTBLC17544"], "PUBCHEM": ["769"], "map_info": {"color": "#aec7e8", "display_name": "CO2", "hidden": true}, "orig_id": "HCO3_c"}}, {"id": "icit_c", "name": "Isocitrate", "compartment": "c", "formula": "C6H5O7", "notes": {"BIOCYC": ["THREO-DS-ISO-CITRATE"], "BRENDA": ["BG23698"], "CAS": ["30810-51-6"], "CASID": ["30810-51-6"], "ChEBI": ["14465", "24886", "24884", "36454", "16087", "5998", "30887", "36453"], "HMDB": ["HMDB00193"], "KEGG": "C00311", "MetaCyc": "THREO-DS-ISO-CITRATE", "PUBCHEM ID": ["3605"], "SEED": ["cpd00260"], "UPA": ["UPC00311"], "map_info": {"align": "upper right", "display_name": "ICIT", "x": 738.8850035485335, "y": 227.35352256923665}}}, {"id": "mal__L_c", "name": "L-Malate", "compartment": "c", "formula": "C4H4O5", "notes": {"BIOCYC": ["MAL"], "CAS": ["97-67-6"], "CASID": ["97-67-6"], "KEGG": "C00149", "MetaCyc": "MAL", "PUBCHEM ID": ["3449"], "map_info": {"align": "lower left", "display_name": "MAL", "x": 738.4543949997592, "y": 473.5888174086958}}}, {"id": "nad_c", "name": "Nicotinamide adenine dinucleotide", "compartment": "c", "formula": "C21H26N7O14P2", "notes": {"BIOCYC": ["NAD"], "BRENDA": ["BG11259"], "BioPath": ["NAD"], "CAS": ["53-84-9"], "CASID": ["53-84-9"], "ChEBI": ["21901", "7422", "44214", "15846", "13394", "13393", "44215", "13389", "57540", "44281"], "HMDB": ["HMDB00902"], "KEGG": "C00003", "MetaCyc": "NAD", "PUBCHEM ID": ["3305"], "Reactome": ["192307", "29360", "427523", "194653", "113526"], "SEED": ["cpd00003"], "UPA": ["UPC00003"], "map_info": {"display_name": "NAD", "hidden": true}}}, {"id": "nadh_c", "name": "Nicotinamide adenine dinucleotide - reduced", "compartment": "c", "formula": "C21H27N7O14P2", "notes": {"BIOCYC": ["NADH"], "BRENDA": ["BG11384"], "BioPath": ["NADH"], "CAS": ["58-68-4"], "CASID": ["58-68-4"], "ChEBI": ["13395", "21902", "16908", "7423", "44216", "57945", "13396"], "HMDB": ["HMDB01487"], "KEGG": "C00004", "MetaCyc": "NADH", "PUBCHEM ID": ["3306"], "Reactome": ["192305", "73473", "194697", "29362"], "SEED": ["cpd00004"], "UPA": ["UPC00004"], "map_info": {"color": "#b5cf6b", "display_name": "NADH", "hidden": true}}}, {"id": "nadp_c", "name": "Nicotinamide adenine dinucleotide phosphate", "compartment": "c", "formula": "C21H25N7O17P3", "notes": {"BIOCYC": ["NADP"], "BRENDA": ["BG48210"], "BioPath": ["NADP"], "CAS": ["53-59-8"], "CASID": ["53-59-8"], "ChEBI": ["7424", "13398", "13397", "13390", "25524", "25523", "44405", "44409", "18009", "58349", "21903"], "HMDB": ["HMDB00217"], "KEGG": "C00006", "MetaCyc": "NADP", "PUBCHEM ID": ["3308"], "Reactome": ["29366", "2000348", "113563", "113564", "389556", "428218", "351628", "194668", "517495"], "SEED": ["cpd00006"], "UPA": ["UPC00006"], "map_info": {"display_name": "NADP", "hidden": true}}}, {"id": "nadph_c", "name": "Nicotinamide adenine dinucleotide phosphate - reduced", "compartment": "c", "formula": "C21H26N7O17P3", "notes": {"BIOCYC": ["NADPH"], "BRENDA": ["BG48213"], "BioPath": ["NADPH"], "CAS": ["2646-71-1"], "CASID": ["2646-71-1"], "ChEBI": ["13400", "16474", "7425", "13399", "13392", "57783", "21904", "44286"], "HMDB": ["HMDB00799", "HMDB06341", "HMDB00221"], "KEGG": "C00005", "MetaCyc": "NADPH", "PUBCHEM ID": ["3307"], "Reactome": ["2000347", "29364", "428206", "113602", "113600", "113601", "194725", "517496", "351627"], "SEED": ["cpd00005"], "UPA": ["UPC00005"], "map_info": {"color": "#8ca252", "display_name": "NADPH", "hidden": true}}}, {"id": "nh4_c", "name": "Ammonium", "compartment": "c", "formula": "H4N", "notes": {"BIOCYC": ["AMMONIUM"], "BRENDA": ["BG28734", "BG91971", "BG28736"], "BioPath": ["Ammonium-ion", "Ammonia"], "CAS": ["14798-03-9"], "CASID": ["14798-03-9"], "ChEBI": ["13408", "13405", "13406", "13407", "28938", "62982", "44269", "66871", "18219", "16134", "29337", "49783", "44404", "7436", "7435", "7434", "22533", "22534", "22535", "29340", "63040", "13772", "13771", "29240", "44284"], "HMDB": ["HMDB00051"], "KEGG": "C00014", "MetaCyc": "AMMONIUM", "PUBCHEM ID": ["4547"], "Reactome": ["140912", "2022135", "76230", "113561", "389843", "29382", "31633"], "SEED": ["cpd00013"], "UPA": ["UPC00014"], "map_info": {"display_name": "NH4", "hidden": true}}}, {"id": "nh4_e", "name": "Ammonium", "compartment": "e", "formula": "H4N", "notes": {"BIOCYC": ["AMMONIUM"], "BRENDA": ["BG28734", "BG91971", "BG28736"], "BioPath": ["Ammonium-ion", "Ammonia"], "CAS": ["14798-03-9"], "CASID": ["14798-03-9"], "ChEBI": ["13408", "13405", "13406", "13407", "28938", "62982", "44269", "66871", "18219", "16134", "29337", "49783", "44404", "7436", "7435", "7434", "22533", "22534", "22535", "29340", "63040", "13772", "13771", "29240", "44284"], "HMDB": ["HMDB00051"], "KEGG": "C00014", "MetaCyc": "AMMONIUM", "PUBCHEM ID": ["4547"], "Reactome": ["140912", "2022135", "76230", "113561", "389843", "29382", "31633"], "SEED": ["cpd00013"], "UPA": ["UPC00014"], "map_info": {"display_name": "NH4", "hidden": true}}}, {"id": "o2_c", "name": "O2", "compartment": "c", "formula": "O2", "notes": {"BIOCYC": ["OXYGEN-MOLECULE"], "BRENDA": ["BG36249"], "BioPath": ["Oxygen"], "CAS": ["7782-44-7"], "CASID": ["7782-44-7"], "ChEBI": ["44742", "27140", "15379", "25366", "26689", "30491", "13416", "29793", "23833", "7860", "10745"], "HMDB": ["HMDB01377"], "KEGG": "C00007", "MetaCyc": "OXYGEN-MOLECULE", "PUBCHEM ID": ["3309"], "Reactome": ["113534", "29368", "113535", "1236709", "113533", "189461", "113685", "352327", "351593"], "SEED": ["cpd00532"], "UPA": ["UPC00007"], "map_info": {"display_name": "O2", "hidden": true}}}, {"id": "o2_e", "name": "O2", "compartment": "e", "formula": "O2", "notes": {"BIOCYC": ["OXYGEN-MOLECULE"], "BRENDA": ["BG36249"], "BioPath": ["Oxygen"], "CAS": ["7782-44-7"], "CASID": ["7782-44-7"], "ChEBI": ["44742", "27140", "15379", "25366", "26689", "30491", "13416", "29793", "23833", "7860", "10745"], "HMDB": ["HMDB01377"], "KEGG": "C00007", "MetaCyc": "OXYGEN-MOLECULE", "PUBCHEM ID": ["3309"], "Reactome": ["113534", "29368", "113535", "1236709", "113533", "189461", "113685", "352327", "351593"], "SEED": ["cpd00532"], "UPA": ["UPC00007"], "map_info": {"display_name": "O2", "hidden": true}}}, {"id": "oaa_c", "name": "Oxaloacetate", "compartment": "c", "formula": "C4H2O5", "notes": {"BIOCYC": ["OXALACETIC_ACID"], "BRENDA": ["BG19269", "BG19271"], "BioPath": ["Oxaloacetate"], "CAS": ["328-42-7"], "CASID": ["328-42-7"], "ChEBI": ["23911", "23910", "12810", "10547", "16452", "17479", "30744", "7812", "19638", "25734", "25731", "12820", "1158", "14703", "28394", "24958", "24959"], "HMDB": ["HMDB00223"], "KEGG": "C00036", "LIPIDMAPS": ["LMFA01170061", "LMFA01170120"], "MetaCyc": "OXALACETIC_ACID", "PUBCHEM ID": ["3338"], "Reactome": ["76213", "113587"], "SEED": ["cpd00032"], "UPA": ["UPC00036"], "map_info": {"align": "upper right", "display_name": "OAA", "x": 651.7279962661855, "y": 435.1394538257549}}}, {"id": "pep_c", "name": "Phosphoenolpyruvate", "compartment": "c", "formula": "C3H2O6P", "notes": {"BIOCYC": ["PHOSPHO-ENOL-PYRUVATE"], "BRENDA": ["BG17779"], "BioPath": ["Phosphoenolpyruvate"], "CAS": ["138-08-9"], "CASID": ["138-08-9"], "ChEBI": ["44897", "44894", "14812", "8147", "26055", "26054", "58702", "18021"], "HMDB": ["HMDB00263"], "KEGG": "PHOSPHO-ENOL-PYRUVATE", "MetaCyc": "PHOSPHO-ENOL-PYRUVATE", "PUBCHEM ID": ["3374"], "Reactome": ["29492", "372364"], "SEED": ["cpd00061"], "UPA": ["UPC00074"], "map_info": {"align": "lower center", "display_name": "PEP", "x": 385.02539837249424, "y": 607.2539052069453}}}, {"id": "pi_c", "name": "Phosphate", "compartment": "c", "formula": "HO4P", "notes": {"BIOCYC": ["Pi"], "BRENDA": ["BG92038"], "BioPath": ["Phosphate", "Phosphate_(protonated)"], "CAS": ["14265-44-2"], "CASID": ["14265-44-2"], "ChEBI": ["37583", "7793", "37585", "34683", "14791", "34855", "29137", "29139", "63036", "26020", "39739", "32597", "32596", "43474", "63051", "43470", "9679", "35433", "4496", "45024", "18367", "26078", "39745", "24838"], "HMDB": ["HMDB02142"], "KEGG": "C00009", "MetaCyc": "Pi", "PUBCHEM ID": ["3311"], "Reactome": ["947590", "109277", "113548", "2255331", "29372", "113550", "113551"], "SEED": ["cpd09464", "cpd09463", "cpd00009"], "UPA": ["UPC00009"], "map_info": {"display_name": "PI", "hidden": true}}}, {"id": "pi_e", "name": "Phosphate", "compartment": "e", "formula": "HO4P", "notes": {"BIOCYC": ["Pi"], "BRENDA": ["BG92038"], "BioPath": ["Phosphate", "Phosphate_(protonated)"], "CAS": ["14265-44-2"], "CASID": ["14265-44-2"], "ChEBI": ["37583", "7793", "37585", "34683", "14791", "34855", "29137", "29139", "63036", "26020", "39739", "32597", "32596", "43474", "63051", "43470", "9679", "35433", "4496", "45024", "18367", "26078", "39745", "24838"], "HMDB": ["HMDB02142"], "KEGG": "C00009", "MetaCyc": "Pi", "PUBCHEM ID": ["3311"], "Reactome": ["947590", "109277", "113548", "2255331", "29372", "113550", "113551"], "SEED": ["cpd09464", "cpd09463", "cpd00009"], "UPA": ["UPC00009"], "map_info": {"display_name": "PI", "hidden": true}}}, {"id": "pyr_c", "name": "Pyruvate", "compartment": "c", "formula": "C3H3O3", "notes": {"BIOCYC": ["PYRUVATE"], "BRENDA": ["BG17694"], "BioPath": ["Pyruvate"], "CAS": ["127-17-3"], "CASID": ["127-17-3"], "ChEBI": ["15361", "14987", "8685", "32816", "45253", "26466", "26462"], "HMDB": ["HMDB00243"], "KEGG": "C00022", "LIPIDMAPS": ["LMFA01060077"], "MetaCyc": "PYRUVATE", "PUBCHEM ID": ["3324"], "Reactome": ["113557", "389680", "29398"], "SEED": ["cpd00020"], "UPA": ["UPC00022"], "map_info": {"align": "left", "display_name": "PYR", "x": 384.44180288167246, "y": 534.2529019073535}}}, {"id": "pyr_e", "name": "Pyruvate", "compartment": "e", "formula": "C3H3O3", "notes": {"BIOCYC": ["PYRUVATE"], "BRENDA": ["BG17694"], "BioPath": ["Pyruvate"], "CAS": ["127-17-3"], "CASID": ["127-17-3"], "ChEBI": ["15361", "14987", "8685", "32816", "45253", "26466", "26462"], "HMDB": ["HMDB00243"], "KEGG": "C00022", "LIPIDMAPS": ["LMFA01060077"], "MetaCyc": "PYRUVATE", "PUBCHEM ID": ["3324"], "Reactome": ["113557", "389680", "29398"], "SEED": ["cpd00020"], "UPA": ["UPC00022"], "map_info": {"display_name": "PYR", "hidden": true}}}, {"id": "q8_c", "name": "Ubiquinone-8", "compartment": "c", "formula": "C49H74O4", "notes": {"BIOCYC": ["CPD-9728"], "BRENDA": ["BG18990"], "CAS": ["1339-63-5"], "CASID": ["1339-63-5"], "ChEBI": ["61683"], "KEGG": "C00399", "LIPIDMAPS": ["LMPR02010005"], "MetaCyc": "UBIQUINONE-8", "PUBCHEM ID": ["3689"], "SEED": ["cpd15560"], "map_info": {"color": "#8ca252", "display_name": "Q8", "hidden": true}}}, {"id": "q8h2_c", "name": "Ubiquinol-8", "compartment": "c", "formula": "C49H76O4", "notes": {"BIOCYC": ["REDUCED-MENAQUINONE"], "BRENDA": ["BG79801"], "ChEBI": ["61682"], "KEGG": "C00390", "MetaCyc": "CPD-9956", "PUBCHEM ID": ["3680"], "SEED": ["cpd15561"], "map_info": {"color": "#8ca252", "display_name": "Q8H2", "hidden": true}}}, {"id": "r5p_c", "name": "alpha-D-Ribose 5-phosphate", "compartment": "c", "formula": "C5H9O8P", "notes": {"BIOCYC": ["RIBOSE-5P"], "BRENDA": ["BG81798", "BG34575"], "BioPath": ["alpha-D-Ribose_5-phosphate"], "CAS": ["4300-28-1"], "CASID": ["4300-28-1"], "ChEBI": ["12331", "52742", "10270", "22413", "18189"], "HMDB": ["HMDB00618", "HMDB01548", "HMDB02033", "HMDB02694"], "KEGG": "C00117", "MetaCyc": "RIBOSE-5P", "PUBCHEM ID": ["3417"], "SEED": ["cpd00101"], "UPA": ["UPC00117"], "map_info": {"display_name": "R5P", "x": 279.4968064155013, "y": 452.85302264740017}}}, {"id": "ru5p__D_c", "name": "D-Ribulose 5-phosphate", "compartment": "c", "formula": "C5H9O8P", "notes": {"BIOCYC": ["RIBULOSE-5P"], "CAS": ["4151-19-3"], "CASID": ["4151-19-3"], "KEGG": "C00199", "MetaCyc": "RIBULOSE-5P", "PUBCHEM ID": ["3499"], "map_info": {"display_name": "RU5P", "x": 280.80987288051784, "y": 348.8893086086381}}}, {"id": "s7p_c", "name": "Sedoheptulose 7-phosphate", "compartment": "c", "formula": "C7H13O10P", "notes": {"BIOCYC": ["D-SEDOHEPTULOSE-7-P"], "BRENDA": ["BG24563"], "BioPath": ["D-Sedoheptulose_7-phosphate"], "CASID": ["583-08-4"], "ChEBI": ["26621", "57483", "9083", "15721", "4244", "15074", "15073"], "KEGG": "C05382", "MetaCyc": "D-SEDOHEPTULOSE-7-P", "PUBCHEM ID": ["3576"], "Reactome": ["29882"], "SEED": ["cpd00238"], "UPA": ["UPC05382"], "map_info": {"align": "upper center", "display_name": "S7P", "x": 205.34941750020425, "y": 467.52406543405476}}}, {"id": "succ_c", "name": "Succinate", "compartment": "c", "formula": "C4H4O4", "notes": {"BIOCYC": ["SUC"], "BRENDA": ["BG19270"], "BioPath": ["Succinate"], "CAS": ["110-15-6"], "CASID": ["110-15-6"], "ChEBI": ["22941", "22943", "26807", "26803", "30031", "9304", "15125", "45639", "15741", "30779"], "HMDB": ["HMDB00254"], "KEGG": "C00042", "LIPIDMAPS": ["LMFA01170043"], "MetaCyc": "SUC", "PUBCHEM ID": ["3344"], "Reactome": ["113536", "433123", "29434", "389583", "1650769", "159939"], "SEED": ["cpd00036"], "UPA": ["UPC00042"], "map_info": {"display_name": "SUCC", "x": 862.4717690044146, "y": 350.30740595870986}}}, {"id": "succ_e", "name": "Succinate", "compartment": "e", "formula": "C4H4O4", "notes": {"BIOCYC": ["SUC"], "BRENDA": ["BG19270"], "BioPath": ["Succinate"], "CAS": ["110-15-6"], "CASID": ["110-15-6"], "ChEBI": ["22941", "22943", "26807", "26803", "30031", "9304", "15125", "45639", "15741", "30779"], "HMDB": ["HMDB00254"], "KEGG": "C00042", "LIPIDMAPS": ["LMFA01170043"], "MetaCyc": "SUC", "PUBCHEM ID": ["3344"], "Reactome": ["113536", "433123", "29434", "389583", "1650769", "159939"], "SEED": ["cpd00036"], "UPA": ["UPC00042"], "map_info": {"display_name": "SUCC", "hidden": true}}}, {"id": "xu5p__D_c", "name": "D-Xylulose 5-phosphate", "compartment": "c", "formula": "C5H9O8P", "notes": {"BIOCYC": ["XYLULOSE-5-PHOSPHATE"], "KEGG": "C00231", "MetaCyc": "XYLULOSE-5-PHOSPHATE", "PUBCHEM ID": ["3530"], "map_info": {"align": "left", "display_name": "XU5P", "x": 221.11831519632847, "y": 380.95172384788106}}}], "reactions": [{"id": "2DHGLCK", "name": "", "metabolites": {"2dhglcn_c": -1, "6p2dhglcn_c": 1, "adp_c": 1, "atp_c": -1, "h_c": -2}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"cofactors": {"atp_c": {"x": 544.4508131757798, "y": 126.41213643482297}}, "group": 1, "reversibility": false, "x": 517.7251972651254, "y": 160.67140125569455}}}, {"id": "DHQTi", "name": "3-DEHYDROQUINATE-DEHYDRATASE-RXN", "metabolites": {"3dhq_c": -1, "3dhsk_c": 1, "h2o_c": 1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-6707, PWY-6416, PWY-6163, QUINATEDEG-PWY", "notes": {"BIOCYC": ["3-DEHYDROQUINATE-DEHYDRATASE-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["4.2.1.10"], "KEGG": ["R03084"], "RHEA": ["21096"], "map_info": {"group": 7, "reversibility": true, "x": 540.4790352987333, "y": 693.9963883450243}, "orig_id": "_3-DEHYDROQUINATE-DEHYDRATASE-RXN"}}, {"id": "DHQS", "name": "3-DEHYDROQUINATE-SYNTHASE-RXN", "metabolites": {"2dda7p_c": -1, "3dhq_c": 1, "pi_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-6164", "notes": {"BIOCYC": ["3-DEHYDROQUINATE-SYNTHASE-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["4.2.3.4"], "KEGG": ["R03083"], "RHEA": ["21968"], "map_info": {"group": 7, "reversibility": false, "x": 435.6254226896806, "y": 693.7885168527002}, "orig_id": "_3-DEHYDROQUINATE-SYNTHASE-RXN"}}, {"id": "ACONTa", "name": "ACONITATEDEHYDR-RXN[CCO-CYTOSOL]-CIT//CIS-ACONITATE/WATER.38.", "metabolites": {"acon_c": 1, "cit_c": -1, "h2o_c": 1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY66-398, PWY-5913, PWY-7254, PWY-6969, P105-PWY, PWY-5392, P23-PWY, PWY-7124, TCA, GLYOXYLATE-BYPASS, PWY-6728, PWY-6549, FERMENTATION-PWY, REDCITCYC, PWY-5690, PWY-5750", "notes": {"BIOCYC": ["ACONITATEDEHYDR-RXN"], "CONFIDENCE LEVEL": ["4"], "KEGG": ["R01325"], "RHEA": ["10228"], "map_info": {"group": 5, "reversibility": true, "x": 624.705227973357, "y": 304.39467384346295}, "orig_id": "ACONITATEDEHYDR-RXN[CCO-CYTOSOL]-CIT//CIS-ACONITATE/WATER.38."}}, {"id": "ACONTb", "name": "ACONITATEHYDR-RXN[CCO-CYTOSOL]-CIS-ACONITATE/WATER//THREO-DS-ISO-CITRATE.55.", "metabolites": {"acon_c": -1, "h2o_c": -1, "icit_c": 1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY66-398, PWY-5913, PWY-7254, PWY-6969, P105-PWY, PWY-5392, P23-PWY, PWY-7124, TCA, GLYOXYLATE-BYPASS, PWY-6728, PWY-6549, FERMENTATION-PWY, REDCITCYC, PWY-5690", "notes": {"BIOCYC": ["ACONITATEHYDR-RXN"], "CONFIDENCE LEVEL": ["4"], "KEGG": ["R01900"], "RHEA": ["22144"], "map_info": {"group": 5, "reversibility": true, "x": 692.3472283960645, "y": 234.67588017185594}, "orig_id": "ACONITATEHYDR-RXN[CCO-CYTOSOL]-CIS-ACONITATE/WATER//THREO-DS-ISO-CITRATE.55."}}, {"id": "AKGDH", "name": "2OXOGLUTARATEDEH-RXN", "metabolites": {"adp_c": -1, "akg_c": -1, "atp_c": 1, "co2_c": 1, "nad_c": -1, "nadh_c": 1, "pi_c": -1, "succ_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-7254, TCA, PWY-5690", "notes": {"BIOCYC": ["2OXOGLUTARATEDEH-RXN"], "CONFIDENCE LEVEL": ["4"], "KEGG": ["R08549"], "RHEA": ["27786"], "map_info": {"cofactors": {"atp_c": {"x": 901.9535610497306, "y": 310.7676510127877}, "co2_c": {"x": 887.445408368252, "y": 331.4761627151679}, "nadh_c": {"x": 886.0037292778484, "y": 290.55311164462205}}, "group": 5, "reversibility": false, "x": 852.833857883823, "y": 299.5043877495533}, "orig_id": "_2OXOGLUTARATEDEH-RXN"}}, {"id": "ATPM", "name": "ATPASE-RXN", "metabolites": {"adp_c": 1, "atp_c": -1, "h2o_c": -1, "h_c": 1, "pi_c": 1}, "lower_bound": 8.39, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"BIOCYC": ["ATPASE-RXN"], "CONFIDENCE LEVEL": ["2"], "EC NUMBER": ["3.6.1.3/3.6.1.15/3.6.4.6"], "KEGG": ["R00086"], "RHEA": ["13065"], "map_info": {"cofactors": {"atp_c": {}}, "hidden": true, "reversibility": false}, "orig_id": "ATPASE-RXN"}}, {"id": "ATPS4r", "name": "ATPSYN-RXN[CCO-PM-BAC-NEG]-ATP/PROTON/WATER//ADP/Pi/PROTON.48.", "metabolites": {"adp_c": 1, "atp_c": -1, "h2o_c": -1, "h_c": -3, "h_e": 4, "pi_c": 1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-7219", "notes": {"BIOCYC": ["ATPSYN-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["3.6.3.14"], "RHEA": ["20852"], "map_info": {"cofactors": {"atp_c": {}}, "hidden": true, "reversibility": true}, "orig_id": "ATPSYN-RXN[CCO-PM-BAC-NEG]-ATP/PROTON/WATER//ADP/Pi/PROTON.48."}}, {"id": "Biomass_Ecoli_core_w_GAM", "name": "Biomass Objective Function with GAM", "metabolites": {"3pg_c": -1.496, "accoa_c": -3.7478, "adp_c": 59.81, "akg_c": 4.1182, "atp_c": -59.81, "coa_c": 3.7478, "e4p_c": -0.361, "f6p_c": -0.0709, "g3p_c": -0.129, "g6p_c": -0.205, "gln__L_c": -0.2557, "glu__L_c": -4.9414, "h2o_c": -59.81, "h_c": 59.81, "nad_c": -3.547, "nadh_c": 3.547, "nadp_c": 13.0279, "nadph_c": -13.0279, "oaa_c": -1.7867, "pep_c": -0.5191, "pi_c": 59.81, "pyr_c": -2.8328, "r5p_c": -0.8977}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "objective_coefficient": 1.0, "notes": {"map_info": {"cofactors": {"atp_c": {}, "nadh_c": {}, "nadph_c": {}}, "hidden": true, "reversibility": false}, "original_bigg_id": "Biomass_Ecoli_core_w_GAM"}}, {"id": "CATDOX", "name": "CATECHOL-12-DIOXYGENASE-RXN", "metabolites": {"catechol_c": -1, "ccmuac_c": 1, "h_c": 2, "o2_c": -1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "CATECHOL-ORTHO-CLEAVAGE-PWY", "notes": {"BIOCYC": ["CATECHOL-12-DIOXYGENASE-RXN"], "CONFIDENCE LEVEL": ["2"], "EC NUMBER": ["1.13.11.1"], "KEGG": ["R00817"], "RHEA": ["23852"], "map_info": {"align": "upper center", "display_name": "CatA", "group": 8, "reversibility": false, "x": 740.9043425577053, "y": 763.0072387922382}, "orig_id": "CATECHOL-12-DIOXYGENASE-RXN"}}, {"id": "CO2t", "name": "TRANS-RXN0-545", "metabolites": {"co2_c": 1, "co2_e": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"BIOCYC": ["TRANS-RXN0-545"], "CONFIDENCE LEVEL": ["0"], "map_info": {"cofactors": {"co2_c": {}}, "hidden": true, "reversibility": true}, "orig_id": "TRANS-RXN0-545"}}, {"id": "CS", "name": "RXN-14905", "metabolites": {"accoa_c": -1, "cit_c": 1, "coa_c": 1, "h2o_c": -1, "h_c": 1, "oaa_c": -1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"BIOCYC": ["RXN-14905"], "CONFIDENCE LEVEL": ["0"], "EC NUMBER": ["2.3.3.3"], "map_info": {"group": 5, "reversibility": false, "x": 615.6376924040082, "y": 383.2023169350485}, "orig_id": "RXN-14905"}}, {"id": "CYTBD", "name": "cytochrome oxidase bd (ubiquinol-8: 2 protons)", "metabolites": {"h2o_c": 1, "h_c": -2, "h_e": 2, "o2_c": -0.5, "q8_c": 1, "q8h2_c": -1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"cofactors": {"q8_c": {}, "q8h2_c": {}}, "hidden": true, "reversibility": false}, "original_bigg_id": "CYTBD"}}, {"id": "DDPA", "name": "DAHPSYN-RXN", "metabolites": {"2dda7p_c": 1, "e4p_c": -1, "h2o_c": -1, "pep_c": -1, "pi_c": 1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-6164", "notes": {"BIOCYC": ["DAHPSYN-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["2.5.1.54"], "KEGG": ["R01826"], "RHEA": ["14717"], "map_info": {"group": 7, "reversibility": true, "x": 319.5609941458283, "y": 613.8770983468971}, "orig_id": "DAHPSYN-RXN"}}, {"id": "DHSKDH", "name": "DHSHIKIMATE-DEHYDRO-RXN", "metabolites": {"34dhbz_c": 1, "3dhsk_c": -1, "h2o_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-6419, PWY-6416, PWY-6289, SHIKIMATEDEG-PWY, QUINATEDEG-PWY", "notes": {"BIOCYC": ["DHSHIKIMATE-DEHYDRO-RXN"], "CONFIDENCE LEVEL": ["2"], "EC NUMBER": ["4.2.1.118"], "KEGG": ["R01627"], "RHEA": ["24849"], "map_info": {"align": "left", "display_name": "AsbF", "group": 8, "reversibility": false, "x": 587.554620222031, "y": 725.3663245215857}, "orig_id": "DHSHIKIMATE-DEHYDRO-RXN"}}, {"id": "ENO", "name": "2PGADEHYDRAT-RXN", "metabolites": {"3pg_c": -1, "h2o_c": 1, "pep_c": 1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-1622, GLYCOLYSIS, PWY-5484, ANAGLYCOLYSIS-PWY, PWY-7003, PWY66-400, PWY-6901, PWY-2221, NPGLUCAT-PWY, PWY66-399, PWY-7218, GLUCONEO-PWY, PWY-7124, PWY-6142, PWY-6886, PWY-5723, P124-PWY, P341-PWY, P122-PWY, PWY-1042", "notes": {"BIOCYC": ["2PGADEHYDRAT-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["4.2.1.11"], "KEGG": ["R00658"], "RHEA": ["10164"], "map_info": {"group": 2, "reversibility": true, "x": 306.00590331062807, "y": 607.5508151559774}, "orig_id": "_2PGADEHYDRAT-RXN"}}, {"id": "EX_co2_e", "name": "CO2 exchange", "metabolites": {"co2_e": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": true}, "original_bigg_id": "EX_co2_e"}}, {"id": "EX_glc_e", "name": "D-Glucose exchange", "metabolites": {"glc__D_e": -1}, "lower_bound": -7.03, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": true}, "original_bigg_id": "EX_glc_e"}}, {"id": "EX_h2o_e", "name": "H2O exchange", "metabolites": {"h2o_e": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": true}, "original_bigg_id": "EX_h2o_e"}}, {"id": "EX_h_e", "name": "H+ exchange", "metabolites": {"h_e": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": true}, "original_bigg_id": "EX_h_e"}}, {"id": "EX_nh4_e", "name": "Ammonia exchange", "metabolites": {"nh4_e": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": true}, "original_bigg_id": "EX_nh4_e"}}, {"id": "EX_o2_e", "name": "O2 exchange", "metabolites": {"o2_e": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": true}, "original_bigg_id": "EX_o2_e"}}, {"id": "EX_pi_e", "name": "Phosphate exchange", "metabolites": {"pi_e": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": true}, "original_bigg_id": "EX_pi_e"}}, {"id": "EX_pyr_e", "name": "Pyruvate exchange", "metabolites": {"pyr_e": -1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": false}, "original_bigg_id": "EX_pyr_e"}}, {"id": "EX_succ_e", "name": "Succinate exchange", "metabolites": {"succ_e": -1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": false}, "original_bigg_id": "EX_succ_e"}}, {"id": "FBA", "name": "F16ALDOLASE-RXN", "metabolites": {"dhap_c": 1, "fdp_c": -1, "g3p_c": 1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "GLYCOLYSIS, PWY-5484, ANAGLYCOLYSIS-PWY, PWY-7385, PWY66-400, SUCSYN-PWY, PWY66-399, GLUCONEO-PWY, PWY-6142, CALVIN-PWY, P341-PWY, P185-PWY, PWY-1861, PWY-1042", "notes": {"BIOCYC": ["F16ALDOLASE-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["4.1.2.13"], "KEGG": ["R01068"], "RHEA": ["14729"], "map_info": {"group": 2, "reversibility": true, "x": 91.32455144614897, "y": 481.1630905704439}, "orig_id": "F16ALDOLASE-RXN"}}, {"id": "FBP", "name": "F16BDEPHOS-RXN[CCO-CYTOSOL]-FRUCTOSE-16-DIPHOSPHATE/WATER//FRUCTOSE-6P/Pi.59.", "metabolites": {"f6p_c": 1, "fdp_c": -1, "h2o_c": -1, "pi_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "GLYCOLYSIS, PWY-5484, SUCSYN-PWY, PWY66-399, GLUCONEO-PWY, CALVIN-PWY, P185-PWY", "notes": {"BIOCYC": ["F16BDEPHOS-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["3.1.3.11"], "KEGG": ["R00762"], "RHEA": ["11064"], "map_info": {"group": 2, "reversibility": false, "x": 33.86414270894326, "y": 371.46644312458926}, "orig_id": "F16BDEPHOS-RXN[CCO-CYTOSOL]-FRUCTOSE-16-DIPHOSPHATE/WATER//FRUCTOSE-6P/Pi.59."}}, {"id": "FRD7", "name": "R601-RXN[CCO-PM-BAC-NEG]-FUM/REDUCED-MENAQUINONE//SUC/CPD-9728.54.", "metabolites": {"fum_c": -1, "q8_c": 1, "q8h2_c": -1, "succ_c": 1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY0-1582, PWY0-1576, PWY-5392, P42-PWY, P23-PWY, FERMENTATION-PWY, PWY0-1336, REDCITCYC, P108-PWY", "notes": {"BIOCYC": ["R601-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["1.3.5.4"], "map_info": {"cofactors": {"q8_c": {"align": "left", "x": 835.8763362330001, "y": 367.8072528207118}, "q8h2_c": {"align": "left", "x": 821.8162635877821, "y": 390.73625450559075}}, "group": 5, "reversibility": true, "x": 852.8352362753185, "y": 398.2571225858406}, "orig_id": "R601-RXN[CCO-PM-BAC-NEG]-FUM/REDUCED-MENAQUINONE//SUC/CPD-9728.54."}}, {"id": "FUM", "name": "FUMHYDR-RXN[CCO-CYTOSOL]-MAL//FUM/WATER.28.", "metabolites": {"fum_c": 1, "h2o_c": 1, "mal__L_c": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY66-398, PWY-7384, PWY-5913, PWY-7254, PWY-6969, P105-PWY, PWY-5392, P42-PWY, P23-PWY, TCA, PWY-6728, PWY-561, FERMENTATION-PWY, REDCITCYC, PWY-5690, P108-PWY", "notes": {"BIOCYC": ["FUMHYDR-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["4.2.1.2"], "KEGG": ["R01082"], "RHEA": ["12460"], "map_info": {"group": 5, "reversibility": true, "x": 786.2140643207673, "y": 464.12034501490393}, "orig_id": "FUMHYDR-RXN[CCO-CYTOSOL]-MAL//FUM/WATER.28."}}, {"id": "G6PDH2r", "name": "GLU6PDEHYDROG-RXN", "metabolites": {"6pgc_c": 1, "g6p_c": -1, "h2o_c": -1, "h_c": 2, "nadp_c": -1, "nadph_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "OXIDATIVEPENT-PWY, PWY-7268, RUMP-PWY, P122-PWY, GLYCOLYSIS-E-D", "notes": {"BIOCYC": ["GLU6PDEHYDROG-RXN"], "CONFIDENCE LEVEL": ["2"], "EC NUMBER": ["1.1.1.49"], "KEGG": ["R02736"], "RHEA": ["15841"], "map_info": {"cofactors": {"nadph_c": {"align": "left", "x": 336.45873908248484, "y": 250.48522423374297}}, "group": 3, "reversibility": false, "x": 314.43458034300716, "y": 191.0424894354274}, "orig_id": "GLU6PDEHYDROG-RXN"}}, {"id": "GADktpp", "name": "", "metabolites": {"2dhglcn_c": 1, "glcn_c": -1, "h_c": 1, "nad_c": -1, "nadh_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"cofactors": {"nadh_c": {"x": 466.3517259677519, "y": 46.77099640766862}}, "group": 1, "reversibility": false, "x": 432.75341989649314, "y": 80.12816900465222}}}, {"id": "GAPD", "name": "GAPOXNPHOSPHN-RXN", "metabolites": {"3pg_c": 1, "adp_c": -1, "atp_c": 1, "g3p_c": -1, "h_c": 1, "nad_c": -1, "nadh_c": 1, "pi_c": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "GLYCOLYSIS, PWY-5484, ANAGLYCOLYSIS-PWY, PWY-7003, PWY66-400, SUCSYN-PWY, PWY-6901, PWY66-399, GLUCONEO-PWY, P185-PWY, P124-PWY, P122-PWY, PWY-1042", "notes": {"BIOCYC": ["GAPOXNPHOSPHN-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["1.2.1.12"], "KEGG": ["R01061"], "RHEA": ["10300"], "map_info": {"cofactors": {"atp_c": {"x": 253.89141623300299, "y": 590.8389632418914}, "nadh_c": {"x": 253.40866920430852, "y": 571.0903947376696}}, "group": 2, "reversibility": true, "x": 214.79562796533543, "y": 559.880873717573}, "orig_id": "GAPOXNPHOSPHN-RXN"}}, {"id": "GLCDpp", "name": "Glucose dehydrogenase (ubiquinone-8 as acceptor) (periplasm)", "metabolites": {"glc__D_c": -1, "glcn_c": 1, "h2o_e": -1, "h_e": 1, "q8_c": -1, "q8h2_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"cofactors": {"q8_c": {"x": 267.71756255175376, "y": 112.53207209866534}, "q8h2_c": {"x": 322.44031103702196, "y": 113.53184436050847}}, "group": 1, "reversibility": false, "x": 297.84146356339807, "y": 80.76836483394578}, "original_bigg_id": "GLCDpp"}}, {"id": "GLCabcpp", "name": "D-glucose transport via ABC system (periplasm)", "metabolites": {"adp_c": 1, "atp_c": -1, "glc__D_c": 1, "glc__D_e": -1, "h2o_c": -1, "h_c": 1, "pi_c": 1}, "lower_bound": 0.0, "upper_bound": 999999.0, "gene_reaction_rule": "", "notes": {"map_info": {"cofactors": {"atp_c": {"align": "left", "x": 182.86139559078066, "y": 20.832498269383663}}, "group": null, "reversibility": false, "x": 205.4374987586769, "y": 45.39361444434964}, "original_bigg_id": "GLCabcpp"}}, {"id": "GLNS", "name": "GLUTAMINESYN-RXN", "metabolites": {"adp_c": 1, "atp_c": -1, "gln__L_c": 1, "glu__L_c": -1, "h_c": 1, "nh4_c": -1, "pi_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-5675, PWY490-3, PWY-6964, PWY-6963, GLNSYN-PWY, PWY-6549, PWY-381", "notes": {"BIOCYC": ["GLUTAMINESYN-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["6.3.1.2"], "KEGG": ["R00253"], "RHEA": ["16169"], "map_info": {"cofactors": {"atp_c": {}}, "hidden": true, "reversibility": false}, "orig_id": "GLUTAMINESYN-RXN"}}, {"id": "GLUDy", "name": "GLUTDEHYD-RXN", "metabolites": {"akg_c": 1, "glu__L_c": -1, "h2o_c": -1, "h_c": 1, "nadp_c": -1, "nadph_c": 1, "nh4_c": 1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-5913, PWY-5675, PWY490-3, GLUTAMINEFUM-PWY, GLUTSYN-PWY, GLUTSYNIII-PWY", "notes": {"BIOCYC": ["GLUTDEHYD-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["1.4.1.4"], "KEGG": ["R00248"], "RHEA": ["11612"], "map_info": {"cofactors": {"nadph_c": {}}, "hidden": true, "reversibility": true}, "orig_id": "GLUTDEHYD-RXN"}}, {"id": "GLUN", "name": "GLUTAMIN-RXN", "metabolites": {"gln__L_c": -1, "glu__L_c": 1, "h2o_c": -1, "nh4_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "CITRULBIO-PWY, PWY-7176, PWY-7177, PWY-7185, PWY-7221, PWY-6466, PWY-7400, PWY-5154, PWY-5686, ARGSYNBSUB-PWY, ARGSYN-PWY, ASPARAGINE-BIOSYNTHESIS, PWY-6964, PWY-6549, PWY-4341, GLUTAMINEFUM-PWY, GLUTSYN-PWY, GLUTAMINDEG-PWY", "notes": {"BIOCYC": ["GLUTAMIN-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["3.5.1.2/3.5.1.38"], "KEGG": ["R00256"], "RHEA": ["15889"], "map_info": {"hidden": true, "reversibility": false}, "orig_id": "GLUTAMIN-RXN"}}, {"id": "GLUSy", "name": "GLUTAMATESYN-RXN", "metabolites": {"akg_c": -1, "gln__L_c": -1, "glu__L_c": 2, "h_c": -1, "nadp_c": 1, "nadph_c": -1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "GLUTAMINEFUM-PWY, GLUTSYN-PWY", "notes": {"BIOCYC": ["GLUTAMATESYN-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["1.4.1.13"], "KEGG": ["R00114"], "RHEA": ["15501"], "map_info": {"cofactors": {"nadph_c": {}}, "hidden": true, "reversibility": false}, "orig_id": "GLUTAMATESYN-RXN"}}, {"id": "GND", "name": "RXN-9952", "metabolites": {"6pgc_c": -1, "co2_c": 1, "nadp_c": -1, "nadph_c": 1, "ru5p__D_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "OXIDATIVEPENT-PWY", "notes": {"BIOCYC": ["RXN-9952"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["1.1.1.44"], "KEGG": ["R01528"], "RHEA": ["10116"], "map_info": {"cofactors": {"co2_c": {"x": 314.2407150186436, "y": 293.25893890947725}, "nadph_c": {"x": 292.68913873784066, "y": 277.7658253333281}}, "group": 3, "reversibility": false, "x": 343.484086635417, "y": 317.22291707037226}, "orig_id": "RXN-9952"}}, {"id": "GNK", "name": "gluconokinase", "metabolites": {"6pgc_c": 1, "adp_c": 1, "atp_c": -1, "glcn_c": -1, "h_c": 1}, "lower_bound": 0.0, "upper_bound": 999999.0, "gene_reaction_rule": "", "notes": {"map_info": {"cofactors": {"atp_c": {"x": 420.3678374325176, "y": 123.61436490654211}}, "group": 1, "reversibility": false, "x": 393.21969884501925, "y": 172.81278999658102}, "original_bigg_id": "GNK"}}, {"id": "H2Ot", "name": "TRANS-RXN-145", "metabolites": {"h2o_c": 1, "h2o_e": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"BIOCYC": ["TRANS-RXN-145"], "CONFIDENCE LEVEL": ["4"], "map_info": {"hidden": true, "reversibility": true}, "orig_id": "TRANS-RXN-145"}}, {"id": "HCO3E", "name": "RXN0-5224", "metabolites": {"co2_c": 1, "h2o_c": 1, "h_c": -1, "hco3_c": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-7117, PWY-7115, PWY-241, CYANCAT-PWY, PWY-6142, PWYQT-4429", "notes": {"BIOCYC": ["RXN0-5224"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["4.2.1.1"], "RHEA": ["10748"], "map_info": {"cofactors": {"co2_c": {}, "hco3_c": {}}, "hidden": true, "reversibility": true}, "orig_id": "RXN0-5224"}}, {"id": "HEX1", "name": "hexokinase (D-glucose:ATP)", "metabolites": {"adp_c": 1, "atp_c": -1, "g6p_c": 1, "glc__D_c": -1, "h_c": 1}, "lower_bound": 0.0, "upper_bound": 999999.0, "gene_reaction_rule": "", "notes": {"map_info": {"cofactors": {"atp_c": {"align": "left", "x": 184.88096245925033, "y": 101.14171174328351}}, "group": 2, "reversibility": false, "x": 206.08638993630842, "y": 128.45033362171716}, "original_bigg_id": "HEX1"}}, {"id": "ICDHyr", "name": "ISOCITDEH-RXN", "metabolites": {"akg_c": 1, "co2_c": 1, "icit_c": -1, "nadp_c": -1, "nadph_c": 1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-5913, PWY-7254, PWY-6969, P105-PWY, P23-PWY, PWY-7268, PWY-7124, TCA, PWY-6728, PWY-6549, FERMENTATION-PWY, REDCITCYC", "notes": {"BIOCYC": ["ISOCITDEH-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["1.1.1.42"], "KEGG": ["R00267"], "map_info": {"cofactors": {"co2_c": {"x": 838.7001816688123, "y": 230.55080854664823}, "nadph_c": {"x": 826.7428910654495, "y": 205.78610653784597}}, "group": 5, "reversibility": true, "x": 785.0632211391702, "y": 236.04855137361588}, "orig_id": "ISOCITDEH-RXN"}}, {"id": "ICL", "name": "ISOCIT-CLEAV-RXN", "metabolites": {"glx_c": 1, "icit_c": -1, "succ_c": 1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-6969, P105-PWY, GLYOXYLATE-BYPASS", "notes": {"BIOCYC": ["ISOCIT-CLEAV-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["4.1.3.1"], "KEGG": ["R00479"], "RHEA": ["13245"], "map_info": {"group": 5, "reversibility": true, "x": 755.6574167865804, "y": 287.62626632806007}, "orig_id": "ISOCIT-CLEAV-RXN"}}, {"id": "KDPGALDOL", "name": "KDPGALDOL-RXN", "metabolites": {"2ddg6p_c": -1, "g3p_c": 1, "pyr_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "GALACTUROCAT-PWY, PWY-6507, PWY-7242, ENTNER-DOUDOROFF-PWY, PWY-7310, PWY-2221", "notes": {"BIOCYC": ["KDPGALDOL-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["4.1.2.14/4.1.2.55"], "KEGG": ["R05605"], "RHEA": ["17089"], "map_info": {"group": 4, "reversibility": false, "x": 361.946922286626, "y": 462.2505148804707}, "orig_id": "KDPGALDOL-RXN"}}, {"id": "MALS", "name": "MALSYN-RXN", "metabolites": {"accoa_c": -1, "coa_c": 1, "glx_c": -1, "h2o_c": -1, "h_c": 1, "mal__L_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-6969, P105-PWY, PWY-7295, PWY-7294, PWY-7118, GLYOXYLATE-BYPASS, PWY-6728, GLYOXDEG-PWY", "notes": {"BIOCYC": ["MALSYN-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["2.3.3.9"], "KEGG": ["R00472"], "RHEA": ["18181"], "map_info": {"group": 5, "reversibility": false, "x": 717.0667175611219, "y": 402.7037787211368}, "orig_id": "MALSYN-RXN"}}, {"id": "MDH", "name": "MALATE-DEH-RXN[CCO-CYTOSOL]-MAL/NAD//OXALACETIC_ACID/NADH/PROTON.50.", "metabolites": {"h_c": 1, "mal__L_c": -1, "nad_c": -1, "nadh_c": 1, "oaa_c": 1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY66-398, PWY-1622, PWY-7115, PWY-7383, PWY-5913, PWY-6969, P105-PWY, PWY-5392, P42-PWY, P23-PWY, PWY66-399, GLUCONEO-PWY, PWY-561, TCA, GLYOXYLATE-BYPASS, PWY-6728, FERMENTATION-PWY, PWY-5690, P108-PWY, MALATE-ASPARTATE-SHUTTLE-PWY", "notes": {"BIOCYC": ["MALATE-DEH-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["1.1.1.37"], "KEGG": ["R00342"], "RHEA": ["21432"], "map_info": {"cofactors": {"nadh_c": {"x": 700.292183430524, "y": 434.77711979752655}}, "group": 5, "reversibility": true, "x": 692.4332389929946, "y": 466.09880720468925}, "orig_id": "MALATE-DEH-RXN[CCO-CYTOSOL]-MAL/NAD//OXALACETIC_ACID/NADH/PROTON.50."}}, {"id": "ME1", "name": "1.1.1.39-RXN", "metabolites": {"co2_c": 1, "mal__L_c": -1, "nad_c": -1, "nadh_c": 1, "pyr_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-3641, PWY-7115, PWY-7384, PWY-7118, GLUCONEO-PWY", "notes": {"BIOCYC": ["1.1.1.39-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["1.1.1.38/1.1.1.39"], "KEGG": ["R00214"], "RHEA": ["12653"], "map_info": {"cofactors": {"co2_c": {"x": 689.2741628441586, "y": 630.1538263076146}, "nadh_c": {"display_name": "NAD[P]H", "x": 696.7972157543039, "y": 610.9220712863572}}, "group": 6, "reversibility": false, "x": 693.168733804173, "y": 585.0091547300502}, "orig_id": "_1.1.1.39-RXN"}}, {"id": "ME2", "name": "MALIC-NADP-RXN", "metabolites": {"co2_c": 1, "mal__L_c": -1, "nadp_c": -1, "nadph_c": 1, "pyr_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-7117, PWY-241, GLUCONEO-PWY", "notes": {"BIOCYC": ["MALIC-NADP-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["1.1.1.40"], "KEGG": ["R00216"], "RHEA": ["18253"], "map_info": {"cofactors": {"co2_c": {"x": 633.2460204718325, "y": 666.6694372324865}, "nadph_c": {"x": 645.2125952280475, "y": 649.0120209453213}}, "group": 6, "hidden": true, "reversibility": false, "x": 679.0547007702069, "y": 578.655134181628}, "orig_id": "MALIC-NADP-RXN"}}, {"id": "NADH16", "name": "NADH dehydrogenase (ubiquinone-8 & 3 protons)", "metabolites": {"h_c": -4, "h_e": 3, "nad_c": 1, "nadh_c": -1, "q8_c": -1, "q8h2_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"cofactors": {"nadh_c": {}, "q8_c": {}, "q8h2_c": {}}, "hidden": true, "reversibility": false}, "original_bigg_id": "NADH16"}}, {"id": "NADTRHD", "name": "PYRNUTRANSHYDROGEN-RXN", "metabolites": {"nad_c": -1, "nadh_c": 1, "nadp_c": 1, "nadph_c": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-5083", "notes": {"BIOCYC": ["PYRNUTRANSHYDROGEN-RXN"], "CONFIDENCE LEVEL": ["2"], "EC NUMBER": ["1.6.1.1/1.6.1.2/1.6.1.3"], "KEGG": ["R00112"], "RHEA": ["11692"], "map_info": {"cofactors": {"nadh_c": {}, "nadph_c": {}}, "hidden": true, "reversibility": true}, "orig_id": "PYRNUTRANSHYDROGEN-RXN"}}, {"id": "NH4t", "name": "TRANS-RXN0-206", "metabolites": {"nh4_c": 1, "nh4_e": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"BIOCYC": ["TRANS-RXN0-206"], "CONFIDENCE LEVEL": ["2"], "map_info": {"hidden": true, "reversibility": true}, "orig_id": "TRANS-RXN0-206"}}, {"id": "O2t", "name": "TRANS-RXN0-474", "metabolites": {"o2_c": 1, "o2_e": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"BIOCYC": ["TRANS-RXN0-474"], "CONFIDENCE LEVEL": ["0"], "map_info": {"hidden": true, "reversibility": true}, "orig_id": "TRANS-RXN0-474"}}, {"id": "PC", "name": "PYRUVATE-CARBOXYLASE-RXN", "metabolites": {"adp_c": 1, "atp_c": -1, "h_c": 1, "hco3_c": -1, "oaa_c": 1, "pi_c": 1, "pyr_c": -1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "P42-PWY, PWY66-399, PWY-6146, PWY-6142, PWY-5750", "notes": {"BIOCYC": ["PYRUVATE-CARBOXYLASE-RXN"], "CONFIDENCE LEVEL": ["2"], "EC NUMBER": ["6.4.1.1"], "KEGG": ["R00344"], "RHEA": ["20844"], "map_info": {"cofactors": {"atp_c": {"x": 508.0035104149847, "y": 529.3038878985418}, "hco3_c": {"x": 487.52963663200785, "y": 544.852974568623}}, "group": 6, "reversibility": false, "x": 544.712553758037, "y": 490.78438032301176}, "orig_id": "PYRUVATE-CARBOXYLASE-RXN"}}, {"id": "PDH", "name": "PYRUVDEH-RXN", "metabolites": {"accoa_c": 1, "co2_c": 1, "coa_c": -1, "nad_c": -1, "nadh_c": 1, "pyr_c": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-7384, PWY-7218, PWY-6886, GLYCOLYSIS-TCA-GLYOX-BYPASS, PWY-5537, PWY-5482", "notes": {"BIOCYC": ["PYRUVDEH-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["1.2.1.-"], "KEGG": ["R00209"], "RHEA": ["28042"], "map_info": {"cofactors": {"co2_c": {"x": 454.65352078804676, "y": 491.3335473522898}, "nadh_c": {"x": 486.0789644721509, "y": 474.1524206762996}}, "group": 5, "reversibility": true, "x": 422.3566053847384, "y": 463.62661361736286}, "orig_id": "PYRUVDEH-RXN"}}, {"id": "PGI", "name": "PGLUCISOM-RXN", "metabolites": {"f6p_c": 1, "g6p_c": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-622, GLYCOLYSIS, ANAGLYCOLYSIS-PWY, PWY-7347, PWY-5514, PWY-7385, SUCSYN-PWY, PWY-621, UDPNAGSYN-PWY, PWY-7238, GLUCONEO-PWY, PWY-6981, PWY-6142, P124-PWY, PWY-5659, P341-PWY, RUMP-PWY, P122-PWY, PWY-5384, PWY-5054", "notes": {"BIOCYC": ["PGLUCISOM-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["5.3.1.9"], "KEGG": ["R00771"], "RHEA": ["11816"], "map_info": {"group": 2, "reversibility": true, "x": 116.71315563966994, "y": 191.31343033849578}, "orig_id": "PGLUCISOM-RXN"}}, {"id": "PGLCNDH", "name": "", "metabolites": {"6p2dhglcn_c": -1, "6pgc_c": 1, "h_c": 2, "nadp_c": 1, "nadph_c": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"cofactors": {"nadph_c": {"x": 482.8727415318293, "y": 264.8072333689067}}, "group": 4, "reversibility": true, "x": 432.1956466282303, "y": 272.17772928318766}}}, {"id": "PGLUCONDEHYDRAT", "name": "PGLUCONDEHYDRAT-RXN", "metabolites": {"2ddg6p_c": 1, "6pgc_c": -1, "h2o_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "ENTNER-DOUDOROFF-PWY", "notes": {"BIOCYC": ["PGLUCONDEHYDRAT-RXN"], "CONFIDENCE LEVEL": ["2"], "EC NUMBER": ["4.2.1.12"], "KEGG": ["R02036"], "RHEA": ["17277"], "map_info": {"group": 4, "reversibility": false, "x": 397.28246999453165, "y": 367.9547027749643}, "orig_id": "PGLUCONDEHYDRAT-RXN"}}, {"id": "PIt2r", "name": "TRANS-RXN-114", "metabolites": {"h_c": 1, "h_e": -1, "pi_c": 1, "pi_e": -1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"BIOCYC": ["TRANS-RXN-114"], "CONFIDENCE LEVEL": ["2"], "map_info": {"hidden": true, "reversibility": false}, "orig_id": "TRANS-RXN-114"}}, {"id": "PPC", "name": "PEPCARBOX-RXN", "metabolites": {"hco3_c": -1, "oaa_c": 1, "pep_c": -1, "pi_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-1622, PWY-7117, PWY-7115, PWY-241, PWY-5913, P23-PWY, PWY-7124, PWY-6146, PWY-6142, PWYQT-4429, PWY-6549, FERMENTATION-PWY", "notes": {"BIOCYC": ["PEPCARBOX-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["4.1.1.31"], "KEGG": ["R00345"], "map_info": {"cofactors": {"hco3_c": {"x": 504.82567834484064, "y": 591.4641425827806}}, "group": 6, "reversibility": false, "x": 565.9245231875734, "y": 538.8012332743394}, "orig_id": "PEPCARBOX-RXN"}}, {"id": "PPCK", "name": "PEPCARBOXYKIN-RXN", "metabolites": {"adp_c": 1, "atp_c": -1, "co2_c": 1, "oaa_c": -1, "pep_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-7117, GLUCONEO-PWY, PWY-561", "notes": {"BIOCYC": ["PEPCARBOXYKIN-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["4.1.1.49"], "KEGG": ["R00341"], "RHEA": ["18617"], "map_info": {"cofactors": {"atp_c": {"x": 658.7416541621698, "y": 545.3093456092739}, "co2_c": {"x": 577.0755163410221, "y": 634.6549868542099}}, "group": 6, "reversibility": false, "x": 607.4786888943325, "y": 597.5909818065343}, "orig_id": "PEPCARBOXYKIN-RXN"}}, {"id": "PCATDC", "name": "PROTOCATECHUATE-DECARBOXYLASE-RXN", "metabolites": {"34dhbz_c": -1, "catechol_c": 1, "co2_c": 1, "h_c": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"BIOCYC": ["PROTOCATECHUATE-DECARBOXYLASE-RXN"], "CONFIDENCE LEVEL": ["0"], "EC NUMBER": ["4.1.1.63"], "KEGG": ["R00822"], "RHEA": ["22416"], "map_info": {"align": "lower center", "cofactors": {"co2_c": {"x": 688.0713493901226, "y": 782.728443691234}}, "display_name": "AroY", "group": 8, "reversibility": true, "x": 636.4884320271109, "y": 762.877900929361}, "orig_id": "PROTOCATECHUATE-DECARBOXYLASE-RXN"}}, {"id": "PYK", "name": "PEPDEPHOS-RXN", "metabolites": {"adp_c": -1, "atp_c": 1, "h_c": -1, "pep_c": -1, "pyr_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "GLYCOLYSIS, PWY-5484, ANAGLYCOLYSIS-PWY, PWY-7003, PWY-7383, PWY66-400, PWY-6901, PWY-2221, NPGLUCAT-PWY, PWY-7218, PWY-6142, PWY-6886, PWY-5723, P124-PWY, FERMENTATION-PWY, P341-PWY, P122-PWY, PWY-1042", "notes": {"BIOCYC": ["PEPDEPHOS-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["2.7.1.40"], "KEGG": ["R00200"], "RHEA": ["18157"], "map_info": {"cofactors": {"atp_c": {"x": 414.85951218368245, "y": 565.0030599445818}}, "group": 2, "reversibility": false, "x": 384.5756071925602, "y": 575.7309109338713}, "orig_id": "PEPDEPHOS-RXN"}}, {"id": "PYRt2", "name": "R_eyruvate_transport_in_via_eroton_symport", "metabolites": {"h_c": 1, "h_e": -1, "pyr_c": 1, "pyr_e": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": true}, "original_bigg_id": "PYRt2r"}}, {"id": "RPE", "name": "RIBULP3EPIM-RXN", "metabolites": {"ru5p__D_c": -1, "xu5p__D_c": 1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "CALVIN-PWY, PWY-5723, NONOXIPENT-PWY, P124-PWY, P185-PWY, PWY-1861, P21-PWY, P122-PWY", "notes": {"BIOCYC": ["RIBULP3EPIM-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["5.1.3.1"], "KEGG": ["R01529"], "RHEA": ["13677"], "map_info": {"group": 3, "reversibility": true, "x": 252.26334126446113, "y": 364.82032031261105}, "orig_id": "RIBULP3EPIM-RXN"}}, {"id": "RPI", "name": "RIB5PISOM-RXN", "metabolites": {"r5p_c": -1, "ru5p__D_c": 1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "CALVIN-PWY, PWY-5723, NONOXIPENT-PWY, P124-PWY, P185-PWY, PWY-1861", "notes": {"BIOCYC": ["RIB5PISOM-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["5.3.1.6"], "KEGG": ["R01056"], "RHEA": ["14657"], "map_info": {"group": 3, "reversibility": true, "x": 280.1755840324833, "y": 395.9755800572946}, "orig_id": "RIB5PISOM-RXN"}}, {"id": "SUCCt2_2", "name": "TRANS-RXN-121", "metabolites": {"h_c": 2, "h_e": -2, "succ_c": 1, "succ_e": -1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"BIOCYC": ["TRANS-RXN-121"], "CONFIDENCE LEVEL": ["4"], "map_info": {"hidden": true, "reversibility": false}, "orig_id": "TRANS-RXN-121"}}, {"id": "SUCCt3", "name": "succinate transport out via proton antiport", "metabolites": {"h_c": 1, "h_e": -1, "succ_c": -1, "succ_e": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": false}, "original_bigg_id": "SUCCt3"}}, {"id": "TALA", "name": "TRANSALDOL-RXN", "metabolites": {"e4p_c": 1, "f6p_c": 1, "g3p_c": -1, "s7p_c": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "P185-PWY, PWY-5723, NONOXIPENT-PWY, P124-PWY, PWY-1861", "notes": {"BIOCYC": ["TRANSALDOL-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["2.2.1.2"], "KEGG": ["R01827"], "RHEA": ["17053"], "map_info": {"group": 3, "reversibility": true, "x": 88.36951105966634, "y": 399.5427773322028}, "orig_id": "TRANSALDOL-RXN"}}, {"id": "THD2", "name": "TRANS-RXN0-277", "metabolites": {"h_c": 1, "h_e": -1, "nad_c": 1, "nadh_c": -1, "nadp_c": -1, "nadph_c": 1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "NADPHOS-DEPHOS-PWY-1, NADPHOS-DEPHOS-PWY", "notes": {"BIOCYC": ["TRANS-RXN0-277"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["1.6.1.2"], "map_info": {"cofactors": {"nadh_c": {}, "nadph_c": {}}, "hidden": true, "reversibility": false}, "orig_id": "TRANS-RXN0-277"}}, {"id": "TKT1", "name": "1TRANSKETO-RXN", "metabolites": {"g3p_c": -1, "r5p_c": 1, "s7p_c": -1, "xu5p__D_c": 1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "CALVIN-PWY, PWY-5723, NONOXIPENT-PWY, P124-PWY, P185-PWY, PWY-1861, P21-PWY", "notes": {"BIOCYC": ["1TRANSKETO-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["2.2.1.1"], "KEGG": ["R01641"], "RHEA": ["10508"], "map_info": {"group": 3, "reversibility": true, "x": 231.06688662141812, "y": 443.28124293668486}, "orig_id": "_1TRANSKETO-RXN"}}, {"id": "TKT2", "name": "2TRANSKETO-RXN", "metabolites": {"e4p_c": -1, "f6p_c": 1, "g3p_c": 1, "xu5p__D_c": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "PWY-6901, CALVIN-PWY, PWY-5723, NONOXIPENT-PWY, P185-PWY, PWY-1861, P21-PWY", "notes": {"BIOCYC": ["2TRANSKETO-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["2.2.1.1"], "KEGG": ["R01067"], "RHEA": ["27626"], "map_info": {"group": 3, "reversibility": true, "x": 161.4510433130614, "y": 329.14486542413476}, "orig_id": "_2TRANSKETO-RXN"}}, {"id": "TPI", "name": "TRIOSEPISOMERIZATION-RXN", "metabolites": {"dhap_c": 1, "g3p_c": -1}, "lower_bound": -1000.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "subsystem": "GLYCOLYSIS, PWY-5484, ANAGLYCOLYSIS-PWY, PWY-7003, PWY66-400, PWY66-373, PWY66-399, GLUCONEO-PWY, PWY-6142, CALVIN-PWY, P341-PWY, P185-PWY, PWY-1042", "notes": {"BIOCYC": ["TRIOSEPISOMERIZATION-RXN"], "CONFIDENCE LEVEL": ["4"], "EC NUMBER": ["5.3.1.1"], "KEGG": ["R01015"], "RHEA": ["18585"], "map_info": {"group": 2, "reversibility": true, "x": 164.62229295088235, "y": 564.8634819707205}, "orig_id": "TRIOSEPISOMERIZATION-RXN"}}, {"id": "muconate_sink", "name": "muconate_sink", "metabolites": {"ccmuac_c": -1}, "lower_bound": 0.0, "upper_bound": 1000.0, "gene_reaction_rule": "", "notes": {"map_info": {"hidden": true, "reversibility": false}}}], "genes": [], "id": "putida_core", "compartments": {"c": "", "e": ""}, "notes": {"map_info": {"figsize": [950, 800], "fontsize": 15}}};

require.config({
  paths: {
    d3: "https://d3js.org/d3.v3.min",
    cola: "https://ialab.it.monash.edu/webcola/cola.min",
    math: "https://cdnjs.cloudflare.com/ajax/libs/mathjs/7.6.0/math.min",
    FileSaver: "https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.2/FileSaver.min",
  },
  shim: {
    'cola': {
      exports: 'cola'
    }
  }
});

require(["cola", "d3", "math", "FileSaver", ], function (cola, d3, math, FileSaver) {

  function main(model) {
    // Render a metabolic network representation of a cobra.Model object.
    //
    // `model` is a json-serialized representation of a metabolic network,
    // generated by cobra.display.flux_analysis.create_model_json

    // Height and width of the SVG figure, passed via jinja2
    var width = 1280,
    height = 1024;

    // var color = d3.scale.category10();

    // Reaction color allows different reaction groups to be colored
    // accordingly. Grouping is mainly handled by color_redox_reactions. First
    // group ('undefined') is for normal reactions (gray). Second group is for
    // knocked-out reactions, (red). Others are rendered in different
    // contrasting colors
    var rxncolor = d3.scale.ordinal()
      // .range(["#bbb", "#d62728", "#ff7f0e", "#2ca02c", "#9467bd",
      //         "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf"])
      .range(["#bbb", "#d62728",
        "#eb6a9b",
        "#6f3589",
        "#f18572",
        "#246035",
        "#009fea",
        "#83522b",
        "#29378a",
        "#989033"])
      .domain([undefined, 'ko', 1, 2, 3, 4, 5, 6, 7, 8]);

    // Initialize the d3 force diagram. Parameters like charge, gavity, and
    // link distance are currently hard-coded in -- probably should change
    // this?
    var force = cola.d3adaptor()
      .linkDistance(30)
      
      .size([width, height]);
    // var force = d3.layout.force()
    //   .linkDistance(30)
    //   .charge(-100)
    //   .chargeDistance(400)
    //   .gravity(.015)
    //   .size([width, height]);

    // Allow for a background SVG template if one has been provided, otherwise
    // initalize the svg canvas
    if (true) {
      var svg = d3.select("#d3flux001").append("svg")
        .attr("viewBox", "0 0 1280 1024")
        .attr("style", "display:block;margin:auto;width:100%");
    } else {
      var svg = d3.select("#d3flux001").select("svg");
    }

    // Append the CSS styles
    svg.append("style").text('.node.rxn{fill:#ffa319}.node.rxn.hidden{fill:none;stroke:none;stroke-width:0}.link{fill:none;stroke-linecap:round}text.nodelabel{font-size:15pt;fill:#555;font-family:Arial}text.nodelabel.cofactor{font-size:12.0pt;fill:#789}text.nodelabel.rxn{fill:#a9a9a9;font-size:12.0pt;font-style:italic}marker.inactive,.node.inactive,text.inactive{fill-opacity:.5}.link.inactive{stroke-opacity:.5}.d3-tip{line-height:1;font-weight:bold;padding:12px;background:rgba(0,0,0,0.8);color:#fff;border-radius:2px}.d3-tip:after{box-sizing:border-box;display:inline;font-size:10px;width:100%;line-height:1;color:rgba(0,0,0,0.8);position:absolute;text-align:center}.d3-tip.n:after{margin:-1px 0 0 0;top:100%;left:0}svg{z-index:5}#content-area{margin-top:100px}#vismap-sidebar{position:fixed;top:51px;bottom:0;right:0;z-index:1000;display:block;padding:20px;overflow-x:hidden;overflow-y:auto;border-right:1px solid #eee}.menu_item{cursor:pointer}');


    // Zoom function
    svg_panel = d3.select("#svg_panel");
    var zoom = d3.behavior.zoom().scaleExtent([0.5, 4]).on("zoom", zoomed);
    function zoomed() {
      svg.attr("transform",
          "translate(" + zoom.translate() + ")" +
          "scale(" + zoom.scale() + ")"
      );
    }
  
    function interpolateZoom (translate, scale) {
        var self = this;
        return d3.transition().duration(350).tween("zoom", function () {
            var iTranslate = d3.interpolate(zoom.translate(), translate),
                iScale = d3.interpolate(zoom.scale(), scale);
            return function (t) {
                zoom
                    .scale(iScale(t))
                    .translate(iTranslate(t));
                zoomed();
            };
        });
    }

    function zoomClick() {
      var clicked = d3.event.target,
          direction = 1,
          factor = 0.2,
          target_zoom = 1,
          center = [width / 2, height / 2],
          extent = zoom.scaleExtent(),
          translate = zoom.translate(),
          translate0 = [],
          l = [],
          view = {x: translate[0], y: translate[1], k: zoom.scale()};
  
      d3.event.preventDefault();
      direction = (this.id === 'zoom_in') ? 1 : -1;
      target_zoom = zoom.scale() * (1 + factor * direction);
  
      if (target_zoom < extent[0] || target_zoom > extent[1]) { return false; }
  
      translate0 = [(center[0] - view.x) / view.k, (center[1] - view.y) / view.k];
      view.k = target_zoom;
      l = [translate0[0] * view.k + view.x, translate0[1] * view.k + view.y];
  
      view.x += center[0] - l[0];
      view.y += center[1] - l[1];
  
      interpolateZoom([view.x, view.y], view.k);
  }
  

  var zoomEnabled = false;
  var zoomToggle = d3.select('#cb-zoom').on('click', toggleZoom);
  toggleZoom();

  function toggleZoom() {
    if (zoomEnabled) {
      svg.call(zoom);
    } else {
      svg.on('.zoom', null);
    }
    zoomEnabled = !zoomEnabled;
  };

                        
  d3.selectAll('.zoom_button').on('click', zoomClick);

  // svg.call(zoom);


    d3.select("#d3flux001_options .svgbutton").on("click", function() { 
      // Download the svg using SVG Crowbar. This is still very buggy.

      var e = document.createElement('script'); 
      e.setAttribute('src', 'https://rawgit.com/pstjohn/svg-crowbar/gh-pages/svg-crowbar.js'); 
      e.setAttribute('class', 'svg-crowbar'); 
      document.body.appendChild(e); 
    });

    function calc_imag_angle(x1, y1, x2, y2) {
      // Function to calculate the imaginary angle of the line between two
      // points. Used to find the average direction to the metabolites of a
      // reaction node
      var calcAngleVal = Math.atan2(x1-x2,y1-y2);
      return math.exp(math.multiply(math.i, calcAngleVal));
    }

    function average_angles(rxn, rstoich, nodes) {
      // Find the slope of the line through the reaction node as a function of
      // the current position of the metabolites. Reactants and products are
      // separated and placed on opposite ends of the nodes.
      //
      // Looks like for cofactors, rstoich could be set to zero to remove the
      // effect on the reaction slope. 
      var angles = []
      for (var n in rstoich) {
        if (!('cofactor' in nodes[n])) {
          var angle = calc_imag_angle(rxn.x, rxn.y, nodes[n].x, nodes[n].y);
          angles.push([math.multiply(angle, rstoich[n])]);
        }
      }
      return math.mean(angles).toPolar().phi;
    }

    function average_dist(rxn, rstoich, nodes) {
      // Calculate the average distance to the reaction nodes, which is used to
      var dist = []
      for (var n in rstoich) {
        var this_dist = math.sqrt(math.square(rxn.x - nodes[n].x) 
            + math.square(rxn.y - nodes[n].y));
        dist.push([this_dist]);
      }
      return math.mean(dist);
    }

    function calculate_path(d, force) {
      var s = d.source,
      t = d.target,
      r = d.rxn,
      a=.1, b=.1,
      cp_inv = {};

      var angle = average_angles(r, d.rstoich, force.nodes());
      var dist = average_dist(r, d.rstoich, force.nodes());

      cp = new Point2D(r.x - math.multiply(.5*dist, math.sin(angle)),
                 r.y - math.multiply(.5*dist, math.cos(angle)));

      cp_inv = new Point2D(r.x + math.multiply(.5*dist, math.sin(angle)),
                     r.y + math.multiply(.5*dist, math.cos(angle)));

      s_point = new Point2D(s.x, s.y)
      r_point = new Point2D(r.x, r.y)
      t_point = new Point2D(t.x, t.y)

      var padding = 5;
      // var total_len = quadraticBezierLength(s, cp, r) + quadraticBezierLength(r, cp_inv, t);


      // Adjust control points to start late and stop early
      if (plot_reverse_arrowhead(d.rxn)) {

        first_intersect = Intersection.intersectBezier2Circle(
    s_point, cp, r_point, s_point, 
    padding + arrowhead_scale(get_flux_width(d.rxn)) + get_node_radius(s)).slice(0)[0];
        last_intersect = Intersection.intersectBezier2Circle(
    r_point, cp_inv, t_point, t_point, 
    padding + arrowhead_scale(get_flux_width(d.rxn)) + get_node_radius(t)).slice(-1)[0];
        a = first_intersect;
        b = last_intersect;

      }
      else {

        first_intersect = Intersection.intersectBezier2Circle(
    s_point, cp, r_point, s_point, padding + get_node_radius(s)).slice(0)[0];
        last_intersect = Intersection.intersectBezier2Circle(
    r_point, cp_inv, t_point, t_point,
    padding + arrowhead_scale(get_flux_width(d.rxn)) + get_node_radius(t)).slice(-1)[0];
        a = first_intersect;
        b = last_intersect;

        // b = 1 - (padding + arrowhead_scale(get_flux_width(d.rxn)))/total_len;
      }
            
      var source_x = s.x*a**2 - 2*s.x*a + s.x - 2*cp.x*a**2 + 2*cp.x*a + r.x*a**2;
      var source_y = s.y*a**2 - 2*s.y*a + s.y - 2*cp.y*a**2 + 2*cp.y*a + r.y*a**2;

      var cp_x = -cp.x*a + cp.x + r.x*a;
      var cp_y = -cp.y*a + cp.y + r.y*a;

      var cp_inv_x = -r.x*b + r.x + cp_inv.x*b
      var cp_inv_y = -r.y*b + r.y + cp_inv.y*b

      var target_x = r.x*b**2 - 2*r.x*b + r.x - 2*cp_inv.x*b**2 + 2*cp_inv.x*b + t.x*b**2;
      var target_y = r.y*b**2 - 2*r.y*b + r.y - 2*cp_inv.y*b**2 + 2*cp_inv.y*b + t.y*b**2;

      if ( isFinite(source_x) & isFinite(cp_x) & isFinite(cp_inv_x) & isFinite(target_x) ) {
        return "M" + source_x + "," + source_y
          + " Q" + cp_x + "," + cp_y
          + " " + r.x + "," + r.y
          + " Q" + cp_inv_x + "," + cp_inv_y
          +" " + target_x + "," + target_y;
      } else {
        return "M" + s.x + "," + s.y
          + " L" + r.x + "," + r.y
          +" L" + t.x + "," + t.y;
      }
    }


// d3.tip
// Copyright (c) 2013 Justin Palmer
//
// Tooltips for d3.js SVG visualizations

// Public - contructs a new tooltip
//
// Returns a tip
d3.tip = function() {
  var direction = d3_tip_direction,
      offset    = d3_tip_offset,
      html      = d3_tip_html,
      node      = initNode(),
      svg       = null,
      point     = null,
      target    = null

  function tip(vis) {
    svg = getSVGNode(vis)
    point = svg.createSVGPoint()
    document.body.appendChild(node)
  }

  // Public - show the tooltip on the screen
  //
  // Returns a tip
  tip.show = function() {
    var args = Array.prototype.slice.call(arguments)
    if(args[args.length - 1] instanceof SVGElement) target = args.pop()

    var content = html.apply(this, args),
        poffset = offset.apply(this, args),
        dir     = direction.apply(this, args),
        nodel   = d3.select(node), i = 0,
        coords

    nodel.html(content)
      .style({ opacity: 1, 'pointer-events': 'all' })

    while(i--) nodel.classed(directions[i], false)
    coords = direction_callbacks.get(dir).apply(this)
    nodel.classed(dir, true).style({
      top: (coords.top +  poffset[0]) + 'px',
      left: (coords.left + poffset[1]) + 'px'
    })

    return tip
  }

  // Public - hide the tooltip
  //
  // Returns a tip
  tip.hide = function() {
    nodel = d3.select(node)
    nodel.style({ opacity: 0, 'pointer-events': 'none' })
    return tip
  }

  // Public: Proxy attr calls to the d3 tip container.  Sets or gets attribute value.
  //
  // n - name of the attribute
  // v - value of the attribute
  //
  // Returns tip or attribute value
  tip.attr = function(n, v) {
    if (arguments.length < 2 && typeof n === 'string') {
      return d3.select(node).attr(n)
    } else {
      var args =  Array.prototype.slice.call(arguments)
      d3.selection.prototype.attr.apply(d3.select(node), args)
    }

    return tip
  }

  // Public: Proxy style calls to the d3 tip container.  Sets or gets a style value.
  //
  // n - name of the property
  // v - value of the property
  //
  // Returns tip or style property value
  tip.style = function(n, v) {
    if (arguments.length < 2 && typeof n === 'string') {
      return d3.select(node).style(n)
    } else {
      var args =  Array.prototype.slice.call(arguments)
      d3.selection.prototype.style.apply(d3.select(node), args)
    }

    return tip
  }

  // Public: Set or get the direction of the tooltip
  //
  // v - One of n(north), s(south), e(east), or w(west), nw(northwest),
  //     sw(southwest), ne(northeast) or se(southeast)
  //
  // Returns tip or direction
  tip.direction = function(v) {
    if (!arguments.length) return direction
    direction = v == null ? v : d3.functor(v)

    return tip
  }

  // Public: Sets or gets the offset of the tip
  //
  // v - Array of [x, y] offset
  //
  // Returns offset or
  tip.offset = function(v) {
    if (!arguments.length) return offset
    offset = v == null ? v : d3.functor(v)

    return tip
  }

  // Public: sets or gets the html value of the tooltip
  //
  // v - String value of the tip
  //
  // Returns html value or tip
  tip.html = function(v) {
    if (!arguments.length) return html
    html = v == null ? v : d3.functor(v)

    return tip
  }

  function d3_tip_direction() { return 'n' }
  function d3_tip_offset() { return [0, 0] }
  function d3_tip_html() { return ' ' }

  var direction_callbacks = d3.map({
    n:  direction_n,
    s:  direction_s,
    e:  direction_e,
    w:  direction_w,
    nw: direction_nw,
    ne: direction_ne,
    sw: direction_sw,
    se: direction_se
  }),

  directions = direction_callbacks.keys()

  function direction_n() {
    var bbox = getScreenBBox()
    return {
      top:  bbox.n.y - node.offsetHeight,
      left: bbox.n.x - node.offsetWidth / 2
    }
  }

  function direction_s() {
    var bbox = getScreenBBox()
    return {
      top:  bbox.s.y,
      left: bbox.s.x - node.offsetWidth / 2
    }
  }

  function direction_e() {
    var bbox = getScreenBBox()
    return {
      top:  bbox.e.y - node.offsetHeight / 2,
      left: bbox.e.x
    }
  }

  function direction_w() {
    var bbox = getScreenBBox()
    return {
      top:  bbox.w.y - node.offsetHeight / 2,
      left: bbox.w.x - node.offsetWidth
    }
  }

  function direction_nw() {
    var bbox = getScreenBBox()
    return {
      top:  bbox.nw.y - node.offsetHeight,
      left: bbox.nw.x - node.offsetWidth
    }
  }

  function direction_ne() {
    var bbox = getScreenBBox()
    return {
      top:  bbox.ne.y - node.offsetHeight,
      left: bbox.ne.x
    }
  }

  function direction_sw() {
    var bbox = getScreenBBox()
    return {
      top:  bbox.sw.y,
      left: bbox.sw.x - node.offsetWidth
    }
  }

  function direction_se() {
    var bbox = getScreenBBox()
    return {
      top:  bbox.se.y,
      left: bbox.e.x
    }
  }

  function initNode() {
    var node = d3.select(document.createElement('div'))
    node.style({
      position: 'absolute',
      opacity: 0,
      pointerEvents: 'none',
      boxSizing: 'border-box'
    })

    return node.node()
  }

  function getSVGNode(el) {
    el = el.node()
    if(el.tagName.toLowerCase() == 'svg')
      return el

    return el.ownerSVGElement
  }

  // Private - gets the screen coordinates of a shape
  //
  // Given a shape on the screen, will return an SVGPoint for the directions
  // n(north), s(south), e(east), w(west), ne(northeast), se(southeast), nw(northwest),
  // sw(southwest).
  //
  //    +-+-+
  //    |   |
  //    +   +
  //    |   |
  //    +-+-+
  //
  // Returns an Object {n, s, e, w, nw, sw, ne, se}
  function getScreenBBox() {
    var targetel   = target || d3.event.target,
        bbox       = {},
        matrix     = targetel.getScreenCTM(),
        tbbox      = targetel.getBBox(),
        width      = tbbox.width,
        height     = tbbox.height,
        x          = tbbox.x,
        y          = tbbox.y,
        scrollTop  = document.documentElement.scrollTop || document.body.scrollTop,
        scrollLeft = document.documentElement.scrollLeft || document.body.scrollLeft


    point.x = x + scrollLeft
    point.y = y + scrollTop
    bbox.nw = point.matrixTransform(matrix)
    point.x += width
    bbox.ne = point.matrixTransform(matrix)
    point.y += height
    bbox.se = point.matrixTransform(matrix)
    point.x -= width
    bbox.sw = point.matrixTransform(matrix)
    point.y -= height / 2
    bbox.w  = point.matrixTransform(matrix)
    point.x += width
    bbox.e = point.matrixTransform(matrix)
    point.x -= width / 2
    point.y -= height / 2
    bbox.n = point.matrixTransform(matrix)
    point.y += height
    bbox.s = point.matrixTransform(matrix)

    return bbox
  }

  return tip
};



    // _note: return a boolean of whether to draw reverse arrowhead
    function plot_reverse_arrowhead(rxn) {
     return (((Math.abs(rxn.notes.map_info.flux) < 1E-8) || isNaN(rxn.notes.map_info.flux))
      && rxn.notes.map_info.reversibility);
    }

    // _note: need to distinguish links and bilinks
    // _ans: links include the edge between a source node and a reaction node.
    metabolites = jQuery.extend(true, [], model.metabolites),
    reactions = jQuery.extend(true, [], model.reactions),
    nodes = [],
    node_lookup = {},
    links = [],
    mlinks = [],
    bilinks = []
    rxn_stoich = {};

    var mfluxes = [];
    metabolites.forEach(function(metabolite) {
      if ('notes' in metabolite) {
        if ('map_info' in metabolite.notes) {
          if (metabolite.notes.map_info.hidden) {
            return;
          } else {
            if (false && (Math.abs(metabolite.notes.map_info.flux) < 1E-6)) {
              return;
            }
            mfluxes.push(Math.abs(metabolite.notes.map_info.flux));
          }
        }
      }
      // It's not hidden, add it to the nodes
      metabolite.type = "metabolite";
      nodes.push(metabolite);
    });

    // Create a dictionary-like structure to allow us to look up nodes by their
    // id, rather than numerical index
    for (var i = 0, len = nodes.length; i < len; i++) {
      var node = nodes[i]
      node_lookup[node.id] = i;
    }

    // Handle cofactor metabolites
    reactions.forEach(function(reaction) {
      if ('notes' in reaction) {
        if ('map_info' in reaction.notes) {
          if ('hidden' in reaction.notes.map_info) {
            if (reaction.notes.map_info.hidden) {
              return;
            }
          }
          if (false &&
              (Math.abs(reaction.notes.map_info.flux) < 1E-6)) {
            return;
          } 
          if ('cofactors' in reaction.notes.map_info) {
            for (var cofactor in reaction.notes.map_info.cofactors) {

              var orig_metabolite = obj = $.grep(model.metabolites,
                  function(e){ return e.id == cofactor; })[0];
              var cf_id = cofactor + '_' + reaction.id;

              var cofactor_node = {
                'id' : cf_id,
                'name' : orig_metabolite.name,
                'type' : "cofactor",
                'notes' : {
                  'map_info' : reaction.notes.map_info.cofactors[cofactor],
                  'orig_id' : cofactor
                },
                'cofactor' : reaction.id
              };

              if ('flux' in orig_metabolite.notes.map_info) {
                cofactor_node.notes.map_info['flux'] = orig_metabolite.notes.map_info.flux;
              }

              // Inheret color from original metabolite
              if ('color' in orig_metabolite.notes.map_info) {
                cofactor_node.notes.map_info.color = 
                  orig_metabolite.notes.map_info.color;
              }

              // Get the cofactor display name from the original 
              // metabolite node
              if ('map_info' in orig_metabolite.notes) {
                if (('display_name' in orig_metabolite.notes.map_info) &
	            !('display_name' in cofactor_node.notes.map_info)) {
                  cofactor_node.notes.map_info.display_name =
                    orig_metabolite.notes.map_info.display_name;
                }
              }

              reaction.metabolites[cf_id] = reaction.metabolites[cofactor];
              delete reaction.metabolites[cofactor];

              // Update nodes and node_lookup table
              nodes.push(cofactor_node);
              node_lookup[cf_id]  = nodes.length - 1;

            }
          }
        }
      }
    });


    // Create a dictionary-like structure to allow us to look up nodes by their
    // id, rather than numerical index
    // for (var i = 0, len = nodes.length; i < len; i++) {
    //   var node = nodes[i]
    //   node_lookup[node.id] = i;
    // }

    var fluxes = [];
    reactions.forEach(function(reaction) {

      // Don't add hidden reactions
      if ('notes' in reaction) {
        if ('map_info' in reaction.notes) {
          if (reaction.notes.map_info.hidden) {
            return;
          } else if ('flux' in reaction.notes.map_info) {
            if (false && (Math.abs(reaction.notes.map_info.flux) < 1E-6)) {
              return;
            }
            fluxes.push(Math.abs(reaction.notes.map_info.flux));
            if (reaction.notes.map_info.flux < -1E-10) {
              // If the reaction is flowing in reverse, switch products and
              // reactants.
              for (var item in reaction.metabolites) {
                reaction.metabolites[item] *= -1;
              }
            }
          }
        }
      }

      // !important
      reaction['reactants'] = []
      reaction['products'] = []

      for (var item in reaction.metabolites) {
        if (reaction.metabolites[item] > 0) {
          if (item in node_lookup) {
            // _notes: reaction.metabolites[item] = 1 -> product, = -1 -> reactant
            // Only add if the node hasn't been hidden
            reaction.products.push(item);
          }
        } else if (item in node_lookup) {
          reaction.reactants.push(item);
        }
      }

      var r_length = reaction.reactants.length,
      p_length = reaction.products.length,
      r_node = {
        "id" : reaction.id,
        "type" : "rxn"
      };

      // Add notes to reaction, if it exists (for map_info)
      if ("notes" in reaction) {
        r_node["notes"] = reaction.notes;
      }

      // Don't add links on the boundary
      if (r_length == 0 || p_length == 0) {
        return; 
      }

      // Add reaction to the nodes list, get the current length of the nodes
      // list as the reaction index for later.
      nodes.push(r_node);
      rindex = nodes.length - 1;


      // !important: drawing
      if (r_length >= p_length) {
        reaction.reactants.forEach(function (reactant, i) {
          // Add source -> rxn -> product triplets for drawing the line. For
          // each reactant (product), just get any product (reactant), as the
          // lines will overlap)
          mlinks.push({
            "source" : node_lookup[reactant],
            // _note: ? i % p_length - 1 
            "target" : node_lookup[reaction.products[i % p_length]],
            "rxn" : rindex
        });
      });
      } // else: products > reactants
      else {
        reaction.products.forEach(function (product, i) {
          mlinks.push({
            "source" : node_lookup[reaction.reactants[i % r_length]],
            "target" : node_lookup[product],
            "rxn" : rindex
          });
        });
      }

    });

    // Build the reaction stoichiometry database to remember which nodes are
    // reactants and which are products. Used to calculate path angles.
    // _note: rxn_stoich is the database.
    mlinks.forEach(function(link) {
      if (link.rxn in rxn_stoich) {
        rxn_stoich[link.rxn][link.source] = 1;
        rxn_stoich[link.rxn][link.target] = -1;
      } else {
        rxn_stoich[link.rxn] = {};
        rxn_stoich[link.rxn][link.source] = 1;
        rxn_stoich[link.rxn][link.target] = -1;
      }
    });

    mlinks.forEach(function(link, i) {
      var s = nodes[link.source],
      t = nodes[link.target],
      r = nodes[link.rxn];

      // _note: push 2 objects into links
      links.push({source: s, target: r}, {source: r, target: t});
      //_note: bilinks stand for what?
      bilinks.push({
        "source" : s,
        "target" : t,
        "rxn" : r,
        "rstoich" : rxn_stoich[link.rxn],
        "id": "bilink_" + i
      });
    });

    nodes.forEach( function (node) {
      if ("notes" in node) {
        if ("map_info" in node.notes) {
          if (("x" in node.notes.map_info) && ("y" in node.notes.map_info)) {
            node.x = node.notes.map_info.x;
            node.y = node.notes.map_info.y;
            node.fixed = 1;
          }
        }
      }
    });



    // Modify link strength based on flux:
    // link_strength_scale = d3.scale.pow().exponent(1/2)
    // link_strength_scale = d3.scale.linear()
    //   .domain([d3.min(fluxes), d3.max(fluxes)])
    //   .range([.2, 2]);
    //
    // force
    //   .linkStrength(function (link) {
    //     try {
    //       return link.rxn.notes.map_info.flux;
    //     }
    //     catch(err) {
    //       return 1;
    //     }
    //   });

    force
      .nodes(nodes)
      .links(links)
      .start();

    svg.append("defs").selectAll("marker")
      .data(reactions)
      .enter()
      .append("marker")
      .attr("id", function (d) { return "d3flux001" + d.id; })
      .attr("viewBox", "0 0 10 10")
      .attr("refX", 1)
      .attr("refY", 5)
      .attr("markerUnits", "userSpaceOnUse")
      .attr("markerWidth", "7pt")
      .attr("markerHeight", "7pt")
      .attr("orient", "auto")
      .attr("class", function (d) {
        var labels = "endmarker"
        if ('flux' in d.notes.map_info) {
          // _note: flux = 0 means this reaction is inactive
          if (d.notes.map_info.flux == 0) {
            labels = labels.concat(" inactive");
          }
        }
        return labels;
      })
      .append("path")
      .attr("d", "M 0 0 L 10 5 L 0 10 z");

    svg.append("defs").selectAll("marker")
      .data(reactions)
      .enter()
      .append("marker")
      .attr("id", function (d) { return "d3flux001" + d.id + "_rev"; })
      .attr("viewBox", "0 0 10 10")
      .attr("refX", 9)
      .attr("refY", 5)
      .attr("markerUnits", "userSpaceOnUse")
      .attr("markerWidth", "7pt")
      .attr("markerHeight", "7pt")
      .attr("orient", "auto")
      .attr("class", function (d) {
        var labels = "startmarker"
        if ('flux' in d.notes.map_info) {
          if (d.notes.map_info.flux == 0) {
            labels = labels.concat(" inactive");
          }
        }
        return labels;
      })
      .append("path")
      .attr("d", "M 10,10 0,5 10,0 Z");

    var link = svg.append('g').selectAll(".link")
      .data(bilinks)
      .enter()
      .append("path")
      .attr("class", function (d) {
        var labels = "link d3flux001" + d.rxn.id;
        if ('flux' in d.rxn.notes.map_info) {
          if (d.rxn.notes.map_info.flux == 0) {
            // _note: use labels to select the link.
            labels = labels.concat(" inactive");
          }
        }
        return labels;
      })
      .attr("id", function (d) {
        return d.id;
      })
      .attr("marker-end", function(d) {
        return "url(#d3flux001" + d.rxn.id + ")"; 
      })
      .attr("marker-start", function(d) {
  // Only show the reversible arrow if the reaction isnt carrying flux in
  // a particular direction
        if (plot_reverse_arrowhead(d.rxn)) {
    return "url(#d3flux001" + d.rxn.id + "_rev)";
  }
      });



    var node_drag = force.drag()
      .on("dragstart", dragstart);

    function dragstart(d) {
      d3.select(this).classed("fixed", d.fixed = true);
    }

    function releasenode(d) {
      // of course set the node to fixed so the force doesn't include the node in
      // its auto positioning stuff
      d.fixed = false; 
      force.resume();
    }

    function showInfo(d) {
      return d.id;
    }



// Node hover tooltip
var tip = d3.tip()
  .attr('class', 'd3-tip')
  .offset([10, 0])
  .direction('s')
  .html(function (d) {
    if (d.type == "metabolite") {
      return "<strong>Metabolite:</strong> <span style='color:red'>" + d.id + "</span>" + "<br/><br/>" +
      "<strong>Name:</strong> <span style='color:red'>" + d.name + "</span>" + "<br/><br/>" +
      "<strong>Formula:</strong> <span style='color:red'>" + d.formula + "</span>" + "<br/><br/>" +
      "<strong>Charge:</strong> <span style='color:red'>" + d.charge + "</span>";
    } else
    if (d.type == "rxn") {
      return "<strong>Reaction:</strong> <span style='color:red'>" + d.id + "</span>" + "<br/><br/>" +
      "<strong>Enzymes:</strong> <span style='color:red'>" + d.notes.Enzymes + "</span>" + "<br/><br/>" +
      "<strong>KEGG:</strong> <span style='color:red'>" + d.notes.KEGG + "</span>" + "<br/><br/>" +
      "<strong>MetaCyc:</strong> <span style='color:red'>" + d.notes.MetaCyc + "</span>" + "<br/><br/>" +
      "<strong>original_bigg_id:</strong> <span style='color:red'>" + d.notes.original_bigg_id + "</span>";
    } else
    if (d.type == "cofactor") {
      return "<strong>Cofactor:</strong> <span style='color:red'>" + d.id + "</span>" + "<br/><br/>" +
      "<strong>Name:</strong> <span style='color:red'>" + d.name + "</span>";
    }

    return "<strong>Node:</strong> <span style='color:red'>" + d.id + "</span>";
  })

  // Enable or disable tooltip
  var tipEnalbed;
  var tipToggle = d3.select('#cb-tip').on('click', toggleTip);
  toggleTip();

  function toggleTip(){
    console.log("cb-tip clicked!");
    var node = svg.selectAll(".node");
    tipEnalbed = !tipEnalbed;
    if (tipEnalbed) {
        svg.call(tip);
        node.on('mouseover', tip.show);
        node.on('mouseout', tip.hide);
    } else {
        node.on('mouseover', null);
        node.on('mouseout', null);
    }
    zoomToggle.node().innerText = 'Zoom is ' + (zoomEnabled ? 'enabled' : 'disabled');
}; 

  // svg.call(tip);

    // define the nodes
    var node = svg.append("g").selectAll(".node")
      .data(nodes)
      .enter()
      .append("g")
      .on('dblclick', releasenode)
      .call(node_drag)
      .on('mouseover', tip.show)
      .on('mouseout', tip.hide)
      // hari: how node info on click
      .on("click", function (d) {
        d3.select("#info")
        .property("value", d.id);
        console.log(d.id);
      });


    node.append("circle")
      .attr("class", function(d) {
        var labels = "node";
        if (d.type == 'rxn') {
          labels = labels.concat(" " + d.type + " hidden");
        } else {
          labels = labels.concat(" metabolite");
        }
        if ('flux' in d.notes.map_info) {
          if (d.notes.map_info.flux == 0) {
            labels = labels.concat(" inactive");
          }
        }
        return labels;
      })
      .attr("id", function(d) { return "_" + d.id; })
      .attr("r", 5)
      .style("fill", function(d) { 
        if (d.type != 'rxn') {
          if ('color' in d.notes.map_info) {
            return d.notes.map_info.color;
          } else {
            return '#1f77b4';
          }
        } else return "";
      });

    
    // test            
    // add the text 
    var text = node.append("text")
      .attr("class", function(d) {
        var labels = "nodelabel";
        if ('cofactor' in d) {
          labels = labels.concat(" cofactor");
        }
        if ('flux' in d.notes.map_info) {
          if (d.notes.map_info.flux == 0) {
            labels = labels.concat(" inactive");
          }
        }
        if (d.type == 'rxn') {
	  labels = labels.concat(" rxn");
        }
        return labels;
      })
      .attr("id", function(d) {return d.id})

      .attr("y", function(d) {
        if ('align' in d.notes.map_info) {
          if (d.notes.map_info.align.indexOf("upper") !== -1) {
            return '-.65em';
          }
          else if (d.notes.map_info.align.indexOf("lower") !== -1) {
            return '1.35em';
          }
          else {
            return '.35em';
          }
        } else {
          return '.35em';
        }
      })
      .attr("text-anchor", function(d) {
        if ('align' in d.notes.map_info) {
          if (d.notes.map_info.align.indexOf("left") !== -1) {
            return 'end';
          }
          else if (d.notes.map_info.align.indexOf("center") !== -1) {
            return 'middle';
          }
          else {
            return 'start';
          }
        } else {
          return 'start';
        }
      });
      // .text(function(d) { 
      //   if ('map_info' in d.notes) {
      //     if ('display_name' in d.notes.map_info) {
      //       return d.notes.map_info.display_name;
      //     }}});
      
    text.selectAll("tspan.text")
      .data(function(d) { 
        if ('map_info' in d.notes) {
          if ('display_name' in d.notes.map_info) {
            return d.notes.map_info.display_name.split('\n').map(function(item, index) {
                 return {
                   text : item,
                   notes : d.notes,
                   index : index
                 }})
          }
        }
        // Must not have returned a display name, return the metabolite name
        // instead
        return [{text: d.name, notes: d.notes, index: 0}]; 
      })
      .enter()
      .append("tspan")
      .attr("class", "text")
      .text(d => d.text)
      .attr("dy", function(d) {
        if (d.index == 0) {
          return "0"
        } else {
          return "1.2em"
        }
      })
      .attr("x", function(d) {
        if ('align' in d.notes.map_info) {
          if (d.notes.map_info.align.indexOf("left") !== -1) {
            if ((d.notes.map_info.align.indexOf("upper") !== -1) || 
                (d.notes.map_info.align.indexOf("lower") !== -1)) {
              return '-.6em';
            }
            else {
              return '-.9em';
            }
          }
          else if (d.notes.map_info.align.indexOf("center") !== -1) {
            return '0em';
          }
          else {
            if ((d.notes.map_info.align.indexOf("upper") !== -1) ||
                (d.notes.map_info.align.indexOf("lower") !== -1)) {
              return '.6em';
            }
            else {
              return '.9em';
            }
          }
        }
        else {
          return '.9em';
        }
      });

    var updateNode = function() {
      this.attr("transform", function(d) {
        return "translate(" + Math.max(0, Math.min(width, d.x)) + ","
          + Math.max(0, Math.min(height, d.y)) + ")";
      });
    }

    var updateAnchorLink = function() {
      this.attr("x1", function(d) {
        return d.source.x;
      }).attr("y1", function(d) {
        return d.source.y;
      }).attr("x2", function(d) {
        return d.target.x;
      }).attr("y2", function(d) {
        return d.target.y;
      });
    }

    var updateLink = function() {
        try {
          this.attr("d", function(d) {
            return calculate_path(d, force, Math.max(this.getTotalLength(), 15));
          });
        }
        catch(err) {
          return '';
        }
    }

    var updateAnchorNodes = function() {
      this.each(function(d, i) {
        if(i % 2 == 0) {
          d.x = d.node.x;
          d.y = d.node.y;
        } else {
          var b = this.childNodes[1].getBBox();

          var diffX = d.x - d.node.x;
          var diffY = d.y - d.node.y;

          var dist = Math.sqrt(diffX * diffX + diffY * diffY);

          var shiftX = b.width * (diffX - dist) / (dist * 2);
          shiftX = Math.max(-b.width, Math.min(0, shiftX));
          var shiftY = 5;
          this.childNodes[1].setAttribute("transform", "translate(" + shiftX + "," + shiftY + ")");
        }
      });
    }

    force.on("tick", function() {
      link.call(updateLink);
      node.call(updateNode);
    });

    // flux_scale = d3.scale.pow().exponent(1/2)
    flux_scale = d3.scale.linear()
      .domain([d3.min(fluxes), d3.max(fluxes)])
      .range([1.5, 6]);

    // metabolite_scale = d3.scale.pow().exponent(1/2)
    metabolite_scale = d3.scale.linear()
      .domain([d3.min(mfluxes), d3.max(mfluxes)])
      .range([4, 8]);

    arrowhead_scale = d3.scale.linear()
      .domain([1.5, 6])
      .range([6, 12]);

    function get_flux_width (rxn) {
      try {
        var flux = flux_scale(Math.abs(rxn.notes.map_info.flux));
        if (!isNaN(flux)) {
          return flux;
        } else{
          return 2.5;
        }
      }
      catch(err) {
        return 2.5; // Default linewidth
      }
    }

    function get_flux_dasharray (d) {
      try {
        if (d.rxn.notes.map_info.group == 'ko') {
          return "5, 5, 1, 5";
        }
        else if (Math.abs(d.rxn.notes.map_info.flux) < 1E-6) {
          return "5,5";
        }
      }
      catch(err) {
        return;
      }
    }

    function get_flux_stroke (d) {
      if ('color' in d.notes.map_info) {
        return d.notes.map_info.color;
      } else {
          return rxncolor(d.notes.map_info.group);
        }
    }

    function markerscale (d) {
      return arrowhead_scale(get_flux_width(d)) + "pt";
    }

    function get_node_radius (d) {
      if ('cofactor' in d) {return 4;}
      try {
        var nodewidth = metabolite_scale(Math.abs(d.notes.map_info.flux));
        if (!isNaN(nodewidth)) {
          return nodewidth;
        } else {
          return 5;
        }
      }
      catch(err){ return 5; }
    }



// **************************************************************
// **************************************************************
// **************************************************************
// Author: Haoyu Zhang
// Costom functions for my project VisMap


// Button Behavior

    // Node selection effect
    svg.selectAll("circle").on("mouseover", function(){
        d3.select(this)
        .style("fill", "red");
    })

  //   var focus_node = "null";
  //   svg.selectAll("circle").on("click", function(){
  //     if (focus_node == "null") {
  //       focus_node = d3.select(this);
  //       console.log(focus_node);
  //       d3.select(focus_node)
  //       .style("fill", "red");
  //     }
  //     else {
  //       d3.select(focus_node)
  //       .style("fill", function(d) { 
  //         if (d.type != 'rxn') {
  //           if ('color' in d.notes.map_info) {
  //             return d.notes.map_info.color;
  //           } else {
  //             return '#1f77b4';
  //           }
  //         } else return "";});

  //         // focus_node = d3.select(this);
  //         // d3.select(focus_node)
  //         // .style("fill", "red");
  //     }

  // })

    svg.selectAll("circle").on("mouseout", function(){
      d3.select(this)
      .style("fill", function(d) { 
        if (d.type != 'rxn') {
          if ('color' in d.notes.map_info) {
            return d.notes.map_info.color;
          } else {
            return '#1f77b4';
          }
        } else return "";});
  })


    // hari: !important
    svg.selectAll(".link")
      .attr("stroke-width", function (d) {return get_flux_width(d.rxn);})
      .attr("stroke", function (d) {return get_flux_stroke(d.rxn);})
      .attr("stroke-dasharray", get_flux_dasharray);

    svg.selectAll("marker")
      .attr("markerWidth", markerscale)
      .attr("markerHeight", markerscale)
      .select("path")
      .attr("fill", get_flux_stroke);

    //btn test
    // d3.select("#d3flux001_options .marker_button").on("click", function() {
    //   svg.selectAll("marker")
    //   .select("path")
    //   .transition()
    //   .style("fill", "purple");
    // });


    // Button:"Show Reaction Node"
    // Show/hide the reaction control node points.
    d3.select("#btn_reaction").on("click", function() {
      // _note: HTMLjquery
      var $this = $(this);
      $this.toggleClass('btn-danger');
      $this.toggleClass('btn-on');
      d3.selectAll(".node.rxn")
        .classed("hidden", function (d, i) {
          return !d3.select(this).classed("hidden");
        });

      if($this.hasClass('btn-on')){
        $this.text('Hide Reaction Nodes');
      } else {
        $this.text('Show Reaction Nodes');
      }
    });


    // Button:"Disable Path Color"
    d3.select("#btn_path-color").on("click", function() {
      var $this = $(this);
      $this.toggleClass('btn-danger');
      $this.toggleClass('btn-success');
      $this.toggleClass('btn-off');

      if($this.hasClass('btn-off')){
        $this.text('Show Path Color');

        svg.selectAll(".link")
        // color is not effective
        .transition()
        .style("stroke", "grey");
  
        svg.selectAll("marker")
        .select("path")
        .transition()
        .style("fill", "grey");
      } else {
        $this.text('Diasble Path Color');

        svg.selectAll(".link")
        // color is not effective
        .transition()
        .style("stroke", function (d) {return get_flux_stroke(d.rxn);});
  
        svg.selectAll("marker")
        .select("path")
        .transition()
        .style("fill", get_flux_stroke);
      }
    });


    // Button:"Reset"
    d3.select("#btn_reset").on("click", function() {
      svg.selectAll(".link")
      // color is not effective
      .transition()
      .style("stroke", function (d) {return get_flux_stroke(d.rxn);});

      svg.selectAll("marker")
      .select("path")
      .transition()
      .style("fill", get_flux_stroke);

      svg.selectAll("circle")
      .transition()
      .style("fill", function(d) { 
        if (d.type != 'rxn') {
          if ('color' in d.notes.map_info) {
            return d.notes.map_info.color;
          } else {
            return '#1f77b4';
          }
        } else return "";});

    });


    // Button:"Downsteam Nodes"
    d3.select("#btn_downstream").on("click", function() {
      //svg.selectAll(".metabolite")
      graph = new Graph();
      // add unhidden metabolites

      // nodes.forEach(function(metabolite) {
      //   //graph.vertices.addVertex(metabolite);
      //   console.log(metabolite.id);
      //   graph.addVertex(metabolite.id);
      // });

      bilinks.forEach(function(link, i) {
        //console.log(link.source.id, " -> ",link.target.id);
        // if (!link.source.id in graph.getVertives) {
        //   graph.addVertex(link.source.id);
        // }

        // _debug: can't use id cause id will be identical
        //console.log(link.source.id, " -> ",link.target.id);

        // Ignore cofacor nodes
        if(link.target.cofactor) {
          return;
        }
        //tar = link.target.id;
       // tar.pointed_edge = 
        graph.addVertex(link.source.id);
        graph.addVertex(link.target.id);
        graph.addEdge(link.source.id, link.target.id);

        if(link.rxn.notes["map_info"]["reversibility"] == true){
          console.log("reverse!")
          graph.addEdge(link.target.id, link.source.id);
        }
        // svg.select("#" + link.id)
        // .transition()
        // .duration(700)
        // .delay( i * 700)
        // .style("stroke", "#006633");

      });
      
      console.log(graph.toString());
      var count = 0;
      function printNode(value) {
        
        console.log('Visited vertex: ' + value);
        count++;
        svg.select("circle#" + "_" + value)
        .transition()
        .duration(700)
        .delay(count* 700)
        .style("fill", "red");
      }

      var select = d3.select("#info").property("value");
      graph.dfs(select, printNode);
    });


d3.select("#d3flux001_options .test_button").on("click", function () {
  d3.select("#info")
  .property("value", "test");
  graph = new Graph();
  var myVertices = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I'];
  for (var i = 0; i < myVertices.length; i++) {
    graph.addVertex(myVertices[i]);
  }
  graph.addEdge('A', 'B');
  graph.addEdge('A', 'C');
  graph.addEdge('A', 'D');
  graph.addEdge('C', 'D');
  graph.addEdge('C', 'G');
  graph.addEdge('D', 'G');
  graph.addEdge('D', 'H');
  graph.addEdge('B', 'E');
  graph.addEdge('B', 'F');
  graph.addEdge('E', 'I');
  console.log(graph.toString());

  function printNode(value) {
    console.log('Visited vertex: ' + value);
  }
  graph.dfs("B", printNode);

});


    svg.selectAll(".metabolite")
      .attr("r", get_node_radius);

    d3.select("#menu_save-json")
      .on("click", function () {

        // Add position data to model nodes
        force.nodes().forEach(function (node) {
          if (node.fixed) {
            if (node.type == "rxn") {
              // Reaction object
              obj = $.grep(model.reactions, function(e){ return e.id == node.id; })[0];
              if (!("notes" in obj)) { obj.notes = {}; }
              if (!("map_info" in obj.notes)) { obj.notes.map_info = {}; }
              obj.notes.map_info['x'] = node.x;
              obj.notes.map_info['y'] = node.y;
            } else {
              // Look in metabolites
              if (!('cofactor' in node)) {
                obj = $.grep(model.metabolites, function(e){ return e.id == node.id; })[0];
                if (!("notes" in obj)) { obj.notes = {}; }
                if (!("map_info" in obj.notes)) { obj.notes.map_info = {}; }
                obj.notes.map_info['x'] = node.x;
                obj.notes.map_info['y'] = node.y;
              } else {
                rxn = $.grep(model.reactions, function(e){ 
                  return e.id == node.cofactor; })[0];
                rxn.notes.map_info.cofactors[node.notes.orig_id]['x'] = node.x
                rxn.notes.map_info.cofactors[node.notes.orig_id]['y'] = node.y
              }
            }
          }
        });

        var json = JSON.stringify(model);
        var blob = new Blob([json], {type: "application/json"});
        saveAs(blob, model.id + ".json");
      });
  }

  main(d3flux001model);


  

});


class Queue {
  constructor() {
    var items = [];
    this.enqueue = function (element) {
      items.push(element);
    };
    this.dequeue = function () {
      return items.shift();
    };
    this.front = function () {
      return items[0];
    };
    this.isEmpty = function () {
      return items.length == 0;
    };
    this.clear = function () {
      items = [];
    };
    this.size = function () {
      return items.length;
    };
    this.print = function () {
      console.log(items.toString());
    };
  }
}

// Graph function
class Graph {
  constructor() {
    var vertices = []; //
    var adjList = new Dictionary(); //
    this.addVertex = function (v) {
      // Ignore existed vertex.
      if (vertices.indexOf(v) in vertices) {
        return;
      }
      vertices.push(v);
      adjList.set(v, []); //
    };
    this.addEdge = function (v, w) {
      adjList.get(v).push(w); //
      //adjList.get(w).push(v); //
    };
    this.hasVertex = function (v) {
      return v in vertices;
    }
    this.toString = function () {
      var s = '';
      for (var i = 0; i < vertices.length; i++) {
        s += vertices[i] + ' -> ';
        var neighbors = adjList.get(vertices[i]);
        for (var j = 0; j < neighbors.length; j++) {
          s += neighbors[j] + ' ';
        }
        s += '\n';
      }
      return s;
    };
    var initializeColor = function () {
      var color = [];
      for (var i = 0; i < vertices.length; i++) {
        color[vertices[i]] = 'white';
      }
      return color;
    };

    

    this.dfs2 = function (s, callback) {
      var color = initializeColor(); //
      // for (var i=0; i<vertices.length; i++){
      //     if (color[vertices[i]] === 'white'){
      //         dfsVisit(vertices[i], color, callback); //
      //     }
      // }
      if (color[s] == "white") {
        dfsVisit2(s, color, callback);
      }
    };
    var dfsVisit2 = function (u, color, callback) {
      color[u] = 'grey';
      if (callback) {
        callback(u);
      }
      var neighbors = adjList.get(u); //


      for (var i = 0; i < neighbors.length; i++) {
        var w = neighbors[i];
        // Stop recursion when end vertex is visted.
        if (neighbors.length == 0)
        {
          color[u] = 'black';
          callback(u);
          return;
        }

        if (color[w] === 'white') {
          dfsVisit2(w, color, callback); //w
        }

      }
      color[u] = 'black';
    };


    this.dfs = function (s, callback) {
      var color = initializeColor(); //
      // for (var i=0; i<vertices.length; i++){
      //     if (color[vertices[i]] === 'white'){
      //         dfsVisit(vertices[i], color, callback); //
      //     }
      // }
      if (color[s] == "white") {
        dfsVisit(s, color, callback);
      }
    };
    var dfsVisit = function (u, color, callback) {
      color[u] = 'grey';
      if (callback) {
        callback(u);
      }
      var neighbors = adjList.get(u); //
      for (var i = 0; i < neighbors.length; i++) {
        var w = neighbors[i];
        if (color[w] === 'white') {
          dfsVisit(w, color, callback); //w
        }
      }
      color[u] = 'black';
    };

    this.bfs = function (v, callback) {
      var color = initializeColor(),
        queue = new Queue(); //
      queue.enqueue(v); //
      while (!queue.isEmpty()) {
        var u = queue.dequeue(), //
          neighbors = adjList.get(u); //
        color[u] = 'grey'; //
        for (var i = 0; i < neighbors.length; i++) {
          var w = neighbors[i]; //
          if (color[w] === 'white') {
            color[w] = 'grey'; //
            queue.enqueue(w); //
          }
        }
        color[u] = 'black'; //
        if (callback) {
          callback(u);
        }
      }
    };

  }
}

// Class Dictionary
class Dictionary {
  constructor() {
    var items = {};
    this.set = function (key, value) {
      items[key] = value;
    };
    this.remove = function (key) {
      if (this.has(key)) {
        delete items[key];
        return true;
      }
      return false;
    };
    this.has = function (key) {
      return items.hasOwnProperty(key);
    };
    this.get = function (key) {
      return this.has(key) ? items[key] : undefined;
    };
    this.clear = function () {
      items = {};
    };
    this.size = function () {
      return Object.keys(items).length;
    };
    this.keys = function () {
      return Object.keys(items);
    };
    this.values = function () {
      var values = [];
      for (var k in items) {
        if (this.has(k)) {
          values.push(items[k]);
        }
      }
      return values;
    };
    this.each = function (fn) {
      for (var k in items) {
        if (this.has(k)) {
          fn(k, items[k]);
        }
      }
    };
    this.getItems = function () {
      return items;
    };
  }
}











function Point(x, y) {
    this.x = x;
    this.y = y;
}

function quadraticBezierLength(p0, p1, p2) {
    var a = new Point(
        p0.x - 2 * p1.x + p2.x,
        p0.y - 2 * p1.y + p2.y
    );
    var b = new Point(
        2 * p1.x - 2 * p0.x,
        2 * p1.y - 2 * p0.y
    );
    var A = 4 * (a.x * a.x + a.y * a.y);
    var B = 4 * (a.x * b.x + a.y * b.y);
    var C = b.x * b.x + b.y * b.y;

    var Sabc = 2 * Math.sqrt(A+B+C);
    var A_2 = Math.sqrt(A);
    var A_32 = 2 * A * A_2;
    var C_2 = 2 * Math.sqrt(C);
    var BA = B / A_2;

    return (A_32 * Sabc + A_2 * B * (Sabc - C_2) + (4 * C * A - B * B) * Math.log((2 * A_2 + BA + Sabc) / (BA + C_2))) / (4 * A_32);
}


/*****
*
*   Point2D.js
*
*   copyright 2001-2002, Kevin Lindsey
*
*****/

/*****
*
*   Point2D
*
*****/

/*****
*
*   constructor
*
*****/
function Point2D(x, y) {
    if ( arguments.length > 0 ) {
        this.x = x;
        this.y = y;
    }
}


/*****
*
*   clone
*
*****/
Point2D.prototype.clone = function() {
    return new Point2D(this.x, this.y);
};


/*****
*
*   add
*
*****/
Point2D.prototype.add = function(that) {
    return new Point2D(this.x+that.x, this.y+that.y);
};


/*****
*
*   addEquals
*
*****/
Point2D.prototype.addEquals = function(that) {
    this.x += that.x;
    this.y += that.y;

    return this;
};


/*****
*
*   offset - used in dom_graph
*
*   This method is based on code written by Walter Korman
*      http://www.go2net.com/internet/deep/1997/05/07/body.html 
*   which is in turn based on an algorithm by Sven Moen
*
*****/
Point2D.prototype.offset = function(a, b) {
    var result = 0;

    if ( !( b.x <= this.x || this.x + a.x <= 0 ) ) {
        var t = b.x * a.y - a.x * b.y;
        var s;
        var d;

        if ( t > 0 ) {
            if ( this.x < 0 ) {
                s = this.x * a.y;
                d = s / a.x - this.y;
            } else if ( this.x > 0 ) {
                s = this.x * b.y;
                d = s / b.x - this.y
            } else {
                d = -this.y;
            }
        } else {
            if ( b.x < this.x + a.x ) {
                s = ( b.x - this.x ) * a.y;
                d = b.y - (this.y + s / a.x);
            } else if ( b.x > this.x + a.x ) {
                s = (a.x + this.x) * b.y;
                d = s / b.x - (this.y + a.y);
            } else {
                d = b.y - (this.y + a.y);
            }
        }

        if ( d > 0 ) {
            result = d;
        }
    }

    return result;
};


/*****
*
*   rmoveto
*
*****/
Point2D.prototype.rmoveto = function(dx, dy) {
    this.x += dx;
    this.y += dy;
};


/*****
*
*   scalarAdd
*
*****/
Point2D.prototype.scalarAdd = function(scalar) {
    return new Point2D(this.x+scalar, this.y+scalar);
};


/*****
*
*   scalarAddEquals
*
*****/
Point2D.prototype.scalarAddEquals = function(scalar) {
    this.x += scalar;
    this.y += scalar;

    return this;
};


/*****
*
*   subtract
*
*****/
Point2D.prototype.subtract = function(that) {
    return new Point2D(this.x-that.x, this.y-that.y);
};


/*****
*
*   subtractEquals
*
*****/
Point2D.prototype.subtractEquals = function(that) {
    this.x -= that.x;
    this.y -= that.y;

    return this;
};


/*****
*
*   scalarSubtract
*
*****/
Point2D.prototype.scalarSubtract = function(scalar) {
    return new Point2D(this.x-scalar, this.y-scalar);
};


/*****
*
*   scalarSubtractEquals
*
*****/
Point2D.prototype.scalarSubtractEquals = function(scalar) {
    this.x -= scalar;
    this.y -= scalar;

    return this;
};


/*****
*
*   multiply
*
*****/
Point2D.prototype.multiply = function(scalar) {
    return new Point2D(this.x*scalar, this.y*scalar);
};


/*****
*
*   multiplyEquals
*
*****/
Point2D.prototype.multiplyEquals = function(scalar) {
    this.x *= scalar;
    this.y *= scalar;

    return this;
};


/*****
*
*   divide
*
*****/
Point2D.prototype.divide = function(scalar) {
    return new Point2D(this.x/scalar, this.y/scalar);
};


/*****
*
*   divideEquals
*
*****/
Point2D.prototype.divideEquals = function(scalar) {
    this.x /= scalar;
    this.y /= scalar;

    return this;
};


/*****
*
*   comparison methods
*
*   these were a nice idea, but ...  It would be better to define these names
*   in two parts so that the first part is the x comparison and the second is
*   the y.  For example, to test p1.x < p2.x and p1.y >= p2.y, you would call
*   p1.lt_gte(p2).  Honestly, I only did these types of comparisons in one
*   Intersection routine, so these probably could be removed.
*
*****/

/*****
*
*   compare
*
*****/
Point2D.prototype.compare = function(that) {
    return (this.x - that.x || this.y - that.y);
};


/*****
*
*   eq - equal
*
*****/
Point2D.prototype.eq = function(that) {
    return ( this.x == that.x && this.y == that.y );
};


/*****
*
*   lt - less than
*
*****/
Point2D.prototype.lt = function(that) {
    return ( this.x < that.x && this.y < that.y );
};


/*****
*
*   lte - less than or equal
*
*****/
Point2D.prototype.lte = function(that) {
    return ( this.x <= that.x && this.y <= that.y );
};


/*****
*
*   gt - greater than
*
*****/
Point2D.prototype.gt = function(that) {
    return ( this.x > that.x && this.y > that.y );
};


/*****
*
*   gte - greater than or equal
*
*****/
Point2D.prototype.gte = function(that) {
    return ( this.x >= that.x && this.y >= that.y );
};


/*****
*
*   utility methods
*
*****/

/*****
*
*   lerp
*
*****/
Point2D.prototype.lerp = function(that, t) {
    return new Point2D(
        this.x + (that.x - this.x) * t,
        this.y + (that.y - this.y) * t
    );
};


/*****
*
*   distanceFrom
*
*****/
Point2D.prototype.distanceFrom = function(that) {
    var dx = this.x - that.x;
    var dy = this.y - that.y;

    return Math.sqrt(dx*dx + dy*dy);
};


/*****
*
*   min
*
*****/
Point2D.prototype.min = function(that) {
    return new Point2D(
        Math.min( this.x, that.x ),
        Math.min( this.y, that.y )
    );
};


/*****
*
*   max
*
*****/
Point2D.prototype.max = function(that) {
    return new Point2D(
        Math.max( this.x, that.x ),
        Math.max( this.y, that.y )
    );
};


/*****
*
*   toString
*
*****/
Point2D.prototype.toString = function() {
    return this.x + "," + this.y;
};


/*****
*
*   get/set methods
*
*****/

/*****
*
*   setXY
*
*****/
Point2D.prototype.setXY = function(x, y) {
    this.x = x;
    this.y = y;
};


/*****
*
*   setFromPoint
*
*****/
Point2D.prototype.setFromPoint = function(that) {
    this.x = that.x;
    this.y = that.y;
};


/*****
*
*   swap
*
*****/
Point2D.prototype.swap = function(that) {
    var x = this.x;
    var y = this.y;

    this.x = that.x;
    this.y = that.y;

    that.x = x;
    that.y = y;
};

/*****
*
*   Polynomial.js
*
*   copyright 2002, Kevin Lindsey
*
*****/

Polynomial.TOLERANCE = 1e-6;
Polynomial.ACCURACY  = 6;


/*****
*
*   interpolate - class method
*
*****/
Polynomial.interpolate = function(xs, ys, n, offset, x) {
    if ( xs.constructor !== Array || ys.constructor !== Array )
        throw new Error("Polynomial.interpolate: xs and ys must be arrays");
    if ( isNaN(n) || isNaN(offset) || isNaN(x) )
        throw new Error("Polynomial.interpolate: n, offset, and x must be numbers");

    var y  = 0;
    var dy = 0;
    var c = new Array(n);
    var d = new Array(n);
    var ns = 0;
    var result;

    var diff = Math.abs(x - xs[offset]);
    for ( var i = 0; i < n; i++ ) {
        var dift = Math.abs(x - xs[offset+i]);

        if ( dift < diff ) {
            ns = i;
            diff = dift;
        }
        c[i] = d[i] = ys[offset+i];
    }
    y = ys[offset+ns];
    ns--;

    for ( var m = 1; m < n; m++ ) {
        for ( var i = 0; i < n-m; i++ ) {
            var ho = xs[offset+i] - x;
            var hp = xs[offset+i+m] - x;
            var w = c[i+1]-d[i];
            var den = ho - hp;

            if ( den == 0.0 ) {
                result = { y: 0, dy: 0};
                break;
            }

            den = w / den;
            d[i] = hp*den;
            c[i] = ho*den;
        }
        dy = (2*(ns+1) < (n-m)) ? c[ns+1] : d[ns--];
        y += dy;
    }

    return { y: y, dy: dy };
};


/*****
*
*   constructor
*
*****/
function Polynomial() {
    this.init( arguments );
}


/*****
*
*   init
*
*****/
Polynomial.prototype.init = function(coefs) {
    this.coefs = new Array();

    for ( var i = coefs.length - 1; i >= 0; i-- )
        this.coefs.push( coefs[i] );

    this._variable = "t";
    this._s = 0;
};


/*****
*
*   eval
*
*****/
Polynomial.prototype.eval = function(x) {
    if ( isNaN(x) )
        throw new Error("Polynomial.eval: parameter must be a number");

    var result = 0;

    for ( var i = this.coefs.length - 1; i >= 0; i-- )
        result = result * x + this.coefs[i];

    return result;
};


/*****
*
*   add
*
*****/
Polynomial.prototype.add = function(that) {
    var result = new Polynomial();
    var d1 = this.getDegree();
    var d2 = that.getDegree();
    var dmax = Math.max(d1,d2);

    for ( var i = 0; i <= dmax; i++ ) {
        var v1 = (i <= d1) ? this.coefs[i] : 0;
        var v2 = (i <= d2) ? that.coefs[i] : 0;

        result.coefs[i] = v1 + v2;
    }

    return result;
};


/*****
*
*   multiply
*
*****/
Polynomial.prototype.multiply = function(that) {
    var result = new Polynomial();

    for ( var i = 0; i <= this.getDegree() + that.getDegree(); i++ )
        result.coefs.push(0);

    for ( var i = 0; i <= this.getDegree(); i++ )
        for ( var j = 0; j <= that.getDegree(); j++ )
            result.coefs[i+j] += this.coefs[i] * that.coefs[j];

    return result;
};


/*****
*
*   divide_scalar
*
*****/
Polynomial.prototype.divide_scalar = function(scalar) {
    for ( var i = 0; i < this.coefs.length; i++ )
        this.coefs[i] /= scalar;
};


/*****
*
*   simplify
*
*****/
Polynomial.prototype.simplify = function() {
    for ( var i = this.getDegree(); i >= 0; i-- ) {
        if ( Math.abs( this.coefs[i] ) <= Polynomial.TOLERANCE )
            this.coefs.pop();
        else
            break;
    }
};


/*****
*
*   bisection
*
*****/
Polynomial.prototype.bisection = function(min, max) {
    var minValue = this.eval(min);
    var maxValue = this.eval(max);
    var result;
    
    if ( Math.abs(minValue) <= Polynomial.TOLERANCE )
        result = min;
    else if ( Math.abs(maxValue) <= Polynomial.TOLERANCE )
        result = max;
    else if ( minValue * maxValue <= 0 ) {
        var tmp1  = Math.log(max - min);
        var tmp2  = Math.LN10 * Polynomial.ACCURACY;
        var iters = Math.ceil( (tmp1+tmp2) / Math.LN2 );

        for ( var i = 0; i < iters; i++ ) {
            result = 0.5 * (min + max);
            var value = this.eval(result);

            if ( Math.abs(value) <= Polynomial.TOLERANCE ) {
                break;
            }

            if ( value * minValue < 0 ) {
                max = result;
                maxValue = value;
            } else {
                min = result;
                minValue = value;
            }
        }
    }

    return result;
};


/*****
*
*   toString
*
*****/
Polynomial.prototype.toString = function() {
    var coefs = new Array();
    var signs = new Array();
    
    for ( var i = this.coefs.length - 1; i >= 0; i-- ) {
        var value = Math.round(this.coefs[i]*1000)/1000;
        //var value = this.coefs[i];

        if ( value != 0 ) {
            var sign = ( value < 0 ) ? " - " : " + ";

            value = Math.abs(value);
            if ( i > 0 )
                if ( value == 1 )
                    value = this._variable;
                else
                    value += this._variable;
            if ( i > 1 ) value += "^" + i;

            signs.push( sign );
            coefs.push( value );
        }
    }

    signs[0] = ( signs[0] == " + " ) ? "" : "-";

    var result = "";
    for ( var i = 0; i < coefs.length; i++ )
        result += signs[i] + coefs[i];
    
    return result;
};


/*****
*
*   trapezoid
*   Based on trapzd in "Numerical Recipes in C", page 137
*
*****/
Polynomial.prototype.trapezoid = function(min, max, n) {
    if ( isNaN(min) || isNaN(max) || isNaN(n) )
        throw new Error("Polynomial.trapezoid: parameters must be numbers");

    var range = max - min;
    var TOLERANCE = 1e-7;

    if ( n == 1 ) {
        var minValue = this.eval(min);
        var maxValue = this.eval(max);
        this._s = 0.5*range*( minValue + maxValue );
    } else {
        var it = 1 << (n-2);
        var delta = range / it;
        var x = min + 0.5*delta;
        var sum = 0;

        for ( var i = 0; i < it; i++ ) {
            sum += this.eval(x);
            x += delta;
        }
        this._s = 0.5*(this._s + range*sum/it);
    }

    if ( isNaN(this._s) )
        throw new Error("Polynomial.trapezoid: this._s is NaN");

    return this._s;
};


/*****
*
*   simpson
*   Based on trapzd in "Numerical Recipes in C", page 139
*
*****/
Polynomial.prototype.simpson = function(min, max) {
    if ( isNaN(min) || isNaN(max) )
        throw new Error("Polynomial.simpson: parameters must be numbers");

    var range = max - min;
    var st = 0.5 * range * ( this.eval(min) + this.eval(max) );
    var t = st;
    var s = 4.0*st/3.0;
    var os = s;
    var ost = st;
    var TOLERANCE = 1e-7;

    var it = 1;
    for ( var n = 2; n <= 20; n++ ) {
        var delta = range / it;
        var x     = min + 0.5*delta;
        var sum   = 0;

        for ( var i = 1; i <= it; i++ ) {
            sum += this.eval(x);
            x += delta;
        }

        t = 0.5 * (t + range * sum / it);
        st = t;
        s = (4.0*st - ost)/3.0;

        if ( Math.abs(s-os) < TOLERANCE*Math.abs(os) )
            break;

        os = s;
        ost = st;
        it <<= 1;
    }

    return s;
};


/*****
*
*   romberg
*
*****/
Polynomial.prototype.romberg = function(min, max) {
    if ( isNaN(min) || isNaN(max) )
        throw new Error("Polynomial.romberg: parameters must be numbers");

    var MAX = 20;
    var K = 3;
    var TOLERANCE = 1e-6;
    var s = new Array(MAX+1);
    var h = new Array(MAX+1);
    var result = { y: 0, dy: 0 };

    h[0] = 1.0;
    for ( var j = 1; j <= MAX; j++ ) {
        s[j-1] = this.trapezoid(min, max, j);
        if ( j >= K ) {
            result = Polynomial.interpolate(h, s, K, j-K, 0.0);
            if ( Math.abs(result.dy) <= TOLERANCE*result.y) break;
        }
        s[j] = s[j-1];
        h[j] = 0.25 * h[j-1];
    }

    return result.y;
};


/*****
*
*   get/set methods
*
*****/

/*****
*
*   get degree
*
*****/
Polynomial.prototype.getDegree = function() {
    return this.coefs.length - 1;
};


/*****
*
*   getDerivative
*
*****/
Polynomial.prototype.getDerivative = function() {
    var derivative = new Polynomial();

    for ( var i = 1; i < this.coefs.length; i++ ) {
        derivative.coefs.push(i*this.coefs[i]);
    }

    return derivative;
};


/*****
*
*   getRoots
*
*****/
Polynomial.prototype.getRoots = function() {
    var result;

    this.simplify();
    switch ( this.getDegree() ) {
        case 0: result = new Array();              break;
        case 1: result = this.getLinearRoot();     break;
        case 2: result = this.getQuadraticRoots(); break;
        case 3: result = this.getCubicRoots();     break;
        case 4: result = this.getQuarticRoots();   break;
        default:
            result = new Array();
            // should try Newton's method and/or bisection
    }

    return result;
};


/*****
*
*   getRootsInInterval
*
*****/
Polynomial.prototype.getRootsInInterval = function(min, max) {
    var roots = new Array();
    var root;

    if ( this.getDegree() == 1 ) {
        root = this.bisection(min, max);
        if ( root != null ) roots.push(root);
    } else {
        // get roots of derivative
        var deriv  = this.getDerivative();
        var droots = deriv.getRootsInInterval(min, max);

        if ( droots.length > 0 ) {
            // find root on [min, droots[0]]
            root = this.bisection(min, droots[0]);
            if ( root != null ) roots.push(root);

            // find root on [droots[i],droots[i+1]] for 0 <= i <= count-2
            for ( i = 0; i <= droots.length-2; i++ ) {
                root = this.bisection(droots[i], droots[i+1]);
                if ( root != null ) roots.push(root);
            }

            // find root on [droots[count-1],xmax]
            root = this.bisection(droots[droots.length-1], max);
            if ( root != null ) roots.push(root);
        } else {
            // polynomial is monotone on [min,max], has at most one root
            root = this.bisection(min, max);
            if ( root != null ) roots.push(root);
        }
    }

    return roots;
};


/*****
*
*   getLinearRoot
*
*****/
Polynomial.prototype.getLinearRoot = function() {
    var result = new Array();
    var a = this.coefs[1];
    
    if ( a != 0 )
        result.push( -this.coefs[0] / a );

    return result;
};


/*****
*
*   getQuadraticRoots
*
*****/
Polynomial.prototype.getQuadraticRoots = function() {
    var results = new Array();

    if ( this.getDegree() == 2 ) {
        var a = this.coefs[2];
        var b = this.coefs[1] / a;
        var c = this.coefs[0] / a;
        var d = b*b - 4*c;

        if ( d > 0 ) {
            var e = Math.sqrt(d);
            
            results.push( 0.5 * (-b + e) );
            results.push( 0.5 * (-b - e) );
        } else if ( d == 0 ) {
            // really two roots with same value, but we only return one
            results.push( 0.5 * -b );
        }
    }

    return results;
};


/*****
*
*   getCubicRoots
*
*   This code is based on MgcPolynomial.cpp written by David Eberly.  His
*   code along with many other excellent examples are avaiable at his site:
*   http://www.magic-software.com
*
*****/
Polynomial.prototype.getCubicRoots = function() {
    var results = new Array();

    if ( this.getDegree() == 3 ) {
        var c3 = this.coefs[3];
        var c2 = this.coefs[2] / c3;
        var c1 = this.coefs[1] / c3;
        var c0 = this.coefs[0] / c3;

        var a       = (3*c1 - c2*c2) / 3;
        var b       = (2*c2*c2*c2 - 9*c1*c2 + 27*c0) / 27;
        var offset  = c2 / 3;
        var discrim = b*b/4 + a*a*a/27;
        var halfB   = b / 2;

        if ( Math.abs(discrim) <= Polynomial.TOLERANCE ) discrim = 0;
        
        if ( discrim > 0 ) {
            var e = Math.sqrt(discrim);
            var tmp;
            var root;

            tmp = -halfB + e;
            if ( tmp >= 0 )
                root = Math.pow(tmp, 1/3);
            else
                root = -Math.pow(-tmp, 1/3);

            tmp = -halfB - e;
            if ( tmp >= 0 )
                root += Math.pow(tmp, 1/3);
            else
                root -= Math.pow(-tmp, 1/3);

            results.push( root - offset );
        } else if ( discrim < 0 ) {
            var distance = Math.sqrt(-a/3);
            var angle    = Math.atan2( Math.sqrt(-discrim), -halfB) / 3;
            var cos      = Math.cos(angle);
            var sin      = Math.sin(angle);
            var sqrt3    = Math.sqrt(3);

            results.push( 2*distance*cos - offset );
            results.push( -distance * (cos + sqrt3 * sin) - offset);
            results.push( -distance * (cos - sqrt3 * sin) - offset);
        } else {
            var tmp;

            if ( halfB >= 0 )
                tmp = -Math.pow(halfB, 1/3);
            else
                tmp = Math.pow(-halfB, 1/3);

            results.push( 2*tmp - offset );
            // really should return next root twice, but we return only one
            results.push( -tmp - offset );
        }
    }

    return results;
};


/*****
*
*   getQuarticRoots
*
*   This code is based on MgcPolynomial.cpp written by David Eberly.  His
*   code along with many other excellent examples are avaiable at his site:
*   http://www.magic-software.com
*
*****/
Polynomial.prototype.getQuarticRoots = function() {
    var results = new Array();

    if ( this.getDegree() == 4 ) {
        var c4 = this.coefs[4];
        var c3 = this.coefs[3] / c4;
        var c2 = this.coefs[2] / c4;
        var c1 = this.coefs[1] / c4;
        var c0 = this.coefs[0] / c4;

        var resolveRoots = new Polynomial(
            1, -c2, c3*c1 - 4*c0, -c3*c3*c0 + 4*c2*c0 -c1*c1
        ).getCubicRoots();
        var y       = resolveRoots[0];
        var discrim = c3*c3/4 - c2 + y;

        if ( Math.abs(discrim) <= Polynomial.TOLERANCE ) discrim = 0;

        if ( discrim > 0 ) {
            var e     = Math.sqrt(discrim);
            var t1    = 3*c3*c3/4 - e*e - 2*c2;
            var t2    = ( 4*c3*c2 - 8*c1 - c3*c3*c3 ) / ( 4*e );
            var plus  = t1+t2;
            var minus = t1-t2;

            if ( Math.abs(plus)  <= Polynomial.TOLERANCE ) plus  = 0;
            if ( Math.abs(minus) <= Polynomial.TOLERANCE ) minus = 0;

            if ( plus >= 0 ) {
                var f = Math.sqrt(plus);

                results.push( -c3/4 + (e+f)/2 );
                results.push( -c3/4 + (e-f)/2 );
            }
            if ( minus >= 0 ) {
                var f = Math.sqrt(minus);

                results.push( -c3/4 + (f-e)/2 );
                results.push( -c3/4 - (f+e)/2 );
            }
        } else if ( discrim < 0 ) {
            // no roots
        } else {
            var t2 = y*y - 4*c0;

            if ( t2 >= -Polynomial.TOLERANCE ) {
                if ( t2 < 0 ) t2 = 0;

                t2 = 2*Math.sqrt(t2);
                t1 = 3*c3*c3/4 - 2*c2;
                if ( t1+t2 >= Polynomial.TOLERANCE ) {
                    var d = Math.sqrt(t1+t2);

                    results.push( -c3/4 + d/2 );
                    results.push( -c3/4 - d/2 );
                }
                if ( t1-t2 >= Polynomial.TOLERANCE ) {
                    var d = Math.sqrt(t1-t2);

                    results.push( -c3/4 + d/2 );
                    results.push( -c3/4 - d/2 );
                }
            }
        }
    }

    return results;
};

/*****
*
*   Intersection.js
*
*   copyright 2002, Kevin Lindsey
*
*****/

/*****
*
*   constructor
*
*****/
function Intersection(status) {
    if ( arguments.length > 0 ) {
        this.init(status);
    }
}


/*****
*
*   init
*
*****/
Intersection.prototype.init = function(status) {
    this.status = status;
    this.points = new Array();
};


/*****
*
*   appendPoint
*
*****/
Intersection.prototype.appendPoint = function(point) {
    this.points.push(point);
};


/*****
*
*   appendPoints
*
*****/
Intersection.prototype.appendPoints = function(points) {
    this.points = this.points.concat(points);
};


/*****
*
*   class methods
*
*****/

/*****
*
*   intersectShapes
*
*****/
Intersection.intersectShapes = function(shape1, shape2) {
    var ip1 = shape1.getIntersectionParams();
    var ip2 = shape2.getIntersectionParams();
    var result;

    if ( ip1 != null && ip2 != null ) {
        if ( ip1.name == "Path" ) {
            result = Intersection.intersectPathShape(shape1, shape2);
        } else if ( ip2.name == "Path" ) {
            result = Intersection.intersectPathShape(shape2, shape1);
        } else {
            var method;
            var params;

            if ( ip1.name < ip2.name ) {
                method = "intersect" + ip1.name + ip2.name;
                params = ip1.params.concat( ip2.params );
            } else {
                method = "intersect" + ip2.name + ip1.name;
                params = ip2.params.concat( ip1.params );
            }

            if ( !(method in Intersection) )
                throw new Error("Intersection not available: " + method);

            result = Intersection[method].apply(null, params);
        }
    } else {
        result = new Intersection("No Intersection");
    }

    return result;
};


/*****
*
*   intersectPathShape
*
*****/
Intersection.intersectPathShape = function(path, shape) {
    return path.intersectShape(shape);
};


/*****
*
*   intersectBezier2Bezier2
*
*****/
Intersection.intersectBezier2Bezier2 = function(a1, a2, a3, b1, b2, b3) {
    var a, b;
    var c12, c11, c10;
    var c22, c21, c20;
    var result = new Intersection("No Intersection");
    var poly;

    a = a2.multiply(-2);
    c12 = a1.add(a.add(a3));

    a = a1.multiply(-2);
    b = a2.multiply(2);
    c11 = a.add(b);

    c10 = new Point2D(a1.x, a1.y);

    a = b2.multiply(-2);
    c22 = b1.add(a.add(b3));

    a = b1.multiply(-2);
    b = b2.multiply(2);
    c21 = a.add(b);

    c20 = new Point2D(b1.x, b1.y);
    
    if ( c12.y == 0 ) {
        var v0 = c12.x*(c10.y - c20.y);
        var v1 = v0 - c11.x*c11.y;
        var v2 = v0 + v1;
        var v3 = c11.y*c11.y;

        poly = new Polynomial(
            c12.x*c22.y*c22.y,
            2*c12.x*c21.y*c22.y,
            c12.x*c21.y*c21.y - c22.x*v3 - c22.y*v0 - c22.y*v1,
            -c21.x*v3 - c21.y*v0 - c21.y*v1,
            (c10.x - c20.x)*v3 + (c10.y - c20.y)*v1
        );
    } else {
        var v0 = c12.x*c22.y - c12.y*c22.x;
        var v1 = c12.x*c21.y - c21.x*c12.y;
        var v2 = c11.x*c12.y - c11.y*c12.x;
        var v3 = c10.y - c20.y;
        var v4 = c12.y*(c10.x - c20.x) - c12.x*v3;
        var v5 = -c11.y*v2 + c12.y*v4;
        var v6 = v2*v2;

        poly = new Polynomial(
            v0*v0,
            2*v0*v1,
            (-c22.y*v6 + c12.y*v1*v1 + c12.y*v0*v4 + v0*v5) / c12.y,
            (-c21.y*v6 + c12.y*v1*v4 + v1*v5) / c12.y,
            (v3*v6 + v4*v5) / c12.y
        );
    }

    var roots = poly.getRoots();
    for ( var i = 0; i < roots.length; i++ ) {
        var s = roots[i];

        if ( 0 <= s && s <= 1 ) {
            var xRoots = new Polynomial(
                c12.x,
                c11.x,
                c10.x - c20.x - s*c21.x - s*s*c22.x
            ).getRoots();
            var yRoots = new Polynomial(
                c12.y,
                c11.y,
                c10.y - c20.y - s*c21.y - s*s*c22.y
            ).getRoots();

            if ( xRoots.length > 0 && yRoots.length > 0 ) {
                var TOLERANCE = 1e-4;

                checkRoots:
                for ( var j = 0; j < xRoots.length; j++ ) {
                    var xRoot = xRoots[j];

                    if ( 0 <= xRoot && xRoot <= 1 ) {
                        for ( var k = 0; k < yRoots.length; k++ ) {
                            if ( Math.abs( xRoot - yRoots[k] ) < TOLERANCE ) {
                                result.points.push( c22.multiply(s*s).add(c21.multiply(s).add(c20)) );
                                break checkRoots;
                            }
                        }
                    }
                }
            }
        }
    }

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectBezier2Bezier3
*
*****/
Intersection.intersectBezier2Bezier3 = function(a1, a2, a3, b1, b2, b3, b4) {
    var a, b,c, d;
    var c12, c11, c10;
    var c23, c22, c21, c20;
    var result = new Intersection("No Intersection");

    a = a2.multiply(-2);
    c12 = a1.add(a.add(a3));

    a = a1.multiply(-2);
    b = a2.multiply(2);
    c11 = a.add(b);

    c10 = new Point2D(a1.x, a1.y);

    a = b1.multiply(-1);
    b = b2.multiply(3);
    c = b3.multiply(-3);
    d = a.add(b.add(c.add(b4)));
    c23 = new Vector2D(d.x, d.y);

    a = b1.multiply(3);
    b = b2.multiply(-6);
    c = b3.multiply(3);
    d = a.add(b.add(c));
    c22 = new Vector2D(d.x, d.y);

    a = b1.multiply(-3);
    b = b2.multiply(3);
    c = a.add(b);
    c21 = new Vector2D(c.x, c.y);

    c20 = new Vector2D(b1.x, b1.y);

    var c10x2 = c10.x*c10.x;
    var c10y2 = c10.y*c10.y;
    var c11x2 = c11.x*c11.x;
    var c11y2 = c11.y*c11.y;
    var c12x2 = c12.x*c12.x;
    var c12y2 = c12.y*c12.y;
    var c20x2 = c20.x*c20.x;
    var c20y2 = c20.y*c20.y;
    var c21x2 = c21.x*c21.x;
    var c21y2 = c21.y*c21.y;
    var c22x2 = c22.x*c22.x;
    var c22y2 = c22.y*c22.y;
    var c23x2 = c23.x*c23.x;
    var c23y2 = c23.y*c23.y;

    var poly = new Polynomial(
        -2*c12.x*c12.y*c23.x*c23.y + c12x2*c23y2 + c12y2*c23x2,
        -2*c12.x*c12.y*c22.x*c23.y - 2*c12.x*c12.y*c22.y*c23.x + 2*c12y2*c22.x*c23.x +
            2*c12x2*c22.y*c23.y,
        -2*c12.x*c21.x*c12.y*c23.y - 2*c12.x*c12.y*c21.y*c23.x - 2*c12.x*c12.y*c22.x*c22.y +
            2*c21.x*c12y2*c23.x + c12y2*c22x2 + c12x2*(2*c21.y*c23.y + c22y2),
        2*c10.x*c12.x*c12.y*c23.y + 2*c10.y*c12.x*c12.y*c23.x + c11.x*c11.y*c12.x*c23.y +
            c11.x*c11.y*c12.y*c23.x - 2*c20.x*c12.x*c12.y*c23.y - 2*c12.x*c20.y*c12.y*c23.x -
            2*c12.x*c21.x*c12.y*c22.y - 2*c12.x*c12.y*c21.y*c22.x - 2*c10.x*c12y2*c23.x -
            2*c10.y*c12x2*c23.y + 2*c20.x*c12y2*c23.x + 2*c21.x*c12y2*c22.x -
            c11y2*c12.x*c23.x - c11x2*c12.y*c23.y + c12x2*(2*c20.y*c23.y + 2*c21.y*c22.y),
        2*c10.x*c12.x*c12.y*c22.y + 2*c10.y*c12.x*c12.y*c22.x + c11.x*c11.y*c12.x*c22.y +
            c11.x*c11.y*c12.y*c22.x - 2*c20.x*c12.x*c12.y*c22.y - 2*c12.x*c20.y*c12.y*c22.x -
            2*c12.x*c21.x*c12.y*c21.y - 2*c10.x*c12y2*c22.x - 2*c10.y*c12x2*c22.y +
            2*c20.x*c12y2*c22.x - c11y2*c12.x*c22.x - c11x2*c12.y*c22.y + c21x2*c12y2 +
            c12x2*(2*c20.y*c22.y + c21y2),
        2*c10.x*c12.x*c12.y*c21.y + 2*c10.y*c12.x*c21.x*c12.y + c11.x*c11.y*c12.x*c21.y +
            c11.x*c11.y*c21.x*c12.y - 2*c20.x*c12.x*c12.y*c21.y - 2*c12.x*c20.y*c21.x*c12.y -
            2*c10.x*c21.x*c12y2 - 2*c10.y*c12x2*c21.y + 2*c20.x*c21.x*c12y2 -
            c11y2*c12.x*c21.x - c11x2*c12.y*c21.y + 2*c12x2*c20.y*c21.y,
        -2*c10.x*c10.y*c12.x*c12.y - c10.x*c11.x*c11.y*c12.y - c10.y*c11.x*c11.y*c12.x +
            2*c10.x*c12.x*c20.y*c12.y + 2*c10.y*c20.x*c12.x*c12.y + c11.x*c20.x*c11.y*c12.y +
            c11.x*c11.y*c12.x*c20.y - 2*c20.x*c12.x*c20.y*c12.y - 2*c10.x*c20.x*c12y2 +
            c10.x*c11y2*c12.x + c10.y*c11x2*c12.y - 2*c10.y*c12x2*c20.y -
            c20.x*c11y2*c12.x - c11x2*c20.y*c12.y + c10x2*c12y2 + c10y2*c12x2 +
            c20x2*c12y2 + c12x2*c20y2
    );
    var roots = poly.getRootsInInterval(0,1);

    for ( var i = 0; i < roots.length; i++ ) {
        var s = roots[i];
        var xRoots = new Polynomial(
            c12.x,
            c11.x,
            c10.x - c20.x - s*c21.x - s*s*c22.x - s*s*s*c23.x
        ).getRoots();
        var yRoots = new Polynomial(
            c12.y,
            c11.y,
            c10.y - c20.y - s*c21.y - s*s*c22.y - s*s*s*c23.y
        ).getRoots();

        if ( xRoots.length > 0 && yRoots.length > 0 ) {
            var TOLERANCE = 1e-4;

            checkRoots:
            for ( var j = 0; j < xRoots.length; j++ ) {
                var xRoot = xRoots[j];
                
                if ( 0 <= xRoot && xRoot <= 1 ) {
                    for ( var k = 0; k < yRoots.length; k++ ) {
                        if ( Math.abs( xRoot - yRoots[k] ) < TOLERANCE ) {
                            result.points.push(
                                c23.multiply(s*s*s).add(c22.multiply(s*s).add(c21.multiply(s).add(c20)))
                            );
                            break checkRoots;
                        }
                    }
                }
            }
        }
    }

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;

};


/*****
*
*   intersectBezier2Circle
*
*****/
Intersection.intersectBezier2Circle = function(p1, p2, p3, c, r) {
    return Intersection.intersectBezier2Ellipse(p1, p2, p3, c, r, r);
};


/*****
*
*   intersectBezier2Ellipse
*
*****/
Intersection.intersectBezier2Ellipse = function(p1, p2, p3, ec, rx, ry) {
    var a, b;       // temporary variables
    var c2, c1, c0; // coefficients of quadratic
    var result = new Intersection("No Intersection");

    a = p2.multiply(-2);
    c2 = p1.add(a.add(p3));

    a = p1.multiply(-2);
    b = p2.multiply(2);
    c1 = a.add(b);

    c0 = new Point2D(p1.x, p1.y);

    var rxrx  = rx*rx;
    var ryry  = ry*ry;
    var roots = new Polynomial(
        ryry*c2.x*c2.x + rxrx*c2.y*c2.y,
        2*(ryry*c2.x*c1.x + rxrx*c2.y*c1.y),
        ryry*(2*c2.x*c0.x + c1.x*c1.x) + rxrx*(2*c2.y*c0.y+c1.y*c1.y) -
            2*(ryry*ec.x*c2.x + rxrx*ec.y*c2.y),
        2*(ryry*c1.x*(c0.x-ec.x) + rxrx*c1.y*(c0.y-ec.y)),
        ryry*(c0.x*c0.x+ec.x*ec.x) + rxrx*(c0.y*c0.y + ec.y*ec.y) -
            2*(ryry*ec.x*c0.x + rxrx*ec.y*c0.y) - rxrx*ryry
    ).getRoots();

    function isValid(value) {
    return ( 0 <= value && value <= 1 );
  }

    return roots.filter(isValid).sort();

    // for ( var i = 0; i < roots.length; i++ ) {
    //     var t = roots[i];
    //
    //     if ( 0 <= t && t <= 1 )
    //         result.points.push( c2.multiply(t*t).add(c1.multiply(t).add(c0)) );
    // }

    // if ( result.points.length > 0 ) result.status = "Intersection";
    //
    // return result;
};


/*****
*
*   intersectBezier2Line
*
*****/
Intersection.intersectBezier2Line = function(p1, p2, p3, a1, a2) {
    var a, b;             // temporary variables
    var c2, c1, c0;       // coefficients of quadratic
    var cl;               // c coefficient for normal form of line
    var n;                // normal for normal form of line
    var min = a1.min(a2); // used to determine if point is on line segment
    var max = a1.max(a2); // used to determine if point is on line segment
    var result = new Intersection("No Intersection");
    
    a = p2.multiply(-2);
    c2 = p1.add(a.add(p3));

    a = p1.multiply(-2);
    b = p2.multiply(2);
    c1 = a.add(b);

    c0 = new Point2D(p1.x, p1.y);

    // Convert line to normal form: ax + by + c = 0
    // Find normal to line: negative inverse of original line's slope
    n = new Vector2D(a1.y - a2.y, a2.x - a1.x);
    
    // Determine new c coefficient
    cl = a1.x*a2.y - a2.x*a1.y;

    // Transform cubic coefficients to line's coordinate system and find roots
    // of cubic
    roots = new Polynomial(
        n.dot(c2),
        n.dot(c1),
        n.dot(c0) + cl
    ).getRoots();

    // Any roots in closed interval [0,1] are intersections on Bezier, but
    // might not be on the line segment.
    // Find intersections and calculate point coordinates
    for ( var i = 0; i < roots.length; i++ ) {
        var t = roots[i];

        if ( 0 <= t && t <= 1 ) {
            // We're within the Bezier curve
            // Find point on Bezier
            var p4 = p1.lerp(p2, t);
            var p5 = p2.lerp(p3, t);

            var p6 = p4.lerp(p5, t);

            // See if point is on line segment
            // Had to make special cases for vertical and horizontal lines due
            // to slight errors in calculation of p6
            if ( a1.x == a2.x ) {
                if ( min.y <= p6.y && p6.y <= max.y ) {
                    result.status = "Intersection";
                    result.appendPoint( p6 );
                }
            } else if ( a1.y == a2.y ) {
                if ( min.x <= p6.x && p6.x <= max.x ) {
                    result.status = "Intersection";
                    result.appendPoint( p6 );
                }
            } else if ( p6.gte(min) && p6.lte(max) ) {
                result.status = "Intersection";
                result.appendPoint( p6 );
            }
        }
    }

    return result;
};


/*****
*
*   intersectBezier2Polygon
*
*****/
Intersection.intersectBezier2Polygon = function(p1, p2, p3, points) {
    var result = new Intersection("No Intersection");
    var length = points.length;

    for ( var i = 0; i < length; i++ ) {
        var a1 = points[i];
        var a2 = points[(i+1) % length];
        var inter = Intersection.intersectBezier2Line(p1, p2, p3, a1, a2);

        result.appendPoints(inter.points);
    }

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectBezier2Rectangle
*
*****/
Intersection.intersectBezier2Rectangle = function(p1, p2, p3, r1, r2) {
    var min        = r1.min(r2);
    var max        = r1.max(r2);
    var topRight   = new Point2D( max.x, min.y );
    var bottomLeft = new Point2D( min.x, max.y );
    
    var inter1 = Intersection.intersectBezier2Line(p1, p2, p3, min, topRight);
    var inter2 = Intersection.intersectBezier2Line(p1, p2, p3, topRight, max);
    var inter3 = Intersection.intersectBezier2Line(p1, p2, p3, max, bottomLeft);
    var inter4 = Intersection.intersectBezier2Line(p1, p2, p3, bottomLeft, min);
    
    var result = new Intersection("No Intersection");

    result.appendPoints(inter1.points);
    result.appendPoints(inter2.points);
    result.appendPoints(inter3.points);
    result.appendPoints(inter4.points);

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectBezier3Bezier3
*
*****/
Intersection.intersectBezier3Bezier3 = function(a1, a2, a3, a4, b1, b2, b3, b4) {
    var a, b, c, d;         // temporary variables
    var c13, c12, c11, c10; // coefficients of cubic
    var c23, c22, c21, c20; // coefficients of cubic
    var result = new Intersection("No Intersection");

    // Calculate the coefficients of cubic polynomial
    a = a1.multiply(-1);
    b = a2.multiply(3);
    c = a3.multiply(-3);
    d = a.add(b.add(c.add(a4)));
    c13 = new Vector2D(d.x, d.y);

    a = a1.multiply(3);
    b = a2.multiply(-6);
    c = a3.multiply(3);
    d = a.add(b.add(c));
    c12 = new Vector2D(d.x, d.y);

    a = a1.multiply(-3);
    b = a2.multiply(3);
    c = a.add(b);
    c11 = new Vector2D(c.x, c.y);

    c10 = new Vector2D(a1.x, a1.y);

    a = b1.multiply(-1);
    b = b2.multiply(3);
    c = b3.multiply(-3);
    d = a.add(b.add(c.add(b4)));
    c23 = new Vector2D(d.x, d.y);

    a = b1.multiply(3);
    b = b2.multiply(-6);
    c = b3.multiply(3);
    d = a.add(b.add(c));
    c22 = new Vector2D(d.x, d.y);

    a = b1.multiply(-3);
    b = b2.multiply(3);
    c = a.add(b);
    c21 = new Vector2D(c.x, c.y);

    c20 = new Vector2D(b1.x, b1.y);

    var c10x2 = c10.x*c10.x;
    var c10x3 = c10.x*c10.x*c10.x;
    var c10y2 = c10.y*c10.y;
    var c10y3 = c10.y*c10.y*c10.y;
    var c11x2 = c11.x*c11.x;
    var c11x3 = c11.x*c11.x*c11.x;
    var c11y2 = c11.y*c11.y;
    var c11y3 = c11.y*c11.y*c11.y;
    var c12x2 = c12.x*c12.x;
    var c12x3 = c12.x*c12.x*c12.x;
    var c12y2 = c12.y*c12.y;
    var c12y3 = c12.y*c12.y*c12.y;
    var c13x2 = c13.x*c13.x;
    var c13x3 = c13.x*c13.x*c13.x;
    var c13y2 = c13.y*c13.y;
    var c13y3 = c13.y*c13.y*c13.y;
    var c20x2 = c20.x*c20.x;
    var c20x3 = c20.x*c20.x*c20.x;
    var c20y2 = c20.y*c20.y;
    var c20y3 = c20.y*c20.y*c20.y;
    var c21x2 = c21.x*c21.x;
    var c21x3 = c21.x*c21.x*c21.x;
    var c21y2 = c21.y*c21.y;
    var c22x2 = c22.x*c22.x;
    var c22x3 = c22.x*c22.x*c22.x;
    var c22y2 = c22.y*c22.y;
    var c23x2 = c23.x*c23.x;
    var c23x3 = c23.x*c23.x*c23.x;
    var c23y2 = c23.y*c23.y;
    var c23y3 = c23.y*c23.y*c23.y;
    var poly = new Polynomial(
        -c13x3*c23y3 + c13y3*c23x3 - 3*c13.x*c13y2*c23x2*c23.y +
            3*c13x2*c13.y*c23.x*c23y2,
        -6*c13.x*c22.x*c13y2*c23.x*c23.y + 6*c13x2*c13.y*c22.y*c23.x*c23.y + 3*c22.x*c13y3*c23x2 -
            3*c13x3*c22.y*c23y2 - 3*c13.x*c13y2*c22.y*c23x2 + 3*c13x2*c22.x*c13.y*c23y2,
        -6*c21.x*c13.x*c13y2*c23.x*c23.y - 6*c13.x*c22.x*c13y2*c22.y*c23.x + 6*c13x2*c22.x*c13.y*c22.y*c23.y +
            3*c21.x*c13y3*c23x2 + 3*c22x2*c13y3*c23.x + 3*c21.x*c13x2*c13.y*c23y2 - 3*c13.x*c21.y*c13y2*c23x2 -
            3*c13.x*c22x2*c13y2*c23.y + c13x2*c13.y*c23.x*(6*c21.y*c23.y + 3*c22y2) + c13x3*(-c21.y*c23y2 -
            2*c22y2*c23.y - c23.y*(2*c21.y*c23.y + c22y2)),
        c11.x*c12.y*c13.x*c13.y*c23.x*c23.y - c11.y*c12.x*c13.x*c13.y*c23.x*c23.y + 6*c21.x*c22.x*c13y3*c23.x +
            3*c11.x*c12.x*c13.x*c13.y*c23y2 + 6*c10.x*c13.x*c13y2*c23.x*c23.y - 3*c11.x*c12.x*c13y2*c23.x*c23.y -
            3*c11.y*c12.y*c13.x*c13.y*c23x2 - 6*c10.y*c13x2*c13.y*c23.x*c23.y - 6*c20.x*c13.x*c13y2*c23.x*c23.y +
            3*c11.y*c12.y*c13x2*c23.x*c23.y - 2*c12.x*c12y2*c13.x*c23.x*c23.y - 6*c21.x*c13.x*c22.x*c13y2*c23.y -
            6*c21.x*c13.x*c13y2*c22.y*c23.x - 6*c13.x*c21.y*c22.x*c13y2*c23.x + 6*c21.x*c13x2*c13.y*c22.y*c23.y +
            2*c12x2*c12.y*c13.y*c23.x*c23.y + c22x3*c13y3 - 3*c10.x*c13y3*c23x2 + 3*c10.y*c13x3*c23y2 +
            3*c20.x*c13y3*c23x2 + c12y3*c13.x*c23x2 - c12x3*c13.y*c23y2 - 3*c10.x*c13x2*c13.y*c23y2 +
            3*c10.y*c13.x*c13y2*c23x2 - 2*c11.x*c12.y*c13x2*c23y2 + c11.x*c12.y*c13y2*c23x2 - c11.y*c12.x*c13x2*c23y2 +
            2*c11.y*c12.x*c13y2*c23x2 + 3*c20.x*c13x2*c13.y*c23y2 - c12.x*c12y2*c13.y*c23x2 -
            3*c20.y*c13.x*c13y2*c23x2 + c12x2*c12.y*c13.x*c23y2 - 3*c13.x*c22x2*c13y2*c22.y +
            c13x2*c13.y*c23.x*(6*c20.y*c23.y + 6*c21.y*c22.y) + c13x2*c22.x*c13.y*(6*c21.y*c23.y + 3*c22y2) +
            c13x3*(-2*c21.y*c22.y*c23.y - c20.y*c23y2 - c22.y*(2*c21.y*c23.y + c22y2) - c23.y*(2*c20.y*c23.y + 2*c21.y*c22.y)),
        6*c11.x*c12.x*c13.x*c13.y*c22.y*c23.y + c11.x*c12.y*c13.x*c22.x*c13.y*c23.y + c11.x*c12.y*c13.x*c13.y*c22.y*c23.x -
            c11.y*c12.x*c13.x*c22.x*c13.y*c23.y - c11.y*c12.x*c13.x*c13.y*c22.y*c23.x - 6*c11.y*c12.y*c13.x*c22.x*c13.y*c23.x -
            6*c10.x*c22.x*c13y3*c23.x + 6*c20.x*c22.x*c13y3*c23.x + 6*c10.y*c13x3*c22.y*c23.y + 2*c12y3*c13.x*c22.x*c23.x -
            2*c12x3*c13.y*c22.y*c23.y + 6*c10.x*c13.x*c22.x*c13y2*c23.y + 6*c10.x*c13.x*c13y2*c22.y*c23.x +
            6*c10.y*c13.x*c22.x*c13y2*c23.x - 3*c11.x*c12.x*c22.x*c13y2*c23.y - 3*c11.x*c12.x*c13y2*c22.y*c23.x +
            2*c11.x*c12.y*c22.x*c13y2*c23.x + 4*c11.y*c12.x*c22.x*c13y2*c23.x - 6*c10.x*c13x2*c13.y*c22.y*c23.y -
            6*c10.y*c13x2*c22.x*c13.y*c23.y - 6*c10.y*c13x2*c13.y*c22.y*c23.x - 4*c11.x*c12.y*c13x2*c22.y*c23.y -
            6*c20.x*c13.x*c22.x*c13y2*c23.y - 6*c20.x*c13.x*c13y2*c22.y*c23.x - 2*c11.y*c12.x*c13x2*c22.y*c23.y +
            3*c11.y*c12.y*c13x2*c22.x*c23.y + 3*c11.y*c12.y*c13x2*c22.y*c23.x - 2*c12.x*c12y2*c13.x*c22.x*c23.y -
            2*c12.x*c12y2*c13.x*c22.y*c23.x - 2*c12.x*c12y2*c22.x*c13.y*c23.x - 6*c20.y*c13.x*c22.x*c13y2*c23.x -
            6*c21.x*c13.x*c21.y*c13y2*c23.x - 6*c21.x*c13.x*c22.x*c13y2*c22.y + 6*c20.x*c13x2*c13.y*c22.y*c23.y +
            2*c12x2*c12.y*c13.x*c22.y*c23.y + 2*c12x2*c12.y*c22.x*c13.y*c23.y + 2*c12x2*c12.y*c13.y*c22.y*c23.x +
            3*c21.x*c22x2*c13y3 + 3*c21x2*c13y3*c23.x - 3*c13.x*c21.y*c22x2*c13y2 - 3*c21x2*c13.x*c13y2*c23.y +
            c13x2*c22.x*c13.y*(6*c20.y*c23.y + 6*c21.y*c22.y) + c13x2*c13.y*c23.x*(6*c20.y*c22.y + 3*c21y2) +
            c21.x*c13x2*c13.y*(6*c21.y*c23.y + 3*c22y2) + c13x3*(-2*c20.y*c22.y*c23.y - c23.y*(2*c20.y*c22.y + c21y2) -
            c21.y*(2*c21.y*c23.y + c22y2) - c22.y*(2*c20.y*c23.y + 2*c21.y*c22.y)),
        c11.x*c21.x*c12.y*c13.x*c13.y*c23.y + c11.x*c12.y*c13.x*c21.y*c13.y*c23.x + c11.x*c12.y*c13.x*c22.x*c13.y*c22.y -
            c11.y*c12.x*c21.x*c13.x*c13.y*c23.y - c11.y*c12.x*c13.x*c21.y*c13.y*c23.x - c11.y*c12.x*c13.x*c22.x*c13.y*c22.y -
            6*c11.y*c21.x*c12.y*c13.x*c13.y*c23.x - 6*c10.x*c21.x*c13y3*c23.x + 6*c20.x*c21.x*c13y3*c23.x +
            2*c21.x*c12y3*c13.x*c23.x + 6*c10.x*c21.x*c13.x*c13y2*c23.y + 6*c10.x*c13.x*c21.y*c13y2*c23.x +
            6*c10.x*c13.x*c22.x*c13y2*c22.y + 6*c10.y*c21.x*c13.x*c13y2*c23.x - 3*c11.x*c12.x*c21.x*c13y2*c23.y -
            3*c11.x*c12.x*c21.y*c13y2*c23.x - 3*c11.x*c12.x*c22.x*c13y2*c22.y + 2*c11.x*c21.x*c12.y*c13y2*c23.x +
            4*c11.y*c12.x*c21.x*c13y2*c23.x - 6*c10.y*c21.x*c13x2*c13.y*c23.y - 6*c10.y*c13x2*c21.y*c13.y*c23.x -
            6*c10.y*c13x2*c22.x*c13.y*c22.y - 6*c20.x*c21.x*c13.x*c13y2*c23.y - 6*c20.x*c13.x*c21.y*c13y2*c23.x -
            6*c20.x*c13.x*c22.x*c13y2*c22.y + 3*c11.y*c21.x*c12.y*c13x2*c23.y - 3*c11.y*c12.y*c13.x*c22x2*c13.y +
            3*c11.y*c12.y*c13x2*c21.y*c23.x + 3*c11.y*c12.y*c13x2*c22.x*c22.y - 2*c12.x*c21.x*c12y2*c13.x*c23.y -
            2*c12.x*c21.x*c12y2*c13.y*c23.x - 2*c12.x*c12y2*c13.x*c21.y*c23.x - 2*c12.x*c12y2*c13.x*c22.x*c22.y -
            6*c20.y*c21.x*c13.x*c13y2*c23.x - 6*c21.x*c13.x*c21.y*c22.x*c13y2 + 6*c20.y*c13x2*c21.y*c13.y*c23.x +
            2*c12x2*c21.x*c12.y*c13.y*c23.y + 2*c12x2*c12.y*c21.y*c13.y*c23.x + 2*c12x2*c12.y*c22.x*c13.y*c22.y -
            3*c10.x*c22x2*c13y3 + 3*c20.x*c22x2*c13y3 + 3*c21x2*c22.x*c13y3 + c12y3*c13.x*c22x2 +
            3*c10.y*c13.x*c22x2*c13y2 + c11.x*c12.y*c22x2*c13y2 + 2*c11.y*c12.x*c22x2*c13y2 -
            c12.x*c12y2*c22x2*c13.y - 3*c20.y*c13.x*c22x2*c13y2 - 3*c21x2*c13.x*c13y2*c22.y +
            c12x2*c12.y*c13.x*(2*c21.y*c23.y + c22y2) + c11.x*c12.x*c13.x*c13.y*(6*c21.y*c23.y + 3*c22y2) +
            c21.x*c13x2*c13.y*(6*c20.y*c23.y + 6*c21.y*c22.y) + c12x3*c13.y*(-2*c21.y*c23.y - c22y2) +
            c10.y*c13x3*(6*c21.y*c23.y + 3*c22y2) + c11.y*c12.x*c13x2*(-2*c21.y*c23.y - c22y2) +
            c11.x*c12.y*c13x2*(-4*c21.y*c23.y - 2*c22y2) + c10.x*c13x2*c13.y*(-6*c21.y*c23.y - 3*c22y2) +
            c13x2*c22.x*c13.y*(6*c20.y*c22.y + 3*c21y2) + c20.x*c13x2*c13.y*(6*c21.y*c23.y + 3*c22y2) +
            c13x3*(-2*c20.y*c21.y*c23.y - c22.y*(2*c20.y*c22.y + c21y2) - c20.y*(2*c21.y*c23.y + c22y2) -
            c21.y*(2*c20.y*c23.y + 2*c21.y*c22.y)),
        -c10.x*c11.x*c12.y*c13.x*c13.y*c23.y + c10.x*c11.y*c12.x*c13.x*c13.y*c23.y + 6*c10.x*c11.y*c12.y*c13.x*c13.y*c23.x -
            6*c10.y*c11.x*c12.x*c13.x*c13.y*c23.y - c10.y*c11.x*c12.y*c13.x*c13.y*c23.x + c10.y*c11.y*c12.x*c13.x*c13.y*c23.x +
            c11.x*c11.y*c12.x*c12.y*c13.x*c23.y - c11.x*c11.y*c12.x*c12.y*c13.y*c23.x + c11.x*c20.x*c12.y*c13.x*c13.y*c23.y +
            c11.x*c20.y*c12.y*c13.x*c13.y*c23.x + c11.x*c21.x*c12.y*c13.x*c13.y*c22.y + c11.x*c12.y*c13.x*c21.y*c22.x*c13.y -
            c20.x*c11.y*c12.x*c13.x*c13.y*c23.y - 6*c20.x*c11.y*c12.y*c13.x*c13.y*c23.x - c11.y*c12.x*c20.y*c13.x*c13.y*c23.x -
            c11.y*c12.x*c21.x*c13.x*c13.y*c22.y - c11.y*c12.x*c13.x*c21.y*c22.x*c13.y - 6*c11.y*c21.x*c12.y*c13.x*c22.x*c13.y -
            6*c10.x*c20.x*c13y3*c23.x - 6*c10.x*c21.x*c22.x*c13y3 - 2*c10.x*c12y3*c13.x*c23.x + 6*c20.x*c21.x*c22.x*c13y3 +
            2*c20.x*c12y3*c13.x*c23.x + 2*c21.x*c12y3*c13.x*c22.x + 2*c10.y*c12x3*c13.y*c23.y - 6*c10.x*c10.y*c13.x*c13y2*c23.x +
            3*c10.x*c11.x*c12.x*c13y2*c23.y - 2*c10.x*c11.x*c12.y*c13y2*c23.x - 4*c10.x*c11.y*c12.x*c13y2*c23.x +
            3*c10.y*c11.x*c12.x*c13y2*c23.x + 6*c10.x*c10.y*c13x2*c13.y*c23.y + 6*c10.x*c20.x*c13.x*c13y2*c23.y -
            3*c10.x*c11.y*c12.y*c13x2*c23.y + 2*c10.x*c12.x*c12y2*c13.x*c23.y + 2*c10.x*c12.x*c12y2*c13.y*c23.x +
            6*c10.x*c20.y*c13.x*c13y2*c23.x + 6*c10.x*c21.x*c13.x*c13y2*c22.y + 6*c10.x*c13.x*c21.y*c22.x*c13y2 +
            4*c10.y*c11.x*c12.y*c13x2*c23.y + 6*c10.y*c20.x*c13.x*c13y2*c23.x + 2*c10.y*c11.y*c12.x*c13x2*c23.y -
            3*c10.y*c11.y*c12.y*c13x2*c23.x + 2*c10.y*c12.x*c12y2*c13.x*c23.x + 6*c10.y*c21.x*c13.x*c22.x*c13y2 -
            3*c11.x*c20.x*c12.x*c13y2*c23.y + 2*c11.x*c20.x*c12.y*c13y2*c23.x + c11.x*c11.y*c12y2*c13.x*c23.x -
            3*c11.x*c12.x*c20.y*c13y2*c23.x - 3*c11.x*c12.x*c21.x*c13y2*c22.y - 3*c11.x*c12.x*c21.y*c22.x*c13y2 +
            2*c11.x*c21.x*c12.y*c22.x*c13y2 + 4*c20.x*c11.y*c12.x*c13y2*c23.x + 4*c11.y*c12.x*c21.x*c22.x*c13y2 -
            2*c10.x*c12x2*c12.y*c13.y*c23.y - 6*c10.y*c20.x*c13x2*c13.y*c23.y - 6*c10.y*c20.y*c13x2*c13.y*c23.x -
            6*c10.y*c21.x*c13x2*c13.y*c22.y - 2*c10.y*c12x2*c12.y*c13.x*c23.y - 2*c10.y*c12x2*c12.y*c13.y*c23.x -
            6*c10.y*c13x2*c21.y*c22.x*c13.y - c11.x*c11.y*c12x2*c13.y*c23.y - 2*c11.x*c11y2*c13.x*c13.y*c23.x +
            3*c20.x*c11.y*c12.y*c13x2*c23.y - 2*c20.x*c12.x*c12y2*c13.x*c23.y - 2*c20.x*c12.x*c12y2*c13.y*c23.x -
            6*c20.x*c20.y*c13.x*c13y2*c23.x - 6*c20.x*c21.x*c13.x*c13y2*c22.y - 6*c20.x*c13.x*c21.y*c22.x*c13y2 +
            3*c11.y*c20.y*c12.y*c13x2*c23.x + 3*c11.y*c21.x*c12.y*c13x2*c22.y + 3*c11.y*c12.y*c13x2*c21.y*c22.x -
            2*c12.x*c20.y*c12y2*c13.x*c23.x - 2*c12.x*c21.x*c12y2*c13.x*c22.y - 2*c12.x*c21.x*c12y2*c22.x*c13.y -
            2*c12.x*c12y2*c13.x*c21.y*c22.x - 6*c20.y*c21.x*c13.x*c22.x*c13y2 - c11y2*c12.x*c12.y*c13.x*c23.x +
            2*c20.x*c12x2*c12.y*c13.y*c23.y + 6*c20.y*c13x2*c21.y*c22.x*c13.y + 2*c11x2*c11.y*c13.x*c13.y*c23.y +
            c11x2*c12.x*c12.y*c13.y*c23.y + 2*c12x2*c20.y*c12.y*c13.y*c23.x + 2*c12x2*c21.x*c12.y*c13.y*c22.y +
            2*c12x2*c12.y*c21.y*c22.x*c13.y + c21x3*c13y3 + 3*c10x2*c13y3*c23.x - 3*c10y2*c13x3*c23.y +
            3*c20x2*c13y3*c23.x + c11y3*c13x2*c23.x - c11x3*c13y2*c23.y - c11.x*c11y2*c13x2*c23.y +
            c11x2*c11.y*c13y2*c23.x - 3*c10x2*c13.x*c13y2*c23.y + 3*c10y2*c13x2*c13.y*c23.x - c11x2*c12y2*c13.x*c23.y +
            c11y2*c12x2*c13.y*c23.x - 3*c21x2*c13.x*c21.y*c13y2 - 3*c20x2*c13.x*c13y2*c23.y + 3*c20y2*c13x2*c13.y*c23.x +
            c11.x*c12.x*c13.x*c13.y*(6*c20.y*c23.y + 6*c21.y*c22.y) + c12x3*c13.y*(-2*c20.y*c23.y - 2*c21.y*c22.y) +
            c10.y*c13x3*(6*c20.y*c23.y + 6*c21.y*c22.y) + c11.y*c12.x*c13x2*(-2*c20.y*c23.y - 2*c21.y*c22.y) +
            c12x2*c12.y*c13.x*(2*c20.y*c23.y + 2*c21.y*c22.y) + c11.x*c12.y*c13x2*(-4*c20.y*c23.y - 4*c21.y*c22.y) +
            c10.x*c13x2*c13.y*(-6*c20.y*c23.y - 6*c21.y*c22.y) + c20.x*c13x2*c13.y*(6*c20.y*c23.y + 6*c21.y*c22.y) +
            c21.x*c13x2*c13.y*(6*c20.y*c22.y + 3*c21y2) + c13x3*(-2*c20.y*c21.y*c22.y - c20y2*c23.y -
            c21.y*(2*c20.y*c22.y + c21y2) - c20.y*(2*c20.y*c23.y + 2*c21.y*c22.y)),
        -c10.x*c11.x*c12.y*c13.x*c13.y*c22.y + c10.x*c11.y*c12.x*c13.x*c13.y*c22.y + 6*c10.x*c11.y*c12.y*c13.x*c22.x*c13.y -
            6*c10.y*c11.x*c12.x*c13.x*c13.y*c22.y - c10.y*c11.x*c12.y*c13.x*c22.x*c13.y + c10.y*c11.y*c12.x*c13.x*c22.x*c13.y +
            c11.x*c11.y*c12.x*c12.y*c13.x*c22.y - c11.x*c11.y*c12.x*c12.y*c22.x*c13.y + c11.x*c20.x*c12.y*c13.x*c13.y*c22.y +
            c11.x*c20.y*c12.y*c13.x*c22.x*c13.y + c11.x*c21.x*c12.y*c13.x*c21.y*c13.y - c20.x*c11.y*c12.x*c13.x*c13.y*c22.y -
            6*c20.x*c11.y*c12.y*c13.x*c22.x*c13.y - c11.y*c12.x*c20.y*c13.x*c22.x*c13.y - c11.y*c12.x*c21.x*c13.x*c21.y*c13.y -
            6*c10.x*c20.x*c22.x*c13y3 - 2*c10.x*c12y3*c13.x*c22.x + 2*c20.x*c12y3*c13.x*c22.x + 2*c10.y*c12x3*c13.y*c22.y -
            6*c10.x*c10.y*c13.x*c22.x*c13y2 + 3*c10.x*c11.x*c12.x*c13y2*c22.y - 2*c10.x*c11.x*c12.y*c22.x*c13y2 -
            4*c10.x*c11.y*c12.x*c22.x*c13y2 + 3*c10.y*c11.x*c12.x*c22.x*c13y2 + 6*c10.x*c10.y*c13x2*c13.y*c22.y +
            6*c10.x*c20.x*c13.x*c13y2*c22.y - 3*c10.x*c11.y*c12.y*c13x2*c22.y + 2*c10.x*c12.x*c12y2*c13.x*c22.y +
            2*c10.x*c12.x*c12y2*c22.x*c13.y + 6*c10.x*c20.y*c13.x*c22.x*c13y2 + 6*c10.x*c21.x*c13.x*c21.y*c13y2 +
            4*c10.y*c11.x*c12.y*c13x2*c22.y + 6*c10.y*c20.x*c13.x*c22.x*c13y2 + 2*c10.y*c11.y*c12.x*c13x2*c22.y -
            3*c10.y*c11.y*c12.y*c13x2*c22.x + 2*c10.y*c12.x*c12y2*c13.x*c22.x - 3*c11.x*c20.x*c12.x*c13y2*c22.y +
            2*c11.x*c20.x*c12.y*c22.x*c13y2 + c11.x*c11.y*c12y2*c13.x*c22.x - 3*c11.x*c12.x*c20.y*c22.x*c13y2 -
            3*c11.x*c12.x*c21.x*c21.y*c13y2 + 4*c20.x*c11.y*c12.x*c22.x*c13y2 - 2*c10.x*c12x2*c12.y*c13.y*c22.y -
            6*c10.y*c20.x*c13x2*c13.y*c22.y - 6*c10.y*c20.y*c13x2*c22.x*c13.y - 6*c10.y*c21.x*c13x2*c21.y*c13.y -
            2*c10.y*c12x2*c12.y*c13.x*c22.y - 2*c10.y*c12x2*c12.y*c22.x*c13.y - c11.x*c11.y*c12x2*c13.y*c22.y -
            2*c11.x*c11y2*c13.x*c22.x*c13.y + 3*c20.x*c11.y*c12.y*c13x2*c22.y - 2*c20.x*c12.x*c12y2*c13.x*c22.y -
            2*c20.x*c12.x*c12y2*c22.x*c13.y - 6*c20.x*c20.y*c13.x*c22.x*c13y2 - 6*c20.x*c21.x*c13.x*c21.y*c13y2 +
            3*c11.y*c20.y*c12.y*c13x2*c22.x + 3*c11.y*c21.x*c12.y*c13x2*c21.y - 2*c12.x*c20.y*c12y2*c13.x*c22.x -
            2*c12.x*c21.x*c12y2*c13.x*c21.y - c11y2*c12.x*c12.y*c13.x*c22.x + 2*c20.x*c12x2*c12.y*c13.y*c22.y -
            3*c11.y*c21x2*c12.y*c13.x*c13.y + 6*c20.y*c21.x*c13x2*c21.y*c13.y + 2*c11x2*c11.y*c13.x*c13.y*c22.y +
            c11x2*c12.x*c12.y*c13.y*c22.y + 2*c12x2*c20.y*c12.y*c22.x*c13.y + 2*c12x2*c21.x*c12.y*c21.y*c13.y -
            3*c10.x*c21x2*c13y3 + 3*c20.x*c21x2*c13y3 + 3*c10x2*c22.x*c13y3 - 3*c10y2*c13x3*c22.y + 3*c20x2*c22.x*c13y3 +
            c21x2*c12y3*c13.x + c11y3*c13x2*c22.x - c11x3*c13y2*c22.y + 3*c10.y*c21x2*c13.x*c13y2 -
            c11.x*c11y2*c13x2*c22.y + c11.x*c21x2*c12.y*c13y2 + 2*c11.y*c12.x*c21x2*c13y2 + c11x2*c11.y*c22.x*c13y2 -
            c12.x*c21x2*c12y2*c13.y - 3*c20.y*c21x2*c13.x*c13y2 - 3*c10x2*c13.x*c13y2*c22.y + 3*c10y2*c13x2*c22.x*c13.y -
            c11x2*c12y2*c13.x*c22.y + c11y2*c12x2*c22.x*c13.y - 3*c20x2*c13.x*c13y2*c22.y + 3*c20y2*c13x2*c22.x*c13.y +
            c12x2*c12.y*c13.x*(2*c20.y*c22.y + c21y2) + c11.x*c12.x*c13.x*c13.y*(6*c20.y*c22.y + 3*c21y2) +
            c12x3*c13.y*(-2*c20.y*c22.y - c21y2) + c10.y*c13x3*(6*c20.y*c22.y + 3*c21y2) +
            c11.y*c12.x*c13x2*(-2*c20.y*c22.y - c21y2) + c11.x*c12.y*c13x2*(-4*c20.y*c22.y - 2*c21y2) +
            c10.x*c13x2*c13.y*(-6*c20.y*c22.y - 3*c21y2) + c20.x*c13x2*c13.y*(6*c20.y*c22.y + 3*c21y2) +
            c13x3*(-2*c20.y*c21y2 - c20y2*c22.y - c20.y*(2*c20.y*c22.y + c21y2)),
        -c10.x*c11.x*c12.y*c13.x*c21.y*c13.y + c10.x*c11.y*c12.x*c13.x*c21.y*c13.y + 6*c10.x*c11.y*c21.x*c12.y*c13.x*c13.y -
            6*c10.y*c11.x*c12.x*c13.x*c21.y*c13.y - c10.y*c11.x*c21.x*c12.y*c13.x*c13.y + c10.y*c11.y*c12.x*c21.x*c13.x*c13.y -
            c11.x*c11.y*c12.x*c21.x*c12.y*c13.y + c11.x*c11.y*c12.x*c12.y*c13.x*c21.y + c11.x*c20.x*c12.y*c13.x*c21.y*c13.y +
            6*c11.x*c12.x*c20.y*c13.x*c21.y*c13.y + c11.x*c20.y*c21.x*c12.y*c13.x*c13.y - c20.x*c11.y*c12.x*c13.x*c21.y*c13.y -
            6*c20.x*c11.y*c21.x*c12.y*c13.x*c13.y - c11.y*c12.x*c20.y*c21.x*c13.x*c13.y - 6*c10.x*c20.x*c21.x*c13y3 -
            2*c10.x*c21.x*c12y3*c13.x + 6*c10.y*c20.y*c13x3*c21.y + 2*c20.x*c21.x*c12y3*c13.x + 2*c10.y*c12x3*c21.y*c13.y -
            2*c12x3*c20.y*c21.y*c13.y - 6*c10.x*c10.y*c21.x*c13.x*c13y2 + 3*c10.x*c11.x*c12.x*c21.y*c13y2 -
            2*c10.x*c11.x*c21.x*c12.y*c13y2 - 4*c10.x*c11.y*c12.x*c21.x*c13y2 + 3*c10.y*c11.x*c12.x*c21.x*c13y2 +
            6*c10.x*c10.y*c13x2*c21.y*c13.y + 6*c10.x*c20.x*c13.x*c21.y*c13y2 - 3*c10.x*c11.y*c12.y*c13x2*c21.y +
            2*c10.x*c12.x*c21.x*c12y2*c13.y + 2*c10.x*c12.x*c12y2*c13.x*c21.y + 6*c10.x*c20.y*c21.x*c13.x*c13y2 +
            4*c10.y*c11.x*c12.y*c13x2*c21.y + 6*c10.y*c20.x*c21.x*c13.x*c13y2 + 2*c10.y*c11.y*c12.x*c13x2*c21.y -
            3*c10.y*c11.y*c21.x*c12.y*c13x2 + 2*c10.y*c12.x*c21.x*c12y2*c13.x - 3*c11.x*c20.x*c12.x*c21.y*c13y2 +
            2*c11.x*c20.x*c21.x*c12.y*c13y2 + c11.x*c11.y*c21.x*c12y2*c13.x - 3*c11.x*c12.x*c20.y*c21.x*c13y2 +
            4*c20.x*c11.y*c12.x*c21.x*c13y2 - 6*c10.x*c20.y*c13x2*c21.y*c13.y - 2*c10.x*c12x2*c12.y*c21.y*c13.y -
            6*c10.y*c20.x*c13x2*c21.y*c13.y - 6*c10.y*c20.y*c21.x*c13x2*c13.y - 2*c10.y*c12x2*c21.x*c12.y*c13.y -
            2*c10.y*c12x2*c12.y*c13.x*c21.y - c11.x*c11.y*c12x2*c21.y*c13.y - 4*c11.x*c20.y*c12.y*c13x2*c21.y -
            2*c11.x*c11y2*c21.x*c13.x*c13.y + 3*c20.x*c11.y*c12.y*c13x2*c21.y - 2*c20.x*c12.x*c21.x*c12y2*c13.y -
            2*c20.x*c12.x*c12y2*c13.x*c21.y - 6*c20.x*c20.y*c21.x*c13.x*c13y2 - 2*c11.y*c12.x*c20.y*c13x2*c21.y +
            3*c11.y*c20.y*c21.x*c12.y*c13x2 - 2*c12.x*c20.y*c21.x*c12y2*c13.x - c11y2*c12.x*c21.x*c12.y*c13.x +
            6*c20.x*c20.y*c13x2*c21.y*c13.y + 2*c20.x*c12x2*c12.y*c21.y*c13.y + 2*c11x2*c11.y*c13.x*c21.y*c13.y +
            c11x2*c12.x*c12.y*c21.y*c13.y + 2*c12x2*c20.y*c21.x*c12.y*c13.y + 2*c12x2*c20.y*c12.y*c13.x*c21.y +
            3*c10x2*c21.x*c13y3 - 3*c10y2*c13x3*c21.y + 3*c20x2*c21.x*c13y3 + c11y3*c21.x*c13x2 - c11x3*c21.y*c13y2 -
            3*c20y2*c13x3*c21.y - c11.x*c11y2*c13x2*c21.y + c11x2*c11.y*c21.x*c13y2 - 3*c10x2*c13.x*c21.y*c13y2 +
            3*c10y2*c21.x*c13x2*c13.y - c11x2*c12y2*c13.x*c21.y + c11y2*c12x2*c21.x*c13.y - 3*c20x2*c13.x*c21.y*c13y2 +
            3*c20y2*c21.x*c13x2*c13.y,
        c10.x*c10.y*c11.x*c12.y*c13.x*c13.y - c10.x*c10.y*c11.y*c12.x*c13.x*c13.y + c10.x*c11.x*c11.y*c12.x*c12.y*c13.y -
            c10.y*c11.x*c11.y*c12.x*c12.y*c13.x - c10.x*c11.x*c20.y*c12.y*c13.x*c13.y + 6*c10.x*c20.x*c11.y*c12.y*c13.x*c13.y +
            c10.x*c11.y*c12.x*c20.y*c13.x*c13.y - c10.y*c11.x*c20.x*c12.y*c13.x*c13.y - 6*c10.y*c11.x*c12.x*c20.y*c13.x*c13.y +
            c10.y*c20.x*c11.y*c12.x*c13.x*c13.y - c11.x*c20.x*c11.y*c12.x*c12.y*c13.y + c11.x*c11.y*c12.x*c20.y*c12.y*c13.x +
            c11.x*c20.x*c20.y*c12.y*c13.x*c13.y - c20.x*c11.y*c12.x*c20.y*c13.x*c13.y - 2*c10.x*c20.x*c12y3*c13.x +
            2*c10.y*c12x3*c20.y*c13.y - 3*c10.x*c10.y*c11.x*c12.x*c13y2 - 6*c10.x*c10.y*c20.x*c13.x*c13y2 +
            3*c10.x*c10.y*c11.y*c12.y*c13x2 - 2*c10.x*c10.y*c12.x*c12y2*c13.x - 2*c10.x*c11.x*c20.x*c12.y*c13y2 -
            c10.x*c11.x*c11.y*c12y2*c13.x + 3*c10.x*c11.x*c12.x*c20.y*c13y2 - 4*c10.x*c20.x*c11.y*c12.x*c13y2 +
            3*c10.y*c11.x*c20.x*c12.x*c13y2 + 6*c10.x*c10.y*c20.y*c13x2*c13.y + 2*c10.x*c10.y*c12x2*c12.y*c13.y +
            2*c10.x*c11.x*c11y2*c13.x*c13.y + 2*c10.x*c20.x*c12.x*c12y2*c13.y + 6*c10.x*c20.x*c20.y*c13.x*c13y2 -
            3*c10.x*c11.y*c20.y*c12.y*c13x2 + 2*c10.x*c12.x*c20.y*c12y2*c13.x + c10.x*c11y2*c12.x*c12.y*c13.x +
            c10.y*c11.x*c11.y*c12x2*c13.y + 4*c10.y*c11.x*c20.y*c12.y*c13x2 - 3*c10.y*c20.x*c11.y*c12.y*c13x2 +
            2*c10.y*c20.x*c12.x*c12y2*c13.x + 2*c10.y*c11.y*c12.x*c20.y*c13x2 + c11.x*c20.x*c11.y*c12y2*c13.x -
            3*c11.x*c20.x*c12.x*c20.y*c13y2 - 2*c10.x*c12x2*c20.y*c12.y*c13.y - 6*c10.y*c20.x*c20.y*c13x2*c13.y -
            2*c10.y*c20.x*c12x2*c12.y*c13.y - 2*c10.y*c11x2*c11.y*c13.x*c13.y - c10.y*c11x2*c12.x*c12.y*c13.y -
            2*c10.y*c12x2*c20.y*c12.y*c13.x - 2*c11.x*c20.x*c11y2*c13.x*c13.y - c11.x*c11.y*c12x2*c20.y*c13.y +
            3*c20.x*c11.y*c20.y*c12.y*c13x2 - 2*c20.x*c12.x*c20.y*c12y2*c13.x - c20.x*c11y2*c12.x*c12.y*c13.x +
            3*c10y2*c11.x*c12.x*c13.x*c13.y + 3*c11.x*c12.x*c20y2*c13.x*c13.y + 2*c20.x*c12x2*c20.y*c12.y*c13.y -
            3*c10x2*c11.y*c12.y*c13.x*c13.y + 2*c11x2*c11.y*c20.y*c13.x*c13.y + c11x2*c12.x*c20.y*c12.y*c13.y -
            3*c20x2*c11.y*c12.y*c13.x*c13.y - c10x3*c13y3 + c10y3*c13x3 + c20x3*c13y3 - c20y3*c13x3 -
            3*c10.x*c20x2*c13y3 - c10.x*c11y3*c13x2 + 3*c10x2*c20.x*c13y3 + c10.y*c11x3*c13y2 +
            3*c10.y*c20y2*c13x3 + c20.x*c11y3*c13x2 + c10x2*c12y3*c13.x - 3*c10y2*c20.y*c13x3 - c10y2*c12x3*c13.y +
            c20x2*c12y3*c13.x - c11x3*c20.y*c13y2 - c12x3*c20y2*c13.y - c10.x*c11x2*c11.y*c13y2 +
            c10.y*c11.x*c11y2*c13x2 - 3*c10.x*c10y2*c13x2*c13.y - c10.x*c11y2*c12x2*c13.y + c10.y*c11x2*c12y2*c13.x -
            c11.x*c11y2*c20.y*c13x2 + 3*c10x2*c10.y*c13.x*c13y2 + c10x2*c11.x*c12.y*c13y2 +
            2*c10x2*c11.y*c12.x*c13y2 - 2*c10y2*c11.x*c12.y*c13x2 - c10y2*c11.y*c12.x*c13x2 + c11x2*c20.x*c11.y*c13y2 -
            3*c10.x*c20y2*c13x2*c13.y + 3*c10.y*c20x2*c13.x*c13y2 + c11.x*c20x2*c12.y*c13y2 - 2*c11.x*c20y2*c12.y*c13x2 +
            c20.x*c11y2*c12x2*c13.y - c11.y*c12.x*c20y2*c13x2 - c10x2*c12.x*c12y2*c13.y - 3*c10x2*c20.y*c13.x*c13y2 +
            3*c10y2*c20.x*c13x2*c13.y + c10y2*c12x2*c12.y*c13.x - c11x2*c20.y*c12y2*c13.x + 2*c20x2*c11.y*c12.x*c13y2 +
            3*c20.x*c20y2*c13x2*c13.y - c20x2*c12.x*c12y2*c13.y - 3*c20x2*c20.y*c13.x*c13y2 + c12x2*c20y2*c12.y*c13.x
    );
    var roots = poly.getRootsInInterval(0,1);

    for ( var i = 0; i < roots.length; i++ ) {
        var s = roots[i];
        var xRoots = new Polynomial(
            c13.x,
            c12.x,
            c11.x,
            c10.x - c20.x - s*c21.x - s*s*c22.x - s*s*s*c23.x
        ).getRoots();
        var yRoots = new Polynomial(
            c13.y,
            c12.y,
            c11.y,
            c10.y - c20.y - s*c21.y - s*s*c22.y - s*s*s*c23.y
        ).getRoots();

        if ( xRoots.length > 0 && yRoots.length > 0 ) {
            var TOLERANCE = 1e-4;

            checkRoots:
            for ( var j = 0; j < xRoots.length; j++ ) {
                var xRoot = xRoots[j];
                
                if ( 0 <= xRoot && xRoot <= 1 ) {
                    for ( var k = 0; k < yRoots.length; k++ ) {
                        if ( Math.abs( xRoot - yRoots[k] ) < TOLERANCE ) {
                            result.points.push(
                                c23.multiply(s*s*s).add(c22.multiply(s*s).add(c21.multiply(s).add(c20)))
                            );
                            break checkRoots;
                        }
                    }
                }
            }
        }
    }

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectBezier3Circle
*
*****/
Intersection.intersectBezier3Circle = function(p1, p2, p3, p4, c, r) {
    return Intersection.intersectBezier3Ellipse(p1, p2, p3, p4, c, r, r);
};


/*****
*
*   intersectBezier3Ellipse
*
*****/
Intersection.intersectBezier3Ellipse = function(p1, p2, p3, p4, ec, rx, ry) {
    var a, b, c, d;       // temporary variables
    var c3, c2, c1, c0;   // coefficients of cubic
    var result = new Intersection("No Intersection");

    // Calculate the coefficients of cubic polynomial
    a = p1.multiply(-1);
    b = p2.multiply(3);
    c = p3.multiply(-3);
    d = a.add(b.add(c.add(p4)));
    c3 = new Vector2D(d.x, d.y);

    a = p1.multiply(3);
    b = p2.multiply(-6);
    c = p3.multiply(3);
    d = a.add(b.add(c));
    c2 = new Vector2D(d.x, d.y);

    a = p1.multiply(-3);
    b = p2.multiply(3);
    c = a.add(b);
    c1 = new Vector2D(c.x, c.y);

    c0 = new Vector2D(p1.x, p1.y);

    var rxrx  = rx*rx;
    var ryry  = ry*ry;
    var poly = new Polynomial(
        c3.x*c3.x*ryry + c3.y*c3.y*rxrx,
        2*(c3.x*c2.x*ryry + c3.y*c2.y*rxrx),
        2*(c3.x*c1.x*ryry + c3.y*c1.y*rxrx) + c2.x*c2.x*ryry + c2.y*c2.y*rxrx,
        2*c3.x*ryry*(c0.x - ec.x) + 2*c3.y*rxrx*(c0.y - ec.y) +
            2*(c2.x*c1.x*ryry + c2.y*c1.y*rxrx),
        2*c2.x*ryry*(c0.x - ec.x) + 2*c2.y*rxrx*(c0.y - ec.y) +
            c1.x*c1.x*ryry + c1.y*c1.y*rxrx,
        2*c1.x*ryry*(c0.x - ec.x) + 2*c1.y*rxrx*(c0.y - ec.y),
        c0.x*c0.x*ryry - 2*c0.y*ec.y*rxrx - 2*c0.x*ec.x*ryry +
            c0.y*c0.y*rxrx + ec.x*ec.x*ryry + ec.y*ec.y*rxrx - rxrx*ryry
    );
    var roots = poly.getRootsInInterval(0,1);

    for ( var i = 0; i < roots.length; i++ ) {
        var t = roots[i];

        result.points.push(
            c3.multiply(t*t*t).add(c2.multiply(t*t).add(c1.multiply(t).add(c0)))
        );
    }

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectBezier3Line
*
*   Many thanks to Dan Sunday at SoftSurfer.com.  He gave me a very thorough
*   sketch of the algorithm used here.  Without his help, I'm not sure when I
*   would have figured out this intersection problem.
*
*****/
Intersection.intersectBezier3Line = function(p1, p2, p3, p4, a1, a2) {
    var a, b, c, d;       // temporary variables
    var c3, c2, c1, c0;   // coefficients of cubic
    var cl;               // c coefficient for normal form of line
    var n;                // normal for normal form of line
    var min = a1.min(a2); // used to determine if point is on line segment
    var max = a1.max(a2); // used to determine if point is on line segment
    var result = new Intersection("No Intersection");
    
    // Start with Bezier using Bernstein polynomials for weighting functions:
    //     (1-t^3)P1 + 3t(1-t)^2P2 + 3t^2(1-t)P3 + t^3P4
    //
    // Expand and collect terms to form linear combinations of original Bezier
    // controls.  This ends up with a vector cubic in t:
    //     (-P1+3P2-3P3+P4)t^3 + (3P1-6P2+3P3)t^2 + (-3P1+3P2)t + P1
    //             /\                  /\                /\       /\
    //             ||                  ||                ||       ||
    //             c3                  c2                c1       c0
    
    // Calculate the coefficients
    a = p1.multiply(-1);
    b = p2.multiply(3);
    c = p3.multiply(-3);
    d = a.add(b.add(c.add(p4)));
    c3 = new Vector2D(d.x, d.y);

    a = p1.multiply(3);
    b = p2.multiply(-6);
    c = p3.multiply(3);
    d = a.add(b.add(c));
    c2 = new Vector2D(d.x, d.y);

    a = p1.multiply(-3);
    b = p2.multiply(3);
    c = a.add(b);
    c1 = new Vector2D(c.x, c.y);

    c0 = new Vector2D(p1.x, p1.y);
    
    // Convert line to normal form: ax + by + c = 0
    // Find normal to line: negative inverse of original line's slope
    n = new Vector2D(a1.y - a2.y, a2.x - a1.x);
    
    // Determine new c coefficient
    cl = a1.x*a2.y - a2.x*a1.y;

    // ?Rotate each cubic coefficient using line for new coordinate system?
    // Find roots of rotated cubic
    roots = new Polynomial(
        n.dot(c3),
        n.dot(c2),
        n.dot(c1),
        n.dot(c0) + cl
    ).getRoots();

    // Any roots in closed interval [0,1] are intersections on Bezier, but
    // might not be on the line segment.
    // Find intersections and calculate point coordinates
    for ( var i = 0; i < roots.length; i++ ) {
        var t = roots[i];

        if ( 0 <= t && t <= 1 ) {
            // We're within the Bezier curve
            // Find point on Bezier
            var p5 = p1.lerp(p2, t);
            var p6 = p2.lerp(p3, t);
            var p7 = p3.lerp(p4, t);

            var p8 = p5.lerp(p6, t);
            var p9 = p6.lerp(p7, t);

            var p10 = p8.lerp(p9, t);

            // See if point is on line segment
            // Had to make special cases for vertical and horizontal lines due
            // to slight errors in calculation of p10
            if ( a1.x == a2.x ) {
                if ( min.y <= p10.y && p10.y <= max.y ) {
                    result.status = "Intersection";
                    result.appendPoint( p10 );
                }
            } else if ( a1.y == a2.y ) {
                if ( min.x <= p10.x && p10.x <= max.x ) {
                    result.status = "Intersection";
                    result.appendPoint( p10 );
                }
            } else if ( p10.gte(min) && p10.lte(max) ) {
                result.status = "Intersection";
                result.appendPoint( p10 );
            }
        }
    }

    return result;
};


/*****
*
*   intersectBezier3Polygon
*
*****/
Intersection.intersectBezier3Polygon = function(p1, p2, p3, p4, points) {
    var result = new Intersection("No Intersection");
    var length = points.length;

    for ( var i = 0; i < length; i++ ) {
        var a1 = points[i];
        var a2 = points[(i+1) % length];
        var inter = Intersection.intersectBezier3Line(p1, p2, p3, p4, a1, a2);

        result.appendPoints(inter.points);
    }

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectBezier3Rectangle
*
*****/
Intersection.intersectBezier3Rectangle = function(p1, p2, p3, p4, r1, r2) {
    var min        = r1.min(r2);
    var max        = r1.max(r2);
    var topRight   = new Point2D( max.x, min.y );
    var bottomLeft = new Point2D( min.x, max.y );
    
    var inter1 = Intersection.intersectBezier3Line(p1, p2, p3, p4, min, topRight);
    var inter2 = Intersection.intersectBezier3Line(p1, p2, p3, p4, topRight, max);
    var inter3 = Intersection.intersectBezier3Line(p1, p2, p3, p4, max, bottomLeft);
    var inter4 = Intersection.intersectBezier3Line(p1, p2, p3, p4, bottomLeft, min);
    
    var result = new Intersection("No Intersection");

    result.appendPoints(inter1.points);
    result.appendPoints(inter2.points);
    result.appendPoints(inter3.points);
    result.appendPoints(inter4.points);

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectCircleCircle
*
*****/
Intersection.intersectCircleCircle = function(c1, r1, c2, r2) {
    var result;
    
    // Determine minimum and maximum radii where circles can intersect
    var r_max = r1 + r2;
    var r_min = Math.abs(r1 - r2);
    
    // Determine actual distance between circle circles
    var c_dist = c1.distanceFrom( c2 );

    if ( c_dist > r_max ) {
        result = new Intersection("Outside");
    } else if ( c_dist < r_min ) {
        result = new Intersection("Inside");
    } else {
        result = new Intersection("Intersection");

        var a = (r1*r1 - r2*r2 + c_dist*c_dist) / ( 2*c_dist );
        var h = Math.sqrt(r1*r1 - a*a);
        var p = c1.lerp(c2, a/c_dist);
        var b = h / c_dist;

        result.points.push(
            new Point2D(
                p.x - b * (c2.y - c1.y),
                p.y + b * (c2.x - c1.x)
            )
        );
        result.points.push(
            new Point2D(
                p.x + b * (c2.y - c1.y),
                p.y - b * (c2.x - c1.x)
            )
        );
    }

    return result;
};


/*****
*
*   intersectCircleEllipse
*
*****/
Intersection.intersectCircleEllipse = function(cc, r, ec, rx, ry) {
    return Intersection.intersectEllipseEllipse(cc, r, r, ec, rx, ry);
};


/*****
*
*   intersectCircleLine
*
*****/
Intersection.intersectCircleLine = function(c, r, a1, a2) {
    var result;
    var a  = (a2.x - a1.x) * (a2.x - a1.x) +
             (a2.y - a1.y) * (a2.y - a1.y);
    var b  = 2 * ( (a2.x - a1.x) * (a1.x - c.x) +
                   (a2.y - a1.y) * (a1.y - c.y)   );
    var cc = c.x*c.x + c.y*c.y + a1.x*a1.x + a1.y*a1.y -
             2 * (c.x * a1.x + c.y * a1.y) - r*r;
    var deter = b*b - 4*a*cc;

    if ( deter < 0 ) {
        result = new Intersection("Outside");
    } else if ( deter == 0 ) {
        result = new Intersection("Tangent");
        // NOTE: should calculate this point
    } else {
        var e  = Math.sqrt(deter);
        var u1 = ( -b + e ) / ( 2*a );
        var u2 = ( -b - e ) / ( 2*a );

        if ( (u1 < 0 || u1 > 1) && (u2 < 0 || u2 > 1) ) {
            if ( (u1 < 0 && u2 < 0) || (u1 > 1 && u2 > 1) ) {
                result = new Intersection("Outside");
            } else {
                result = new Intersection("Inside");
            }
        } else {
            result = new Intersection("Intersection");

            if ( 0 <= u1 && u1 <= 1)
                result.points.push( a1.lerp(a2, u1) );

            if ( 0 <= u2 && u2 <= 1)
                result.points.push( a1.lerp(a2, u2) );
        }
    }
    
    return result;
};


/*****
*
*   intersectCirclePolygon
*
*****/
Intersection.intersectCirclePolygon = function(c, r, points) {
    var result = new Intersection("No Intersection");
    var length = points.length;
    var inter;

    for ( var i = 0; i < length; i++ ) {
        var a1 = points[i];
        var a2 = points[(i+1) % length];

        inter = Intersection.intersectCircleLine(c, r, a1, a2);
        result.appendPoints(inter.points);
    }

    if ( result.points.length > 0 )
        result.status = "Intersection";
    else
        result.status = inter.status;

    return result;
};


/*****
*
*   intersectCircleRectangle
*
*****/
Intersection.intersectCircleRectangle = function(c, r, r1, r2) {
    var min        = r1.min(r2);
    var max        = r1.max(r2);
    var topRight   = new Point2D( max.x, min.y );
    var bottomLeft = new Point2D( min.x, max.y );
    
    var inter1 = Intersection.intersectCircleLine(c, r, min, topRight);
    var inter2 = Intersection.intersectCircleLine(c, r, topRight, max);
    var inter3 = Intersection.intersectCircleLine(c, r, max, bottomLeft);
    var inter4 = Intersection.intersectCircleLine(c, r, bottomLeft, min);
    
    var result = new Intersection("No Intersection");

    result.appendPoints(inter1.points);
    result.appendPoints(inter2.points);
    result.appendPoints(inter3.points);
    result.appendPoints(inter4.points);

    if ( result.points.length > 0 )
        result.status = "Intersection";
    else
        result.status = inter1.status;

    return result;
};


/*****
*
*   intersectEllipseEllipse
*   
*   This code is based on MgcIntr2DElpElp.cpp written by David Eberly.  His
*   code along with many other excellent examples are avaiable at his site:
*   http://www.magic-software.com
*
*   NOTE: Rotation will need to be added to this function
*
*****/
Intersection.intersectEllipseEllipse = function(c1, rx1, ry1, c2, rx2, ry2) {
    var a = [
        ry1*ry1, 0, rx1*rx1, -2*ry1*ry1*c1.x, -2*rx1*rx1*c1.y,
        ry1*ry1*c1.x*c1.x + rx1*rx1*c1.y*c1.y - rx1*rx1*ry1*ry1
    ];
    var b = [
        ry2*ry2, 0, rx2*rx2, -2*ry2*ry2*c2.x, -2*rx2*rx2*c2.y,
        ry2*ry2*c2.x*c2.x + rx2*rx2*c2.y*c2.y - rx2*rx2*ry2*ry2
    ];

    var yPoly   = Intersection.bezout(a, b);
    var yRoots  = yPoly.getRoots();
    var epsilon = 1e-3;
    var norm0   = ( a[0]*a[0] + 2*a[1]*a[1] + a[2]*a[2] ) * epsilon;
    var norm1   = ( b[0]*b[0] + 2*b[1]*b[1] + b[2]*b[2] ) * epsilon;
    var result  = new Intersection("No Intersection");

    for ( var y = 0; y < yRoots.length; y++ ) {
        var xPoly = new Polynomial(
            a[0],
            a[3] + yRoots[y] * a[1],
            a[5] + yRoots[y] * (a[4] + yRoots[y]*a[2])
        );
        var xRoots = xPoly.getRoots();

        for ( var x = 0; x < xRoots.length; x++ ) {
            var test =
                ( a[0]*xRoots[x] + a[1]*yRoots[y] + a[3] ) * xRoots[x] + 
                ( a[2]*yRoots[y] + a[4] ) * yRoots[y] + a[5];
            if ( Math.abs(test) < norm0 ) {
                test =
                    ( b[0]*xRoots[x] + b[1]*yRoots[y] + b[3] ) * xRoots[x] +
                    ( b[2]*yRoots[y] + b[4] ) * yRoots[y] + b[5];
                if ( Math.abs(test) < norm1 ) {
                    result.appendPoint( new Point2D( xRoots[x], yRoots[y] ) );
                }
            }
        }
    }

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectEllipseLine
*   
*   NOTE: Rotation will need to be added to this function
*
*****/
Intersection.intersectEllipseLine = function(c, rx, ry, a1, a2) {
    var result;
    var origin = new Vector2D(a1.x, a1.y);
    var dir    = Vector2D.fromPoints(a1, a2);
    var center = new Vector2D(c.x, c.y);
    var diff   = origin.subtract(center);
    var mDir   = new Vector2D( dir.x/(rx*rx),  dir.y/(ry*ry)  );
    var mDiff  = new Vector2D( diff.x/(rx*rx), diff.y/(ry*ry) );

    var a = dir.dot(mDir);
    var b = dir.dot(mDiff);
    var c = diff.dot(mDiff) - 1.0;
    var d = b*b - a*c;

    if ( d < 0 ) {
        result = new Intersection("Outside");
    } else if ( d > 0 ) {
        var root = Math.sqrt(d);
        var t_a  = (-b - root) / a;
        var t_b  = (-b + root) / a;

        if ( (t_a < 0 || 1 < t_a) && (t_b < 0 || 1 < t_b) ) {
            if ( (t_a < 0 && t_b < 0) || (t_a > 1 && t_b > 1) )
                result = new Intersection("Outside");
            else
                result = new Intersection("Inside");
        } else {
            result = new Intersection("Intersection");
            if ( 0 <= t_a && t_a <= 1 )
                result.appendPoint( a1.lerp(a2, t_a) );
            if ( 0 <= t_b && t_b <= 1 )
                result.appendPoint( a1.lerp(a2, t_b) );
        }
    } else {
        var t = -b/a;
        if ( 0 <= t && t <= 1 ) {
            result = new Intersection("Intersection");
            result.appendPoint( a1.lerp(a2, t) );
        } else {
            result = new Intersection("Outside");
        }
    }
    
    return result;
};


/*****
*
*   intersectEllipsePolygon
*
*****/
Intersection.intersectEllipsePolygon = function(c, rx, ry, points) {
    var result = new Intersection("No Intersection");
    var length = points.length;

    for ( var i = 0; i < length; i++ ) {
        var b1 = points[i];
        var b2 = points[(i+1) % length];
        var inter = Intersection.intersectEllipseLine(c, rx, ry, b1, b2);

        result.appendPoints(inter.points);
    }

    if ( result.points.length > 0 )
        result.status = "Intersection";

    return result;
};


/*****
*
*   intersectEllipseRectangle
*
*****/
Intersection.intersectEllipseRectangle = function(c, rx, ry, r1, r2) {
    var min        = r1.min(r2);
    var max        = r1.max(r2);
    var topRight   = new Point2D( max.x, min.y );
    var bottomLeft = new Point2D( min.x, max.y );
    
    var inter1 = Intersection.intersectEllipseLine(c, rx, ry, min, topRight);
    var inter2 = Intersection.intersectEllipseLine(c, rx, ry, topRight, max);
    var inter3 = Intersection.intersectEllipseLine(c, rx, ry, max, bottomLeft);
    var inter4 = Intersection.intersectEllipseLine(c, rx, ry, bottomLeft, min);
    
    var result = new Intersection("No Intersection");

    result.appendPoints(inter1.points);
    result.appendPoints(inter2.points);
    result.appendPoints(inter3.points);
    result.appendPoints(inter4.points);

    if ( result.points.length > 0 )
        result.status = "Intersection";

    return result;
};


/*****
*
*   intersectLineLine
*
*****/
Intersection.intersectLineLine = function(a1, a2, b1, b2) {
    var result;
    
    var ua_t = (b2.x - b1.x) * (a1.y - b1.y) - (b2.y - b1.y) * (a1.x - b1.x);
    var ub_t = (a2.x - a1.x) * (a1.y - b1.y) - (a2.y - a1.y) * (a1.x - b1.x);
    var u_b  = (b2.y - b1.y) * (a2.x - a1.x) - (b2.x - b1.x) * (a2.y - a1.y);

    if ( u_b != 0 ) {
        var ua = ua_t / u_b;
        var ub = ub_t / u_b;

        if ( 0 <= ua && ua <= 1 && 0 <= ub && ub <= 1 ) {
            result = new Intersection("Intersection");
            result.points.push(
                new Point2D(
                    a1.x + ua * (a2.x - a1.x),
                    a1.y + ua * (a2.y - a1.y)
                )
            );
        } else {
            result = new Intersection("No Intersection");
        }
    } else {
        if ( ua_t == 0 || ub_t == 0 ) {
            result = new Intersection("Coincident");
        } else {
            result = new Intersection("Parallel");
        }
    }

    return result;
};


/*****
*
*   intersectLinePolygon
*
*****/
Intersection.intersectLinePolygon = function(a1, a2, points) {
    var result = new Intersection("No Intersection");
    var length = points.length;

    for ( var i = 0; i < length; i++ ) {
        var b1 = points[i];
        var b2 = points[(i+1) % length];
        var inter = Intersection.intersectLineLine(a1, a2, b1, b2);

        result.appendPoints(inter.points);
    }

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   intersectLineRectangle
*
*****/
Intersection.intersectLineRectangle = function(a1, a2, r1, r2) {
    var min        = r1.min(r2);
    var max        = r1.max(r2);
    var topRight   = new Point2D( max.x, min.y );
    var bottomLeft = new Point2D( min.x, max.y );
    
    var inter1 = Intersection.intersectLineLine(min, topRight, a1, a2);
    var inter2 = Intersection.intersectLineLine(topRight, max, a1, a2);
    var inter3 = Intersection.intersectLineLine(max, bottomLeft, a1, a2);
    var inter4 = Intersection.intersectLineLine(bottomLeft, min, a1, a2);
    
    var result = new Intersection("No Intersection");

    result.appendPoints(inter1.points);
    result.appendPoints(inter2.points);
    result.appendPoints(inter3.points);
    result.appendPoints(inter4.points);

    if ( result.points.length > 0 )
        result.status = "Intersection";

    return result;
};


/*****
*
*   intersectPolygonPolygon
*
*****/
Intersection.intersectPolygonPolygon = function(points1, points2) {
    var result = new Intersection("No Intersection");
    var length = points1.length;

    for ( var i = 0; i < length; i++ ) {
        var a1 = points1[i];
        var a2 = points1[(i+1) % length];
        var inter = Intersection.intersectLinePolygon(a1, a2, points2);

        result.appendPoints(inter.points);
    }

    if ( result.points.length > 0 )
        result.status = "Intersection";

    return result;

};


/*****
*
*   intersectPolygonRectangle
*
*****/
Intersection.intersectPolygonRectangle = function(points, r1, r2) {
    var min        = r1.min(r2);
    var max        = r1.max(r2);
    var topRight   = new Point2D( max.x, min.y );
    var bottomLeft = new Point2D( min.x, max.y );
    
    var inter1 = Intersection.intersectLinePolygon(min, topRight, points);
    var inter2 = Intersection.intersectLinePolygon(topRight, max, points);
    var inter3 = Intersection.intersectLinePolygon(max, bottomLeft, points);
    var inter4 = Intersection.intersectLinePolygon(bottomLeft, min, points);
    
    var result = new Intersection("No Intersection");

    result.appendPoints(inter1.points);
    result.appendPoints(inter2.points);
    result.appendPoints(inter3.points);
    result.appendPoints(inter4.points);

    if ( result.points.length > 0 )
        result.status = "Intersection";

    return result;
};


/*****
*
*   intersectRayRay
*
*****/
Intersection.intersectRayRay = function(a1, a2, b1, b2) {
    var result;
    
    var ua_t = (b2.x - b1.x) * (a1.y - b1.y) - (b2.y - b1.y) * (a1.x - b1.x);
    var ub_t = (a2.x - a1.x) * (a1.y - b1.y) - (a2.y - a1.y) * (a1.x - b1.x);
    var u_b  = (b2.y - b1.y) * (a2.x - a1.x) - (b2.x - b1.x) * (a2.y - a1.y);

    if ( u_b != 0 ) {
        var ua = ua_t / u_b;

        result = new Intersection("Intersection");
        result.points.push(
            new Point2D(
                a1.x + ua * (a2.x - a1.x),
                a1.y + ua * (a2.y - a1.y)
            )
        );
    } else {
        if ( ua_t == 0 || ub_t == 0 ) {
            result = new Intersection("Coincident");
        } else {
            result = new Intersection("Parallel");
        }
    }

    return result;
};


/*****
*
*   intersectRectangleRectangle
*
*****/
Intersection.intersectRectangleRectangle = function(a1, a2, b1, b2) {
    var min        = a1.min(a2);
    var max        = a1.max(a2);
    var topRight   = new Point2D( max.x, min.y );
    var bottomLeft = new Point2D( min.x, max.y );
    
    var inter1 = Intersection.intersectLineRectangle(min, topRight, b1, b2);
    var inter2 = Intersection.intersectLineRectangle(topRight, max, b1, b2);
    var inter3 = Intersection.intersectLineRectangle(max, bottomLeft, b1, b2);
    var inter4 = Intersection.intersectLineRectangle(bottomLeft, min, b1, b2);
    
    var result = new Intersection("No Intersection");

    result.appendPoints(inter1.points);
    result.appendPoints(inter2.points);
    result.appendPoints(inter3.points);
    result.appendPoints(inter4.points);

    if ( result.points.length > 0 )
        result.status = "Intersection";

    return result;
};


/*****
*
*   bezout
*
*   This code is based on MgcIntr2DElpElp.cpp written by David Eberly.  His
*   code along with many other excellent examples are avaiable at his site:
*   http://www.magic-software.com
*
*****/
Intersection.bezout = function(e1, e2) {
    var AB    = e1[0]*e2[1] - e2[0]*e1[1];
    var AC    = e1[0]*e2[2] - e2[0]*e1[2];
    var AD    = e1[0]*e2[3] - e2[0]*e1[3];
    var AE    = e1[0]*e2[4] - e2[0]*e1[4];
    var AF    = e1[0]*e2[5] - e2[0]*e1[5];
    var BC    = e1[1]*e2[2] - e2[1]*e1[2];
    var BE    = e1[1]*e2[4] - e2[1]*e1[4];
    var BF    = e1[1]*e2[5] - e2[1]*e1[5];
    var CD    = e1[2]*e2[3] - e2[2]*e1[3];
    var DE    = e1[3]*e2[4] - e2[3]*e1[4];
    var DF    = e1[3]*e2[5] - e2[3]*e1[5];
    var BFpDE = BF + DE;
    var BEmCD = BE - CD;

    return new Polynomial(
        AB*BC - AC*AC,
        AB*BEmCD + AD*BC - 2*AC*AE,
        AB*BFpDE + AD*BEmCD - AE*AE - 2*AC*AF,
        AB*DF + AD*BFpDE - 2*AE*AF,
        AD*DF - AF*AF
    );
};

</script></body> </html>